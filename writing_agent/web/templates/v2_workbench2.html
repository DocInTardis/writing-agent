{% extends "v2_base2.html" %}
{% block content %}
<div class="app" data-doc-id="{{ doc_id }}">
  <header class="topbar">
    <div class="brand">
      <div class="brand-mark">写</div>
      <div class="brand-text">
        <div class="brand-title">写作助手</div>
        <div class="brand-sub">对话生成 · 模板排版 · 本地运行</div>
      </div>
    </div>
    <div class="top-actions">
      <button id="btnRibbonToggle" class="btn ghost" type="button">工具栏</button>
      <button id="btnDocList" class="btn ghost" type="button">文档列表</button>
      <button id="btnVersionHistory" class="btn ghost" type="button" title="版本历史 (Git-like)">版本</button>
      <button id="btnUndo" class="btn ghost" type="button" title="撤销 (Ctrl+Z)">撤销</button>
      <button id="btnRedo" class="btn ghost" type="button" title="重做 (Ctrl+Y)">重做</button>
      <button id="btnSettings" class="btn ghost" type="button" title="设置">⚙️</button>
      <button id="btnPerf" class="btn ghost" type="button" title="性能监控">📊</button>
      <button id="btnSave" class="btn ghost" type="button">保存</button>
      <button id="btnOpen" class="btn ghost" type="button">打开</button>
      <a class="btn ghost" id="btnDownload" href="/download/{{ doc_id }}.docx">导出 .docx</a>
      <button id="btnExportMore" class="btn ghost" type="button">导出其他格式</button>
      <a class="btn ghost" id="btnDownloadPdf" href="/download/{{ doc_id }}.pdf">导出 .pdf</a>
      <a id="btnNew" class="btn primary" href="/">新建空白</a>
    </div>
  </header>

  <div class="ribbon collapsed" id="ribbon">
    <div class="ribbon-tabs">
      <button class="ribbon-tab active" type="button" data-ribbon="home">开始</button>
      <button class="ribbon-tab" type="button" data-ribbon="insert">插入</button>
      <button class="ribbon-tab" type="button" data-ribbon="layout">布局</button>
      <button class="ribbon-tab" type="button" data-ribbon="review">审阅</button>
      <button class="ribbon-tab" type="button" data-ribbon="view">视图</button>
    </div>
    <div class="ribbon-body">
      <div class="ribbon-group" data-panel="home">
        <div class="ribbon-block flat">
          <button class="chip" type="button" data-action="bold">加粗</button>
          <button class="chip" type="button" data-action="italic">斜体</button>
          <button class="chip" type="button" data-action="underline">下划线</button>
          <button class="chip" type="button" data-action="strike">删除线</button>
          <button class="chip" type="button" data-action="heading1">标题1</button>
          <button class="chip" type="button" data-action="heading2">标题2</button>
          <button class="chip" type="button" data-action="heading3">标题3</button>
          <button class="chip" type="button" data-action="list-bullet">项目符号</button>
          <button class="chip" type="button" data-action="list-number">编号</button>
          <button class="chip" type="button" data-action="quote">引用</button>
          <button class="chip" type="button" data-action="clear-format">清除格式</button>
        </div>
      </div>
      <div class="ribbon-group hidden" data-panel="insert">
        <div class="ribbon-block flat">
          <button class="chip" type="button" data-action="insert-table">表格</button>
          <button class="chip" type="button" data-action="insert-figure">图片</button>
          <button class="chip" type="button" data-action="insert-chart">图表</button>
          <button class="chip" type="button" data-action="insert-link">链接</button>
          <button class="chip" type="button" data-action="insert-citation">引用标记</button>
          <button class="chip" type="button" data-action="insert-template">模板片段</button>
        </div>
      </div>
      <div class="ribbon-group hidden" data-panel="layout">
        <div class="ribbon-block flat">
          <button class="chip" type="button" data-action="margin-normal">标准边距</button>
          <button class="chip" type="button" data-action="margin-narrow">窄边距</button>
          <button class="chip" type="button" data-action="line-compact">紧凑行距</button>
          <button class="chip" type="button" data-action="line-normal">标准行距</button>
        </div>
      </div>
      <div class="ribbon-group hidden" data-panel="review">
        <div class="ribbon-block flat">
          <button class="chip" type="button" data-action="check-issues">检查问题</button>
          <button class="chip" type="button" data-action="word-count">字数统计</button>
          <button class="chip" type="button" data-action="find-replace">查找替换</button>
          <button class="chip" type="button" data-action="ai-polish">AI润色</button>
          <button class="chip" type="button" data-action="ai-expand">AI扩写</button>
          <button class="chip" type="button" data-action="ai-summarize">AI摘要</button>
        </div>
      </div>
      <div class="ribbon-group hidden" data-panel="view">
        <div class="ribbon-block flat">
          <button class="chip" type="button" data-action="view-edit">编辑</button>
          <button class="chip" type="button" data-action="view-preview">预览</button>
        </div>
      </div>
    </div>
  </div>

  <div class="statusbar">
    <div class="status-left">
      <input id="docTitle" class="doc-title-input" type="text" placeholder="文档标题" />
      <span class="status-label">生成流程</span>
      <span id="flowStatus" class="pill">就绪</span>
      <div id="progressBar" class="progress-bar hidden">
        <div class="progress-track">
          <div id="progressFill" class="progress-fill" style="width: 0%"></div>
        </div>
        <span id="progressText" class="progress-text">0%</span>
      </div>
    </div>
    <div class="status-right">
      <span id="docStatus" class="pill ghost">就绪</span>
      <span id="wordCount" class="muted"></span>
    </div>
  </div>

  <main class="layout">
    <section class="panel doc">
      <div class="panel-head">
        <div class="tabs">
          <button class="tab active" data-tab="edit" type="button">编辑</button>
          <button class="tab" data-tab="preview" type="button">预览</button>
        </div>
        <div class="panel-actions">
          <button id="btnRevise" class="btn ghost" type="button">修改润色</button>
          <button id="btnStop" class="btn ghost" type="button" disabled>停止</button>
        </div>
      </div>
      <div class="doc-body">
        <textarea id="source" class="source"></textarea>
        <div id="preview" class="paper hidden"></div>
        <div id="emptyState" class="empty-state hidden" aria-hidden="true">
          <div class="thinker">
            <div class="thinker-head"></div>
            <div class="thinker-body"></div>
            <div class="thinker-bubble"></div>
          </div>
          <div class="empty-text">空白文档，先说说你要写什么吧</div>
        </div>
      </div>
    </section>

    <aside class="panel side">
      <div class="panel-head">
        <div class="side-title">对话写作</div>
        <div class="muted">输入需求，系统会自动理解并生成文档。</div>
      </div>
      <div class="side-body">
        <div class="chat-card">
          <div id="thinkingPanel" class="thinking-panel">
            <div class="thinking-title">思考摘要</div>
            <div id="thinkingSummary" class="thinking-summary muted">等待解析…</div>
            <div class="thinking-steps-title">关键步骤</div>
            <ol id="thinkingSteps" class="thinking-steps"></ol>
            <div class="thinking-steps-title">思考链</div>
            <div id="thinkingTimeline" class="thinking-timeline"></div>
            <ul id="thinkingMissing" class="thinking-missing"></ul>
          </div>
          <div id="chatHistory" class="chat-history"></div>
          <div class="composer">
            <textarea id="instruction" class="input composer-input" placeholder="例如：生成一个不限内容的周报&#10;提示：Ctrl+Enter 快速发送"></textarea>
            <button id="btnGenerate" class="btn send" type="button" title="发送指令 (Ctrl+Enter)">发送</button>
          </div>
        </div>
      </div>
    </aside>
  </main>
</div>
<input id="importFile" class="hidden-input" type="file" accept=".doc,.docx,.txt,.md,.pdf,.html,.htm" />
{% endblock %}