var af=Object.defineProperty;var Rl=t=>{throw TypeError(t)};var lf=(t,e,n)=>e in t?af(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var vr=(t,e,n)=>lf(t,typeof e!="symbol"?e+"":e,n),ha=(t,e,n)=>e.has(t)||Rl("Cannot "+n);var q=(t,e,n)=>(ha(t,e,"read from private field"),n?n.call(t):e.get(t)),$t=(t,e,n)=>e.has(t)?Rl("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),bt=(t,e,n,r)=>(ha(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n),Pe=(t,e,n)=>(ha(t,e,"access private method"),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const Ze=2,Ao=4,Vs=8,uc=1<<24,Kr=16,_r=32,Fi=64,Ha=128,er=512,Le=1024,dn=2048,Nr=4096,Pn=8192,Jr=16384,Fo=32768,ds=65536,Pl=1<<17,fc=1<<18,bs=1<<19,dc=1<<20,Hr=1<<25,Mi=32768,wa=1<<21,za=1<<22,fi=1<<23,Ur=Symbol("$state"),vc=Symbol("legacy props"),cf=Symbol(""),ts=new class extends Error{constructor(){super(...arguments);vr(this,"name","StaleReactionError");vr(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}},Bo=3,Bi=8,Sa=!1;var Ks=Array.isArray,uf=Array.prototype.indexOf,vs=Array.prototype.includes,Ro=Array.from,Ja=Object.defineProperty,ns=Object.getOwnPropertyDescriptor,pc=Object.getOwnPropertyDescriptors,ff=Object.prototype,df=Array.prototype,Ua=Object.getPrototypeOf,Hl=Object.isExtensible;const di=()=>{};function vf(t){return t()}function qo(t){for(var e=0;e<t.length;e++)t[e]()}function hc(){var t,e,n=new Promise((r,s)=>{t=r,e=s});return{promise:n,resolve:t,reject:e}}function gc(t){return t===this.v}function mc(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function bc(t){return!mc(t,this.v)}function _c(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function pf(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function hf(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function gf(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function mf(t){throw new Error("https://svelte.dev/e/effect_orphan")}function bf(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function _f(){throw new Error("https://svelte.dev/e/hydration_failed")}function yf(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function wf(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Sf(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function xf(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function kf(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}let _s=!1,$f=!1;function Ef(){_s=!0}const Tf=1,Af=2,yc=4,qf=8,Cf=16,jf=2,If=8,Mf=1,Nf=2,wc="[",Po="[!",Wa="]",Ni={},Ke=Symbol(),Of="http://www.w3.org/1999/xhtml";let de=null;function ps(t){de=t}function Hn(t,e=!1,n){de={p:de,i:!1,c:null,e:null,s:t,x:null,l:_s&&!e?{s:null,u:null,$:[]}:null}}function zn(t){var e=de,n=e.e;if(n!==null){e.e=null;for(var r of n)Xc(r)}return t!==void 0&&(e.x=t),e.i=!0,de=e.p,t??{}}function Gs(){return!_s||de!==null&&de.l===null}let Si=[];function Sc(){var t=Si;Si=[],qo(t)}function Cr(t){if(Si.length===0&&!Fs){var e=Si;queueMicrotask(()=>{e===Si&&Sc()})}Si.push(t)}function Lf(){for(;Si.length>0;)Sc()}function Xs(t){console.warn("https://svelte.dev/e/hydration_mismatch")}function Df(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Ff(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}let Et=!1;function zr(t){Et=t}let qt;function fn(t){if(t===null)throw Xs(),Ni;return qt=t}function Oi(){return fn(yr(qt))}function _(t){if(Et){if(yr(qt)!==null)throw Xs(),Ni;qt=t}}function Ps(t=1){if(Et){for(var e=t,n=qt;e--;)n=yr(n);qt=n}}function Co(t=!0){for(var e=0,n=qt;;){if(n.nodeType===Bi){var r=n.data;if(r===Wa){if(e===0)return n;e-=1}else(r===wc||r===Po)&&(e+=1)}var s=yr(n);t&&n.remove(),n=s}}function xc(t){if(!t||t.nodeType!==Bi)throw Xs(),Ni;return t.data}function es(t){if(typeof t!="object"||t===null||Ur in t)return t;const e=Ua(t);if(e!==ff&&e!==df)return t;var n=new Map,r=Ks(t),s=ni(0),o=Ci,l=a=>{if(Ci===o)return a();var f=Mt,p=Ci;ir(null),Kl(o);var m=a();return ir(f),Kl(p),m};return r&&n.set("length",ni(t.length)),new Proxy(t,{defineProperty(a,f,p){(!("value"in p)||p.configurable===!1||p.enumerable===!1||p.writable===!1)&&wf();var m=n.get(f);return m===void 0?m=l(()=>{var S=ni(p.value);return n.set(f,S),S}):g(m,p.value,!0),!0},deleteProperty(a,f){var p=n.get(f);if(p===void 0){if(f in a){const m=l(()=>ni(Ke));n.set(f,m),Bs(s)}}else g(p,Ke),Bs(s);return!0},get(a,f,p){var I;if(f===Ur)return t;var m=n.get(f),S=f in a;if(m===void 0&&(!S||(I=ns(a,f))!=null&&I.writable)&&(m=l(()=>{var M=es(S?a[f]:Ke),B=ni(M);return B}),n.set(f,m)),m!==void 0){var $=i(m);return $===Ke?void 0:$}return Reflect.get(a,f,p)},getOwnPropertyDescriptor(a,f){var p=Reflect.getOwnPropertyDescriptor(a,f);if(p&&"value"in p){var m=n.get(f);m&&(p.value=i(m))}else if(p===void 0){var S=n.get(f),$=S==null?void 0:S.v;if(S!==void 0&&$!==Ke)return{enumerable:!0,configurable:!0,value:$,writable:!0}}return p},has(a,f){var $;if(f===Ur)return!0;var p=n.get(f),m=p!==void 0&&p.v!==Ke||Reflect.has(a,f);if(p!==void 0||Rt!==null&&(!m||($=ns(a,f))!=null&&$.writable)){p===void 0&&(p=l(()=>{var I=m?es(a[f]):Ke,M=ni(I);return M}),n.set(f,p));var S=i(p);if(S===Ke)return!1}return m},set(a,f,p,m){var et;var S=n.get(f),$=f in a;if(r&&f==="length")for(var I=p;I<S.v;I+=1){var M=n.get(I+"");M!==void 0?g(M,Ke):I in a&&(M=l(()=>ni(Ke)),n.set(I+"",M))}if(S===void 0)(!$||(et=ns(a,f))!=null&&et.writable)&&(S=l(()=>ni(void 0)),g(S,es(p)),n.set(f,S));else{$=S.v!==Ke;var B=l(()=>es(p));g(S,B)}var j=Reflect.getOwnPropertyDescriptor(a,f);if(j!=null&&j.set&&j.set.call(m,p),!$){if(r&&typeof f=="string"){var J=n.get("length"),ft=Number(f);Number.isInteger(ft)&&ft>=J.v&&g(J,ft+1)}Bs(s)}return!0},ownKeys(a){i(s);var f=Reflect.ownKeys(a).filter(S=>{var $=n.get(S);return $===void 0||$.v!==Ke});for(var[p,m]of n)m.v!==Ke&&!(p in a)&&f.push(p);return f},setPrototypeOf(){Sf()}})}function zl(t){try{if(t!==null&&typeof t=="object"&&Ur in t)return t[Ur]}catch{}return t}function Bf(t,e){return Object.is(zl(t),zl(e))}var Jl,kc,$c,Ec;function xa(){if(Jl===void 0){Jl=window,kc=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,n=Text.prototype;$c=ns(e,"firstChild").get,Ec=ns(e,"nextSibling").get,Hl(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),Hl(n)&&(n.__t=void 0)}}function nr(t=""){return document.createTextNode(t)}function tr(t){return $c.call(t)}function yr(t){return Ec.call(t)}function w(t,e){if(!Et)return tr(t);var n=tr(qt);if(n===null)n=qt.appendChild(nr());else if(e&&n.nodeType!==Bo){var r=nr();return n==null||n.before(r),fn(r),r}return e&&Ka(n),fn(n),n}function Ee(t,e=!1){if(!Et){var n=tr(t);return n instanceof Comment&&n.data===""?yr(n):n}if(e){if((qt==null?void 0:qt.nodeType)!==Bo){var r=nr();return qt==null||qt.before(r),fn(r),r}Ka(qt)}return qt}function h(t,e=1,n=!1){let r=Et?qt:t;for(var s;e--;)s=r,r=yr(r);if(!Et)return r;if(n){if((r==null?void 0:r.nodeType)!==Bo){var o=nr();return r===null?s==null||s.after(o):r.before(o),fn(o),o}Ka(r)}return fn(r),r}function Va(t){t.textContent=""}function Tc(){return!1}function Ka(t){if(t.nodeValue.length<65536)return;let e=t.nextSibling;for(;e!==null&&e.nodeType===Bo;)e.remove(),t.nodeValue+=e.nodeValue,e=t.nextSibling}function Ac(t){var e=Rt;if(e===null)return Mt.f|=fi,t;if(e.f&Fo)hs(t,e);else{if(!(e.f&Ha))throw t;e.b.error(t)}}function hs(t,e){for(;e!==null;){if(e.f&Ha)try{e.b.error(t);return}catch(n){t=n}e=e.parent}throw t}const Rf=-7169;function je(t,e){t.f=t.f&Rf|e}function Ga(t){t.f&er||t.deps===null?je(t,Le):je(t,Nr)}function qc(t){if(t!==null)for(const e of t)!(e.f&Ze)||!(e.f&Mi)||(e.f^=Mi,qc(e.deps))}function Cc(t,e,n){t.f&dn?e.add(t):t.f&Nr&&n.add(t),qc(t.deps),je(t,Le)}const bo=new Set;let wt=null,jo=null,Ye=null,Rn=[],Ho=null,ka=!1,Fs=!1;var ss,os,ki,as,Hs,zs,$i,ls,Mr,$a,Ea,jc;const ul=class ul{constructor(){$t(this,Mr);vr(this,"committed",!1);vr(this,"current",new Map);vr(this,"previous",new Map);$t(this,ss,new Set);$t(this,os,new Set);$t(this,ki,0);$t(this,as,0);$t(this,Hs,null);$t(this,zs,new Set);$t(this,$i,new Set);vr(this,"skipped_effects",new Set);vr(this,"is_fork",!1);$t(this,ls,!1)}is_deferred(){return this.is_fork||q(this,as)>0}process(e){var s;Rn=[],this.apply();var n=[],r=[];for(const o of e)Pe(this,Mr,$a).call(this,o,n,r);if(this.is_deferred()){Pe(this,Mr,Ea).call(this,r),Pe(this,Mr,Ea).call(this,n);for(const o of this.skipped_effects)Oc(o)}else{for(const o of q(this,ss))o();q(this,ss).clear(),q(this,ki)===0&&Pe(this,Mr,jc).call(this),jo=this,wt=null,Ul(r),Ul(n),jo=null,(s=q(this,Hs))==null||s.resolve()}Ye=null}capture(e,n){n!==Ke&&!this.previous.has(e)&&this.previous.set(e,n),e.f&fi||(this.current.set(e,e.v),Ye==null||Ye.set(e,e.v))}activate(){wt=this,this.apply()}deactivate(){wt===this&&(wt=null,Ye=null)}flush(){if(this.activate(),Rn.length>0){if(Ic(),wt!==null&&wt!==this)return}else q(this,ki)===0&&this.process([]);this.deactivate()}discard(){for(const e of q(this,os))e(this);q(this,os).clear()}increment(e){bt(this,ki,q(this,ki)+1),e&&bt(this,as,q(this,as)+1)}decrement(e){bt(this,ki,q(this,ki)-1),e&&bt(this,as,q(this,as)-1),!q(this,ls)&&(bt(this,ls,!0),Cr(()=>{bt(this,ls,!1),this.is_deferred()?Rn.length>0&&this.flush():this.revive()}))}revive(){for(const e of q(this,zs))q(this,$i).delete(e),je(e,dn),Wr(e);for(const e of q(this,$i))je(e,Nr),Wr(e);this.flush()}oncommit(e){q(this,ss).add(e)}ondiscard(e){q(this,os).add(e)}settled(){return(q(this,Hs)??bt(this,Hs,hc())).promise}static ensure(){if(wt===null){const e=wt=new ul;bo.add(wt),Fs||Cr(()=>{wt===e&&e.flush()})}return wt}apply(){}};ss=new WeakMap,os=new WeakMap,ki=new WeakMap,as=new WeakMap,Hs=new WeakMap,zs=new WeakMap,$i=new WeakMap,ls=new WeakMap,Mr=new WeakSet,$a=function(e,n,r){e.f^=Le;for(var s=e.first,o=null;s!==null;){var l=s.f,a=(l&(_r|Fi))!==0,f=a&&(l&Le)!==0,p=f||(l&Pn)!==0||this.skipped_effects.has(s);if(!p&&s.fn!==null){a?s.f^=Le:o!==null&&l&(Ao|Vs|uc)?o.b.defer_effect(s):l&Ao?n.push(s):ys(s)&&(l&Kr&&q(this,$i).add(s),gs(s));var m=s.first;if(m!==null){s=m;continue}}var S=s.parent;for(s=s.next;s===null&&S!==null;)S===o&&(o=null),s=S.next,S=S.parent}},Ea=function(e){for(var n=0;n<e.length;n+=1)Cc(e[n],q(this,zs),q(this,$i))},jc=function(){var s;if(bo.size>1){this.previous.clear();var e=Ye,n=!0;for(const o of bo){if(o===this){n=!1;continue}const l=[];for(const[f,p]of this.current){if(o.current.has(f))if(n&&p!==o.current.get(f))o.current.set(f,p);else continue;l.push(f)}if(l.length===0)continue;const a=[...o.current.keys()].filter(f=>!this.current.has(f));if(a.length>0){var r=Rn;Rn=[];const f=new Set,p=new Map;for(const m of l)Mc(m,a,f,p);if(Rn.length>0){wt=o,o.apply();for(const m of Rn)Pe(s=o,Mr,$a).call(s,m,[],[]);o.deactivate()}Rn=r}}wt=null,Ye=e}this.committed=!0,bo.delete(this)};let vi=ul;function an(t){var e=Fs;Fs=!0;try{for(var n;;){if(Lf(),Rn.length===0&&(wt==null||wt.flush(),Rn.length===0))return Ho=null,n;Ic()}}finally{Fs=e}}function Ic(){ka=!0;var t=null;try{for(var e=0;Rn.length>0;){var n=vi.ensure();if(e++>1e3){var r,s;Pf()}n.process(Rn),pi.clear()}}finally{ka=!1,Ho=null}}function Pf(){try{bf()}catch(t){hs(t,Ho)}}let pr=null;function Ul(t){var e=t.length;if(e!==0){for(var n=0;n<e;){var r=t[n++];if(!(r.f&(Jr|Pn))&&ys(r)&&(pr=new Set,gs(r),r.deps===null&&r.first===null&&r.nodes===null&&(r.teardown===null&&r.ac===null?eu(r):r.fn=null),(pr==null?void 0:pr.size)>0)){pi.clear();for(const s of pr){if(s.f&(Jr|Pn))continue;const o=[s];let l=s.parent;for(;l!==null;)pr.has(l)&&(pr.delete(l),o.push(l)),l=l.parent;for(let a=o.length-1;a>=0;a--){const f=o[a];f.f&(Jr|Pn)||gs(f)}}pr.clear()}}pr=null}}function Mc(t,e,n,r){if(!n.has(t)&&(n.add(t),t.reactions!==null))for(const s of t.reactions){const o=s.f;o&Ze?Mc(s,e,n,r):o&(za|Kr)&&!(o&dn)&&Nc(s,e,r)&&(je(s,dn),Wr(s))}}function Nc(t,e,n){const r=n.get(t);if(r!==void 0)return r;if(t.deps!==null)for(const s of t.deps){if(vs.call(e,s))return!0;if(s.f&Ze&&Nc(s,e,n))return n.set(s,!0),!0}return n.set(t,!1),!1}function Wr(t){for(var e=Ho=t;e.parent!==null;){e=e.parent;var n=e.f;if(ka&&e===Rt&&n&Kr&&!(n&fc))return;if(n&(Fi|_r)){if(!(n&Le))return;e.f^=Le}}Rn.push(e)}function Oc(t){if(!(t.f&_r&&t.f&Le)){je(t,Le);for(var e=t.first;e!==null;)Oc(e),e=e.next}}function Hf(t){let e=0,n=Li(0),r;return()=>{tl()&&(i(n),ws(()=>(e===0&&(r=z(()=>t(()=>Bs(n)))),e+=1,()=>{Cr(()=>{e-=1,e===0&&(r==null||r(),r=void 0,Bs(n))})})))}}var zf=ds|bs|Ha;function Jf(t,e,n){new Uf(t,e,n)}var Fn,Js,Er,Ei,Tr,Xn,wn,Ar,Fr,ci,Ti,Br,cs,Ai,us,fs,Rr,Lo,Ce,Lc,Dc,Ta,wo,So,Aa;class Uf{constructor(e,n,r){$t(this,Ce);vr(this,"parent");vr(this,"is_pending",!1);$t(this,Fn);$t(this,Js,Et?qt:null);$t(this,Er);$t(this,Ei);$t(this,Tr);$t(this,Xn,null);$t(this,wn,null);$t(this,Ar,null);$t(this,Fr,null);$t(this,ci,null);$t(this,Ti,0);$t(this,Br,0);$t(this,cs,!1);$t(this,Ai,!1);$t(this,us,new Set);$t(this,fs,new Set);$t(this,Rr,null);$t(this,Lo,Hf(()=>(bt(this,Rr,Li(q(this,Ti))),()=>{bt(this,Rr,null)})));bt(this,Fn,e),bt(this,Er,n),bt(this,Ei,r),this.parent=Rt.b,this.is_pending=!!q(this,Er).pending,bt(this,Tr,el(()=>{if(Rt.b=this,Et){const o=q(this,Js);Oi(),o.nodeType===Bi&&o.data===Po?Pe(this,Ce,Dc).call(this):(Pe(this,Ce,Lc).call(this),q(this,Br)===0&&(this.is_pending=!1))}else{var s=Pe(this,Ce,Ta).call(this);try{bt(this,Xn,Qn(()=>r(s)))}catch(o){this.error(o)}q(this,Br)>0?Pe(this,Ce,So).call(this):this.is_pending=!1}return()=>{var o;(o=q(this,ci))==null||o.remove()}},zf)),Et&&bt(this,Fn,qt)}defer_effect(e){Cc(e,q(this,us),q(this,fs))}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!q(this,Er).pending}update_pending_count(e){Pe(this,Ce,Aa).call(this,e),bt(this,Ti,q(this,Ti)+e),!(!q(this,Rr)||q(this,cs))&&(bt(this,cs,!0),Cr(()=>{bt(this,cs,!1),q(this,Rr)&&Di(q(this,Rr),q(this,Ti))}))}get_effect_pending(){return q(this,Lo).call(this),i(q(this,Rr))}error(e){var n=q(this,Er).onerror;let r=q(this,Er).failed;if(q(this,Ai)||!n&&!r)throw e;q(this,Xn)&&(xn(q(this,Xn)),bt(this,Xn,null)),q(this,wn)&&(xn(q(this,wn)),bt(this,wn,null)),q(this,Ar)&&(xn(q(this,Ar)),bt(this,Ar,null)),Et&&(fn(q(this,Js)),Ps(),fn(Co()));var s=!1,o=!1;const l=()=>{if(s){Ff();return}s=!0,o&&kf(),vi.ensure(),bt(this,Ti,0),q(this,Ar)!==null&&ji(q(this,Ar),()=>{bt(this,Ar,null)}),this.is_pending=this.has_pending_snippet(),bt(this,Xn,Pe(this,Ce,wo).call(this,()=>(bt(this,Ai,!1),Qn(()=>q(this,Ei).call(this,q(this,Fn)))))),q(this,Br)>0?Pe(this,Ce,So).call(this):this.is_pending=!1};Cr(()=>{try{o=!0,n==null||n(e,l),o=!1}catch(a){hs(a,q(this,Tr)&&q(this,Tr).parent)}r&&bt(this,Ar,Pe(this,Ce,wo).call(this,()=>{vi.ensure(),bt(this,Ai,!0);try{return Qn(()=>{r(q(this,Fn),()=>e,()=>l)})}catch(a){return hs(a,q(this,Tr).parent),null}finally{bt(this,Ai,!1)}}))})}}Fn=new WeakMap,Js=new WeakMap,Er=new WeakMap,Ei=new WeakMap,Tr=new WeakMap,Xn=new WeakMap,wn=new WeakMap,Ar=new WeakMap,Fr=new WeakMap,ci=new WeakMap,Ti=new WeakMap,Br=new WeakMap,cs=new WeakMap,Ai=new WeakMap,us=new WeakMap,fs=new WeakMap,Rr=new WeakMap,Lo=new WeakMap,Ce=new WeakSet,Lc=function(){try{bt(this,Xn,Qn(()=>q(this,Ei).call(this,q(this,Fn))))}catch(e){this.error(e)}},Dc=function(){const e=q(this,Er).pending;e&&(bt(this,wn,Qn(()=>e(q(this,Fn)))),Cr(()=>{var n=Pe(this,Ce,Ta).call(this);bt(this,Xn,Pe(this,Ce,wo).call(this,()=>(vi.ensure(),Qn(()=>q(this,Ei).call(this,n))))),q(this,Br)>0?Pe(this,Ce,So).call(this):(ji(q(this,wn),()=>{bt(this,wn,null)}),this.is_pending=!1)}))},Ta=function(){var e=q(this,Fn);return this.is_pending&&(bt(this,ci,nr()),q(this,Fn).before(q(this,ci)),e=q(this,ci)),e},wo=function(e){var n=Rt,r=Mt,s=de;Ir(q(this,Tr)),ir(q(this,Tr)),ps(q(this,Tr).ctx);try{return e()}catch(o){return Ac(o),null}finally{Ir(n),ir(r),ps(s)}},So=function(){const e=q(this,Er).pending;q(this,Xn)!==null&&(bt(this,Fr,document.createDocumentFragment()),q(this,Fr).append(q(this,ci)),iu(q(this,Xn),q(this,Fr))),q(this,wn)===null&&bt(this,wn,Qn(()=>e(q(this,Fn))))},Aa=function(e){var n;if(!this.has_pending_snippet()){this.parent&&Pe(n=this.parent,Ce,Aa).call(n,e);return}if(bt(this,Br,q(this,Br)+e),q(this,Br)===0){this.is_pending=!1;for(const r of q(this,us))je(r,dn),Wr(r);for(const r of q(this,fs))je(r,Nr),Wr(r);q(this,us).clear(),q(this,fs).clear(),q(this,wn)&&ji(q(this,wn),()=>{bt(this,wn,null)}),q(this,Fr)&&(q(this,Fn).before(q(this,Fr)),bt(this,Fr,null))}};function Wf(t,e,n,r){const s=Gs()?Xa:Ya;var o=t.filter($=>!$.settled);if(n.length===0&&o.length===0){r(e.map(s));return}var l=wt,a=Rt,f=Vf(),p=o.length===1?o[0].promise:o.length>1?Promise.all(o.map($=>$.promise)):null;function m($){f();try{r($)}catch(I){a.f&Jr||hs(I,a)}l==null||l.deactivate(),qa()}if(n.length===0){p.then(()=>m(e.map(s)));return}function S(){f(),Promise.all(n.map($=>Kf($))).then($=>m([...e.map(s),...$])).catch($=>hs($,a))}p?p.then(S):S()}function Vf(){var t=Rt,e=Mt,n=de,r=wt;return function(o=!0){Ir(t),ir(e),ps(n),o&&(r==null||r.activate())}}function qa(){Ir(null),ir(null),ps(null)}function Xa(t){var e=Ze|dn,n=Mt!==null&&Mt.f&Ze?Mt:null;return Rt!==null&&(Rt.f|=bs),{ctx:de,deps:null,effects:null,equals:gc,f:e,fn:t,reactions:null,rv:0,v:Ke,wv:0,parent:n??Rt,ac:null}}function Kf(t,e,n){let r=Rt;r===null&&pf();var s=r.b,o=void 0,l=Li(Ke),a=!Mt,f=new Map;return sd(()=>{var I;var p=hc();o=p.promise;try{Promise.resolve(t()).then(p.resolve,p.reject).then(()=>{m===wt&&m.committed&&m.deactivate(),qa()})}catch(M){p.reject(M),qa()}var m=wt;if(a){var S=s.is_rendered();s.update_pending_count(1),m.increment(S),(I=f.get(m))==null||I.reject(ts),f.delete(m),f.set(m,p)}const $=(M,B=void 0)=>{if(m.activate(),B)B!==ts&&(l.f|=fi,Di(l,B));else{l.f&fi&&(l.f^=fi),Di(l,M);for(const[j,J]of f){if(f.delete(j),j===m)break;J.reject(ts)}}a&&(s.update_pending_count(-1),m.decrement(S))};p.promise.then($,M=>$(null,M||"unknown"))}),Uo(()=>{for(const p of f.values())p.reject(ts)}),new Promise(p=>{function m(S){function $(){S===o?p(l):m(o)}S.then($,$)}m(o)})}function Ya(t){const e=Xa(t);return e.equals=bc,e}function Fc(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)xn(e[n])}}function Gf(t){for(var e=t.parent;e!==null;){if(!(e.f&Ze))return e.f&Jr?null:e;e=e.parent}return null}function Qa(t){var e,n=Rt;Ir(Gf(t));try{t.f&=~Mi,Fc(t),e=Wc(t)}finally{Ir(n)}return e}function Bc(t){var e=Qa(t);if(!t.equals(e)&&(t.wv=Jc(),(!(wt!=null&&wt.is_fork)||t.deps===null)&&(t.v=e,t.deps===null))){je(t,Le);return}mi||(Ye!==null?(tl()||wt!=null&&wt.is_fork)&&Ye.set(t,e):Ga(t))}let Ca=new Set;const pi=new Map;let Rc=!1;function Li(t,e){var n={f:0,v:t,reactions:null,equals:gc,rv:0,wv:0};return n}function ni(t,e){const n=Li(t);return Qf(n),n}function V(t,e=!1,n=!0){var s;const r=Li(t);return e||(r.equals=bc),_s&&n&&de!==null&&de.l!==null&&((s=de.l).s??(s.s=[])).push(r),r}function ai(t,e){return g(t,z(()=>i(t))),e}function g(t,e,n=!1){Mt!==null&&(!gr||Mt.f&Pl)&&Gs()&&Mt.f&(Ze|Kr|za|Pl)&&(rr===null||!vs.call(rr,t))&&xf();let r=n?es(e):e;return Di(t,r)}function Di(t,e){if(!t.equals(e)){var n=t.v;mi?pi.set(t,e):pi.set(t,n),t.v=e;var r=vi.ensure();if(r.capture(t,n),t.f&Ze){const s=t;t.f&dn&&Qa(s),Ga(s)}t.wv=Jc(),Pc(t,dn),Gs()&&Rt!==null&&Rt.f&Le&&!(Rt.f&(_r|Fi))&&(Gn===null?Zf([t]):Gn.push(t)),!r.is_fork&&Ca.size>0&&!Rc&&Xf()}return e}function Xf(){Rc=!1;for(const t of Ca)t.f&Le&&je(t,Nr),ys(t)&&gs(t);Ca.clear()}function Bs(t){g(t,t.v+1)}function Pc(t,e){var n=t.reactions;if(n!==null)for(var r=Gs(),s=n.length,o=0;o<s;o++){var l=n[o],a=l.f;if(!(!r&&l===Rt)){var f=(a&dn)===0;if(f&&je(l,e),a&Ze){var p=l;Ye==null||Ye.delete(p),a&Mi||(a&er&&(l.f|=Mi),Pc(p,Nr))}else f&&(a&Kr&&pr!==null&&pr.add(l),Wr(l))}}}let li=null;function Yf(t){var e=li;try{if(li=new Set,z(t),e!==null)for(var n of li)e.add(n);return li}finally{li=e}}function xo(t){for(var e of Yf(t))Di(e,e.v)}function hi(t){Et&&tr(t)!==null&&Va(t)}let Wl=!1;function Hc(){Wl||(Wl=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{var e;if(!t.defaultPrevented)for(const n of t.target.elements)(e=n.__on_r)==null||e.call(n)})},{capture:!0}))}function zo(t){var e=Mt,n=Rt;ir(null),Ir(null);try{return t()}finally{ir(e),Ir(n)}}function Za(t,e,n,r=n){t.addEventListener(e,()=>zo(n));const s=t.__on_r;s?t.__on_r=()=>{s(),r(!0)}:t.__on_r=()=>r(!0),Hc()}let ko=!1,mi=!1;function Vl(t){mi=t}let Mt=null,gr=!1;function ir(t){Mt=t}let Rt=null;function Ir(t){Rt=t}let rr=null;function Qf(t){Mt!==null&&(rr===null?rr=[t]:rr.push(t))}let Sn=null,Dn=0,Gn=null;function Zf(t){Gn=t}let zc=1,xi=0,Ci=xi;function Kl(t){Ci=t}function Jc(){return++zc}function ys(t){var e=t.f;if(e&dn)return!0;if(e&Ze&&(t.f&=~Mi),e&Nr){for(var n=t.deps,r=n.length,s=0;s<r;s++){var o=n[s];if(ys(o)&&Bc(o),o.wv>t.wv)return!0}e&er&&Ye===null&&je(t,Le)}return!1}function Uc(t,e,n=!0){var r=t.reactions;if(r!==null&&!(rr!==null&&vs.call(rr,t)))for(var s=0;s<r.length;s++){var o=r[s];o.f&Ze?Uc(o,e,!1):e===o&&(n?je(o,dn):o.f&Le&&je(o,Nr),Wr(o))}}function Wc(t){var B;var e=Sn,n=Dn,r=Gn,s=Mt,o=rr,l=de,a=gr,f=Ci,p=t.f;Sn=null,Dn=0,Gn=null,Mt=p&(_r|Fi)?null:t,rr=null,ps(t.ctx),gr=!1,Ci=++xi,t.ac!==null&&(zo(()=>{t.ac.abort(ts)}),t.ac=null);try{t.f|=wa;var m=t.fn,S=m(),$=t.deps,I=wt==null?void 0:wt.is_fork;if(Sn!==null){var M;if(I||Io(t,Dn),$!==null&&Dn>0)for($.length=Dn+Sn.length,M=0;M<Sn.length;M++)$[Dn+M]=Sn[M];else t.deps=$=Sn;if(tl()&&t.f&er)for(M=Dn;M<$.length;M++)((B=$[M]).reactions??(B.reactions=[])).push(t)}else!I&&$!==null&&Dn<$.length&&(Io(t,Dn),$.length=Dn);if(Gs()&&Gn!==null&&!gr&&$!==null&&!(t.f&(Ze|Nr|dn)))for(M=0;M<Gn.length;M++)Uc(Gn[M],t);if(s!==null&&s!==t){if(xi++,s.deps!==null)for(let j=0;j<n;j+=1)s.deps[j].rv=xi;if(e!==null)for(const j of e)j.rv=xi;Gn!==null&&(r===null?r=Gn:r.push(...Gn))}return t.f&fi&&(t.f^=fi),S}catch(j){return Ac(j)}finally{t.f^=wa,Sn=e,Dn=n,Gn=r,Mt=s,rr=o,ps(l),gr=a,Ci=f}}function td(t,e){let n=e.reactions;if(n!==null){var r=uf.call(n,t);if(r!==-1){var s=n.length-1;s===0?n=e.reactions=null:(n[r]=n[s],n.pop())}}if(n===null&&e.f&Ze&&(Sn===null||!vs.call(Sn,e))){var o=e;o.f&er&&(o.f^=er,o.f&=~Mi),Ga(o),Fc(o),Io(o,0)}}function Io(t,e){var n=t.deps;if(n!==null)for(var r=e;r<n.length;r++)td(t,n[r])}function gs(t){var e=t.f;if(!(e&Jr)){je(t,Le);var n=Rt,r=ko;Rt=t,ko=!0;try{e&(Kr|uc)?od(t):Zc(t),Qc(t);var s=Wc(t);t.teardown=typeof s=="function"?s:null,t.wv=zc;var o;Sa&&$f&&t.f&dn&&t.deps}finally{ko=r,Rt=n}}}async function ed(){await Promise.resolve(),an()}function i(t){var e=t.f,n=(e&Ze)!==0;if(li==null||li.add(t),Mt!==null&&!gr){var r=Rt!==null&&(Rt.f&Jr)!==0;if(!r&&(rr===null||!vs.call(rr,t))){var s=Mt.deps;if(Mt.f&wa)t.rv<xi&&(t.rv=xi,Sn===null&&s!==null&&s[Dn]===t?Dn++:Sn===null?Sn=[t]:Sn.push(t));else{(Mt.deps??(Mt.deps=[])).push(t);var o=t.reactions;o===null?t.reactions=[Mt]:vs.call(o,Mt)||o.push(Mt)}}}if(mi&&pi.has(t))return pi.get(t);if(n){var l=t;if(mi){var a=l.v;return(!(l.f&Le)&&l.reactions!==null||Kc(l))&&(a=Qa(l)),pi.set(l,a),a}var f=(l.f&er)===0&&!gr&&Mt!==null&&(ko||(Mt.f&er)!==0),p=l.deps===null;ys(l)&&(f&&(l.f|=er),Bc(l)),f&&!p&&Vc(l)}if(Ye!=null&&Ye.has(t))return Ye.get(t);if(t.f&fi)throw t.v;return t.v}function Vc(t){if(t.deps!==null){t.f|=er;for(const e of t.deps)(e.reactions??(e.reactions=[])).push(t),e.f&Ze&&!(e.f&er)&&Vc(e)}}function Kc(t){if(t.v===Ke)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(pi.has(e)||e.f&Ze&&Kc(e))return!0;return!1}function z(t){var e=gr;try{return gr=!0,t()}finally{gr=e}}function Jo(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(Ur in t)ja(t);else if(!Array.isArray(t))for(let e in t){const n=t[e];typeof n=="object"&&n&&Ur in n&&ja(n)}}}function ja(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let r in t)try{ja(t[r],e)}catch{}const n=Ua(t);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=pc(n);for(let s in r){const o=r[s].get;if(o)try{o.call(t)}catch{}}}}}function Gc(t){Rt===null&&(Mt===null&&mf(),gf()),mi&&hf()}function nd(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function Or(t,e,n){var r=Rt;r!==null&&r.f&Pn&&(t|=Pn);var s={ctx:de,deps:null,nodes:null,f:t|dn|er,first:null,fn:e,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,wv:0,ac:null};if(n)try{gs(s),s.f|=Fo}catch(a){throw xn(s),a}else e!==null&&Wr(s);var o=s;if(n&&o.deps===null&&o.teardown===null&&o.nodes===null&&o.first===o.last&&!(o.f&bs)&&(o=o.first,t&Kr&&t&ds&&o!==null&&(o.f|=ds)),o!==null&&(o.parent=r,r!==null&&nd(o,r),Mt!==null&&Mt.f&Ze&&!(t&Fi))){var l=Mt;(l.effects??(l.effects=[])).push(o)}return s}function tl(){return Mt!==null&&!gr}function Uo(t){const e=Or(Vs,null,!1);return je(e,Le),e.teardown=t,e}function Ia(t){Gc();var e=Rt.f,n=!Mt&&(e&_r)!==0&&(e&Fo)===0;if(n){var r=de;(r.e??(r.e=[])).push(t)}else return Xc(t)}function Xc(t){return Or(Ao|dc,t,!1)}function rd(t){return Gc(),Or(Vs|dc,t,!0)}function id(t){vi.ensure();const e=Or(Fi|bs,t,!0);return(n={})=>new Promise(r=>{n.outro?ji(e,()=>{xn(e),r(void 0)}):(xn(e),r(void 0))})}function Yc(t){return Or(Ao,t,!1)}function rs(t,e){var n=de,r={effect:null,ran:!1,deps:t};n.l.$.push(r),r.effect=ws(()=>{t(),!r.ran&&(r.ran=!0,z(e))})}function Wo(){var t=de;ws(()=>{for(var e of t.l.$){e.deps();var n=e.effect;n.f&Le&&n.deps!==null&&je(n,Nr),ys(n)&&gs(n),e.ran=!1}})}function sd(t){return Or(za|bs,t,!0)}function ws(t,e=0){return Or(Vs|e,t,!0)}function pt(t,e=[],n=[],r=[]){Wf(r,e,n,s=>{Or(Vs,()=>t(...s.map(i)),!0)})}function el(t,e=0){var n=Or(Kr|e,t,!0);return n}function Qn(t){return Or(_r|bs,t,!0)}function Qc(t){var e=t.teardown;if(e!==null){const n=mi,r=Mt;Vl(!0),ir(null);try{e.call(null)}finally{Vl(n),ir(r)}}}function Zc(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const s=n.ac;s!==null&&zo(()=>{s.abort(ts)});var r=n.next;n.f&Fi?n.parent=null:xn(n,e),n=r}}function od(t){for(var e=t.first;e!==null;){var n=e.next;e.f&_r||xn(e),e=n}}function xn(t,e=!0){var n=!1;(e||t.f&fc)&&t.nodes!==null&&t.nodes.end!==null&&(tu(t.nodes.start,t.nodes.end),n=!0),Zc(t,e&&!n),Io(t,0),je(t,Jr);var r=t.nodes&&t.nodes.t;if(r!==null)for(const o of r)o.stop();Qc(t);var s=t.parent;s!==null&&s.first!==null&&eu(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function tu(t,e){for(;t!==null;){var n=t===e?null:yr(t);t.remove(),t=n}}function eu(t){var e=t.parent,n=t.prev,r=t.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),e!==null&&(e.first===t&&(e.first=r),e.last===t&&(e.last=n))}function ji(t,e,n=!0){var r=[];nu(t,r,!0);var s=()=>{n&&xn(t),e&&e()},o=r.length;if(o>0){var l=()=>--o||s();for(var a of r)a.out(l)}else s()}function nu(t,e,n){if(!(t.f&Pn)){t.f^=Pn;var r=t.nodes&&t.nodes.t;if(r!==null)for(const a of r)(a.is_global||n)&&e.push(a);for(var s=t.first;s!==null;){var o=s.next,l=(s.f&ds)!==0||(s.f&_r)!==0&&(t.f&Kr)!==0;nu(s,e,l?n:!1),s=o}}}function nl(t){ru(t,!0)}function ru(t,e){if(t.f&Pn){t.f^=Pn,t.f&Le||(je(t,dn),Wr(t));for(var n=t.first;n!==null;){var r=n.next,s=(n.f&ds)!==0||(n.f&_r)!==0;ru(n,s?e:!1),n=r}var o=t.nodes&&t.nodes.t;if(o!==null)for(const l of o)(l.is_global||e)&&l.in()}}function iu(t,e){if(t.nodes)for(var n=t.nodes.start,r=t.nodes.end;n!==null;){var s=n===r?null:yr(n);e.append(n),n=s}}const ad=new Set,Gl=new Set;function ld(t,e,n,r={}){function s(o){if(r.capture||Ls.call(e,o),!o.cancelBubble)return zo(()=>n==null?void 0:n.call(this,o))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?Cr(()=>{e.addEventListener(t,s,r)}):e.addEventListener(t,s,r),s}function T(t,e,n,r,s){var o={capture:r,passive:s},l=ld(t,e,n,o);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&Uo(()=>{e.removeEventListener(t,l,o)})}let Xl=null;function Ls(t){var j;var e=this,n=e.ownerDocument,r=t.type,s=((j=t.composedPath)==null?void 0:j.call(t))||[],o=s[0]||t.target;Xl=t;var l=0,a=Xl===t&&t.__root;if(a){var f=s.indexOf(a);if(f!==-1&&(e===document||e===window)){t.__root=e;return}var p=s.indexOf(e);if(p===-1)return;f<=p&&(l=f)}if(o=s[l]||t.target,o!==e){Ja(t,"currentTarget",{configurable:!0,get(){return o||n}});var m=Mt,S=Rt;ir(null),Ir(null);try{for(var $,I=[];o!==null;){var M=o.assignedSlot||o.parentNode||o.host||null;try{var B=o["__"+r];B!=null&&(!o.disabled||t.target===o)&&B.call(o,t)}catch(J){$?I.push(J):$=J}if(t.cancelBubble||M===e||M===null)break;o=M}if($){for(let J of I)queueMicrotask(()=>{throw J});throw $}}finally{t.__root=e,delete t.currentTarget,ir(m),Ir(S)}}}function su(t){var e=document.createElement("template");return e.innerHTML=t.replaceAll("<!>","<!---->"),e.content}function gi(t,e){var n=Rt;n.nodes===null&&(n.nodes={start:t,end:e,a:null,t:null})}function G(t,e){var n=(e&Mf)!==0,r=(e&Nf)!==0,s,o=!t.startsWith("<!>");return()=>{if(Et)return gi(qt,null),qt;s===void 0&&(s=su(o?t:"<!>"+t),n||(s=tr(s)));var l=r||kc?document.importNode(s,!0):s.cloneNode(!0);if(n){var a=tr(l),f=l.lastChild;gi(a,f)}else gi(l,l);return l}}function mr(){if(Et)return gi(qt,null),qt;var t=document.createDocumentFragment(),e=document.createComment(""),n=nr();return t.append(e,n),gi(e,n),t}function P(t,e){if(Et){var n=Rt;(!(n.f&Fo)||n.nodes.end===null)&&(n.nodes.end=qt),Oi();return}t!==null&&t.before(e)}const cd=["touchstart","touchmove"];function ud(t){return cd.includes(t)}function ct(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??(t.__t=t.nodeValue))&&(t.__t=n,t.nodeValue=n+"")}function ou(t,e){return au(t,e)}function fd(t,e){xa(),e.intro=e.intro??!1;const n=e.target,r=Et,s=qt;try{for(var o=tr(n);o&&(o.nodeType!==Bi||o.data!==wc);)o=yr(o);if(!o)throw Ni;zr(!0),fn(o);const l=au(t,{...e,anchor:o});return zr(!1),l}catch(l){if(l instanceof Error&&l.message.split(`
`).some(a=>a.startsWith("https://svelte.dev/e/")))throw l;return l!==Ni&&console.warn("Failed to hydrate: ",l),e.recover===!1&&_f(),xa(),Va(n),zr(!1),ou(t,e)}finally{zr(r),fn(s)}}const Yi=new Map;function au(t,{target:e,anchor:n,props:r={},events:s,context:o,intro:l=!0}){xa();var a=new Set,f=S=>{for(var $=0;$<S.length;$++){var I=S[$];if(!a.has(I)){a.add(I);var M=ud(I);e.addEventListener(I,Ls,{passive:M});var B=Yi.get(I);B===void 0?(document.addEventListener(I,Ls,{passive:M}),Yi.set(I,1)):Yi.set(I,B+1)}}};f(Ro(ad)),Gl.add(f);var p=void 0,m=id(()=>{var S=n??e.appendChild(nr());return Jf(S,{pending:()=>{}},$=>{if(o){Hn({});var I=de;I.c=o}if(s&&(r.$$events=s),Et&&gi($,null),p=t($,r)||{},Et&&(Rt.nodes.end=qt,qt===null||qt.nodeType!==Bi||qt.data!==Wa))throw Xs(),Ni;o&&zn()}),()=>{var M;for(var $ of a){e.removeEventListener($,Ls);var I=Yi.get($);--I===0?(document.removeEventListener($,Ls),Yi.delete($)):Yi.set($,I)}Gl.delete(f),S!==n&&((M=S.parentNode)==null||M.removeChild(S))}});return Ma.set(p,m),p}let Ma=new WeakMap;function dd(t,e){const n=Ma.get(t);return n?(Ma.delete(t),n(e)):Promise.resolve()}function vd(t){return function(...e){var n=e[0];n.target===this&&(t==null||t.apply(this,e))}}function lu(t){return function(...e){var n=e[0];return n.stopPropagation(),t==null?void 0:t.apply(this,e)}}function sr(t){return new pd(t)}var Pr,Yn;class pd{constructor(e){$t(this,Pr);$t(this,Yn);var o;var n=new Map,r=(l,a)=>{var f=V(a,!1,!1);return n.set(l,f),f};const s=new Proxy({...e.props||{},$$events:{}},{get(l,a){return i(n.get(a)??r(a,Reflect.get(l,a)))},has(l,a){return a===vc?!0:(i(n.get(a)??r(a,Reflect.get(l,a))),Reflect.has(l,a))},set(l,a,f){return g(n.get(a)??r(a,f),f),Reflect.set(l,a,f)}});bt(this,Yn,(e.hydrate?fd:ou)(e.component,{target:e.target,anchor:e.anchor,props:s,context:e.context,intro:e.intro??!1,recover:e.recover})),(!((o=e==null?void 0:e.props)!=null&&o.$$host)||e.sync===!1)&&an(),bt(this,Pr,s.$$events);for(const l of Object.keys(q(this,Yn)))l==="$set"||l==="$destroy"||l==="$on"||Ja(this,l,{get(){return q(this,Yn)[l]},set(a){q(this,Yn)[l]=a},enumerable:!0});q(this,Yn).$set=l=>{Object.assign(s,l)},q(this,Yn).$destroy=()=>{dd(q(this,Yn))}}$set(e){q(this,Yn).$set(e)}$on(e,n){q(this,Pr)[e]=q(this,Pr)[e]||[];const r=(...s)=>n.call(this,...s);return q(this,Pr)[e].push(r),()=>{q(this,Pr)[e]=q(this,Pr)[e].filter(s=>s!==r)}}$destroy(){q(this,Yn).$destroy()}}Pr=new WeakMap,Yn=new WeakMap;const hd="5";var cc;typeof window<"u"&&((cc=window.__svelte??(window.__svelte={})).v??(cc.v=new Set)).add(hd);Ef();var hr,qr,Bn,qi,Us,Ws,Do;class gd{constructor(e,n=!0){vr(this,"anchor");$t(this,hr,new Map);$t(this,qr,new Map);$t(this,Bn,new Map);$t(this,qi,new Set);$t(this,Us,!0);$t(this,Ws,()=>{var e=wt;if(q(this,hr).has(e)){var n=q(this,hr).get(e),r=q(this,qr).get(n);if(r)nl(r),q(this,qi).delete(n);else{var s=q(this,Bn).get(n);s&&(q(this,qr).set(n,s.effect),q(this,Bn).delete(n),s.fragment.lastChild.remove(),this.anchor.before(s.fragment),r=s.effect)}for(const[o,l]of q(this,hr)){if(q(this,hr).delete(o),o===e)break;const a=q(this,Bn).get(l);a&&(xn(a.effect),q(this,Bn).delete(l))}for(const[o,l]of q(this,qr)){if(o===n||q(this,qi).has(o))continue;const a=()=>{if(Array.from(q(this,hr).values()).includes(o)){var p=document.createDocumentFragment();iu(l,p),p.append(nr()),q(this,Bn).set(o,{effect:l,fragment:p})}else xn(l);q(this,qi).delete(o),q(this,qr).delete(o)};q(this,Us)||!r?(q(this,qi).add(o),ji(l,a,!1)):a()}}});$t(this,Do,e=>{q(this,hr).delete(e);const n=Array.from(q(this,hr).values());for(const[r,s]of q(this,Bn))n.includes(r)||(xn(s.effect),q(this,Bn).delete(r))});this.anchor=e,bt(this,Us,n)}ensure(e,n){var r=wt,s=Tc();if(n&&!q(this,qr).has(e)&&!q(this,Bn).has(e))if(s){var o=document.createDocumentFragment(),l=nr();o.append(l),q(this,Bn).set(e,{effect:Qn(()=>n(l)),fragment:o})}else q(this,qr).set(e,Qn(()=>n(this.anchor)));if(q(this,hr).set(r,e),s){for(const[a,f]of q(this,qr))a===e?r.skipped_effects.delete(f):r.skipped_effects.add(f);for(const[a,f]of q(this,Bn))a===e?r.skipped_effects.delete(f.effect):r.skipped_effects.add(f.effect);r.oncommit(q(this,Ws)),r.ondiscard(q(this,Do))}else Et&&(this.anchor=qt),q(this,Ws).call(this)}}hr=new WeakMap,qr=new WeakMap,Bn=new WeakMap,qi=new WeakMap,Us=new WeakMap,Ws=new WeakMap,Do=new WeakMap;function Ys(t){de===null&&_c(),_s&&de.l!==null?bd(de).m.push(t):Ia(()=>{const e=z(t);if(typeof e=="function")return e})}function md(t,e,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:r})}function rl(){const t=de;return t===null&&_c(),(e,n,r)=>{var o;const s=(o=t.s.$$events)==null?void 0:o[e];if(s){const l=Ks(s)?s.slice():[s],a=md(e,n,r);for(const f of l)f.call(t.x,a);return!a.defaultPrevented}return!0}}function bd(t){var e=t.l;return e.u??(e.u={a:[],b:[],m:[]})}function gt(t,e,n=!1){Et&&Oi();var r=new gd(t),s=n?ds:0;function o(l,a){if(Et){const p=xc(t)===Po;if(l===p){var f=Co();fn(f),r.anchor=f,zr(!1),r.ensure(l,a),zr(!0);return}}r.ensure(l,a)}el(()=>{var l=!1;e((a,f=!0)=>{l=!0,o(f,a)}),l||o(!1,null)},s)}function Qe(t,e){return e}function _d(t,e,n){for(var r=[],s=e.length,o,l=e.length,a=0;a<s;a++){let S=e[a];ji(S,()=>{if(o){if(o.pending.delete(S),o.done.add(S),o.pending.size===0){var $=t.outrogroups;Na(Ro(o.done)),$.delete(o),$.size===0&&(t.outrogroups=null)}}else l-=1},!1)}if(l===0){var f=r.length===0&&n!==null;if(f){var p=n,m=p.parentNode;Va(m),m.append(p),t.items.clear()}Na(e,!f)}else o={pending:new Set(e),done:new Set},(t.outrogroups??(t.outrogroups=new Set)).add(o)}function Na(t,e=!0){for(var n=0;n<t.length;n++)xn(t[n],e)}var Yl;function ze(t,e,n,r,s,o=null){var l=t,a=new Map,f=(e&yc)!==0;if(f){var p=t;l=Et?fn(tr(p)):p.appendChild(nr())}Et&&Oi();var m=null,S=Ya(()=>{var J=n();return Ks(J)?J:J==null?[]:Ro(J)}),$,I=!0;function M(){j.fallback=m,yd(j,$,l,e,r),m!==null&&($.length===0?m.f&Hr?(m.f^=Hr,Ds(m,null,l)):nl(m):ji(m,()=>{m=null}))}var B=el(()=>{$=i(S);var J=$.length;let ft=!1;if(Et){var et=xc(l)===Po;et!==(J===0)&&(l=Co(),fn(l),zr(!1),ft=!0)}for(var ot=new Set,Q=wt,mt=Tc(),it=0;it<J;it+=1){Et&&qt.nodeType===Bi&&qt.data===Wa&&(l=qt,ft=!0,zr(!1));var R=$[it],ut=r(R,it),K=I?null:a.get(ut);K?(K.v&&Di(K.v,R),K.i&&Di(K.i,it),mt&&Q.skipped_effects.delete(K.e)):(K=wd(a,I?l:Yl??(Yl=nr()),R,ut,it,s,e,n),I||(K.e.f|=Hr),a.set(ut,K)),ot.add(ut)}if(J===0&&o&&!m&&(I?m=Qn(()=>o(l)):(m=Qn(()=>o(Yl??(Yl=nr()))),m.f|=Hr)),Et&&J>0&&fn(Co()),!I)if(mt){for(const[lt,dt]of a)ot.has(lt)||Q.skipped_effects.add(dt.e);Q.oncommit(M),Q.ondiscard(()=>{})}else M();ft&&zr(!0),i(S)}),j={effect:B,items:a,outrogroups:null,fallback:m};I=!1,Et&&(l=qt)}function Os(t){for(;t!==null&&!(t.f&_r);)t=t.next;return t}function yd(t,e,n,r,s){var K,lt,dt,Nt,Lt,Tt,ee,Ut,Dt;var o=(r&qf)!==0,l=e.length,a=t.items,f=Os(t.effect.first),p,m=null,S,$=[],I=[],M,B,j,J;if(o)for(J=0;J<l;J+=1)M=e[J],B=s(M,J),j=a.get(B).e,j.f&Hr||((lt=(K=j.nodes)==null?void 0:K.a)==null||lt.measure(),(S??(S=new Set)).add(j));for(J=0;J<l;J+=1){if(M=e[J],B=s(M,J),j=a.get(B).e,t.outrogroups!==null)for(const Pt of t.outrogroups)Pt.pending.delete(j),Pt.done.delete(j);if(j.f&Hr)if(j.f^=Hr,j===f)Ds(j,null,n);else{var ft=m?m.next:f;j===t.effect.last&&(t.effect.last=j.prev),j.prev&&(j.prev.next=j.next),j.next&&(j.next.prev=j.prev),ri(t,m,j),ri(t,j,ft),Ds(j,ft,n),m=j,$=[],I=[],f=Os(m.next);continue}if(j.f&Pn&&(nl(j),o&&((Nt=(dt=j.nodes)==null?void 0:dt.a)==null||Nt.unfix(),(S??(S=new Set)).delete(j))),j!==f){if(p!==void 0&&p.has(j)){if($.length<I.length){var et=I[0],ot;m=et.prev;var Q=$[0],mt=$[$.length-1];for(ot=0;ot<$.length;ot+=1)Ds($[ot],et,n);for(ot=0;ot<I.length;ot+=1)p.delete(I[ot]);ri(t,Q.prev,mt.next),ri(t,m,Q),ri(t,mt,et),f=et,m=mt,J-=1,$=[],I=[]}else p.delete(j),Ds(j,f,n),ri(t,j.prev,j.next),ri(t,j,m===null?t.effect.first:m.next),ri(t,m,j),m=j;continue}for($=[],I=[];f!==null&&f!==j;)(p??(p=new Set)).add(f),I.push(f),f=Os(f.next);if(f===null)continue}j.f&Hr||$.push(j),m=j,f=Os(j.next)}if(t.outrogroups!==null){for(const Pt of t.outrogroups)Pt.pending.size===0&&(Na(Ro(Pt.done)),(Lt=t.outrogroups)==null||Lt.delete(Pt));t.outrogroups.size===0&&(t.outrogroups=null)}if(f!==null||p!==void 0){var it=[];if(p!==void 0)for(j of p)j.f&Pn||it.push(j);for(;f!==null;)!(f.f&Pn)&&f!==t.fallback&&it.push(f),f=Os(f.next);var R=it.length;if(R>0){var ut=r&yc&&l===0?n:null;if(o){for(J=0;J<R;J+=1)(ee=(Tt=it[J].nodes)==null?void 0:Tt.a)==null||ee.measure();for(J=0;J<R;J+=1)(Dt=(Ut=it[J].nodes)==null?void 0:Ut.a)==null||Dt.fix()}_d(t,it,ut)}}o&&Cr(()=>{var Pt,St;if(S!==void 0)for(j of S)(St=(Pt=j.nodes)==null?void 0:Pt.a)==null||St.apply()})}function wd(t,e,n,r,s,o,l,a){var f=l&Tf?l&Cf?Li(n):V(n,!1,!1):null,p=l&Af?Li(s):null;return{v:f,i:p,e:Qn(()=>(o(e,f??n,p??s,a),()=>{t.delete(r)}))}}function Ds(t,e,n){if(t.nodes)for(var r=t.nodes.start,s=t.nodes.end,o=e&&!(e.f&Hr)?e.nodes.start:n;r!==null;){var l=yr(r);if(o.before(r),r===s)return;r=l}}function ri(t,e,n){e===null?t.effect.first=n:e.next=n,n===null?t.effect.last=e:n.prev=e}function Sd(t,e,n=!1,r=!1,s=!1){var o=t,l="";pt(()=>{var a=Rt;if(l===(l=e()??"")){Et&&Oi();return}if(a.nodes!==null&&(tu(a.nodes.start,a.nodes.end),a.nodes=null),l!==""){if(Et){qt.data;for(var f=Oi(),p=f;f!==null&&(f.nodeType!==Bi||f.data!=="");)p=f,f=yr(f);if(f===null)throw Xs(),Ni;gi(qt,p),o=fn(f);return}var m=l+"";n?m=`<svg>${m}</svg>`:r&&(m=`<math>${m}</math>`);var S=su(m);if((n||r)&&(S=tr(S)),gi(tr(S),S.lastChild),n||r)for(;tr(S);)o.before(tr(S));else o.before(S)}})}function cu(t,e,n,r,s){var a;Et&&Oi();var o=(a=e.$$slots)==null?void 0:a[n],l=!1;o===!0&&(o=e.children,l=!0),o===void 0||o(t,l?()=>r:r)}const Ql=[...` 	
\r\f \v\uFEFF`];function xd(t,e,n){var r=t==null?"":""+t;if(e&&(r=r?r+" "+e:e),n){for(var s in n)if(n[s])r=r?r+" "+s:s;else if(r.length)for(var o=s.length,l=0;(l=r.indexOf(s,l))>=0;){var a=l+o;(l===0||Ql.includes(r[l-1]))&&(a===r.length||Ql.includes(r[a]))?r=(l===0?"":r.substring(0,l))+r.substring(a+1):l=a}}return r===""?null:r}function kd(t,e){return t==null?null:String(t)}function un(t,e,n,r,s,o){var l=t.__className;if(Et||l!==n||l===void 0){var a=xd(n,r,o);(!Et||a!==t.getAttribute("class"))&&(a==null?t.removeAttribute("class"):t.className=a),t.__className=n}else if(o&&s!==o)for(var f in o){var p=!!o[f];(s==null||p!==!!s[f])&&t.classList.toggle(f,p)}return o}function ui(t,e,n,r){var s=t.__style;if(Et||s!==e){var o=kd(e);(!Et||o!==t.getAttribute("style"))&&(o==null?t.removeAttribute("style"):t.style.cssText=o),t.__style=e}return r}function uu(t,e,n=!1){if(t.multiple){if(e==null)return;if(!Ks(e))return Df();for(var r of t.options)r.selected=e.includes(Rs(r));return}for(r of t.options){var s=Rs(r);if(Bf(s,e)){r.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function $d(t){var e=new MutationObserver(()=>{uu(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Uo(()=>{e.disconnect()})}function $o(t,e,n=e){var r=new WeakSet,s=!0;Za(t,"change",o=>{var l=o?"[selected]":":checked",a;if(t.multiple)a=[].map.call(t.querySelectorAll(l),Rs);else{var f=t.querySelector(l)??t.querySelector("option:not([disabled])");a=f&&Rs(f)}n(a),wt!==null&&r.add(wt)}),Yc(()=>{var o=e();if(t===document.activeElement){var l=jo??wt;if(r.has(l))return}if(uu(t,o,s),s&&o===void 0){var a=t.querySelector(":checked");a!==null&&(o=Rs(a),n(o))}t.__value=o,s=!1}),$d(t)}function Rs(t){return"__value"in t?t.__value:t.value}const Ed=Symbol("is custom element"),Td=Symbol("is html");function Zn(t){if(Et){var e=!1,n=()=>{if(!e){if(e=!0,t.hasAttribute("value")){var r=t.value;is(t,"value",null),t.value=r}if(t.hasAttribute("checked")){var s=t.checked;is(t,"checked",null),t.checked=s}}};t.__on_r=n,Cr(n),Hc()}}function is(t,e,n,r){var s=Ad(t);Et&&(s[e]=t.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&t.nodeName==="LINK")||s[e]!==(s[e]=n)&&(e==="loading"&&(t[cf]=n),n==null?t.removeAttribute(e):typeof n!="string"&&qd(t).includes(e)?t[e]=n:t.setAttribute(e,n))}function Ad(t){return t.__attributes??(t.__attributes={[Ed]:t.nodeName.includes("-"),[Td]:t.namespaceURI===Of})}var Zl=new Map;function qd(t){var e=t.getAttribute("is")||t.nodeName,n=Zl.get(e);if(n)return n;Zl.set(e,n=[]);for(var r,s=t,o=Element.prototype;o!==s;){r=pc(s);for(var l in r)r[l].set&&n.push(l);s=Ua(s)}return n}function Je(t,e,n=e){var r=new WeakSet;Za(t,"input",async s=>{var o=s?t.defaultValue:t.value;if(o=ga(t)?ma(o):o,n(o),wt!==null&&r.add(wt),await ed(),o!==(o=e())){var l=t.selectionStart,a=t.selectionEnd,f=t.value.length;if(t.value=o??"",a!==null){var p=t.value.length;l===a&&a===f&&p>f?(t.selectionStart=p,t.selectionEnd=p):(t.selectionStart=l,t.selectionEnd=Math.min(a,p))}}}),(Et&&t.defaultValue!==t.value||z(e)==null&&t.value)&&(n(ga(t)?ma(t.value):t.value),wt!==null&&r.add(wt)),ws(()=>{var s=e();if(t===document.activeElement){var o=jo??wt;if(r.has(o))return}ga(t)&&s===ma(t.value)||t.type==="date"&&!s&&!t.value||s!==t.value&&(t.value=s??"")})}function tc(t,e,n=e){Za(t,"change",r=>{var s=r?t.defaultChecked:t.checked;n(s)}),(Et&&t.defaultChecked!==t.checked||z(e)==null)&&n(t.checked),ws(()=>{var r=e();t.checked=!!r})}function ga(t){var e=t.type;return e==="number"||e==="range"}function ma(t){return t===""?null:+t}function ec(t,e){return t===e||(t==null?void 0:t[Ur])===e}function Cd(t={},e,n,r){return Yc(()=>{var s,o;return ws(()=>{s=o,o=[],z(()=>{t!==n(...o)&&(e(t,...o),s&&ec(n(...s),t)&&e(null,...s))})}),()=>{Cr(()=>{o&&ec(n(...o),t)&&e(null,...o)})}}),t}function bi(t=!1){const e=de,n=e.l.u;if(!n)return;let r=()=>Jo(e.s);if(t){let s=0,o={};const l=Xa(()=>{let a=!1;const f=e.s;for(const p in f)f[p]!==o[p]&&(o[p]=f[p],a=!0);return a&&s++,s});r=()=>i(l)}n.b.length&&rd(()=>{nc(e,r),qo(n.b)}),Ia(()=>{const s=z(()=>n.m.map(vf));return()=>{for(const o of s)typeof o=="function"&&o()}}),n.a.length&&Ia(()=>{nc(e,r),qo(n.a)})}function nc(t,e){if(t.l.s)for(const n of t.l.s)i(n);e()}function fu(t,e){var o;var n=(o=t.$$events)==null?void 0:o[e.type],r=Ks(n)?n.slice():n==null?[]:[n];for(var s of r)s.call(this,e)}function or(t,e,n){var r;t.$$events||(t.$$events={}),(r=t.$$events)[e]||(r[e]=[]),t.$$events[e].push(n)}function ar(t){for(var e in t)e in this&&(this[e]=t[e])}function il(t,e,n){if(t==null)return e(void 0),n&&n(void 0),di;const r=z(()=>t.subscribe(e,n));return r.unsubscribe?()=>r.unsubscribe():r}const Qi=[];function jd(t,e){return{subscribe:Ie(t,e).subscribe}}function Ie(t,e=di){let n=null;const r=new Set;function s(a){if(mc(t,a)&&(t=a,n)){const f=!Qi.length;for(const p of r)p[1](),Qi.push(p,t);if(f){for(let p=0;p<Qi.length;p+=2)Qi[p][0](Qi[p+1]);Qi.length=0}}}function o(a){s(a(t))}function l(a,f=di){const p=[a,f];return r.add(p),r.size===1&&(n=e(s,o)||di),a(t),()=>{r.delete(p),r.size===0&&n&&(n(),n=null)}}return{set:s,update:o,subscribe:l}}function Id(t,e,n){const r=!Array.isArray(t),s=r?[t]:t;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const o=e.length<2;return jd(n,(l,a)=>{let f=!1;const p=[];let m=0,S=di;const $=()=>{if(m)return;S();const M=e(r?p[0]:p,l,a);o?l(M):S=typeof M=="function"?M:di},I=s.map((M,B)=>il(M,j=>{p[B]=j,m&=~(1<<B),f&&$()},()=>{m|=1<<B}));return f=!0,$(),function(){qo(I),S(),f=!1}})}function br(t){let e;return il(t,n=>e=n)(),e}let _o=!1,Oa=Symbol();function qe(t,e,n){const r=n[e]??(n[e]={store:null,source:V(void 0),unsubscribe:di});if(r.store!==t&&!(Oa in n))if(r.unsubscribe(),r.store=t??null,t==null)r.source.v=void 0,r.unsubscribe=di;else{var s=!0;r.unsubscribe=il(t,o=>{s?r.source.v=o:g(r.source,o)}),s=!1}return t&&Oa in n?br(t):i(r.source)}function Md(t,e){return t.set(e),e}function Ss(){const t={};function e(){Uo(()=>{for(var n in t)t[n].unsubscribe();Ja(t,Oa,{enumerable:!1,value:!0})})}return[t,e]}function Nd(t){var e=_o;try{return _o=!1,[t(),_o]}finally{_o=e}}function kn(t,e,n,r){var ft;var s=!_s||(n&jf)!==0,o=(n&If)!==0,l=r,a=!0,f=()=>(a&&(a=!1,l=r),l),p;{var m=Ur in t||vc in t;p=((ft=ns(t,e))==null?void 0:ft.set)??(m&&e in t?et=>t[e]=et:void 0)}var S,$=!1;[S,$]=Nd(()=>t[e]),S===void 0&&r!==void 0&&(S=f(),p&&(s&&yf(),p(S)));var I;if(s?I=()=>{var et=t[e];return et===void 0?f():(a=!0,et)}:I=()=>{var et=t[e];return et!==void 0&&(l=void 0),et===void 0?l:et},p){var M=t.$$legacy;return function(et,ot){return arguments.length>0?((!s||!ot||M||$)&&p(ot?I():et),et):I()}}var B=!1,j=Ya(()=>(B=!1,I()));i(j);var J=Rt;return function(et,ot){if(arguments.length>0){const Q=ot?i(j):s&&o?es(et):et;return g(j,Q),B=!0,l!==void 0&&(l=Q),et}return mi&&B||J.f&Jr?j.v:i(j)}}const Vr=Ie(""),Ii=Ie(""),Xe=Ie(""),Ge=Ie(null),He=Ie(!1),Zi=Ie("就绪"),Kn=Ie("就绪"),sl=Ie([]),Od=Ie("等待解析…"),Ld=Ie([]),Dd=Ie([]),ol=Ie([]),Eo=Ie(!1),La=Ie(null),al=Ie([]),ms=Ie(-1),ll=Id(Xe,t=>String(t||"").replace(/\s/g,"").length),Da=Ie([]),rc=Ie(!1),yo=Ie(!1);let ba=null,_a=null;typeof window<"u"&&(window.__waGetStore=t=>{const n={docId:Vr,instruction:Ii,sourceText:Xe,docIr:Ge,docIrDirty:He,flowStatus:Zi,docStatus:Kn,generating:Eo,wordCount:ll}[t];return n?br(n):void 0});async function Fd(){const t=br(Vr);if(!t)return;const e=await fetch(`/api/doc/${t}/chat`);if(!e.ok)return;const n=await e.json(),r=Array.isArray(n.items)?n.items:[];sl.set(r)}async function Bd(){const t=br(Vr);if(!t)return;const e=await fetch(`/api/doc/${t}/thoughts`);if(!e.ok)return;const n=await e.json(),r=Array.isArray(n.items)?n.items:[];ol.set(r)}async function Rd(t){const e=br(Vr);e&&await fetch(`/api/doc/${e}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:t.slice(-200)})})}async function Pd(t){const e=br(Vr);e&&await fetch(`/api/doc/${e}/thoughts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:t.slice(-200)})})}function ii(t,e){const n={role:t,text:String(e||"").trim()};n.text&&sl.update(r=>{const s=[...r,n];return ba&&clearTimeout(ba),ba=setTimeout(()=>{Rd(s).catch(()=>{})},300),s})}function on(t,e,n){const r={label:t,detail:e,time:n||new Date().toLocaleTimeString()};ol.update(s=>{const o=[...s,r].slice(-200);return _a&&clearTimeout(_a),_a=setTimeout(()=>{Pd(o).catch(()=>{})},300),o})}function It(t,e="info"){const n=Date.now(),r={id:n,message:t,type:e};Da.update(s=>[...s,r]),setTimeout(()=>{Da.update(s=>s.filter(o=>o.id!==n))},2600)}function Hd(t){const e=String(t||"");al.update(n=>{const r=n.slice(0,br(ms)+1);if(r[r.length-1]===e)return n;r.push(e);const s=r.slice(-50);return ms.set(s.length-1),s})}function zd(){const t=br(ms);if(t<=0)return;ms.set(t-1);const e=br(al);Xe.set(e[t-1]||""),He.set(!0)}function Jd(){const t=br(ms),e=br(al);t>=e.length-1||(ms.set(t+1),Xe.set(e[t+1]||""),He.set(!0))}var Ud=G('<div class="assistant-header svelte-191yngm"><div class="assistant-title svelte-191yngm"><span class="assistant-dot svelte-191yngm"></span> 智能助手</div> <button class="assistant-toggle svelte-191yngm"> </button></div>'),Wd=G('<div class="panel-title svelte-191yngm">对话写作</div>'),Vd=G('<div class="thought-item svelte-191yngm"><div class="thought-meta svelte-191yngm"><span class="label"> </span> <span class="time"> </span></div> <div class="detail svelte-191yngm"> </div></div>'),Kd=G('<div class="thoughts svelte-191yngm"><div class="thoughts-title svelte-191yngm">思考链</div> <div class="thought-list svelte-191yngm"></div></div>'),Gd=G('<div><div class="chat-bubble svelte-191yngm"> </div></div>'),Xd=G('<div><!> <!> <div class="chat-history svelte-191yngm"></div> <div class="composer svelte-191yngm"><textarea rows="3" placeholder="输入需求或修改指令" class="svelte-191yngm"></textarea> <button class="send-btn svelte-191yngm">发送</button></div></div>');function du(t,e){if(new.target)return sr({component:du,...t});Hn(e,!1);const n=()=>qe(Ii,"$instruction",o),r=()=>qe(ol,"$thoughtLog",o),s=()=>qe(sl,"$chat",o),[o,l]=Ss(),a=rl();let f=kn(e,"variant",12,"panel"),p=V(!0);function m(){const K=n().trim();K&&(a("send",K),Ii.set(""),I())}function S(K){K.key==="Enter"&&!K.shiftKey&&(K.preventDefault(),m())}function $(){g(p,!i(p)),I()}function I(){queueMicrotask(()=>{const K=document.querySelector(".chat-history");K&&(K.scrollTop=K.scrollHeight);const lt=document.querySelector(".thought-list");lt&&(lt.scrollTop=lt.scrollHeight)})}var M={get variant(){return f()},set variant(K){f(K),an()},$set:ar,$on:(K,lt)=>or(e,K,lt)};bi();var B=Xd(),j=w(B);{var J=K=>{var lt=Ud(),dt=h(w(lt),2),Nt=w(dt,!0);_(dt),_(lt),pt(()=>ct(Nt,i(p)?"隐藏思考":"思考链")),T("click",dt,$),P(K,lt)},ft=K=>{var lt=Wd();P(K,lt)};gt(j,K=>{f()==="assistant"?K(J):K(ft,!1)})}var et=h(j,2);{var ot=K=>{var lt=Kd(),dt=h(w(lt),2);ze(dt,5,r,Qe,(Nt,Lt)=>{var Tt=Vd(),ee=w(Tt),Ut=w(ee),Dt=w(Ut,!0);_(Ut);var Pt=h(Ut,2),St=w(Pt,!0);_(Pt),_(ee);var ce=h(ee,2),ve=w(ce,!0);_(ce),_(Tt),pt(()=>{ct(Dt,(i(Lt),z(()=>i(Lt).label))),ct(St,(i(Lt),z(()=>i(Lt).time))),ct(ve,(i(Lt),z(()=>i(Lt).detail)))}),P(Nt,Tt)}),_(dt),_(lt),P(K,lt)};gt(et,K=>{i(p)&&K(ot)})}var Q=h(et,2);ze(Q,5,s,Qe,(K,lt)=>{var dt=Gd(),Nt=w(dt),Lt=w(Nt,!0);_(Nt),_(dt),pt(()=>{un(dt,1,`chat-msg ${i(lt),z(()=>i(lt).role)??""}`,"svelte-191yngm"),ct(Lt,(i(lt),z(()=>i(lt).text)))}),P(K,dt)}),_(Q);var mt=h(Q,2),it=w(mt);hi(it);var R=h(it,2);_(mt),_(B),pt(()=>un(B,1,`chat-shell ${f()}`,"svelte-191yngm")),Je(it,n,K=>Md(Ii,K)),T("keydown",it,S),T("click",R,m),P(t,B);var ut=zn(M);return l(),ut}function Yd(t){const e=String(t||"").replace(/\r\n/g,`
`).replace(/\r/g,`
`);if(!e.trim())return"";const n=Zd(e)||e,r=xu(n.split(`
`));let s="",o=!1,l="";const a=[],f=()=>{l&&(a.push(l==="ol"?"</ol>":"</ul>"),l="")};for(const p of r){const m=p.trim();if(m.startsWith("```")){o?(a.push("</code></pre>"),o=!1):(f(),a.push('<pre class="code"><code>'),o=!0);continue}if(o){a.push(`${Te(p)}
`);continue}if(/^#{1,6}$/.test(m))continue;if(m===":::left"){f(),s="left";continue}if(m===":::center"){f(),s="center";continue}if(m===":::right"){f(),s="right";continue}if(m===":::"){f(),s="";continue}const S=m.match(/^\[\[(FIGURE|TABLE)\s*:\s*(\{[\s\S]*\})\s*\]\]$/i);if(S){f();const j=String(S[1]||"").toLowerCase();let J=j==="figure"?"图示":"表格";try{const ft=JSON.parse(S[2]);ft&&typeof ft.caption=="string"&&ft.caption.trim()&&(J=ft.caption.trim())}catch{}j==="figure"?a.push(`<figure class="wa-figure" data-wa-figure="1"><div class="wa-figure-box">图</div><figcaption>${Te(J)}</figcaption></figure>`):a.push(`<div class="wa-table" data-wa-table="1"><div class="wa-table-box">表</div><div class="wa-table-caption">${Te(J)}</div></div>`);continue}const $=m.match(/^(#{1,3})\s*(.+?)\s*$/);if($){f();const j=Math.min(3,$[1].length);a.push(`<h${j}>${jr($[2])}</h${j}>`);continue}if(!m){if(l)continue;f(),a.push("<p><br/></p>");continue}const I=m.match(/^-\s+(.+)/),M=m.match(/^\d+\.\s+(.+)/);if(I||M){const j=I?"ul":"ol";l?l!==j&&(f(),l=j,a.push(j==="ol"?"<ol>":"<ul>")):(l=j,a.push(j==="ol"?"<ol>":"<ul>"));const J=(I||M)[1];a.push(`<li>${jr(J)}</li>`);continue}f();const B=s?` style="text-align:${s};"`:"";a.push(`<p${B}>${jr(p)}</p>`)}return f(),a.join("")}function Qd(t,e,n){const r=String(t||""),s=ev(r);if(s)return s;if(!n){const o=nv(e);if(o)return o}return Yd(r)}function Fa(t){let e=String(t||"").replace(/\r\n/g,`
`).replace(/\r/g,`
`);if(!e.endsWith(`
`)){const $=e.lastIndexOf(`
`),I=$>=0?e.slice($+1):e;I.trim().length<=4&&(/^#{1,6}\s*\S*$/.test(I)||/^[-*•·]\s*\S*$/.test(I))&&(e=$>=0?e.slice(0,$+1):"")}if(!e.trim())return null;const n=xu(e.split(`
`)),r=[];let s="",o=[],l=[],a=null;const f=()=>{if(!o.length)return;const $=o.join(" ").replace(/\s+/g," ").trim();$&&r.push({type:"paragraph",text:$}),o=[]},p=()=>{l.length&&(r.push({type:"list",items:l.slice(),ordered:!!a}),l=[],a=null)};let m=!0;for(const $ of n){const M=String($||"").trim();if(!M){f(),p(),m=!0;continue}if(/^#{1,6}$/.test(M))continue;const B=/^(#{1,3})\s*(.+)$/.exec(M);if(B){f(),p();const ot=Math.min(3,Math.max(1,B[1].length));let Q=String(B[2]||"").trim(),mt="";const it=sc(Q);it&&(Q=it.heading,mt=it.rest),ot===1&&!s&&Q&&(s=Q),r.push({type:"heading",level:ot,text:Q||"章节"}),mt&&r.push({type:"paragraph",text:mt}),m=!1;continue}const j=/^(\d+(?:\.\d+){0,3})[\.、\)]?\s+(.+)$/.exec(M);if(j){const ot=String(j[1]||"");let Q=String(j[2]||"").trim();const mt=(ot.match(/\./g)||[]).length,it=Math.min(6,2+mt),R=sc(Q),ut=Q.length<=16&&!oi.test(Q),K=wu.some(dt=>Q.startsWith(dt)),lt=m||!o.length&&!l.length||R||ut||K;if(Q&&lt){f(),p();let dt="";R&&(Q=R.heading,dt=R.rest),it===1&&!s&&Q&&(s=Q),r.push({type:"heading",level:it,text:Q||"章节"}),dt&&r.push({type:"paragraph",text:dt}),m=!1;continue}}const J=M.match(/^\[\[(FIGURE|TABLE)\s*:\s*(\{[\s\S]*\})\s*\]\]$/i);if(J){f(),p();const ot=String(J[1]||"").toLowerCase(),Q=Qs(J[2])||{raw:J[2]};ot==="table"?r.push({type:"table",table:Q}):r.push({type:"figure",figure:Q});continue}const ft=M.match(/^[-*•·]\s+(.*)$/),et=M.match(/^\d+[\.\)]\s+(.*)$/);if(ft||et){f();const ot=!!et;a===null&&(a=ot),a!==ot&&(p(),a=ot);const Q=String((et==null?void 0:et[1])||(ft==null?void 0:ft[1])||"").trim();Q&&l.push(Q),m=!1;continue}p(),o.push(M),m=!1}f(),p();const S=s||cl(r)||"自动生成文档";return fv(r,S)}function Zd(t){const e=String(t||"").trim();if(!e||/^#{1,3}\s+/m.test(e))return null;const n=vu(e);if(n){const s=Qs(n);if(s!==null){const o=tv(s);if(o)return o}}const r=pu(e);return r.length>0?Ra(r):null}function vu(t){let e=String(t||"").trim();return e?(e.startsWith("```")&&(e=e.replace(/^```json/i,"").replace(/^```/,""),e.endsWith("```")&&(e=e.slice(0,-3)),e=e.trim()),e.startsWith("{")||e.startsWith("[")?e:null):null}function Qs(t){try{return JSON.parse(t)}catch{return null}}function pu(t){const e=[],n=String(t||"").split(`
`);for(const r of n){const s=r.trim();if(!s)continue;const o=Qs(s);o&&typeof o=="object"&&!Array.isArray(o)&&e.push(o)}return e}function tv(t){if(!t||typeof t!="object")return null;const e=t;return e.doc_ir&&typeof e.doc_ir=="object"?Mo(e.doc_ir):Array.isArray(t)?Ra(t):Array.isArray(e.blocks)?Ra(e.blocks):Array.isArray(e.sections)?e.sections.some(s=>s&&(s.blocks||s.children))?Mo(e):rv(e):null}function ev(t){const e=String(t||"").trim();if(!e)return null;const n=vu(e);if(n){const s=Qs(n);if(s!==null){const o=Ba(s);if(o)return o}}const r=pu(e);if(r.length>0){const s=Pa(r);if(s)return s}return null}function nv(t){if(!t)return null;if(typeof t=="string"){const e=Qs(t);return e?Ba(e):null}return typeof t!="object"?null:Ba(t)}function Ba(t){if(!t||typeof t!="object")return null;const e=t;return e.doc_ir&&typeof e.doc_ir=="object"?ic(e.doc_ir):Array.isArray(t)?Pa(t):Array.isArray(e.blocks)?Pa(e.blocks,String(e.title||"").trim()):Array.isArray(e.sections)?ic(e):null}function Mo(t){const e=Su(t),n=Array.isArray(t.sections)?t.sections:[],r=[];e&&r.push(`# ${e}`);for(const s of n)gu(s,r);return r.length?r.join(`

`).trim():null}function ic(t){const e=Su(t),n=Array.isArray(t.sections)?t.sections:[];if(!e&&n.length===0)return null;const r=['<div class="wa-doc">'],s=e;r.push(`<div class="wa-header" contenteditable="false">${Te(s)}</div>`),r.push('<div class="wa-body">');const o=Oo(e);e&&r.push(`<div class="wa-title">${jr(e)}</div>`);for(const l of n)r.push(hu(l,o));return r.push("</div>"),r.push('<div class="wa-footer" contenteditable="false">Page 1</div>'),r.push("</div>"),r.join("")}function hu(t,e){const n=String(t.title||"").trim(),r=Math.min(6,Math.max(1,Number(t.level||2))),s=String(t.id||"").trim(),o=s?` data-section-id="${Te(s)}" data-section-level="${r}"`:"",l=mu({style:t.style}),a=`${o}${l}`,f=[];n&&(r===1&&e&&Oo(n)===e||f.push(No(r,n,a)));const p=Array.isArray(t.blocks)?t.blocks:[];for(const S of p){const $=_u(S);$&&f.push($)}const m=Array.isArray(t.children)?t.children:[];for(const S of m)f.push(hu(S,e));return f.join("")}function gu(t,e){const n=String(t.title||"").trim();if(n){const o=Math.min(6,Math.max(1,Number(t.level||2)));e.push(`${"#".repeat(o)} ${n}`)}const r=Array.isArray(t.blocks)?t.blocks:[];for(const o of r)e.push(...bu(o));const s=Array.isArray(t.children)?t.children:[];for(const o of s)gu(o,e)}function rv(t){const e=String(t.title||"").trim(),n=Array.isArray(t.sections)?t.sections:[],r=[];e&&r.push(`# ${e}`);for(const s of n){const o=String(s.title||s.name||s.section||"").trim();if(!o)continue;r.push(`## ${o}`);let l=s.content??s.text??s.body;Array.isArray(l)&&(l=l.map(f=>String(f||"").trim()).filter(Boolean).join(`

`));const a=String(l||"").trim();a&&r.push(a)}return r.length?r.join(`

`).trim():null}function Ra(t){const e=[];let n="";for(const r of t){const s=String(r.section_id||r.section_title||"").trim();if(s&&s!==n){const o=iv(s);o&&e.push(o),n=s}e.push(...bu(r))}return e.length?e.join(`

`).trim():null}function Pa(t,e){const n=['<div class="wa-doc">'],r=String(e||"").trim()||cl(t),s=r;n.push(`<div class="wa-header" contenteditable="false">${Te(s)}</div>`),n.push('<div class="wa-body">'),r&&n.push(`<div class="wa-title">${jr(r)}</div>`);let o="",l=!1;for(const a of t){const f=String(a.section_id||a.section_title||"").trim();if(f&&f!==o){const S=sv(f);S&&n.push(S),o=f}const p=String(a.type||"").toLowerCase();if(!l&&r&&p==="heading"&&Number(a.level||0)===1){const S=String(a.text||"").trim();if(Oo(S)===Oo(r)){l=!0;continue}}const m=_u(a);m&&n.push(m)}return n.push("</div>"),n.push('<div class="wa-footer" contenteditable="false">Page 1</div>'),n.push("</div>"),n.length>2?n.join(""):null}function iv(t){const e=/^H([1-6])::(.+)$/.exec(t);if(e){const n=Math.min(6,Math.max(1,Number(e[1]||2))),r=String(e[2]||"").trim();if(r)return`${"#".repeat(n)} ${r}`}return`## ${t}`}function sv(t){const e=/^H([1-6])::(.+)$/.exec(t);if(e){const n=Math.min(6,Math.max(1,Number(e[1]||2))),r=String(e[2]||"").trim();if(r)return No(n,r)}return No(2,t)}function ov(t){const e=String(t.id||"").trim();return e?` data-block-id="${Te(e)}"`:""}function mu(t){const e=t.style;if(!e||typeof e!="object")return"";const n=[],r=String(e.align||e.textAlign||"").trim();["left","center","right","justify"].includes(r)&&n.push(`text-align:${r}`);const s=String(e.lineHeight||"").trim();/^\d+(\.\d+)?$/.test(s)&&n.push(`line-height:${s}`);const o=String(e.indent||e.textIndent||"").trim();/^\d+(\.\d+)?(px|pt|em|rem)?$/.test(o)&&n.push(`text-indent:${o}`);const l=String(e.marginTop||"").trim();/^\d+(\.\d+)?(px|pt|em|rem)?$/.test(l)&&n.push(`margin-top:${l}`);const a=String(e.marginBottom||"").trim();/^\d+(\.\d+)?(px|pt|em|rem)?$/.test(a)&&n.push(`margin-bottom:${a}`);const f=String(e.fontFamily||"").trim();f&&f.length<80&&n.push(`font-family:${Te(f)}`);const p=String(e.fontSize||"").trim();/^\d+(\.\d+)?(px|pt|em|rem)?$/.test(p)&&n.push(`font-size:${p}`);const m=String(e.color||"").trim();(/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(m)||m.startsWith("rgb("))&&n.push(`color:${Te(m)}`);const S=String(e.background||e.backgroundColor||"").trim();return(/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(S)||S.startsWith("rgb("))&&n.push(`background-color:${Te(S)}`),n.length?` style="${n.join(";")}"`:""}function bu(t){const e=String(t.type||"paragraph").toLowerCase();if(e==="paragraph"||e==="text"||e==="p"){const r=Array.isArray(t.runs)?t.runs:null,o=(r&&r.length?r.map(l=>String(l.text||"")).join(""):String(t.text||"")).trim();return o?[o]:[]}if(e==="list"||e==="bullets"||e==="bullet"){const r=!!t.ordered,s=Array.isArray(t.items)?t.items:[];if(s.length){const a=s.map(f=>String(f||"").trim()).filter(Boolean);return r?a.map((f,p)=>`${p+1}. ${f}`):a.map(f=>`- ${f}`)}const o=String(t.text||"").trim();if(!o)return[];const l=o.split(/\n+/).map(a=>a.trim()).filter(Boolean);return r?l.map((a,f)=>{const p=a.replace(/^\d+[\.\)]\s+/,"");return`${f+1}. ${p}`}):l.map(a=>a.startsWith("-")?a:`- ${a}`)}if(e==="table"||e==="figure"){const r={};return typeof t.caption=="string"&&(r.caption=t.caption),Array.isArray(t.columns)&&(r.columns=t.columns),Array.isArray(t.rows)&&(r.rows=t.rows),t.data&&typeof t.data=="object"&&(r.data=t.data),[`[[${e==="table"?"TABLE":"FIGURE"}:${JSON.stringify(r)}]]`]}if(e==="reference"||e==="ref"){const r=String(t.text||"").trim();return r?[r]:(Array.isArray(t.items)?t.items:[]).map(o=>String(o||"").trim()).filter(Boolean)}const n=String(t.text||"").trim();return n?[n]:[]}function _u(t){const e=ov(t),n=mu(t),r=String(t.type||"paragraph").toLowerCase();if(r==="heading"){const o=Math.min(6,Math.max(1,Number(t.level||1))),l=String(t.text||""),a=Array.isArray(t.runs)?t.runs:null,f=l.trim(),p=`${e}${n}`;if(a&&a.length){const m=oc(a);return`<h${o}${p}>${m||"<br/>"}</h${o}>`}return f?No(o,l,p):p?`<h${o}${p}><br/></h${o}>`:""}if(r==="paragraph"||r==="text"||r==="p"){const o=String(t.text||""),l=Array.isArray(t.runs)?t.runs:null,a=o.trim(),f=`${e}${n}`;if(l&&l.length){const p=oc(l);return`<p${f}>${p||"<br/>"}</p>`}return a?`<p${f}>${jr(o).replace(/\n/g,"<br/>")}</p>`:f?`<p${f}><br/></p>`:""}if(r==="list"||r==="bullets"||r==="bullet"){let o=!!t.ordered;const l=Array.isArray(t.items)?t.items:[],a=l.length>0;let f=l.length?l.map(S=>String(S??"")):String(t.text||"").split(/\n+/).map(S=>S.trim()).filter(Boolean);if(!f.length&&!a)return"";if(!o){const S=/^\d+[\.\)]\s+/;f.filter(I=>S.test(I)).length===f.length&&(o=!0,f=f.map(I=>I.replace(S,"")))}const p=f.map(S=>{const $=String(S??"");return $.trim()?`<li>${jr($)}</li>`:"<li><br/></li>"}).join(""),m=`${e}${n}`;return o?`<ol${m}>${p}</ol>`:`<ul${m}>${p}</ul>`}if(r==="table"){const o=lv(t),l=o.caption||"Table",a=o.columns.length?o.columns:["Col 1","Col 2"],f=o.rows.length?o.rows:[["",""]],p=a.map($=>`<th>${Te($)}</th>`).join(""),m=f.map($=>{const I=Array.isArray($)?$:[$];return`<tr>${a.map((B,j)=>`<td>${Te(String(I[j]??""))}</td>`).join("")}</tr>`}).join("");return`<figure class="wa-table"${`${e}${n}`}><figcaption>${Te(l)}</figcaption><table><thead><tr>${p}</tr></thead><tbody>${m}</tbody></table></figure>`}if(r==="figure"){const o=cv(t),l=o.caption||"??",a=`${e}${n}`,f=o.spec&&typeof o.spec=="object"?o.spec:null,p=f?encodeURIComponent(JSON.stringify(f)):"",m=p?` data-figure-spec="${Te(p)}"`:"";return`<figure class="wa-figure"${a}${m}><div class="wa-figure-box">?</div><figcaption>${Te(l)}</figcaption></figure>`}if(r==="quote"){const o=String(t.text||"").trim();return o?`<blockquote>${jr(o)}</blockquote>`:""}const s=String(t.text||"").trim();return s?av(s):""}function No(t,e,n=""){const r=jr(e),s=Math.min(6,Math.max(1,Number(t||1)));return`<h${s}${n}>${r}</h${s}>`}function av(t){return`<p>${jr(t).replace(/\n/g,"<br/>")}</p>`}function lv(t){const e={caption:"",columns:[],rows:[]},n=t.table,r=typeof n=="object"&&n?n:t.data,s=typeof r=="object"&&r?r:t,o=String(s.caption||"").trim();e.caption=o;const l=s.columns;Array.isArray(l)&&(e.columns=l.map(f=>String(f)));const a=s.rows;return Array.isArray(a)&&(e.rows=a),e}function cv(t){const e=t.figure,n=typeof e=="object"&&e?e:null,s=String((n||t).caption||"").trim(),o=n?{...n}:{};return s&&(o.caption=s),{caption:s,spec:o}}function Oo(t){return String(t||"").trim().toLowerCase()}function yu(t){for(const e of t){const n=String(e.title||"").trim(),r=Number(e.level||0);if(n&&r<=1)return n;const s=Array.isArray(e.children)?e.children:[],o=yu(s);if(o)return o}return""}function cl(t){for(const e of t)if(String(e.type||"").toLowerCase()==="heading"&&Number(e.level||0)===1){const r=String(e.text||"").trim();if(r)return r}for(const e of t)if(String(e.type||"")==="paragraph"){const n=String(e.text||"").trim();if(n)return n.slice(0,24)}return""}const wu=["摘要","引言","绪论","背景","研究背景","目标","范围","术语","定义","需求","需求分析","总体设计","系统设计","架构设计","详细设计","模块设计","实现","关键技术","应用","方法","数据","分析","讨论","评估","结果","结论","总结","展望","风险","问题","计划","本周工作","下周计划","问题与风险","需协助事项","参考文献","附录","致谢"],oi=/[。！？!?；;，、]/,uv=["本文","本研究","本项目","随着","本周","本次","本节","我们","由于","因此","此外","同时","首先","其次","最后"];function sc(t){const e=String(t||"").trim();if(!e||e.length<=12&&!oi.test(e))return null;const n=/^(.{1,12})[:：](.+)$/.exec(e);if(n){const l=String(n[1]||"").trim(),a=String(n[2]||"").trim();if(l&&a&&(oi.test(a)||a.length>=12))return{heading:l.replace(/[：:、\-—\s]+$/g,""),rest:a.replace(/^[：:、\-—\s]+/g,"")}}const r=/^(.{2,10})\s*\1(.+)$/.exec(e);if(r){const l=String(r[1]||"").trim(),a=String(r[2]||"").trim();if(l&&a&&(oi.test(a)||a.length>=6))return{heading:l.replace(/[：:、\-—\s]+$/g,""),rest:a.replace(/^[：:、\-—\s]+/g,"")}}const s=wu.slice().sort((l,a)=>a.length-l.length);for(const l of s)if(e.startsWith(l)&&e.length>l.length+1){const a=e.slice(l.length).trim().replace(/^[：:、\-—\s]+/g,"");if(a&&(oi.test(a)||a.length>=12))return{heading:l,rest:a}}for(const l of s){const a=e.indexOf(l);if(a<=0)continue;const f=a+l.length;if(f>10)continue;const p=e.slice(0,f).trim(),m=e.slice(f).trim().replace(/^[：:、\-—\s]+/g,"");if(p&&m&&(oi.test(m)||m.length>=12))return{heading:p.replace(/[：:、\-—\s]+$/g,""),rest:m}}const o=e.search(/\b\d+(?:\.\d+)+\b/);if(o>0&&o<=12){const l=e.slice(0,o).trim(),a=e.slice(o).trim().replace(/^[：:、\-—\s]+/g,"");if(l&&a&&(oi.test(a)||a.length>=12))return{heading:l.replace(/[：:、\-—\s]+$/g,""),rest:a}}for(const l of uv){const a=e.indexOf(l);if(a>0&&a<=10){const f=e.slice(0,a).trim(),p=e.slice(a).trim().replace(/^[：:、\-—\s]+/g,"");if(f&&p&&p.length>=6&&!oi.test(f))return{heading:f.replace(/[：:、\-—\s]+$/g,""),rest:p}}}return null}function fv(t,e){const n=String(e).trim()||"自动生成文档",r=[],s=[];let o=[];const l=()=>{if(!o.length)return;const a={id:To(),title:n,level:1,blocks:o,children:[]};r.push(a),s.push({level:1,node:a}),o=[]};for(const a of t){if(String(a.type||"").toLowerCase()==="heading"){const m=Math.min(6,Math.max(1,Number(a.level||1))),S=String(a.text||"").trim()||"章节",$={id:To(),title:S,level:m,blocks:[],children:[]};for(o.length&&s.length===0&&l();s.length&&s[s.length-1].level>=m;)s.pop();s.length?s[s.length-1].node.children.push($):r.push($),s.push({level:m,node:$});continue}const p=dv(a);p&&(s.length?s[s.length-1].node.blocks.push(p):o.push(p))}return o.length&&!r.length&&r.push({id:To(),title:n,level:1,blocks:o,children:[]}),{title:n,sections:r}}function dv(t){const e=String(t.type||"paragraph").toLowerCase(),r=String(t.id||"").trim()||To();if(e==="paragraph"){const o=String(t.text||"").trim();return o?{id:r,type:"paragraph",text:o}:null}if(e==="list"){const o=Array.isArray(t.items)?t.items.map(a=>String(a||"").trim()).filter(Boolean):[];if(!o.length)return null;const l=!!t.ordered;return{id:r,type:"list",items:o,ordered:l}}if(e==="table")return{id:r,type:"table",table:t.table||{}};if(e==="figure")return{id:r,type:"figure",figure:t.figure||{}};const s=String(t.text||"").trim();return s?{id:r,type:"paragraph",text:s}:null}function To(){return typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID().replace(/-/g,""):`b${Math.random().toString(16).slice(2)}${Date.now().toString(16)}`}function Su(t){const e=String(t.title||"").trim();if(e)return e;const n=Array.isArray(t.sections)?t.sections:[],r=yu(n);if(r)return r;if(n.length===1){const o=n[0],l=Number(o.level||0),a=String(o.title||"").trim();if(a&&l<=1)return a}const s=Array.isArray(t.blocks)?t.blocks:[];return cl(s)}function xu(t){const e=[];let n=[],r=!1;const s=()=>{n.length>=4?e.push(n.join("")):e.push(...n),n=[]};for(const o of t){const l=o.trim();if(!l){s(),r||(e.push(""),r=!0);continue}r=!1;const a=l.length<=1,f=/[\u4e00-\u9fa5A-Za-z0-9\.\-\u3000-\u303F]/.test(l);if(a&&f){n.push(l);continue}s(),e.push(o)}return s(),e}function jr(t){let e=Te(t);return e=e.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/\*(.+?)\*/g,"<em>$1</em>"),e=e.replace(/~~(.+?)~~/g,"<del>$1</del>"),e=e.replace(/==(.+?)==/g,"<mark>$1</mark>"),e=e.replace(/\+\+(.+?)\+\+/g,"<u>$1</u>"),e=e.replace(/\[(.+?)\]\((.+?)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>'),e}function vv(t){const e=[],n=String(t.color||"").trim();(/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(n)||n.startsWith("rgb("))&&e.push(`color:${Te(n)}`);const r=String(t.background||"").trim();(/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(r)||r.startsWith("rgb("))&&e.push(`background-color:${Te(r)}`);const s=String(t.font||"").trim();s&&s.length<80&&e.push(`font-family:${Te(s)}`);const o=String(t.size||"").trim();return/^\d+(\.\d+)?(px|pt|em|rem)?$/.test(o)&&e.push(`font-size:${o}`),e.length?` style="${e.join(";")}"`:""}function oc(t){const e=[];return t.forEach(n=>{const r=String(n.text||"");if(!r)return;let s=Te(r).replace(/\n/g,"<br/>");n.bold&&(s=`<strong>${s}</strong>`),n.italic&&(s=`<em>${s}</em>`),n.underline&&(s=`<u>${s}</u>`),n.strike&&(s=`<del>${s}</del>`);const o=String(n.link||"").trim();o&&(s=`<a href="${Te(o)}" target="_blank" rel="noopener">${s}</a>`);const l=vv(n);l&&(s=`<span${l}>${s}</span>`),e.push(s)}),e.join("")}function Te(t){return String(t||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var pv=G('<button class="dropdown-item svelte-1ctqrjb"> </button>'),hv=G('<div class="dropdown-panel svelte-1ctqrjb"></div>'),gv=G("<option> </option>"),mv=G('<button class="color-item svelte-1ctqrjb"></button>'),bv=G('<div class="dropdown-panel color-grid svelte-1ctqrjb"></div>'),_v=G('<button class="color-item svelte-1ctqrjb"></button>'),yv=G('<div class="dropdown-panel color-grid svelte-1ctqrjb"></div>'),wv=G('<button class="dropdown-item svelte-1ctqrjb"> </button>'),Sv=G('<div class="dropdown-panel svelte-1ctqrjb"></div>'),xv=G('<div class="dropdown-panel svelte-1ctqrjb"><button class="dropdown-item svelte-1ctqrjb">插入表格</button> <button class="dropdown-item svelte-1ctqrjb">合并单元格</button> <button class="dropdown-item svelte-1ctqrjb">插入行</button> <button class="dropdown-item svelte-1ctqrjb">插入列</button> <button class="dropdown-item svelte-1ctqrjb">删除行</button> <button class="dropdown-item svelte-1ctqrjb">删除列</button></div>'),kv=G('<div class="panel-header svelte-1ctqrjb"><div class="panel-title">正文编辑</div> <div class="editor-stats svelte-1ctqrjb"><span> </span> <span>·</span> <span> </span></div></div> <div class="extended-toolbar svelte-1ctqrjb"><div class="toolbar-group svelte-1ctqrjb"><button class="tool-btn svelte-1ctqrjb" title="字体"><span style="font-family: serif;">A</span></button> <!></div> <div class="toolbar-group svelte-1ctqrjb"><select class="tool-select svelte-1ctqrjb"><option>字号</option><!></select></div> <div class="toolbar-group svelte-1ctqrjb"><button class="tool-btn svelte-1ctqrjb" title="文字颜色"><span style="color: #FF0000;">A</span></button> <!></div> <div class="toolbar-group svelte-1ctqrjb"><button class="tool-btn svelte-1ctqrjb" title="背景颜色"><span style="background: #FFFF00;">█</span></button> <!></div> <span class="separator svelte-1ctqrjb"></span> <button class="tool-btn svelte-1ctqrjb" title="左对齐">≡</button> <button class="tool-btn svelte-1ctqrjb" title="居中">≡</button> <button class="tool-btn svelte-1ctqrjb" title="右对齐">≡</button> <button class="tool-btn svelte-1ctqrjb" title="两端对齐">≡</button> <span class="separator svelte-1ctqrjb"></span> <button class="tool-btn svelte-1ctqrjb" title="上标">x²</button> <button class="tool-btn svelte-1ctqrjb" title="下标">x₂</button> <button class="tool-btn svelte-1ctqrjb" title="水平线">—</button> <span class="separator svelte-1ctqrjb"></span> <div class="toolbar-group svelte-1ctqrjb"><button class="tool-btn svelte-1ctqrjb" title="行距">≣</button> <!></div> <button class="tool-btn svelte-1ctqrjb" title="首行缩进">¶</button> <button class="tool-btn svelte-1ctqrjb" title="段间距">⇕</button> <span class="separator svelte-1ctqrjb"></span> <button class="tool-btn svelte-1ctqrjb" title="行内公式">𝑓(𝑥)</button> <button class="tool-btn svelte-1ctqrjb" title="公式块">∫</button> <span class="separator svelte-1ctqrjb"></span> <button class="tool-btn svelte-1ctqrjb" title="插入脚注">※</button> <button class="tool-btn svelte-1ctqrjb" title="生成目录">☰</button> <span class="separator svelte-1ctqrjb"></span> <div class="toolbar-group svelte-1ctqrjb"><button class="tool-btn svelte-1ctqrjb" title="表格">⊞</button> <!></div></div>',1),$v=G('<div class="block-marquee svelte-1ctqrjb" aria-hidden="true"></div>'),Ev=G('<div class="find-replace-panel svelte-1ctqrjb"><div class="find-replace-row svelte-1ctqrjb"><input type="text" placeholder="查找..." class="svelte-1ctqrjb"/> <button class="btn-small svelte-1ctqrjb">下一个</button> <button class="btn-small svelte-1ctqrjb">✕</button></div> <div class="find-replace-row svelte-1ctqrjb"><input type="text" placeholder="替换为..." class="svelte-1ctqrjb"/> <button class="btn-small svelte-1ctqrjb">替换</button> <button class="btn-small svelte-1ctqrjb">全部替换</button></div></div>'),Tv=G('<div><!> <div class="editable svelte-1ctqrjb" contenteditable="false" role="region" aria-label="文档编辑区"></div> <!> <!></div>');function ku(t,e){if(new.target)return sr({component:ku,...t});Hn(e,!1);const n=()=>qe(Xe,"$sourceText",o),r=()=>qe(Ge,"$docIr",o),s=()=>qe(ll,"$wordCount",o),[o,l]=Ss();let a=V(null),f="",p=V("text"),m=null,S=null,$=null,I=kn(e,"showToolbar",12,!0),M=kn(e,"paper",12,!0);const B=rl();let j=null,J=!1,ft=null,et="",ot=null,Q=[],mt=[],it="",R=null,ut=V(!1),K=V({left:0,top:0,width:0,height:0}),lt=!1;function dt(c){if(!i(a))return;const d=!String(c||"").trim();ai(a,i(a).dataset.empty=d?"1":"0")}function Nt(){if(!i(a))return;const c=String(n()||""),d=r(),b=!!(d&&typeof d=="object"),k=!b,A=b?`doc:${Lt(d)}`:`text:${c}`;if(j&&i(a).contains(j)&&A!==f){ft=A;return}A!==f&&(m&&clearTimeout(m),m=setTimeout(()=>{if(ai(a,i(a).innerHTML=Qd(c,d,k)),g(p,k?"text":"doc"),f=A,ft=null,dt(c),ee(),cn(),et){const L=i(a).querySelector(`[data-block-id="${CSS.escape(et)}"]`);et="",L&&L.focus()}ro(),Xr(),ur()},100))}function Lt(c){try{return JSON.stringify(c)||""}catch{return""}}function Tt(c){c.setAttribute("contenteditable","true"),c.setAttribute("spellcheck","false"),c.dataset.waEdit="1"}function ee(){if(!i(a))return;const c=i(a).querySelector(".wa-title");c&&(c.dataset.docTitle="1",Tt(c)),i(a).querySelectorAll("[data-section-id]").forEach(d=>{Tt(d)}),i(a).querySelectorAll("[data-block-id]").forEach(d=>{const b=d,k=b.tagName.toLowerCase();if(k==="figure"||k==="table"){b.setAttribute("contenteditable","false");return}Tt(b)})}function Ut(c){if(!c||!(c instanceof HTMLElement)||!i(a))return null;const d=c.closest('[data-wa-edit="1"]');return!d||!i(a).contains(d)?null:d}function Dt(c){let d=String(c||"").replace(/\r/g,"");return d=d.replace(/[ \t]+/g," "),d=d.replace(/[ \t]*\n[ \t]*/g,`
`),d=d.replace(/\n{3,}/g,`

`),d.trim()}function Pt(c){if(c.nodeType===Node.TEXT_NODE)return c.textContent||"";if(!(c instanceof HTMLElement))return"";const d=c.tagName.toLowerCase();if(d==="br")return`
`;if(d==="strong"||d==="b")return`**${St(c)}**`;if(d==="em"||d==="i")return`*${St(c)}*`;if(d==="u")return`++${St(c)}++`;if(d==="del"||d==="s")return`~~${St(c)}~~`;if(d==="mark")return`==${St(c)}==`;if(d==="code")return"`"+(c.textContent||"")+"`";if(d==="a"){const b=c.getAttribute("href")||"",k=St(c);return b?`[${k}](${b})`:k}return St(c)}function St(c){const d=[];return c.childNodes.forEach(b=>d.push(Pt(b))),Dt(d.join(""))}function ce(c){if(c.nodeType===Node.TEXT_NODE)return c.textContent||"";if(!(c instanceof HTMLElement))return"";if(c.tagName.toLowerCase()==="br")return`
`;const b=[];return c.childNodes.forEach(k=>b.push(ce(k))),b.join("")}function ve(c){const d=[];return c.childNodes.forEach(b=>d.push(ce(b))),d.join("")}function _e(c){const d=document.createElement("div");return d.appendChild(c),St(d)}function nt(c){const d=window.getSelection();if(!d||d.rangeCount===0)return null;const b=d.getRangeAt(0);if(!c.contains(b.startContainer))return null;const k=b.cloneRange();k.selectNodeContents(c),k.setEnd(b.startContainer,b.startOffset);const A=b.cloneRange();A.selectNodeContents(c),A.setStart(b.startContainer,b.startOffset);const L=_e(k.cloneContents()),F=_e(A.cloneContents());return{before:L,after:F}}function rt(c){if(c.nodeType===Node.TEXT_NODE)return(c.textContent||"").length;if(!(c instanceof HTMLElement))return 0;if(c.tagName.toLowerCase()==="br")return 1;let b=0;return c.childNodes.forEach(k=>{b+=rt(k)}),b}function _t(c){const d=window.getSelection();if(!d||d.rangeCount===0)return null;const b=d.getRangeAt(0),k=b.startContainer;if(!c.contains(k))return null;let A=0,L=!1;const F=U=>{if(!L){if(U===k){if(U.nodeType===Node.TEXT_NODE)A+=b.startOffset;else if(U instanceof HTMLElement){const Z=Array.from(U.childNodes);for(let O=0;O<b.startOffset;O++)A+=rt(Z[O])}L=!0;return}if(U.nodeType===Node.TEXT_NODE||U instanceof HTMLElement&&U.tagName.toLowerCase()==="br"){A+=rt(U);return}U.childNodes.forEach(Z=>F(Z))}};return F(c),A}function Ft(c){const d=c.style,b={},k=d.textAlign||c.getAttribute("align")||"";k&&(b.align=k);const A=d.lineHeight;A&&(b.lineHeight=A);const L=d.textIndent;L&&(b.indent=L);const F=d.marginTop;F&&(b.marginTop=F);const U=d.marginBottom;U&&(b.marginBottom=U);const Z=d.fontFamily;Z&&(b.fontFamily=Z);const O=d.fontSize;O&&(b.fontSize=O);const H=d.color;H&&(b.color=H);const tt=d.backgroundColor;return tt&&(b.background=tt),Object.keys(b).length?b:null}function Ct(c){const d=[],b=(O,H)=>{O&&d.push({text:O,bold:H.bold,italic:H.italic,underline:H.underline,strike:H.strike,color:H.color,background:H.background,font:H.font,size:H.size,link:H.link})},k=O=>{const H=String(O||"").trim();return H?H.split(",")[0].replace(/["']/g,"").trim():""},A=(O,H)=>{if(O.nodeType===Node.TEXT_NODE){b(O.textContent||"",H);return}if(!(O instanceof HTMLElement))return;const tt=O.tagName.toLowerCase();if(tt==="br"){b(`
`,H);return}const X={...H};if((tt==="strong"||tt==="b")&&(X.bold=!0),(tt==="em"||tt==="i")&&(X.italic=!0),tt==="u"&&(X.underline=!0),(tt==="s"||tt==="del"||tt==="strike")&&(X.strike=!0),tt==="a"){const at=O.getAttribute("href")||"";at&&(X.link=at)}if(tt==="font"){const at=O.getAttribute("color");at&&(X.color=at);const ht=O.getAttribute("face");ht&&(X.font=k(ht));const jt=O.getAttribute("size");jt&&(X.size=String(jt))}const st=O.style;if(st){st.color&&(X.color=st.color),st.backgroundColor&&(X.background=st.backgroundColor),st.fontFamily&&(X.font=k(st.fontFamily)),st.fontSize&&(X.size=st.fontSize);const at=st.textDecoration;at&&at.includes("underline")&&(X.underline=!0),at&&at.includes("line-through")&&(X.strike=!0)}O.childNodes.forEach(at=>A(at,X))};A(c,{});const L=[],F=O=>[O.bold?"b":"",O.italic?"i":"",O.underline?"u":"",O.strike?"s":"",O.color||"",O.background||"",O.font||"",O.size||"",O.link||""].join("|");d.forEach(O=>{const H=L[L.length-1];H&&F(H)===F(O)?H.text+=O.text:L.push({...O})});const U=Dt(L.map(O=>O.text).join("")),Z=L.some(O=>Object.keys(O).some(H=>H!=="text"&&O[H]));return{text:U,runs:Z?L:null}}function vn(c){if(c.dataset.docTitle==="1")return{kind:"title",text:St(c)};const d=String(c.dataset.sectionId||"").trim();if(d)return{kind:"section",id:d,text:St(c),style:Ft(c)};const b=String(c.dataset.blockId||"").trim();if(!b)return null;const k=c.tagName.toLowerCase();if(k==="ul"||k==="ol"){const O={type:"list",items:Array.from(c.querySelectorAll(":scope > li")).map(tt=>Dt(St(tt))),ordered:k==="ol"},H=Ft(c);return H&&(O.style=H),{kind:"block",id:b,payload:O}}if(/^h[1-6]$/.test(k)){const Z=Number(k.slice(1)),O=Ct(c),H=O.text.replace(/\n+/g," ").trim(),tt={type:"heading",level:Z,text:H};O.runs&&(tt.runs=O.runs);const X=Ft(c);return X&&(tt.style=X),{kind:"block",id:b,payload:tt}}const A=Ct(c),F={type:"paragraph",text:A.text};A.runs&&(F.runs=A.runs);const U=Ft(c);return U&&(F.style=U),{kind:"block",id:b,payload:F}}function $n(c){S&&clearTimeout(S),S=setTimeout(()=>{const d=Mo(c)||"";Xe.set(d),dt(d),Hd(d)},180)}function le(c){Ge.set(c),He.set(!1),f=`doc:${Lt(c)}`,$n(c)}function Ue(c,d){const b=String(d||"").trim()||"自动生成文档",k=String(c.title||"").trim();let A=!1;b!==k&&(A=!0);const L=Z=>{let O=!1;const H=Z.map(tt=>{let X=!1,st=tt;String(tt.title||"").trim()===k&&(st={...tt,title:b},X=!0);const at=Array.isArray(tt.children)?tt.children:[];if(at.length){const ht=L(at);ht!==at&&(st={...st,children:ht},X=!0)}return X&&(O=!0),st});return O&&(A=!0),O?H:Z},F=Array.isArray(c.sections)?c.sections:[],U=L(F);return A?{...c,title:b,sections:U}:null}function ne(c,d,b,k){const A=String(b||"").trim()||"章节";let L=!1;const F=O=>{let H=!1;const tt=O.map(X=>{let st=!1,at=X;String(X.id||"")===d&&(at={...X,title:A},k&&Object.keys(k).length&&(at={...at,style:k}),st=!0);const ht=Array.isArray(X.children)?X.children:[];if(ht.length){const jt=F(ht);jt!==ht&&(at={...at,children:jt},st=!0)}return st&&(H=!0),at});return H&&(L=!0),H?tt:O},U=Array.isArray(c.sections)?c.sections:[],Z=F(U);return L?{...c,sections:Z}:null}function Me(c,d,b){let k=!1;const A=U=>{let Z=!1;const O=U.map(H=>{let tt=!1,X=H;const st=Array.isArray(H.blocks)?H.blocks:[];if(st.length){const ht=st.findIndex(jt=>String(jt.id||"")===d);if(ht>=0){const jt=st[ht]||{},Se={...jt,...b,id:jt.id||d},Be=st.slice();Be[ht]=Se,X={...X,blocks:Be},tt=!0}}const at=Array.isArray(H.children)?H.children:[];if(at.length){const ht=A(at);ht!==at&&(X={...X,children:ht},tt=!0)}return tt&&(Z=!0),X});return Z&&(k=!0),Z?O:U},L=Array.isArray(c.sections)?c.sections:[],F=A(L);return k?{...c,sections:F}:null}function En(c,d,b){let k=!1;const A=U=>{let Z=!1;const O=U.map(H=>{let tt=!1,X=H;const st=Array.isArray(H.blocks)?H.blocks:[];if(st.length){const ht=st.findIndex(jt=>String(jt.id||"")===d);if(ht>=0){const jt=st.slice();jt.splice(ht+1,0,b),X={...X,blocks:jt},tt=!0}}const at=Array.isArray(H.children)?H.children:[];if(at.length){const ht=A(at);ht!==at&&(X={...X,children:ht},tt=!0)}return tt&&(Z=!0),X});return Z&&(k=!0),Z?O:U},L=Array.isArray(c.sections)?c.sections:[],F=A(L);return k?{...c,sections:F}:null}function lr(c,d,b){let k=!1;const A=U=>{let Z=!1;const O=U.map(H=>{let tt=!1,X=H;const st=Array.isArray(H.blocks)?H.blocks:[];if(st.length){const ht=st.findIndex(jt=>String(jt.id||"")===d);if(ht>=0){const jt=st.slice();jt.splice(ht,0,b),X={...X,blocks:jt},tt=!0}}const at=Array.isArray(H.children)?H.children:[];if(at.length){const ht=A(at);ht!==at&&(X={...X,children:ht},tt=!0)}return tt&&(Z=!0),X});return Z&&(k=!0),Z?O:U},L=Array.isArray(c.sections)?c.sections:[],F=A(L);return k?{...c,sections:F}:null}function wr(c,d,b){let k=!1;const A=O=>{const H=String(O.type||"paragraph").toLowerCase();if(H==="list"){const tt=Array.isArray(O.items)?O.items:[],X=tt.map(st=>String(st??"").replace(d,b));return X.join("")!==tt.join("")?(k=!0,{...O,items:X}):O}if(H==="table"){const tt=typeof O.table=="object"&&O.table?O.table:null;if(tt&&typeof tt.caption=="string"){const X=String(tt.caption||"").replace(d,b);if(X!==tt.caption)return k=!0,{...O,table:{...tt,caption:X}}}return O}if(H==="figure"){const tt=typeof O.figure=="object"&&O.figure?O.figure:null;if(tt&&typeof tt.caption=="string"){const X=String(tt.caption||"").replace(d,b);if(X!==tt.caption)return k=!0,{...O,figure:{...tt,caption:X}}}return O}if(typeof O.text=="string"){const tt=String(O.text||"").replace(d,b);if(tt!==O.text)return k=!0,{...O,text:tt}}return O},L=O=>{let H=!1;const tt=O.map(X=>{let st=!1,at=X;if(typeof X.title=="string"){const Se=String(X.title||"").replace(d,b);Se!==X.title&&(at={...at,title:Se},st=!0,k=!0)}const ht=Array.isArray(X.blocks)?X.blocks:[];if(ht.length){const Se=ht.map(Be=>A(Be));Se.some((Be,ie)=>Be!==ht[ie])&&(at={...at,blocks:Se},st=!0)}const jt=Array.isArray(X.children)?X.children:[];if(jt.length){const Se=L(jt);Se!==jt&&(at={...at,children:Se},st=!0)}return st&&(H=!0),st?at:X});return H?tt:O},F={...c};if(typeof F.title=="string"){const O=String(F.title||"").replace(d,b);O!==F.title&&(F.title=O,k=!0)}const U=Array.isArray(F.sections)?F.sections:[],Z=L(U);return Z!==U&&(F.sections=Z),k?F:null}function tn(c,d=160){ot&&clearTimeout(ot),ot=setTimeout(()=>{ln(c)},d)}function ln(c){const d=r();if(!d||typeof d!="object")return;const b=vn(c);if(!b)return;let k=null;b.kind==="title"?k=Ue(d,String(b.text||"")):b.kind==="section"?k=ne(d,String(b.id||""),String(b.text||""),b.style||null):b.kind==="block"&&(k=Me(d,String(b.id||""),b.payload||{})),k&&le(k)}function Tn(){return i(a)?Array.from(i(a).querySelectorAll("[data-block-id]")):[]}function Wt(c){return String((c==null?void 0:c.dataset.blockId)||"").trim()}function An(c){return!i(a)||!c?null:i(a).querySelector(`[data-block-id="${CSS.escape(c)}"]`)}function qn(c){const d=new Set,b=[];for(const k of c){const A=String(k||"").trim();!A||d.has(A)||(d.add(A),b.push(A))}return b}function ue(c){const d=new Set(qn(c)),b=[];for(const k of Tn()){const A=Wt(k);A&&d.has(A)&&b.push(A)}return b}function pn(){const c=mt.map(L=>{const F=Wt(L),U=ve(L);return{id:F,text:U,style:Ft(L)||{}}});if(!c.length){B("blockselect",{blockId:"",blockIds:[],blocks:[],text:"",rect:null,style:{}});return}const d=mt[0],b=Wt(d),k=ve(d),A=d.getBoundingClientRect();B("blockselect",{blockId:b,blockIds:Q.slice(),blocks:c,text:k,rect:{top:A.top,left:A.left,width:A.width,height:A.height},style:Ft(d)||{}})}function pe(c,d){for(const b of mt)b.classList.remove("wa-block-selected");Q=ue(c),mt=Q.map(b=>An(b)).filter(b=>!!b);for(const b of mt)b.classList.add("wa-block-selected");d&&Q.includes(d)?it=d:Q.length===1?it=Q[0]:Q.length||(it=""),pn()}function en(){pe([])}function cn(){!i(a)||!Q.length||pe(Q,it)}function hn(c){const b=Tn().map(Z=>Wt(Z)).filter(Boolean),k=it&&b.includes(it)?it:b[0]||"",A=b.indexOf(k),L=b.indexOf(c);if(A<0||L<0){pe([c],c);return}const[F,U]=A<=L?[A,L]:[L,A];pe(b.slice(F,U+1),k)}function ye(c){const d=Q.includes(c),b=d?Q.filter(k=>k!==c):[...Q,c];pe(b,d?it:c)}function Xt(c,d){const b=Math.min(c.x,d.x),k=Math.min(c.y,d.y),A=Math.abs(c.x-d.x),L=Math.abs(c.y-d.y);return{left:b,top:k,width:A,height:L}}function Cn(c,d){const b=c.left+c.width,k=c.top+c.height,A=d.left+d.width,L=d.top+d.height;return!(b<d.left||A<c.left||k<d.top||L<c.top)}function De(c){const d=[];for(const b of Tn()){const k=Wt(b);k&&Cn(c,b.getBoundingClientRect())&&d.push(k)}return d}function he(c){var A;if(!R)return;const d={x:c.clientX,y:c.clientY},b=Xt(R,d);if(!i(ut)){if(b.width<10&&b.height<10)return;g(ut,!0),lt=!0,(A=window.getSelection())==null||A.removeAllRanges()}c.preventDefault(),g(K,b);const k=De(b);k.length?pe(k,k[0]):pe([])}function re(){R=null,g(ut,!1),g(K,{left:0,top:0,width:0,height:0}),window.removeEventListener("mousemove",he),window.removeEventListener("mouseup",ge)}function ge(){re()}function jn(c){if(!i(a)||c.button!==0)return;const d=c.target;!d||!i(a).contains(d)||d.closest('a,button,input,textarea,select,[data-wa-no-marquee="1"]')||(R={x:c.clientX,y:c.clientY},g(ut,!1),g(K,{left:c.clientX,top:c.clientY,width:0,height:0}),window.addEventListener("mousemove",he),window.addEventListener("mouseup",ge))}function Jn(c){if(lt){lt=!1;return}const d=c.target;if(!d||!i(a))return;const b=d.closest("[data-block-id]");if(!b||!i(a).contains(b)){en();return}const k=Wt(b);if(!k){en();return}const A=c.ctrlKey||c.metaKey;if(c.shiftKey){hn(k);return}if(A){ye(k);return}pe([k],k)}function Ri(c){const d=Ut(c.target);d&&(j=d,String(d.dataset.blockId||d.dataset.sectionId||d.dataset.docTitle||""))}function Lr(c){const d=Ut(c.target);d&&(ln(d),j===d&&(j=null),ft&&ft!==f&&Nt())}function cr(c){if(J)return;const d=Ut(c.target);d&&tn(d)}function Gt(){J=!0}function Yt(c){J=!1,cr(c)}function Ht(){return typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID().replace(/-/g,""):`b${Math.random().toString(16).slice(2)}${Date.now().toString(16)}`}function We(){if(!i(a))return null;const c=document.activeElement;if(c&&i(a).contains(c)&&c.isContentEditable)return c;const d=mt[0]||null;if(d&&d.isContentEditable)return d.focus(),d;const b=i(a).querySelector('[data-wa-edit="1"]');return b?(b.focus(),b):null}function yt(c){if(We()){if(c==="bold")return document.execCommand("bold");if(c==="italic")return document.execCommand("italic");if(c==="underline")return document.execCommand("underline");if(c==="strikethrough")return document.execCommand("strikeThrough");if(c==="superscript")return document.execCommand("superscript");if(c==="subscript")return document.execCommand("subscript");if(c==="heading1")return document.execCommand("formatBlock",!1,"H1");if(c==="heading2")return document.execCommand("formatBlock",!1,"H2");if(c==="heading3")return document.execCommand("formatBlock",!1,"H3");if(c==="paragraph")return document.execCommand("formatBlock",!1,"P");if(c==="list-bullet")return document.execCommand("insertUnorderedList");if(c==="list-number")return document.execCommand("insertOrderedList");if(c==="indent")return document.execCommand("indent");if(c==="outdent")return document.execCommand("outdent");if(c==="quote")return document.execCommand("formatBlock",!1,"BLOCKQUOTE");if(c==="align-left")return document.execCommand("justifyLeft");if(c==="align-center")return document.execCommand("justifyCenter");if(c==="align-right")return document.execCommand("justifyRight");if(c==="align-justify")return document.execCommand("justifyFull");if(c.startsWith("line-height:")){const d=c.slice(12),b=window.getSelection();if(b&&b.rangeCount){let A=b.getRangeAt(0).commonAncestorContainer;if(A.nodeType===Node.TEXT_NODE&&(A=A.parentElement),A instanceof HTMLElement){let L=A.closest("p, div, h1, h2, h3, blockquote");L instanceof HTMLElement&&(L.style.lineHeight=d)}}return}if(c.startsWith("margin:")){const d=c.slice(7),b=window.getSelection();if(b&&b.rangeCount){let A=b.getRangeAt(0).commonAncestorContainer;if(A.nodeType===Node.TEXT_NODE&&(A=A.parentElement),A instanceof HTMLElement){let L=A.closest("p, div, h1, h2, h3");L instanceof HTMLElement&&(L.style.margin=d)}}return}if(c==="indent-first"){const d=window.getSelection();if(d&&d.rangeCount){let k=d.getRangeAt(0).commonAncestorContainer;if(k.nodeType===Node.TEXT_NODE&&(k=k.parentElement),k instanceof HTMLElement){let A=k.closest("p, div");A instanceof HTMLElement&&(A.style.textIndent="2em")}}return}if(c.startsWith("color:")){const d=c.slice(6);return document.execCommand("foreColor",!1,d)}if(c.startsWith("bgcolor:")){const d=c.slice(8);return document.execCommand("hiliteColor",!1,d)}if(c.startsWith("font:")){const d=c.slice(5);return document.execCommand("fontName",!1,d)}if(c.startsWith("size:")){const d=c.slice(5),b=window.getSelection();if(b&&b.rangeCount){const k=b.getRangeAt(0),A=document.createElement("span");A.style.fontSize=d+"px",k.surroundContents(A)}return}if(c==="code"){const d=window.getSelection(),b=d&&d.rangeCount?d.getRangeAt(0).toString():"";return document.execCommand("insertHTML",!1,`<pre><code>${Dr(b||"")}</code></pre>`)}if(c==="image"){const d=document.createElement("input");d.type="file",d.accept="image/*",d.onchange=async b=>{var L;const k=(L=b.target.files)==null?void 0:L[0];if(!k)return;const A=new FileReader;A.onload=F=>{var Z;const U=(Z=F.target)==null?void 0:Z.result;document.execCommand("insertHTML",!1,`<img src="${U}" alt="图片" style="max-width:100%;height:auto;" />`)},A.readAsDataURL(k)},d.click();return}if(c==="table"){const d=prompt("行数：","3"),b=prompt("列数：","3");if(!d||!b)return;let k='<table style="border-collapse:collapse;width:100%;margin:10px 0;">';for(let A=0;A<parseInt(d);A++){k+="<tr>";for(let L=0;L<parseInt(b);L++)k+='<td style="border:1px solid #ccc;padding:8px;min-width:80px;">　</td>';k+="</tr>"}return k+="</table>",document.execCommand("insertHTML",!1,k)}if(c==="link"){const d=prompt("请输入链接地址：","https://");d&&document.execCommand("createLink",!1,d);return}if(c==="hr")return document.execCommand("insertHTML",!1,'<hr style="border:none;border-top:1px solid #ddd;margin:16px 0;" />');if(c==="math-inline"){const d=prompt("输入行内公式（LaTeX）：","x^2 + y^2 = r^2");d&&document.execCommand("insertHTML",!1,`<span class="math-inline" data-latex="${Dr(d)}">$${d}$</span>`);return}if(c==="math-block"){const d=prompt("输入公式块（LaTeX）：","\\int_{-\\infty}^{\\infty} e^{-x^2} dx = \\sqrt{\\pi}");d&&document.execCommand("insertHTML",!1,`<div class="math-block" data-latex="${Dr(d)}">$$${d}$$</div>`);return}if(c==="footnote"){const d=prompt("脚注内容：");if(!d)return;const b="fn-"+Date.now(),k=`<sup><a href="#${b}" id="ref-${b}" style="color:#a5722a;text-decoration:none;">[${xs()}]</a></sup>`;document.execCommand("insertHTML",!1,k),Xo(b,d,xs());return}if(c==="toc"){const d=Yo();document.execCommand("insertHTML",!1,d);return}if(c==="undo")return zd();if(c==="redo")return Jd();if(c==="clear-format")return document.execCommand("removeFormat")}}function Fe(c){const d=c.ctrlKey||c.metaKey;if(d&&c.key==="b"&&(c.preventDefault(),yt("bold")),d&&c.key==="i"&&(c.preventDefault(),yt("italic")),d&&c.key==="u"&&(c.preventDefault(),yt("underline")),d&&c.shiftKey&&c.key==="X"&&(c.preventDefault(),yt("strikethrough")),d&&c.key==="z"&&(c.preventDefault(),yt("undo")),d&&c.key==="y"&&(c.preventDefault(),yt("redo")),d&&c.key==="k"&&(c.preventDefault(),yt("link")),d&&c.key==="f"&&(c.preventDefault(),g(fe,!0)),c.key==="Enter"&&!c.shiftKey){const b=Ut(c.target);if(b&&b.dataset.blockId){const k=b.tagName.toLowerCase();if(k==="ul"||k==="ol"){c.preventDefault();const A=r();if(!A||typeof A!="object")return;const L=String(b.dataset.blockId),F=window.getSelection(),U=F==null?void 0:F.anchorNode,Z=U instanceof HTMLElement?U:U==null?void 0:U.parentElement,O=Z?Z.closest("li"):null;if(!O||!b.contains(O))return;const H=Array.from(b.querySelectorAll(":scope > li")),tt=H.indexOf(O);if(tt<0)return;let X="",st="";const at=nt(O);if(at)X=at.before,st=at.after;else{const ie=ve(O),Jt=_t(O),bn=Jt==null?ie.length:Math.max(0,Math.min(ie.length,Jt));X=ie.slice(0,bn),st=ie.slice(bn)}const ht=Dt(X),jt=Dt(st);if(!ht&&!jt){const ie=H.map((Jt,bn)=>bn===tt?null:Dt(St(Jt))).filter(Jt=>Jt!==null);if(ie.length){const Jt=Me(A,L,{type:"list",items:ie,ordered:k==="ol"});if(Jt){const bn={id:Ht(),type:"paragraph",text:""},kr=En(Jt,L,bn);if(kr){et=String(bn.id||""),le(kr);return}le(Jt)}}else{const Jt=Me(A,L,{type:"paragraph",text:"",items:[],ordered:!1});Jt&&(et=L,le(Jt))}return}const Se=H.map((ie,Jt)=>Jt===tt?ht:Dt(St(ie)));Se.splice(tt+1,0,jt);const Be=Me(A,L,{type:"list",items:Se,ordered:k==="ol"});Be&&(et=L,le(Be));return}if(k==="p"||/^h[1-6]$/.test(k)){c.preventDefault();const A=r();if(!A||typeof A!="object")return;const L=String(b.dataset.blockId),F=ve(b),U=_t(b),Z=U==null?F.length:Math.max(0,Math.min(F.length,U)),O=F.slice(0,Z),H=F.slice(Z),tt=Dt(O),X=Dt(H),st=Ft(b),at=/^h[1-6]$/.test(k);if(Z===0){const ie={id:Ht(),type:"paragraph",text:""};st&&k==="p"&&(ie.style=st);const Jt=lr(A,L,ie);Jt&&(et=String(ie.id||""),le(Jt));return}if(Z>=F.length){const ie={id:Ht(),type:"paragraph",text:""};st&&k==="p"&&(ie.style=st);const Jt=En(A,L,ie);Jt&&(et=String(ie.id||""),le(Jt));return}let ht=null;if(at){const Jt={type:"heading",level:Number(k.slice(1)),text:tt.replace(/\n+/g," ").trim()};st&&(Jt.style=st),ht=Me(A,L,Jt)}else{const ie={type:"paragraph",text:tt};st&&(ie.style=st),ht=Me(A,L,ie)}const jt={id:Ht(),type:"paragraph",text:X};!at&&st&&(jt.style=st);const Be=En(ht||A,L,jt);Be&&(et=String(jt.id||""),le(Be))}}}}let fe=V(!1),nn=V(""),Un=V(""),zt=V(!1),gn=V(!1),we=V(!1),me=V(!1),se=V(!1);const Sr=new Map,Pi=["宋体","黑体","微软雅黑","楷体","Arial","Times New Roman","Courier New","Georgia","Verdana"],Hi=[12,14,16,18,20,22,24,28,32,36,42,48,56,64,72],xr=["#000000","#333333","#666666","#999999","#CCCCCC","#FFFFFF","#FF0000","#FF6600","#FFCC00","#00FF00","#00CCFF","#0000FF","#9900FF","#FF00FF"],Gr=[1,1.15,1.5,2,2.5,3];function zi(){i(nn)&&window.find(i(nn),!1,!1,!0,!1,!0,!1)}function Zs(){if(!i(nn))return;const c=window.getSelection();c&&c.toString().toLowerCase()===i(nn).toLowerCase()&&document.execCommand("insertHTML",!1,i(Un)),zi()}function Ji(){const c=new RegExp(to(i(nn)),"gi");if(!i(nn))return;if(r()&&typeof r()=="object"){const b=wr(r(),c,i(Un));b&&le(b),g(fe,!1);return}if(!i(a))return;let d=i(a).innerHTML;d=d.replace(c,i(Un)),ai(a,i(a).innerHTML=d),ee(),g(fe,!1)}function to(c){return c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function eo(){var A,L;const c=window.getSelection();if(!c||!c.rangeCount)return;const d=(L=(A=c.anchorNode)==null?void 0:A.parentElement)==null?void 0:L.closest("td, th");if(!d)return alert("请先选中表格单元格");const b=d.nextElementSibling;if(!b||b.tagName!=="TD"&&b.tagName!=="TH")return alert("无法合并：需要选中相邻单元格");const k=parseInt(d.getAttribute("colspan")||"1");d.setAttribute("colspan",String(k+1)),b.remove()}function Vo(){var A,L,F;const c=window.getSelection();if(!c||!c.rangeCount)return;const d=(L=(A=c.anchorNode)==null?void 0:A.parentElement)==null?void 0:L.closest("td, th");if(!d)return alert("请先选中表格单元格");const b=d.parentElement,k=b.cloneNode(!0);k.querySelectorAll("td, th").forEach(U=>U.textContent="　"),(F=b.parentElement)==null||F.insertBefore(k,b.nextSibling)}function Ko(){var A,L,F;const c=window.getSelection();if(!c||!c.rangeCount)return;const d=(L=(A=c.anchorNode)==null?void 0:A.parentElement)==null?void 0:L.closest("td, th");if(!d)return alert("请先选中表格单元格");const b=Array.from(((F=d.parentElement)==null?void 0:F.children)||[]).indexOf(d),k=d.closest("table");k&&k.querySelectorAll("tr").forEach(U=>{const Z=document.createElement(d.tagName.toLowerCase());Z.textContent="　",Z.style.cssText=d.style.cssText,U.insertBefore(Z,U.children[b+1])})}function no(){var A,L;const c=window.getSelection();if(!c||!c.rangeCount)return;const d=(L=(A=c.anchorNode)==null?void 0:A.parentElement)==null?void 0:L.closest("td, th");if(!d)return alert("请先选中表格单元格");const b=d.parentElement;if(!b)return;const k=b.parentElement;if(k&&k.children.length<=1)return alert("无法删除：表格至少需要一行");b.remove()}function Go(){var L,F,U;const c=window.getSelection();if(!c||!c.rangeCount)return;const d=(F=(L=c.anchorNode)==null?void 0:L.parentElement)==null?void 0:F.closest("td, th");if(!d)return alert("请先选中表格单元格");const b=Array.from(((U=d.parentElement)==null?void 0:U.children)||[]).indexOf(d),k=d.closest("table");if(!k)return;const A=k.querySelector("tr");if(A&&A.children.length<=1)return alert("无法删除：表格至少需要一列");k.querySelectorAll("tr").forEach(Z=>{var O;(O=Z.children[b])==null||O.remove()})}function xs(){return i(a)?i(a).querySelectorAll('[id^="ref-fn-"]').length+1:1}function Xo(c,d,b){if(!i(a))return;let k=i(a).querySelector(".footnotes-section");k||(k=document.createElement("div"),k.className="footnotes-section",k.innerHTML='<hr style="margin-top:40px;border:none;border-top:1px solid #ddd;" /><h3>脚注</h3>',i(a).appendChild(k));const A=document.createElement("div");A.className="footnote-item",A.id=c,A.innerHTML=`<sup>[${b}]</sup> ${d}`,k.appendChild(A)}function Yo(){if(!i(a))return"";const c=i(a).querySelectorAll("h1, h2, h3");if(c.length===0)return"<p>未找到标题</p>";let d='<div class="toc-section" style="border:1px solid #ddd;padding:16px;border-radius:8px;background:rgba(255,255,255,0.5);margin:20px 0;"><h3>目录</h3><ul style="list-style:none;padding-left:0;">';return c.forEach((b,k)=>{const A=parseInt(b.tagName[1]),L=b.textContent||"",F="heading-"+k;b.id=F;const U=(A-1)*20;d+=`<li style="margin-left:${U}px;margin-top:8px;"><a href="#${F}" style="color:#a5722a;text-decoration:none;">${L}</a></li>`}),d+="</ul></div>",d}function Dr(c){return String(c||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function ro(){if(!(!i(a)||!window.renderMathInElement))try{window.renderMathInElement(i(a),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})}catch(c){console.error("Math rendering error:",c)}}function Xr(){!i(a)||!window.Prism||i(a).querySelectorAll("pre code").forEach(c=>{window.Prism.highlightElement(c)})}async function ur(){if(!i(a))return;const c=Array.from(i(a).querySelectorAll(".wa-figure[data-figure-spec]"));for(const d of c){if(d.dataset.figureRendered==="1")continue;const b=d.dataset.figureSpec||"";if(!b)continue;d.dataset.figureRendered="1";let k=null;try{k=JSON.parse(decodeURIComponent(b))}catch{k=null}if(!k)continue;const A=JSON.stringify(k);let L=Sr.get(A);const F=d.querySelector(".wa-figure-box");if(F&&(F.innerHTML='<div class="wa-figure-loading">渲染中...</div>'),!L)try{const U=await fetch("/api/figure/render",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({spec:k})});if(!U.ok)throw new Error(await U.text());const Z=await U.json();L=String(Z.svg||""),L&&Sr.set(A,L)}catch{L=""}F&&(F.innerHTML=L||'<div class="wa-figure-loading">渲染失败</div>')}}const Qo=La.subscribe(c=>{c&&(yt(c),La.set(null))});Ys(()=>{if(Nt(),!r()){const F=String(n()||"").trim(),U=F?Fa(F):null;if(U)Ge.set(U),He.set(!1);else{const Z="自动生成文档";Ge.set({title:Z,sections:[{id:Ht(),title:Z,level:1,blocks:[{id:Ht(),type:"paragraph",text:""}],children:[]}]}),He.set(!1)}}$=Xe.subscribe(()=>Nt()),Ge.subscribe(()=>Nt());const c=document.createElement("link");c.rel="stylesheet",c.href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css",document.head.appendChild(c);const d=document.createElement("script");d.src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js",d.onload=()=>{const F=document.createElement("script");F.src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js",F.onload=()=>{ro()},document.head.appendChild(F)},document.head.appendChild(d);const b=document.createElement("link");b.rel="stylesheet",b.href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css",document.head.appendChild(b);const k=document.createElement("script");k.src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js",k.onload=()=>{const F=["https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-clike.min.js","https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-c.min.js","https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-cpp.min.js","https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-java.min.js","https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-javascript.min.js","https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-python.min.js","https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-sql.min.js"],U=Z=>new Promise(O=>{const H=document.createElement("script");H.src=Z,H.async=!1,H.onload=()=>O(),H.onerror=()=>O(),document.head.appendChild(H)});(async()=>{for(const Z of F)await U(Z);setTimeout(()=>Xr(),500)})()},document.head.appendChild(k);const A=new IntersectionObserver(F=>{F.forEach(U=>{if(U.isIntersecting&&U.target instanceof HTMLImageElement){const Z=U.target;Z.dataset.src&&(Z.src=Z.dataset.src,Z.removeAttribute("data-src"))}})}),L=new MutationObserver(()=>{var F;(F=i(a))==null||F.querySelectorAll("img[data-src]").forEach(U=>A.observe(U))});return i(a)&&L.observe(i(a),{childList:!0,subtree:!0}),()=>{re(),Qo(),$&&$(),A.disconnect(),L.disconnect(),m&&clearTimeout(m)}}),rs(()=>{},()=>{Nt()}),Wo();var Zo={get showToolbar(){return I()},set showToolbar(c){I(c),an()},get paper(){return M()},set paper(c){M(c),an()},$set:ar,$on:(c,d)=>or(e,c,d)};bi();var Ui=Tv(),io=w(Ui);{var ks=c=>{var d=kv(),b=Ee(d),k=h(w(b),2),A=w(k),L=w(A);_(A);var F=h(A,4),U=w(F);_(F),_(k),_(b);var Z=h(b,2),O=w(Z),H=w(O),tt=h(H,2);{var X=Qt=>{var oe=hv();ze(oe,5,()=>Pi,Qe,(Ne,xe)=>{var Vt=pv(),$r=w(Vt,!0);_(Vt),pt(()=>{ui(Vt,`font-family: ${i(xe)??""}`),ct($r,i(xe))}),T("click",Vt,()=>{yt("font:"+i(xe)),g(zt,!1)}),P(Ne,Vt)}),_(oe),P(Qt,oe)};gt(tt,Qt=>{i(zt)&&Qt(X)})}_(O);var st=h(O,2),at=w(st),ht=w(at);ht.value=ht.__value="";var jt=h(ht);ze(jt,1,()=>Hi,Qe,(Qt,oe)=>{var Ne=gv(),xe=w(Ne);_(Ne);var Vt={};pt(()=>{ct(xe,`${i(oe)??""}pt`),Vt!==(Vt=i(oe))&&(Ne.value=(Ne.__value=i(oe))??"")}),P(Qt,Ne)}),_(at),_(st);var Se=h(st,2),Be=w(Se),ie=h(Be,2);{var Jt=Qt=>{var oe=bv();ze(oe,5,()=>xr,Qe,(Ne,xe)=>{var Vt=mv();pt(()=>{ui(Vt,`background: ${i(xe)??""};`),is(Vt,"aria-label",`文字颜色 ${i(xe)}`)}),T("click",Vt,()=>{yt("color:"+i(xe)),g(gn,!1)}),P(Ne,Vt)}),_(oe),P(Qt,oe)};gt(ie,Qt=>{i(gn)&&Qt(Jt)})}_(Se);var bn=h(Se,2),kr=w(bn),ea=h(kr,2);{var _i=Qt=>{var oe=yv();ze(oe,5,()=>xr,Qe,(Ne,xe)=>{var Vt=_v();pt(()=>{ui(Vt,`background: ${i(xe)??""};`),is(Vt,"aria-label",`背景颜色 ${i(xe)}`)}),T("click",Vt,()=>{yt("bgcolor:"+i(xe)),g(we,!1)}),P(Ne,Vt)}),_(oe),P(Qt,oe)};gt(ea,Qt=>{i(we)&&Qt(_i)})}_(bn);var ao=h(bn,4),Es=h(ao,2),lo=h(Es,2),Ts=h(lo,2),co=h(Ts,4),uo=h(co,2),fo=h(uo,2),Vi=h(fo,4),vo=w(Vi),rn=h(vo,2);{var na=Qt=>{var oe=Sv();ze(oe,5,()=>Gr,Qe,(Ne,xe)=>{var Vt=wv(),$r=w(Vt);_(Vt),pt(()=>ct($r,`${i(xe)??""}倍行距`)),T("click",Vt,()=>{yt("line-height:"+i(xe)),g(me,!1)}),P(Ne,Vt)}),_(oe),P(Qt,oe)};gt(rn,Qt=>{i(me)&&Qt(na)})}_(Vi);var As=h(Vi,2),yi=h(As,2),qs=h(yi,4),Ki=h(qs,2),Cs=h(Ki,4),Gi=h(Cs,2),js=h(Gi,4),po=w(js),Is=h(po,2);{var ra=Qt=>{var oe=xv(),Ne=w(oe),xe=h(Ne,2),Vt=h(xe,2),$r=h(Vt,2),Ms=h($r,2),ho=h(Ms,2);_(oe),T("click",Ne,()=>{yt("table"),g(se,!1)}),T("click",xe,()=>{eo(),g(se,!1)}),T("click",Vt,()=>{Vo(),g(se,!1)}),T("click",$r,()=>{Ko(),g(se,!1)}),T("click",Ms,()=>{no(),g(se,!1)}),T("click",ho,()=>{Go(),g(se,!1)}),P(Qt,oe)};gt(Is,Qt=>{i(se)&&Qt(ra)})}_(js),_(Z),pt(Qt=>{ct(L,`${s()??""} 字`),ct(U,`${Qt??""} 分钟阅读`)},[()=>(s(),z(()=>Math.ceil(s()/400)))]),T("click",H,()=>g(zt,!i(zt))),T("change",at,Qt=>yt("size:"+Qt.currentTarget.value)),T("click",Be,()=>g(gn,!i(gn))),T("click",kr,()=>g(we,!i(we))),T("click",ao,()=>yt("align-left")),T("click",Es,()=>yt("align-center")),T("click",lo,()=>yt("align-right")),T("click",Ts,()=>yt("align-justify")),T("click",co,()=>yt("superscript")),T("click",uo,()=>yt("subscript")),T("click",fo,()=>yt("hr")),T("click",vo,()=>g(me,!i(me))),T("click",As,()=>yt("indent-first")),T("click",yi,()=>yt("margin:10px 0")),T("click",qs,()=>yt("math-inline")),T("click",Ki,()=>yt("math-block")),T("click",Cs,()=>yt("footnote")),T("click",Gi,()=>yt("toc")),T("click",po,()=>g(se,!i(se))),P(c,d)};gt(io,c=>{I()&&c(ks)})}var mn=h(io,2);Cd(mn,c=>g(a,c),()=>i(a));var $s=h(mn,2);{var ta=c=>{var d=$v();pt(()=>ui(d,(i(K),z(()=>`left:${i(K).left}px;top:${i(K).top}px;width:${i(K).width}px;height:${i(K).height}px;`)))),P(c,d)};gt($s,c=>{i(ut)&&c(ta)})}var so=h($s,2);{var Wi=c=>{var d=Ev(),b=w(d),k=w(b);Zn(k);var A=h(k,2),L=h(A,2);_(b);var F=h(b,2),U=w(F);Zn(U);var Z=h(U,2),O=h(Z,2);_(F),_(d),Je(k,()=>i(nn),H=>g(nn,H)),T("click",A,zi),T("click",L,()=>g(fe,!1)),Je(U,()=>i(Un),H=>g(Un,H)),T("click",Z,Zs),T("click",O,Ji),P(c,d)};gt(so,c=>{i(fe)&&c(Wi)})}_(Ui),pt(()=>{un(Ui,1,`panel editor ${M()?"paper":""}`,"svelte-1ctqrjb"),is(mn,"data-render-mode",i(p))}),T("mousedown",mn,jn),T("input",mn,cr),T("focusin",mn,Ri),T("focusout",mn,Lr),T("compositionstart",mn,Gt),T("compositionend",mn,Yt),T("click",mn,Jn),T("keydown",mn,Fe),P(t,Ui);var oo=zn(Zo);return l(),oo}var Av=G("<button> </button>"),qv=G('<button class="template-chip svelte-1ka5p0t"> </button>'),Cv=G('<div class="kind-grid svelte-1ka5p0t"></div> <div class="template-list svelte-1ka5p0t"></div> <textarea class="prompt-box svelte-1ka5p0t" rows="5" placeholder="输入你要绘制的内容，例如：用户登录到下单的关键流程。"></textarea> <div class="canvas-actions svelte-1ka5p0t"><button class="btn primary svelte-1ka5p0t"> </button> <button class="btn ghost svelte-1ka5p0t">插入文档</button></div> <textarea class="prompt-box mini svelte-1ka5p0t" rows="3" placeholder="二次优化，例如：改成更简洁的 5 个节点，强调异常分支。"></textarea> <button class="btn ghost svelte-1ka5p0t">AI 二次优化</button>',1),jv=G('<textarea class="spec-editor svelte-1ka5p0t" rows="18" placeholder="可直接编辑 JSON 规范，例如：type=flow，caption=示例，data 包含 nodes/edges。"></textarea> <div class="canvas-actions svelte-1ka5p0t"><button class="btn primary svelte-1ka5p0t">应用规范</button> <button class="btn ghost svelte-1ka5p0t">复制规范</button></div>',1),Iv=G('<div class="empty svelte-1ka5p0t">暂无历史记录</div>'),Mv=G('<button class="history-item svelte-1ka5p0t"><div class="svelte-1ka5p0t"> </div> <div class="svelte-1ka5p0t"> </div> <div class="svelte-1ka5p0t"> </div></button>'),Nv=G('<div class="history-list svelte-1ka5p0t"><!></div>'),Ov=G('<div class="error svelte-1ka5p0t"> </div>'),Lv=G('<div class="svg-host svelte-1ka5p0t"><div class="svg-scale svelte-1ka5p0t"><!></div></div>'),Dv=G('<div class="placeholder svelte-1ka5p0t"><h4 class="svelte-1ka5p0t">画布预览区</h4> <p class="svelte-1ka5p0t">左侧输入描述后点击“生成图形”，或切换到 JSON 手动编辑规范。</p></div>'),Fv=G('<div class="canvas-backdrop svelte-1ka5p0t" role="button" tabindex="0" aria-label="关闭画布"><section class="canvas-shell svelte-1ka5p0t" aria-label="AI 画布系统"><header class="canvas-topbar svelte-1ka5p0t"><div class="title-wrap svelte-1ka5p0t"><h3 class="svelte-1ka5p0t">AI 画布系统</h3> <p class="svelte-1ka5p0t">同页完成生成、修改、预览、插入，支持流程图/ER 图/时序图/统计图。</p></div> <div class="top-actions svelte-1ka5p0t"><button class="btn ghost svelte-1ka5p0t">工作台</button> <button class="btn ghost svelte-1ka5p0t">JSON</button> <button class="btn ghost svelte-1ka5p0t">历史</button> <button class="btn ghost svelte-1ka5p0t">清空</button> <button class="close-btn svelte-1ka5p0t" aria-label="关闭">×</button></div></header> <div class="canvas-main svelte-1ka5p0t"><aside class="canvas-sidebar svelte-1ka5p0t"><div class="panel-title svelte-1ka5p0t"> </div> <!> <!> <!> <!></aside> <section class="canvas-stage svelte-1ka5p0t"><div class="stage-toolbar svelte-1ka5p0t"><div class="zoom-group svelte-1ka5p0t"><button class="btn ghost svelte-1ka5p0t">-</button> <span> </span> <button class="btn ghost svelte-1ka5p0t">+</button> <button class="btn ghost svelte-1ka5p0t">重置缩放</button></div> <div class="export-group svelte-1ka5p0t"><button class="btn ghost svelte-1ka5p0t">复制 SVG</button> <button class="btn ghost svelte-1ka5p0t">下载 SVG</button> <button class="btn primary svelte-1ka5p0t">插入正文</button></div></div> <div class="preview-wrap svelte-1ka5p0t"><!></div></section></div></section></div>');function $u(t,e){if(new.target)return sr({component:$u,...t});Hn(e,!1);let n=kn(e,"open",12,!1),r=kn(e,"docId",12,"");const s=rl(),o=[{value:"flow",label:"流程图"},{value:"er",label:"ER 图"},{value:"sequence",label:"时序图"},{value:"timeline",label:"时间线"},{value:"bar",label:"柱状图"},{value:"line",label:"折线图"},{value:"pie",label:"饼图"}],l={flow:["需求分析 -> 方案设计 -> 开发实现 -> 测试验收 -> 上线运营","用户登录 -> 权限校验 -> 数据查询 -> 结果返回","问题发现 -> 原因定位 -> 修复验证 -> 发布回归"],er:["电商系统：用户、订单、商品、支付","教学系统：学生、课程、教师、选课记录","医院系统：患者、医生、挂号、检查报告"],sequence:["用户 -> 网关 -> 认证服务 -> 业务服务 -> 数据库","浏览器 -> 服务端 -> 缓存 -> 数据库","客户端 -> API -> 队列 -> Worker -> 存储"],timeline:["立项 -> 调研 -> 设计 -> 开发 -> 测试 -> 发布","需求冻结 -> 联调 -> 验收 -> 复盘","周一需求 -> 周三开发 -> 周五发布"],bar:["近 3 个月活跃用户对比","三种方案成本对比","各模块缺陷数统计"],line:["Q1-Q4 访问量变化趋势","模型版本准确率变化","系统响应时间趋势"],pie:["项目成本占比：人力、硬件、云资源、其他","问题类型占比：功能、性能、兼容性、体验","用户来源占比：自然、投放、活动、推荐"]};let a=V("studio"),f=V("flow"),p=V(""),m=V(""),S=V(!1),$=V(""),I=V(""),M=V(null),B=V(""),j=V(1),J=V([]);function ft(nt){return nt==="json"?"规范编辑":nt==="history"?"历史画布":"智能画布"}function et(){s("close")}function ot(nt){g(p,nt)}function Q(nt){const rt=String(nt||"").trim().toLowerCase();return rt==="er"?"er":rt==="sequence"?"sequence":rt==="timeline"?"timeline":rt==="bar"?"bar":rt==="line"?"line":rt==="pie"?"pie":"flow"}function mt(nt){if(!nt||typeof nt!="object"||Array.isArray(nt))throw new Error("图形规范不是对象");return nt}function it(nt){return JSON.stringify(nt,(rt,_t)=>typeof _t=="string"?_t.replace(/\u0000/g,""):_t,2)}function R(nt,rt,_t,Ft){g(J,[{id:Date.now(),kind:rt,prompt:nt,spec:_t,svg:Ft,ts:Date.now()},...i(J)].slice(0,40))}async function ut(nt,rt,_t){const Ft=await fetch("/api/figure/render",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({spec:nt})});if(!Ft.ok)throw new Error(await Ft.text());const Ct=await Ft.json(),vn=String(Ct.svg||"");g(I,vn),g(M,nt),g(B,it(nt)),R(rt,_t,nt,vn)}async function K(nt){const rt=String(nt||i(p)||"").trim();if(!r()){g($,"文档未加载");return}if(rt){g(S,!0),g($,"");try{const _t=await fetch(`/api/doc/${r()}/diagram/generate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:rt,kind:i(f)})});if(!_t.ok)throw new Error(await _t.text());const Ft=await _t.json(),Ct=mt(Ft.spec||{});await ut(Ct,rt,i(f)),g(a,"studio")}catch(_t){g($,_t instanceof Error?_t.message:"图形生成失败")}finally{g(S,!1)}}}async function lt(){const nt=i(m).trim();if(!nt)return;if(!i(M)){await K(nt);return}const rt=JSON.stringify(i(M)).slice(0,1800);await K(`在当前图基础上优化：${nt}
当前规范：${rt}`)}async function dt(){const nt=String(i(B)||"").trim();if(nt){g(S,!0),g($,"");try{const rt=mt(JSON.parse(nt)),_t=Q(rt.type);g(f,_t),await ut(rt,"手动编辑规范",_t),g(a,"studio")}catch(rt){g($,rt instanceof Error?rt.message:"规范解析失败")}finally{g(S,!1)}}}function Nt(nt){g(f,nt.kind),g(p,nt.prompt),g(M,nt.spec),g(I,nt.svg),g(B,it(nt.spec)),g(a,"studio")}function Lt(){i(M)&&s("insert",{spec:i(M)})}async function Tt(){if(i(I))try{await navigator.clipboard.writeText(i(I))}catch{g($,"复制 SVG 失败，请检查浏览器权限")}}async function ee(){if(i(B).trim())try{await navigator.clipboard.writeText(i(B))}catch{g($,"复制规范失败，请检查浏览器权限")}}function Ut(){if(!i(I))return;const nt=new Blob([i(I)],{type:"image/svg+xml;charset=utf-8"}),rt=URL.createObjectURL(nt),_t=document.createElement("a");_t.href=rt,_t.download=`canvas-${Date.now()}.svg`,document.body.appendChild(_t),_t.click(),_t.remove(),URL.revokeObjectURL(rt)}function Dt(){g(I,""),g(M,null),g(B,""),g(m,""),g($,""),g(j,1)}function Pt(nt){nt.key==="Escape"&&et()}var St={get open(){return n()},set open(nt){n(nt),an()},get docId(){return r()},set docId(nt){r(nt),an()},$set:ar,$on:(nt,rt)=>or(e,nt,rt)};bi();var ce=mr(),ve=Ee(ce);{var _e=nt=>{var rt=Fv(),_t=w(rt),Ft=w(_t),Ct=h(w(Ft),2),vn=w(Ct),$n=h(vn,2),le=h($n,2),Ue=h(le,2),ne=h(Ue,2);_(Ct),_(Ft);var Me=h(Ft,2),En=w(Me),lr=w(En),wr=w(lr,!0);_(lr);var tn=h(lr,2);{var ln=Gt=>{var Yt=Cv(),Ht=Ee(Yt);ze(Ht,5,()=>o,Qe,(we,me)=>{var se=Av(),Sr=w(se,!0);_(se),pt(()=>{un(se,1,(i(f),i(me),z(()=>`kind-chip ${i(f)===i(me).value?"active":""}`)),"svelte-1ka5p0t"),ct(Sr,(i(me),z(()=>i(me).label)))}),T("click",se,()=>g(f,i(me).value)),P(we,se)}),_(Ht);var We=h(Ht,2);ze(We,5,()=>(i(f),z(()=>l[i(f)])),Qe,(we,me)=>{var se=qv(),Sr=w(se,!0);_(se),pt(()=>ct(Sr,i(me))),T("click",se,()=>ot(i(me))),P(we,se)}),_(We);var yt=h(We,2);hi(yt);var Fe=h(yt,2),fe=w(Fe),nn=w(fe,!0);_(fe);var Un=h(fe,2);_(Fe);var zt=h(Fe,2);hi(zt);var gn=h(zt,2);pt((we,me)=>{fe.disabled=we,ct(nn,i(S)?"生成中...":"生成图形"),Un.disabled=!i(M),gn.disabled=me},[()=>(i(S),i(p),z(()=>i(S)||!i(p).trim())),()=>(i(S),i(m),z(()=>i(S)||!i(m).trim()))]),Je(yt,()=>i(p),we=>g(p,we)),T("click",fe,()=>K()),T("click",Un,Lt),Je(zt,()=>i(m),we=>g(m,we)),T("click",gn,lt),P(Gt,Yt)};gt(tn,Gt=>{i(a)==="studio"&&Gt(ln)})}var Tn=h(tn,2);{var Wt=Gt=>{var Yt=jv(),Ht=Ee(Yt);hi(Ht);var We=h(Ht,2),yt=w(We),Fe=h(yt,2);_(We),pt((fe,nn)=>{yt.disabled=fe,Fe.disabled=nn},[()=>(i(S),i(B),z(()=>i(S)||!i(B).trim())),()=>(i(B),z(()=>!i(B).trim()))]),Je(Ht,()=>i(B),fe=>g(B,fe)),T("click",yt,dt),T("click",Fe,ee),P(Gt,Yt)};gt(Tn,Gt=>{i(a)==="json"&&Gt(Wt)})}var An=h(Tn,2);{var qn=Gt=>{var Yt=Nv(),Ht=w(Yt);{var We=Fe=>{var fe=Iv();P(Fe,fe)},yt=Fe=>{var fe=mr(),nn=Ee(fe);ze(nn,1,()=>i(J),Qe,(Un,zt)=>{var gn=Mv(),we=w(gn),me=w(we,!0);_(we);var se=h(we,2),Sr=w(se,!0);_(se);var Pi=h(se,2),Hi=w(Pi,!0);_(Pi),_(gn),pt((xr,Gr)=>{ct(me,xr),ct(Sr,(i(zt),z(()=>i(zt).prompt||"无描述"))),ct(Hi,Gr)},[()=>(i(zt),z(()=>{var xr;return((xr=o.find(Gr=>Gr.value===i(zt).kind))==null?void 0:xr.label)||i(zt).kind})),()=>(i(zt),z(()=>new Date(i(zt).ts).toLocaleString()))]),T("click",gn,()=>Nt(i(zt))),P(Un,gn)}),P(Fe,fe)};gt(Ht,Fe=>{i(J),z(()=>i(J).length===0)?Fe(We):Fe(yt,!1)})}_(Yt),P(Gt,Yt)};gt(An,Gt=>{i(a)==="history"&&Gt(qn)})}var ue=h(An,2);{var pn=Gt=>{var Yt=Ov(),Ht=w(Yt,!0);_(Yt),pt(()=>ct(Ht,i($))),P(Gt,Yt)};gt(ue,Gt=>{i($)&&Gt(pn)})}_(En);var pe=h(En,2),en=w(pe),cn=w(en),hn=w(cn),ye=h(hn,2),Xt=w(ye);_(ye);var Cn=h(ye,2),De=h(Cn,2);_(cn);var he=h(cn,2),re=w(he),ge=h(re,2),jn=h(ge,2);_(he),_(en);var Jn=h(en,2),Ri=w(Jn);{var Lr=Gt=>{var Yt=Lv(),Ht=w(Yt),We=w(Ht);Sd(We,()=>i(I)),_(Ht),_(Yt),pt(()=>ui(Ht,`transform: scale(${i(j)});`)),P(Gt,Yt)},cr=Gt=>{var Yt=Dv();P(Gt,Yt)};gt(Ri,Gt=>{i(I)?Gt(Lr):Gt(cr,!1)})}_(Jn),_(pe),_(Me),_(_t),_(rt),pt((Gt,Yt)=>{ct(wr,Gt),ct(Xt,`${Yt??""}%`),re.disabled=!i(I),ge.disabled=!i(I),jn.disabled=!i(M)},[()=>(i(a),z(()=>ft(i(a)))),()=>(i(j),z(()=>Math.round(i(j)*100)))]),T("click",vn,()=>g(a,"studio")),T("click",$n,()=>g(a,"json")),T("click",le,()=>g(a,"history")),T("click",Ue,Dt),T("click",ne,et),T("click",hn,()=>g(j,Math.max(.4,Number((i(j)-.1).toFixed(1))))),T("click",Cn,()=>g(j,Math.min(2.2,Number((i(j)+.1).toFixed(1))))),T("click",De,()=>g(j,1)),T("click",re,Tt),T("click",ge,Ut),T("click",jn,Lt),T("click",rt,vd(et)),T("keydown",rt,Pt),P(nt,rt)};gt(ve,nt=>{n()&&nt(_e)})}return P(t,ce),zn(St)}var Bv=G("<div> </div>"),Rv=G('<div class="toast-root svelte-1cpok13"></div>');function Eu(t,e){if(new.target)return sr({component:Eu,...t});Hn(e,!1);const n=()=>qe(Da,"$toasts",r),[r,s]=Ss();var o={$set:ar,$on:(f,p)=>or(e,f,p)},l=Rv();ze(l,5,n,f=>f.id,(f,p)=>{var m=Bv(),S=w(m,!0);_(m),pt(()=>{un(m,1,`toast ${i(p),z(()=>i(p).type)??""}`,"svelte-1cpok13"),ct(S,(i(p),z(()=>i(p).message)))}),P(f,m)}),_(l),P(t,l);var a=zn(o);return s(),a}var Pv=G('<button type="button" class="modal-backdrop svelte-ta60gp" aria-label="关闭"></button> <div class="modal svelte-ta60gp" role="dialog" aria-modal="true"><div class="modal-header svelte-ta60gp"><div class="modal-title svelte-ta60gp"> </div> <button class="btn ghost">关闭</button></div> <div class="modal-body"><!></div></div>',1);function Tu(t,e){if(new.target)return sr({component:Tu,...t});Hn(e,!1);let n=kn(e,"open",12,!1),r=kn(e,"title",12,""),s=kn(e,"onClose",12);var o={get open(){return n()},set open(p){n(p),an()},get title(){return r()},set title(p){r(p),an()},get onClose(){return s()},set onClose(p){s(p),an()},$set:ar,$on:(p,m)=>or(e,p,m)},l=mr(),a=Ee(l);{var f=p=>{var m=Pv(),S=Ee(m),$=h(S,2),I=w($),M=w(I),B=w(M,!0);_(M);var j=h(M,2);_(I);var J=h(I,2),ft=w(J);cu(ft,e,"default",{}),_(J),_($),pt(()=>ct(B,r())),T("click",S,function(...et){var ot;(ot=s())==null||ot.apply(this,et)}),T("click",j,function(...et){var ot;(ot=s())==null||ot.apply(this,et)}),P(p,m)};gt(a,p=>{n()&&p(f)})}return P(t,l),zn(o)}var Hv=G('<div class="settings-row svelte-anx9w7"><label><input type="checkbox"/> 扩展大纲</label></div> <div class="settings-row svelte-anx9w7"><label><input type="checkbox"/> 需要引用</label></div> <div class="settings-row svelte-anx9w7"><label for="targetChars">目标字数</label> <input id="targetChars" type="number" min="100" max="10000" placeholder="例如 1000" class="svelte-anx9w7"/></div> <div class="settings-row svelte-anx9w7"><label for="styleTone">风格/语气</label> <input id="styleTone" type="text" placeholder="例如：正式、简洁、适度营销" class="svelte-anx9w7"/></div> <div class="settings-row svelte-anx9w7"><label for="outputFormat">输出格式</label> <select id="outputFormat" class="svelte-anx9w7"><option>Markdown</option><option>纯文本</option></select></div> <div class="settings-section svelte-anx9w7"><div class="section-title svelte-anx9w7">高级设置（可改所有默认值）</div> <label for="formattingJson">格式 formatting</label> <textarea id="formattingJson" rows="6" class="svelte-anx9w7"></textarea> <label for="prefsJson">生成偏好 generation_prefs</label> <textarea id="prefsJson" rows="6" class="svelte-anx9w7"></textarea></div> <div class="settings-actions svelte-anx9w7"><button class="btn primary">保存</button> <button class="btn ghost">取消</button></div>',1),zv=G('<button class="btn ghost">设置</button> <!>',1);function Au(t,e){if(new.target)return sr({component:Au,...t});Hn(e,!1);const n=()=>qe(Vr,"$docId",r),[r,s]=Ss();let o=V(!1),l=V(!1),a=V(""),f=V(""),p=V(!1),m=V("markdown"),S=V(""),$=V("");async function I(){const Q=n();if(!Q)return;const mt=await fetch(`/api/doc/${Q}`);if(!mt.ok)return;const it=await mt.json(),R=it.generation_prefs||{},ut=it.formatting||{};g(l,!!R.expand_outline),g(a,R.target_chars?Number(R.target_chars):""),g(f,String(ut.style||"")),g(p,!!R.citations_required),g(m,String(R.output_format||"markdown")),g(S,JSON.stringify(ut,null,2)),g($,JSON.stringify(R,null,2))}async function M(){const Q=n();if(!Q)return;let mt={},it={};try{mt=i(S).trim()?JSON.parse(i(S)):{},it=i($).trim()?JSON.parse(i($)):{}}catch{It("高级设置 JSON 解析失败，请检查格式。","bad");return}const R={generation_prefs:{...it,expand_outline:i(l),citations_required:i(p),output_format:i(m)},formatting:{...mt,style:i(f)}};i(a)&&(R.generation_prefs.target_chars=Number(i(a))),await fetch(`/api/doc/${Q}/settings`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(R)}),It("设置已保存","ok"),g(o,!1)}function B(){g(o,!0),I().catch(()=>{})}var j={$set:ar,$on:(Q,mt)=>or(e,Q,mt)};bi();var J=zv(),ft=Ee(J),et=h(ft,2);Tu(et,{get open(){return i(o)},title:"生成设置",onClose:()=>g(o,!1),children:(Q,mt)=>{var it=Hv(),R=Ee(it),ut=w(R),K=w(ut);Zn(K),Ps(),_(ut),_(R);var lt=h(R,2),dt=w(lt),Nt=w(dt);Zn(Nt),Ps(),_(dt),_(lt);var Lt=h(lt,2),Tt=h(w(Lt),2);Zn(Tt),_(Lt);var ee=h(Lt,2),Ut=h(w(ee),2);Zn(Ut),_(ee);var Dt=h(ee,2),Pt=h(w(Dt),2);pt(()=>{i(m),xo(()=>{})});var St=w(Pt);St.value=St.__value="markdown";var ce=h(St);ce.value=ce.__value="plain",_(Pt),_(Dt);var ve=h(Dt,2),_e=h(w(ve),4);hi(_e);var nt=h(_e,4);hi(nt),_(ve);var rt=h(ve,2),_t=w(rt),Ft=h(_t,2);_(rt),tc(K,()=>i(l),Ct=>g(l,Ct)),tc(Nt,()=>i(p),Ct=>g(p,Ct)),Je(Tt,()=>i(a),Ct=>g(a,Ct)),Je(Ut,()=>i(f),Ct=>g(f,Ct)),$o(Pt,()=>i(m),Ct=>g(m,Ct)),Je(_e,()=>i(S),Ct=>g(S,Ct)),Je(nt,()=>i($),Ct=>g($,Ct)),T("click",_t,M),T("click",Ft,()=>g(o,!1)),P(Q,it)},$$slots:{default:!0}}),T("click",ft,B),P(t,J);var ot=zn(j);return s(),ot}var Jv=G('<div class="loading svelte-1bmythy">加载中...</div>'),Uv=G('<div class="empty svelte-1bmythy">暂无文档</div>'),Wv=G('<div class="doc-item svelte-1bmythy"><div class="doc-info svelte-1bmythy"><div class="doc-title svelte-1bmythy"> </div> <div class="doc-meta svelte-1bmythy"><span> </span> <span> </span></div> <div class="doc-preview svelte-1bmythy"> </div></div> <button class="delete-btn svelte-1bmythy">删除</button></div>'),Vv=G('<div class="doc-list svelte-1bmythy"></div>'),Kv=G('<div class="modal-backdrop svelte-1bmythy"><div class="modal-panel svelte-1bmythy"><div class="modal-header svelte-1bmythy"><h2 class="svelte-1bmythy">文档列表</h2> <button class="close-btn svelte-1bmythy">✕</button></div> <div class="modal-body svelte-1bmythy"><!></div></div></div>');function qu(t,e){if(new.target)return sr({component:qu,...t});Hn(e,!1);let n=kn(e,"visible",12,!1),r=kn(e,"onSelect",12,()=>{}),s=V([]),o=V(!1);async function l(){g(o,!0);try{const M=await fetch("/api/docs/list");if(!M.ok)throw new Error("加载失败");const B=await M.json();g(s,B.docs||[])}catch{It("加载文档列表失败","error")}finally{g(o,!1)}}function a(M){try{return new Date(M).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return M}}function f(M,B){return(M||"").length>B?M.slice(0,B)+"...":M}async function p(M){if(confirm("确定删除此文档？"))try{await fetch(`/api/doc/${M}/delete`,{method:"POST"}),It("已删除","ok"),await l()}catch{It("删除失败","error")}}Ys(()=>{n()&&l()}),rs(()=>Jo(n()),()=>{n()&&l()}),Wo();var m={get visible(){return n()},set visible(M){n(M),an()},get onSelect(){return r()},set onSelect(M){r(M),an()},$set:ar,$on:(M,B)=>or(e,M,B)};bi();var S=mr(),$=Ee(S);{var I=M=>{var B=Kv(),j=w(B),J=w(j),ft=h(w(J),2);_(J);var et=h(J,2),ot=w(et);{var Q=it=>{var R=Jv();P(it,R)},mt=it=>{var R=mr(),ut=Ee(R);{var K=dt=>{var Nt=Uv();P(dt,Nt)},lt=dt=>{var Nt=Vv();ze(Nt,5,()=>i(s),Qe,(Lt,Tt)=>{var ee=Wv(),Ut=w(ee),Dt=w(Ut),Pt=w(Dt,!0);_(Dt);var St=h(Dt,2),ce=w(St),ve=w(ce,!0);_(ce);var _e=h(ce,2),nt=w(_e);_(_e),_(St);var rt=h(St,2),_t=w(rt,!0);_(rt),_(Ut);var Ft=h(Ut,2);_(ee),pt((Ct,vn)=>{ct(Pt,(i(Tt),z(()=>i(Tt).title||"自动生成文档"))),ct(ve,Ct),ct(nt,`${i(Tt),z(()=>i(Tt).char_count||0)??""} 字`),ct(_t,vn)},[()=>(i(Tt),z(()=>a(i(Tt).updated_at))),()=>(i(Tt),z(()=>f(i(Tt).text,80)))]),T("click",Ut,()=>r()(i(Tt).doc_id)),T("keydown",Ut,()=>{}),T("click",Ft,()=>p(i(Tt).doc_id)),P(Lt,ee)}),_(Nt),P(dt,Nt)};gt(ut,dt=>{i(s),z(()=>i(s).length===0)?dt(K):dt(lt,!1)},!0)}P(it,R)};gt(ot,it=>{i(o)?it(Q):it(mt,!1)})}_(et),_(j),_(B),T("click",ft,()=>n(!1)),T("click",j,lu(function(it){fu.call(this,e,it)})),T("keydown",j,()=>{}),T("click",B,()=>n(!1)),T("keydown",B,()=>{}),P(M,B)};gt($,M=>{n()&&M(I)})}return P(t,S),zn(m)}var Gv=G('<div class="skeleton-wrapper svelte-1bn1hqj"><div class="skeleton-header svelte-1bn1hqj"><div class="skeleton-line skeleton-title svelte-1bn1hqj"></div> <div class="skeleton-line skeleton-subtitle svelte-1bn1hqj"></div></div> <div class="skeleton-content svelte-1bn1hqj"><div class="skeleton-line svelte-1bn1hqj"></div> <div class="skeleton-line svelte-1bn1hqj"></div> <div class="skeleton-line short svelte-1bn1hqj"></div> <div class="skeleton-line svelte-1bn1hqj"></div> <div class="skeleton-line svelte-1bn1hqj"></div> <div class="skeleton-line short svelte-1bn1hqj"></div></div></div>');function Cu(t,e){if(new.target)return sr({component:Cu,...t});Hn(e,!1);var n={$set:ar,$on:(s,o)=>or(e,s,o)},r=Gv();return P(t,r),zn(n)}var Xv=G('<div class="progress-bar indeterminate svelte-1qjgclg"></div>'),Yv=G('<div class="progress-bar svelte-1qjgclg"></div>'),Qv=G('<div class="progress-container svelte-1qjgclg"><!></div>');function ju(t,e){if(new.target)return sr({component:ju,...t});Hn(e,!1);let n=kn(e,"progress",12,0),r=kn(e,"indeterminate",12,!1);var s={get progress(){return n()},set progress(p){n(p),an()},get indeterminate(){return r()},set indeterminate(p){r(p),an()},$set:ar,$on:(p,m)=>or(e,p,m)},o=Qv(),l=w(o);{var a=p=>{var m=Xv();P(p,m)},f=p=>{var m=Yv();pt(S=>ui(m,`width: ${S??""}%`),[()=>(Jo(n()),z(()=>Math.min(100,Math.max(0,n()))))]),P(p,m)};gt(l,p=>{r()?p(a):p(f,!1)})}return _(o),P(t,o),zn(s)}var Zv=G('<div class="error-boundary svelte-1k3aqik"><div class="error-icon svelte-1k3aqik">⚠️</div> <h2 class="svelte-1k3aqik">抱歉，出现了一些问题</h2> <p class="error-message svelte-1k3aqik"> </p> <div class="error-suggestion svelte-1k3aqik">建议： <ul class="svelte-1k3aqik"><li class="svelte-1k3aqik">刷新页面重试</li> <li class="svelte-1k3aqik">检查网络连接</li> <li class="svelte-1k3aqik">清除浏览器缓存</li> <li class="svelte-1k3aqik">如问题持续，请联系技术支持</li></ul></div> <button class="btn-retry svelte-1k3aqik">重新加载</button></div>');function Iu(t,e){if(new.target)return sr({component:Iu,...t});Hn(e,!1);let n=kn(e,"fallback",12,"出现错误，请刷新页面重试"),r=V(!1),s=V("");Ys(()=>{const m=S=>{var $;g(r,!0),g(s,(($=S.error)==null?void 0:$.message)||S.message||"未知错误"),console.error("捕获到错误:",S.error)};return window.addEventListener("error",m),()=>{window.removeEventListener("error",m)}});var o={get fallback(){return n()},set fallback(m){n(m),an()},$set:ar,$on:(m,S)=>or(e,m,S)};bi();var l=mr(),a=Ee(l);{var f=m=>{var S=Zv(),$=h(w(S),4),I=w($,!0);_($);var M=h($,4);_(S),pt(()=>ct(I,i(s))),T("click",M,()=>window.location.reload()),P(m,S)},p=m=>{var S=mr(),$=Ee(S);cu($,e,"default",{}),P(m,S)};gt(a,m=>{i(r)?m(f):m(p,!1)})}return P(t,l),zn(o)}var tp=G('<p class="empty svelte-13e776w">加载中...</p>'),ep=G('<p class="empty svelte-13e776w">暂无引用</p>'),np=G('<span class="source svelte-13e776w"> </span>'),rp=G('<div class="citation-item svelte-13e776w"><div class="citation-info svelte-13e776w"><strong class="svelte-13e776w"> </strong> <span class="svelte-13e776w"> </span> <!></div> <div class="citation-actions svelte-13e776w"><button class="btn-copy svelte-13e776w">复制</button> <button class="btn-delete svelte-13e776w">删除</button></div></div>'),ip=G('<div class="citation-list svelte-13e776w"></div>'),sp=G('<div class="modal-backdrop svelte-13e776w"><div class="modal svelte-13e776w"><div class="modal-header svelte-13e776w"><h2 class="svelte-13e776w">引用管理</h2> <button class="close-btn svelte-13e776w">×</button></div> <div class="modal-body svelte-13e776w"><div class="add-section svelte-13e776w"><h3 class="svelte-13e776w">添加引用</h3> <div class="form-grid svelte-13e776w"><input type="text" placeholder="引用ID (如: smith2023)*" class="svelte-13e776w"/> <input type="text" placeholder="作者*" class="svelte-13e776w"/> <input type="text" placeholder="标题*" class="svelte-13e776w"/> <input type="text" placeholder="年份" class="svelte-13e776w"/> <input type="text" placeholder="来源（期刊/会议/出版社）" class="full-width svelte-13e776w"/></div> <button class="btn-add svelte-13e776w">添加引用</button></div> <div class="export-section svelte-13e776w"><h3 class="svelte-13e776w">导出参考文献</h3> <div class="export-btns svelte-13e776w"><button class="btn-export svelte-13e776w">APA格式</button> <button class="btn-export svelte-13e776w">MLA格式</button> <button class="btn-export svelte-13e776w">GB/T 7714</button></div></div> <div class="list-section svelte-13e776w"><h3 class="svelte-13e776w"> </h3> <!></div></div></div></div>');function Mu(t,e){if(new.target)return sr({component:Mu,...t});Hn(e,!1);const n=()=>qe(Vr,"$docId",r),[r,s]=Ss();let o=kn(e,"visible",12,!1),l=V([]),a=V(!1),f=V(""),p=null,m=V({id:"",author:"",title:"",year:"",source:""});async function S(){const R=n();if(R){g(a,!0);try{const ut=await fetch(`/api/doc/${R}/citations`);if(!ut.ok)throw new Error(await ut.text());const K=await ut.json();g(l,Array.isArray(K.items)?K.items:[])}catch(ut){console.error("Failed to load citations:",ut),It("加载引用失败","error")}finally{g(a,!1)}}}async function $(){const R=n();R&&await fetch(`/api/doc/${R}/citations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:i(l)})})}function I(){p&&clearTimeout(p),p=setTimeout(()=>{$().catch(()=>{It("保存引用失败","error")})},300)}function M(){if(!i(m).id||!i(m).author||!i(m).title){It("请填写必填字段（ID、作者、标题）","bad");return}if(i(l).some(R=>R.id===i(m).id)){It("引用ID已存在","bad");return}g(l,[...i(l),{...i(m)}]),I(),g(m,{id:"",author:"",title:"",year:"",source:""}),It("已添加引用","ok")}function B(R){g(l,i(l).filter(ut=>ut.id!==R)),I(),It("已删除引用","ok")}function j(R){navigator.clipboard.writeText(`[@${R}]`),It("已复制引用标记","ok")}function J(R,ut){return ut==="apa"?`${R.author} (${R.year}). ${R.title}. ${R.source}.`:ut==="mla"?`${R.author}. "${R.title}." ${R.source}, ${R.year}.`:`${R.author}. ${R.title}[J]. ${R.source}, ${R.year}.`}function ft(R){const ut=i(l).map(Nt=>J(Nt,R)).join(`

`),K=new Blob([ut],{type:"text/plain"}),lt=URL.createObjectURL(K),dt=document.createElement("a");dt.href=lt,dt.download=`references_${R}.txt`,dt.click(),URL.revokeObjectURL(lt),It(`已导出 ${R.toUpperCase()} 格式参考文献`,"ok")}Ys(()=>{o()&&S()}),rs(()=>(Jo(o()),n(),i(f)),()=>{if(o()){const R=n();R&&R!==i(f)&&(g(f,R),S())}}),Wo();var et={get visible(){return o()},set visible(R){o(R),an()},$set:ar,$on:(R,ut)=>or(e,R,ut)};bi();var ot=mr(),Q=Ee(ot);{var mt=R=>{var ut=sp(),K=w(ut),lt=w(K),dt=h(w(lt),2);_(lt);var Nt=h(lt,2),Lt=w(Nt),Tt=h(w(Lt),2),ee=w(Tt);Zn(ee);var Ut=h(ee,2);Zn(Ut);var Dt=h(Ut,2);Zn(Dt);var Pt=h(Dt,2);Zn(Pt);var St=h(Pt,2);Zn(St),_(Tt);var ce=h(Tt,2);_(Lt);var ve=h(Lt,2),_e=h(w(ve),2),nt=w(_e),rt=h(nt,2),_t=h(rt,2);_(_e),_(ve);var Ft=h(ve,2),Ct=w(Ft),vn=w(Ct);_(Ct);var $n=h(Ct,2);{var le=ne=>{var Me=tp();P(ne,Me)},Ue=ne=>{var Me=mr(),En=Ee(Me);{var lr=tn=>{var ln=ep();P(tn,ln)},wr=tn=>{var ln=ip();ze(ln,5,()=>i(l),Qe,(Tn,Wt)=>{var An=rp(),qn=w(An),ue=w(qn),pn=w(ue);_(ue);var pe=h(ue,2),en=w(pe);_(pe);var cn=h(pe,2);{var hn=De=>{var he=np(),re=w(he,!0);_(he),pt(()=>ct(re,(i(Wt),z(()=>i(Wt).source)))),P(De,he)};gt(cn,De=>{i(Wt),z(()=>i(Wt).source)&&De(hn)})}_(qn);var ye=h(qn,2),Xt=w(ye),Cn=h(Xt,2);_(ye),_(An),pt(()=>{ct(pn,`[@${i(Wt),z(()=>i(Wt).id)??""}]`),ct(en,`${i(Wt),z(()=>i(Wt).author)??""} (${i(Wt),z(()=>i(Wt).year)??""}). ${i(Wt),z(()=>i(Wt).title)??""}`)}),T("click",Xt,()=>j(i(Wt).id)),T("click",Cn,()=>B(i(Wt).id)),P(Tn,An)}),_(ln),P(tn,ln)};gt(En,tn=>{i(l),z(()=>i(l).length===0)?tn(lr):tn(wr,!1)},!0)}P(ne,Me)};gt($n,ne=>{i(a)?ne(le):ne(Ue,!1)})}_(Ft),_(Nt),_(K),_(ut),pt(()=>ct(vn,`已有引用 (${i(l),z(()=>i(l).length)??""})`)),T("click",dt,()=>o(!1)),Je(ee,()=>i(m).id,ne=>ai(m,i(m).id=ne)),Je(Ut,()=>i(m).author,ne=>ai(m,i(m).author=ne)),Je(Dt,()=>i(m).title,ne=>ai(m,i(m).title=ne)),Je(Pt,()=>i(m).year,ne=>ai(m,i(m).year=ne)),Je(St,()=>i(m).source,ne=>ai(m,i(m).source=ne)),T("click",ce,M),T("click",nt,()=>ft("apa")),T("click",rt,()=>ft("mla")),T("click",_t,()=>ft("gb")),T("click",K,lu(function(ne){fu.call(this,e,ne)})),T("click",ut,()=>o(!1)),P(R,ut)};gt(Q,R=>{o()&&R(mt)})}P(t,ot);var it=zn(et);return s(),it}const op="modulepreload",ap=function(t){return"/"+t},ac={},lp=function(e,n,r){let s=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),a=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));s=Promise.allSettled(n.map(f=>{if(f=ap(f),f in ac)return;ac[f]=!0;const p=f.endsWith(".css"),m=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${m}`))return;const S=document.createElement("link");if(S.rel=p?"stylesheet":op,p||(S.as="script"),S.crossOrigin="",S.href=f,a&&S.setAttribute("nonce",a),document.head.appendChild(S),p)return new Promise(($,I)=>{S.addEventListener("load",$),S.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${f}`)))})}))}function o(l){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=l,window.dispatchEvent(a),!a.defaultPrevented)throw l}return s.then(l=>{for(const a of l||[])a.status==="rejected"&&o(a.reason);return e().catch(o)})};let si=null,ya=null;async function cp(){try{return ya?!0:(si=await lp(()=>import("./chunk-wa_bridge.js"),[]),si!=null&&si.default&&await si.default(),ya=(si==null?void 0:si.WasmEditor)??null,ya?(console.log("已加载 Rust WASM 引擎"),!0):(console.warn("未找到 Rust WASM 入口：WasmEditor"),!1))}catch(t){return console.warn("Rust WASM 加载失败，回退到 contenteditable：",t),!1}}var up=G('<div class="generation-banner svelte-1n46o8q"> </div>'),fp=G('<div class="failure-row svelte-1n46o8q"><span> </span> <button class="btn ghost svelte-1n46o8q">重试</button></div>'),dp=G('<section class="section-failures svelte-1n46o8q"><div class="panel-title svelte-1n46o8q">失败章节</div> <!></section>'),vp=G('<div class="panel-empty svelte-1n46o8q">加载中...</div>'),pp=G('<div class="panel-empty svelte-1n46o8q"> </div>'),hp=G('<div class="panel-empty svelte-1n46o8q">暂无版本</div>'),gp=G('<div class="version-summary svelte-1n46o8q"> </div>'),mp=G('<div class="version-summary svelte-1n46o8q"> </div>'),bp=G('<div><div><div class="minor-title svelte-1n46o8q"> </div> <!> <div class="minor-meta svelte-1n46o8q"> </div></div> <div class="minor-actions svelte-1n46o8q"><button class="btn ghost svelte-1n46o8q">切换</button> <button class="btn ghost svelte-1n46o8q">对比</button></div></div>'),_p=G('<div class="version-minors svelte-1n46o8q"></div>'),yp=G('<div class="version-group"><div><div class="version-title svelte-1n46o8q"><span> </span> <span> </span></div> <div class="version-meta svelte-1n46o8q"><span> </span> <span> </span></div> <!> <div class="version-actions svelte-1n46o8q"><button class="btn ghost svelte-1n46o8q">切换</button> <button class="btn ghost svelte-1n46o8q">对比</button></div></div> <!></div>'),wp=G('<div class="version-groups svelte-1n46o8q"></div>'),Sp=G('<div class="inline-selection-bar svelte-1n46o8q" role="toolbar" aria-label="选中块快捷操作"><div class="inline-selection-meta svelte-1n46o8q"> <span class="svelte-1n46o8q">Ctrl/Cmd+Enter 下弹窗 · Ctrl/Cmd+Shift+Enter 上弹窗</span></div> <div class="inline-selection-actions svelte-1n46o8q"><button class="mini-btn svelte-1n46o8q">改写</button> <button class="mini-btn svelte-1n46o8q">样式</button> <button class="mini-btn svelte-1n46o8q">对话</button> <button class="mini-btn svelte-1n46o8q">上方</button> <button class="mini-btn svelte-1n46o8q">下方</button></div></div>'),xp=G('<span class="selected-chip svelte-1n46o8q"></span>'),kp=G('<div class="inline-style-row compact svelte-1n46o8q"><span>字体</span> <select class="svelte-1n46o8q"><option>默认</option><option>宋体</option><option>黑体</option><option>微软雅黑</option><option>楷体</option><option>仿宋</option></select> <span>字号</span> <select class="svelte-1n46o8q"><option>默认</option><option>12pt</option><option>14pt</option><option>16pt</option><option>18pt</option><option>20pt</option></select> <span>行距</span> <select class="svelte-1n46o8q"><option>默认</option><option>1.2</option><option>1.5</option><option>1.75</option><option>2.0</option></select></div> <div class="panel-empty svelte-1n46o8q">这些样式只作用于当前选中的段落块，不会影响全篇。</div>',1),$p=G('<div class="assistant-inline-tip svelte-1n46o8q"><div>用于处理当前选中块的复杂语义修改。</div> <textarea class="inline-instruction svelte-1n46o8q" placeholder="例如：将选中内容改成课程设计报告语气，并补全术语解释。"></textarea> <div class="assistant-inline-actions svelte-1n46o8q"><button class="btn ghost svelte-1n46o8q">同步到改写指令</button> <button class="btn ghost svelte-1n46o8q">发到右下角全局助手</button></div></div>'),Ep=G('<div class="inline-preset-row svelte-1n46o8q"><button class="preset-chip svelte-1n46o8q">更正式</button> <button class="preset-chip svelte-1n46o8q">更简洁</button> <button class="preset-chip svelte-1n46o8q">更详细</button> <button class="preset-chip svelte-1n46o8q">保留术语</button></div> <div class="inline-ai-row svelte-1n46o8q"><textarea class="inline-instruction svelte-1n46o8q" placeholder="例如：仅重写选中段落，语气更正式，减少20%字数。"></textarea></div> <div class="inline-action-row svelte-1n46o8q"><button class="btn ghost svelte-1n46o8q">切到改动对话</button> <button class="btn primary svelte-1n46o8q"> </button></div>',1),Tp=G('<div class="block-error svelte-1n46o8q"> </div>'),Ap=G('<button><span class="svelte-1n46o8q"> </span> <span class="svelte-1n46o8q"> </span></button>'),qp=G('<div class="candidate-card svelte-1n46o8q"><div class="candidate-head svelte-1n46o8q"><span> </span> <span class="candidate-meta svelte-1n46o8q"> </span></div> <div class="candidate-actions svelte-1n46o8q"><button class="btn primary svelte-1n46o8q">采纳到正文</button> <button class="btn ghost svelte-1n46o8q">重新生成</button> <button class="btn ghost danger svelte-1n46o8q">忽略建议</button></div> <div class="candidate-label svelte-1n46o8q">建议文本</div> <div class="candidate-text svelte-1n46o8q"> </div></div>'),Cp=G('<div class="candidate-compare compact svelte-1n46o8q"><div class="candidate-before svelte-1n46o8q"><div class="candidate-label svelte-1n46o8q">原文</div> <div class="candidate-text svelte-1n46o8q"> </div></div> <div class="candidate-panel svelte-1n46o8q"><div class="candidate-switches svelte-1n46o8q"></div> <!></div></div>'),jp=G('<section aria-label="选中内容修改窗口"><div class="inline-popover-head svelte-1n46o8q"><div><div class="panel-title svelte-1n46o8q">选中内容轻量修改</div> <div class="panel-sub svelte-1n46o8q">当前上下文独立于其他段落块，同一块会继承修改上下文。</div></div> <div class="inline-popover-head-actions svelte-1n46o8q"><button class="btn ghost btn-sm svelte-1n46o8q">上方</button> <button class="btn ghost btn-sm svelte-1n46o8q">下方</button> <button class="btn ghost btn-sm svelte-1n46o8q">关闭</button></div></div> <div class="inline-tabs svelte-1n46o8q"><button>改写建议</button> <button>样式设置</button> <button>改动对话</button></div> <div class="selected-targets svelte-1n46o8q"></div> <!> <!> <!> <!> <!></section>'),Ip=G("<!> <!> <!>",1),Mp=G('<main><header class="topbar svelte-1n46o8q"><div class="brand svelte-1n46o8q"><div class="logo svelte-1n46o8q">IR</div> <div class="brand-text"><div class="brand-title svelte-1n46o8q">写作引擎</div> <div class="brand-sub svelte-1n46o8q">Doc IR · 语义写作</div></div></div> <nav class="menu svelte-1n46o8q"><button class="menu-item svelte-1n46o8q">概览</button> <button class="menu-item svelte-1n46o8q">模板</button> <button class="menu-item svelte-1n46o8q">协作</button> <button class="menu-item svelte-1n46o8q">历史</button> <button class="menu-item svelte-1n46o8q">帮助</button></nav> <div class="top-actions svelte-1n46o8q"><div class="status-chip svelte-1n46o8q"><span class="dot svelte-1n46o8q"></span> <span> </span></div> <div class="status-chip light svelte-1n46o8q"> </div> <button class="btn ghost svelte-1n46o8q">保存</button> <button class="btn ghost svelte-1n46o8q">导出 Word</button> <button class="btn ghost svelte-1n46o8q">导出 PDF</button> <!></div></header> <div class="workspace svelte-1n46o8q"><aside class="nav-rail svelte-1n46o8q"><button class="nav-btn active svelte-1n46o8q" title="文档"><span>文档</span></button> <button class="nav-btn svelte-1n46o8q" title="画布"><span>画布</span></button> <button class="nav-btn svelte-1n46o8q" title="引用"><span>引用</span></button> <button class="nav-btn svelte-1n46o8q" title="文档库"><span>文档库</span></button></aside> <section class="doc-area svelte-1n46o8q"><div class="doc-toolbar svelte-1n46o8q"><div class="toolbar-line svelte-1n46o8q"><div class="toolbar-cluster svelte-1n46o8q"><span class="cluster-label svelte-1n46o8q">文本</span> <button class="tool-btn svelte-1n46o8q" title="撤销">↶</button> <button class="tool-btn svelte-1n46o8q" title="重做">↷</button> <button class="tool-btn svelte-1n46o8q" title="清除格式">Tx</button> <span class="tool-sep svelte-1n46o8q"></span> <button class="tool-btn svelte-1n46o8q" title="加粗">B</button> <button class="tool-btn svelte-1n46o8q" title="斜体">I</button> <button class="tool-btn svelte-1n46o8q" title="下划线">U</button></div> <div class="toolbar-cluster svelte-1n46o8q"><span class="cluster-label svelte-1n46o8q">结构</span> <button class="tool-btn svelte-1n46o8q">H1</button> <button class="tool-btn svelte-1n46o8q">H2</button> <button class="tool-btn svelte-1n46o8q">引用</button> <button class="tool-btn svelte-1n46o8q">代码</button> <button class="tool-btn svelte-1n46o8q">列表</button> <button class="tool-btn svelte-1n46o8q">1.</button></div> <div class="toolbar-cluster svelte-1n46o8q"><span class="cluster-label svelte-1n46o8q">插入</span> <button class="tool-btn svelte-1n46o8q">表格</button> <button class="tool-btn svelte-1n46o8q">图片</button> <button class="tool-btn svelte-1n46o8q">画布</button> <button class="tool-btn svelte-1n46o8q">引用</button></div></div> <div class="toolbar-line right svelte-1n46o8q"><div class="toolbar-cluster compact svelte-1n46o8q"><span class="cluster-label svelte-1n46o8q">智能写作</span> <button class="btn ghost svelte-1n46o8q">生成</button> <button class="btn ghost svelte-1n46o8q">停止</button></div></div></div> <!> <!> <div class="doc-stage svelte-1n46o8q"><!></div></section> <aside class="side-panel svelte-1n46o8q"><div class="panel-card version-panel svelte-1n46o8q"><div class="panel-header svelte-1n46o8q"><div><div class="panel-title svelte-1n46o8q">版本树</div> <div class="panel-sub svelte-1n46o8q">自动小版本 · 手动大版本</div></div> <button class="icon-btn svelte-1n46o8q" title="刷新">刷新</button></div> <div class="major-commit svelte-1n46o8q"><input class="version-input svelte-1n46o8q" placeholder="输入版本说明"/> <button class="btn primary svelte-1n46o8q">保存版本</button></div> <!> <div class="version-diff svelte-1n46o8q"><div class="panel-sub svelte-1n46o8q">对比结果</div> <pre class="svelte-1n46o8q"> </pre></div></div></aside></div> <!> <!> <div><button class="assistant-toggle svelte-1n46o8q"> </button> <!></div> <!></main> <!> <!>',1);function Nu(t,e){if(new.target)return sr({component:Nu,...t});Hn(e,!1);const n=()=>qe(Xe,"$sourceText",I),r=()=>qe(Ge,"$docIr",I),s=()=>qe(Vr,"$docId",I),o=()=>qe(He,"$docIrDirty",I),l=()=>qe(rc,"$darkMode",I),a=()=>qe(Eo,"$generating",I),f=()=>qe(Zi,"$flowStatus",I),p=()=>qe(Kn,"$docStatus",I),m=()=>qe(ll,"$wordCount",I),S=()=>qe(Ii,"$instruction",I),$=()=>qe(yo,"$isLoading",I),[I,M]=Ss();let B=null,j="",J=null,ft=null,et=!1,ot=!1,Q=[],mt=null,it=0,R=0,ut=!1,K=!1,lt=null,dt=null,Nt=0,Lt="",Tt="",ee=!1,Ut=!1,Dt=!1,Pt=0,St=0,ce=0,ve=9e4,_e=null,nt=!1,rt=V({current:0,total:0,percent:0,etaS:0,section:""}),_t=0,Ft=[],Ct=V([]),vn=!1,$n=V(null),le=V(""),Ue=null,ne=V(!1),Me=V(!1),En=V(!1),lr=[],wr=V([]),tn=V(""),ln=V(""),Tn=V(""),Wt=V(!0),An=V(!1),qn="",ue=V([]),pn=V([]),pe=V(""),en=V(""),cn=V(""),hn=V(""),ye=V(""),Xt=V("rewrite"),Cn=V(!1),De=V(""),he=V(""),re=V([]),ge=V(0),jn=V(null),Jn=V("");const Ri=new Map;let Lr="",cr=V(!1),Gt=V(0),Yt=V(0),Ht=V(!1),We=V("down"),yt=V(0),Fe=V(0),fe=null;typeof window<"u"&&document.body.setAttribute("data-engine","rust");function nn(){return fe||(fe=cp().then(u=>u).catch(()=>!1)),fe}function Un(){var y,x;const u=window;if(u.__DOC_ID__)return String(u.__DOC_ID__);const v=(y=document.body)==null?void 0:y.getAttribute("data-doc-id");return v||((x=document.querySelector('meta[name="doc-id"]'))==null?void 0:x.getAttribute("content"))||""}function zt(){if(!Nt)return new Date().toLocaleTimeString();const u=Date.now()-Nt,v=Math.max(0,Math.floor(u/1e3)),E=String(Math.floor(v/60)).padStart(2,"0"),y=String(v%60).padStart(2,"0");return`+${E}:${y}`}function gn(u){const v=(u||"").toUpperCase();return v==="PLAN"?"规划":v==="WRITE"?"写作":v==="DONE"?"完成":v==="STOPPED"?"已停止":u}function we(u){const v=String(u||"");v.trim()&&(v.length<8&&!/[\w\u4e00-\u9fa5]/.test(v)||(j+=v,J&&clearTimeout(J),J=setTimeout(()=>{const E=j.slice(-120);on("写作",E,zt()),j="",J=null},500)))}function me(u,v){if(!v&&!et&&!ot)return;const E=String(u??n()??"");ft&&clearTimeout(ft),ft=setTimeout(()=>{if(!v&&!et&&!ot)return;const y=Fa(E);y&&(Ge.set(y),He.set(!1))},120)}function se(){Q=[],R=0,ut=!1,K=!1,lt=null,dt=null,it+=1,ot=!1,mt&&(clearTimeout(mt),mt=null)}function Sr(){let u=26,v=14;return R>1600?(u=120,v=6):R>700?(u=72,v=8):R>260&&(u=46,v=11),ut&&(u=Math.max(u,140),v=Math.min(v,5)),{chunk:u,delayMs:v}}function Pi(u,v,E){Xe.update(y=>{const x=String(y||""),N=E?x+v:tt(x,u,v);return me(N),N}),we(v)}function Hi(u){if(u!==it)return;if(!Q.length){K=!1,ut=!1,lt!==null&&(zi(lt,dt),lt=null,dt=null),ot=!1;return}const v=Q[0],E=Sr(),y=v.text.slice(0,E.chunk);v.text=v.text.slice(y.length),R=Math.max(0,R-y.length),v.text||Q.shift(),y&&Pi(v.section,y,v.raw),mt=setTimeout(()=>Hi(u),E.delayMs)}function xr(){if(K||!Q.length)return;K=!0,ot=!0;const u=++it;Hi(u)}function Gr(u,v,E){const y=String(v||"");y&&(Q.push({section:String(u||""),raw:!!(E!=null&&E.raw),text:y}),R+=y.length,xr())}function zi(u,v){const E=String(u||"");if(Xe.set(E),v&&typeof v=="object")Ge.set(v),He.set(!1);else{const y=Fa(E);y?(Ge.set(y),He.set(!1)):(Ge.set(null),He.set(!0))}}function Zs(u,v){if(lt=String(u||""),dt=v||null,!Q.length&&!K){zi(lt,dt),lt=null,dt=null;return}ut=!0,xr()}let Ji=0;async function to(u,v){const E=++Ji,y=Math.max(10,(v==null?void 0:v.chunk)??36),x=Math.max(10,(v==null?void 0:v.delayMs)??18);ot=!0,He.set(!0),Xe.set("");let N=0;for(;N<u.length;){if(E!==Ji)return;const C=u.slice(N,N+y);Xe.update(D=>{const W=String(D||"")+C;return me(W),W}),we(C),N+=y,await new Promise(D=>setTimeout(D,x))}E===Ji&&(v!=null&&v.finalDocIr&&typeof v.finalDocIr=="object"?(Ge.set(v.finalDocIr),He.set(!1)):me(u,!0),ot=!1)}function eo(u,v,E){let y=String(u||"").replace(/\r/g,"");/^#\s+/m.test(y)||(y=`# ${v||"自动生成文档"}

`+y.trimStart());for(const x of E||[]){const N=String(x||"").trim();if(!N)continue;new RegExp(`^##\\s+${N.replace(/[.*+?^${}()|[\]\\\\]/g,"\\\\$&")}\\s*$`,"m").test(y)||(y=(y.trimEnd()+`

## ${N}

`).replace(/\n{4,}/g,`

`))}return y}function Vo(u){const v=String(u||"").trim(),E=/^H[23]::(.*)$/.exec(v);return(E?E[1]:v).trim()}function Ko(u){return u.replace(/[.*+?^${}()|[\]\\/]/g,"\\$&")}function no(u){return(u||[]).map(v=>({...v}))}function Go(u){return(u||[]).map(v=>String(v||"").trim()).filter(Boolean).sort().join("|")}function xs(){Lr&&Ri.set(Lr,{tab:i(Xt),cmd:i(ye),styleFontSize:i(en),styleLineHeight:i(cn),styleFontFamily:i(hn),candidates:no(i(re)),activeIndex:i(ge),originalText:i(he),error:i(De),dialogInput:i(Jn)})}function Xo(u){g(Xt,u.tab||"rewrite"),g(ye,String(u.cmd||"")),g(en,String(u.styleFontSize||"")),g(cn,String(u.styleLineHeight||"")),g(hn,String(u.styleFontFamily||"")),g(re,no(u.candidates||[])),g(ge,Number.isFinite(u.activeIndex)?Math.max(0,u.activeIndex):0),g(he,String(u.originalText||i(pe)||"")),g(De,String(u.error||"")),g(Jn,String(u.dialogInput||""))}function Yo(u){g(Xt,"rewrite"),g(en,String(u.fontSize||"")),g(cn,String(u.lineHeight||"")),g(hn,String(u.fontFamily||"")),g(ye,""),g(Cn,!1),g(De,""),g(he,i(pe)),g(re,[]),g(ge,0),g(Jn,"")}function Dr(u,v,E){return Math.min(E,Math.max(v,u))}function ro(u){const v=(u||[]).map(W=>String(W||"").trim()).filter(Boolean);if(!v.length)return null;const E=document.querySelector(".editable");if(!E)return null;let y=Number.POSITIVE_INFINITY,x=Number.POSITIVE_INFINITY,N=0,C=0,D=0;for(const W of v){const Y=`[data-block-id="${CSS.escape(W)}"]`,xt=E.querySelector(Y);if(!xt)continue;const Bt=xt.getBoundingClientRect();y=Math.min(y,Bt.left),x=Math.min(x,Bt.top),N=Math.max(N,Bt.right),C=Math.max(C,Bt.bottom),D+=1}return D?{left:y,top:x,right:N,bottom:C,width:Math.max(0,N-y),height:Math.max(0,C-x)}:null}function Xr(){if(!i(ue).length){g(cr,!1),g(Ht,!1);return}const u=ro(i(ue));if(!u){g(cr,!1),g(Ht,!1);return}const v=Math.min(560,window.innerWidth-24);g(Gt,Dr(u.left,12,Math.max(12,window.innerWidth-v-12))),g(Yt,Dr(u.bottom+10,72,Math.max(72,window.innerHeight-56))),g(cr,!0);const E=Math.min(720,window.innerWidth-24);g(yt,Dr(u.left,12,Math.max(12,window.innerWidth-E-12))),g(Fe,i(We)==="up"?Dr(i(Yt)-10,92,Math.max(92,window.innerHeight-80)):Dr(i(Yt)+50,92,Math.max(92,window.innerHeight-80)))}function ur(u,v="down"){i(ue).length&&(g(Xt,u),g(We,v),g(Ht,!0),Xr())}function Qo(){g(Ht,!1)}function Zo(u){const v=u.detail||{};if(v.docIr&&typeof v.docIr=="object"&&(Ge.set(v.docIr),He.set(!1),Ue=v.docIr),v.text){const E=String(v.text||"");Xe.set(E),g(le,E)}v.meta&&v.meta.action&&It("Block updated","ok")}function Ui(u){const v=u.detail||{},E=Array.isArray(v.blockIds)?v.blockIds.map(Y=>String(Y||"").trim()).filter(Boolean):[],y=String(v.blockId||""),x=E.length?E:y?[y]:[],N=Go(x),C=Lr;if(!x.length&&i(ue).length){const Y=document.activeElement;if(Y&&(Y.closest(".inline-edit-popover")||Y.closest(".inline-selection-bar")||Y.closest(".block-dialog")))return}C&&C!==N&&xs();const D=Array.isArray(v.blocks)?v.blocks.map(Y=>({id:String((Y==null?void 0:Y.id)||"").trim(),text:String((Y==null?void 0:Y.text)||""),style:Y!=null&&Y.style&&typeof Y.style=="object"?Y.style:{}})).filter(Y=>Y.id):[];g(ue,x),g(pn,D.length?D:x.map(Y=>({id:Y,text:String(v.text||""),style:{}}))),qn=x[0]||"",g(pe,i(pn).length>1?i(pn).map((Y,xt)=>`[块${xt+1}] ${Y.text}`.trim()).join(`

`):String(v.text||""));const W=v.style&&typeof v.style=="object"?v.style:{};if(!x.length){Lr="",g(cr,!1),g(Ht,!1),g(he,""),g(re,[]),g(ge,0),g(De,"");return}if(N!==C){const Y=Ri.get(N);Y?Xo(Y):Yo(W),Lr=N}g(he,i(he)||i(pe)),requestAnimationFrame(()=>Xr())}function io(u,v,E){const y=new Set((v||[]).map(Y=>String(Y||"").trim()).filter(Boolean));if(!y.size)return null;const x=Array.isArray(u.sections)?u.sections:[];let N=!1;const C=Y=>{const xt={...Y};for(const[Bt,ke]of Object.entries(E)){const vt=String(ke||"").trim();vt?xt[Bt]=vt:delete xt[Bt]}return xt},D=Y=>{let xt=!1;const ke=(Array.isArray(Y==null?void 0:Y.blocks)?Y.blocks:[]).map(ae=>{if(!y.has(String((ae==null?void 0:ae.id)||"")))return ae;xt=!0,N=!0;const kt=ae!=null&&ae.style&&typeof ae.style=="object"?ae.style:{};return{...ae,style:C(kt)}}),vt=Array.isArray(Y==null?void 0:Y.children)?Y.children:[],Ve=vt.map(ae=>D(ae)),sn=Ve.some((ae,kt)=>ae!==vt[kt]);if(!xt&&!sn)return Y;const Re={...Y};return xt&&(Re.blocks=ke),sn&&(Re.children=Ve),Re},W=x.map(Y=>D(Y));return N?{...u,sections:W}:null}function ks(u){const v=i(ue).length?i(ue):qn?[qn]:[];if(!v.length||!r())return;const E=io(r(),v,u);E&&(A(E),requestAnimationFrame(()=>Xr()),Jt().catch(()=>{}))}function mn(){return i(ue).length?i(ue).slice():qn?[qn]:[]}function $s(){return i(pn).length>1?i(pn).map((u,v)=>`[块${v+1}] ${u.text}`.trim()).join(`

`):i(pn).length===1?String(i(pn)[0].text||""):i(pe).trim()}function ta(u){g(Xt,"assistant"),g(Wt,!0);const v=mn(),E=$s(),y=String(u||"").trim();if(E&&v.length>0){const x=v.length>1?`请只修改我选中的 ${v.length} 个段落块，不要改其他段落。`:"请只修改我选中的这段内容，不要改其他段落。";Ii.set(`${x}
${E}

修改要求：${y}`)}queueMicrotask(()=>{const x=document.querySelector(".assistant-dock .composer textarea");x&&x.focus()})}async function so(){const u=mn();if(!s()||!u.length)return;const v=i(ye).trim();if(v){g(Cn,!0),g(De,""),g(re,[]);try{if(!r()||typeof r()!="object")throw new Error("文档尚未就绪");const E=r();if(g(he,$s()),u.length===1){const y={block_id:u[0],instruction:v};r()&&(y.doc_ir=r());const x=await fetch(`/api/doc/${s()}/block-edit/preview`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)});if(!x.ok)throw new Error(await x.text());const N=await x.json();g(he,String(N.before||i(pe)||""));const C=Array.isArray(N.candidates)?N.candidates:[];g(re,C.filter(D=>D&&typeof D=="object"&&D.doc_ir&&!D.error).map((D,W)=>({label:String(D.label||`方案${W+1}`),selectedAfter:c(String(D.selected_after||""),i(he)),selectedBefore:String(D.selected_before||i(he)||""),docIr:D.doc_ir,diff:D.diff})))}else{const y=[{label:"方案A",instruction:v},{label:"方案B",instruction:`${v}。请采用另一种表达方式，保持原意但在句式和组织上有明显差异。`}],x=[];for(const N of y){let C=JSON.parse(JSON.stringify(E));const D=[],W=[];for(const Y of u){const xt={block_id:Y,instruction:N.instruction,doc_ir:C,variants:[{label:N.label,instruction:N.instruction}]},Bt=await fetch(`/api/doc/${s()}/block-edit/preview`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(xt)});if(!Bt.ok)throw new Error(await Bt.text());const ke=await Bt.json(),vt=Array.isArray(ke.candidates)?ke.candidates[0]:null;if(!vt||!vt.doc_ir)throw new Error(`未生成可用候选：${N.label}`);const Ve=String(ke.before||""),sn=c(String(vt.selected_after||""),Ve);Ve&&D.push(Ve),sn&&W.push(sn),C=vt.doc_ir}x.push({label:N.label,selectedAfter:W.join(`

`),selectedBefore:D.join(`

`)||i(he),docIr:C,diff:""})}g(re,x)}if(!i(re).length)throw new Error("没有生成可用候选版本");g(ge,0)}catch(E){g(De,E instanceof Error?E.message:"候选生成失败")}finally{g(Cn,!1)}}}function Wi(u){const v=i(ye).trim();g(ye,v?`${v}；${u}`:u),g(Xt,"rewrite")}function oo(u){if(i(ue).length){if((u.ctrlKey||u.metaKey)&&u.key==="Enter"){u.preventDefault();const v=u.shiftKey?"up":"down";ur(i(Xt),v);return}u.key==="Escape"&&i(Ht)&&g(Ht,!1)}}function c(u,v){const E=String(u||"").trim();if(!E)return"";const y=String(v||"").trim();let x=E.replace(/^\s*```[a-zA-Z0-9_-]*\s*/g,"").replace(/\s*```\s*$/g,"").trim();const N=/(?:改写后(?:的)?(?:文本|版本)?|优化后(?:的)?(?:文本|版本)?|重写后(?:的)?(?:文本|版本)?|润色后(?:的)?(?:文本|版本)?|rewritten\s*text|revised\s*version|final\s*version)\s*[:：]\s*/gi;let C=null;for(;;){const W=N.exec(x);if(!W)break;C=W}if(C&&C.index>=0&&(x=x.slice(C.index+C[0].length).trim()),y&&x.startsWith(y)){const W=x.slice(y.length).replace(/^[\s:：\-—]+/,"");W.length>=4&&(x=W)}const D=x.split(/\n{2,}/).map(W=>W.trim()).filter(Boolean);if(y&&D.length>=2){const W=D.filter(Y=>Y!==y);W.length&&W.length<D.length&&(x=W.join(`

`))}return x.trim()}function d(u){const v=String((u==null?void 0:u.selectedAfter)||""),E=String((u==null?void 0:u.selectedBefore)||i(he)||""),y=v.length-E.length;return y===0?"长度不变":y>0?`增加 ${y} 字`:`减少 ${Math.abs(y)} 字`}function b(){g(re,[]),g(ge,0),g(De,""),It("已忽略本轮建议","info")}async function k(u){const v=i(re)[u];if(!v||!s()||!v.docIr)return;const E=v.docIr;A(E);try{await fetch(`/api/doc/${s()}/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({doc_ir:E})}),await fetch(`/api/doc/${s()}/version/commit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:`块修改:${v.label}`,author:"user",kind:"minor"})}),It(`已应用${v.label}`,"ok"),g(re,[]),g(ge,0),g(ye,""),requestAnimationFrame(()=>Xr()),await _i()}catch(y){g(De,y instanceof Error?y.message:"应用候选失败")}}function A(u){Ge.set(u),He.set(!1),Ue=u;const v=Mo(u)||"";Xe.set(v),g(le,v)}function L(u){if(!u||typeof u!="object")return;const v=r();if(!v||typeof v!="object")return;const E=Array.isArray(v.sections)?v.sections:[];if(!E.length)return;const y=E[0],x=Array.isArray(y.blocks)?y.blocks.slice():[],N={id:Math.random().toString(36).slice(2),type:"figure",figure:u};x.push(N);const C={...y,blocks:x},D=E.slice();D[0]=C;const W={...v,sections:D};A(W)}const F=new Map;async function U(u){if(!u)return null;if(F.has(u))return F.get(u);try{const v=await fetch(`/api/text/${encodeURIComponent(u)}`);if(!v.ok)throw new Error(await v.text());const E=await v.json();return F.set(u,E),E}catch{return null}}function Z(u){if(!u)return"";const v=String(u.kind||""),E=String(u.format||"");if(E==="text")return String(u.text||"");if(E==="json"){const y=u.data||{};if(v==="list")return(Array.isArray(y.items)?y.items:[]).map(N=>`- ${String(N).trim()}`).join(`
`);if(v==="table")return`[[TABLE:${JSON.stringify(y)}]]`;if(v==="figure")return`[[FIGURE:${JSON.stringify(y)}]]`;if(y.text)return String(y.text)}return""}async function O(u,v){const E=await U(v),y=Z(E);y&&Gr(String(u||""),y,{raw:!u})}function H(u){let v=String(u||"").replace(/\r/g,"");return v=v.replace(/(\n(?:-|\d+\.)[^\n]*)(?:\n{2,})(?=(?:-|\d+\.)\s)/g,`$1
`),v=v.replace(/\n{3,}/g,`

`),v}function tt(u,v,E){const y=Vo(v),x=String(E||"").replace(/\r/g,"");if(!x||!x.trim()&&!x.includes(`
`))return String(u||"");if(!y){const Re=String(u||"").replace(/\r/g,""),ae=Re+(Re.endsWith(`
`)||!Re?"":`
`)+x;return H(ae)}let N=String(u||"").replace(/\r/g,"");const C=new RegExp(`^##\\s+${Ko(y)}\\s*$`,"m");C.test(N)||(N=eo(N,"",[y]));const D=C.exec(N);if(!D){const Re=N+(N.endsWith(`
`)?"":`
`)+delta;return H(Re)}const W=D.index+D[0].length,xt=N.slice(W).search(/^##\s+/m),Bt=xt>=0?W+xt:N.length,ke=N.slice(0,Bt),vt=N.slice(Bt),sn=ke.replace(/\s+$/,"")+`

${x}
`+vt;return H(sn)}function X(u){const v=String(u||"").replace(/\r/g,"").split(`
`);let E="message";const y=[];for(const C of v)C.startsWith("event:")&&(E=C.slice(6).trim()),C.startsWith("data:")&&y.push(C.slice(5).trim());const x=y.join(`
`);let N={};try{N=x?JSON.parse(x):{}}catch{N={raw:x}}return{event:E,data:N}}async function st(u,v,E,y){const x=await fetch(u,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(v),signal:y});if(!x.ok){const Y=await x.text()||x.statusText||"请求失败";throw new Error(`HTTP ${x.status}: ${Y}`)}if(!x.body)throw new Error("当前环境不支持流式输出");const N=x.body.getReader(),C=new TextDecoder("utf-8");let D="";for(;;){const{value:W,done:Y}=await N.read();if(Y)break;D+=C.decode(W,{stream:!0});let xt=D.indexOf(`

`);for(;xt>=0;){const Bt=D.slice(0,xt);if(D=D.slice(xt+2),Bt.trim()){const{event:ke,data:vt}=X(Bt);E(ke,vt)}xt=D.indexOf(`

`)}}}async function at(){const u=s();if(u)try{const v=await fetch(`/api/doc/${u}`);if(!v.ok)throw new Error(await v.text());const E=await v.json();Xe.set(String(E.text||"")),g(le,String(E.text||"")),E.doc_ir&&typeof E.doc_ir=="object"?(Ge.set(E.doc_ir),He.set(!1),Ue=E.doc_ir):(Ge.set(null),Ue=null),_i().catch(()=>{})}catch(v){It(`加载失败: ${v instanceof Error?v.message:"未知错误"}`,"error")}finally{yo.set(!1)}}function ht(u){const v=[],E=Array.isArray(u==null?void 0:u.sections)?u.sections:[],y=x=>{v.push(x),(Array.isArray(x==null?void 0:x.children)?x.children:[]).forEach(C=>y(C))};return E.forEach(x=>y(x)),v}function jt(u){const v=Math.max(1,Math.min(6,Number((u==null?void 0:u.level)||1))),E=String((u==null?void 0:u.title)||"").trim(),y=u!=null&&u.style&&typeof u.style=="object"?JSON.stringify(u.style):"";return`${v}:${E}:${y}`}function Se(u){const v=String((u==null?void 0:u.type)||"paragraph").toLowerCase(),E=u!=null&&u.style&&typeof u.style=="object"?u.style:null,y=Array.isArray(u==null?void 0:u.runs)?u.runs:null;if(v==="list"){const C=Array.isArray(u==null?void 0:u.items)?u.items:[],D=!!(u!=null&&u.ordered),W={type:"list",items:C,ordered:D};return E&&(W.style=E),y&&(W.runs=y),W}if(v==="table"){const C={type:"table",table:(u==null?void 0:u.table)||{}};return E&&(C.style=E),y&&(C.runs=y),C}if(v==="figure"){const C={type:"figure",figure:(u==null?void 0:u.figure)||{}};return E&&(C.style=E),y&&(C.runs=y),C}const N={type:"paragraph",text:String((u==null?void 0:u.text)||"")};return E&&(N.style=E),y&&(N.runs=y),N}function Be(u){const v=String((u==null?void 0:u.type)||"paragraph").toLowerCase(),E=u!=null&&u.style?`:style=${JSON.stringify((u==null?void 0:u.style)||{})}`:"",y=u!=null&&u.runs?`:runs=${JSON.stringify((u==null?void 0:u.runs)||[])}`:"";return v==="list"?`list:${JSON.stringify((u==null?void 0:u.items)||[])}:${!!(u!=null&&u.ordered)}${E}`:v==="table"?`table:${JSON.stringify((u==null?void 0:u.table)||{})}${E}`:v==="figure"?`figure:${JSON.stringify((u==null?void 0:u.figure)||{})}${E}`:`paragraph:${String((u==null?void 0:u.text)||"")}${E}${y}`}function ie(u,v){var N;if(!u||!v)return null;const E=ht(u),y=ht(v);if(E.length!==y.length)return null;for(let C=0;C<E.length;C++)if(jt(E[C])!==jt(y[C])||!((N=E[C])!=null&&N.id))return null;const x=[];for(let C=0;C<E.length;C++){const D=E[C],W=y[C],Y=Array.isArray(D==null?void 0:D.blocks)?D.blocks:[],xt=Array.isArray(W==null?void 0:W.blocks)?W.blocks:[],Bt=Y.map(kt=>String((kt==null?void 0:kt.id)||"")).filter(Boolean),ke=xt.map(kt=>String((kt==null?void 0:kt.id)||"")).filter(Boolean),vt=new Set(Bt),Ve=new Set(ke),sn=new Map(Y.map(kt=>[String((kt==null?void 0:kt.id)||""),kt]));for(const kt of Bt)Ve.has(kt)||x.push({op:"delete",target_id:kt});const Re=ke.filter(kt=>vt.has(kt)),ae=Bt.filter(kt=>Ve.has(kt));Re.forEach((kt,fr)=>{const Wn=ae.indexOf(kt);Wn!==-1&&Wn!==fr&&(x.push({op:"move",target_id:kt,parent_id:String(D.id),index:fr}),ae.splice(Wn,1),ae.splice(fr,0,kt))}),xt.forEach((kt,fr)=>{const Wn=String((kt==null?void 0:kt.id)||"");if(Wn&&vt.has(Wn)){const Zt=sn.get(Wn);Zt&&Be(Zt)!==Be(kt)&&x.push({op:"update",target_id:Wn,payload:Se(kt)});return}const wi=Se(kt);x.push({op:"insert",parent_id:String(D.id),index:fr,payload:wi})})}return x}async function Jt(){const u=s();if(u)try{if(r()&&!o()&&Ue){const E=ie(Ue,r());if(E&&E.length>0){const y=await fetch(`/api/doc/${u}/doc_ir/ops`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ops:E})});if(y.ok){const x=await y.json();if(x.doc_ir&&typeof x.doc_ir=="object"&&(Ge.set(x.doc_ir),He.set(!1),Ue=x.doc_ir),x.text){const N=String(x.text||"");Xe.set(N),g(le,N)}else g(le,n());It("已保存","ok");return}}else if(E&&E.length===0){g(le,n()),Ue=r();return}}const v={text:n()};!o()&&r()&&(v.doc_ir=r()),await fetch(`/api/doc/${u}/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)}),g(le,n()),!o()&&r()?Ue=r():Ue=null,It("已保存","ok")}catch(v){It(`保存失败: ${v instanceof Error?v.message:"未知错误"}`,"error")}}function bn(u){if(!u)return"";try{return new Date(u*1e3).toLocaleString()}catch{return String(u)}}function kr(u){if(!u||typeof u!="object")return"";const v=Number(u.insert||0),E=Number(u.delete||0),y=Number(u.replace||0),x=[];return v&&x.push(`新增${v}`),y&&x.push(`修改${y}`),E&&x.push(`删除${E}`),x.join(" / ")}function ea(u){const v=[];let E=null;return u.forEach(y=>{const x=Array.isArray(y==null?void 0:y.tags)?y.tags:[];((y==null?void 0:y.kind)||(x.includes("major")?"major":x.includes("minor")?"minor":""))==="major"||!E?(E={major:y,minors:[]},v.push(E)):E.minors.push(y)}),v}async function _i(){if(s()){g(En,!0),g(Tn,"");try{const u=await fetch(`/api/doc/${s()}/version/log?branch=main&limit=50`);if(!u.ok)throw new Error(await u.text());const v=await u.json();lr=Array.isArray(v.versions)?v.versions:[],g(wr,ea(lr))}catch(u){g(Tn,u instanceof Error?u.message:"加载失败")}finally{g(En,!1)}}}async function ao(){if(!s())return;const u=i(ln).trim()||"定稿版本";try{const v=await fetch(`/api/doc/${s()}/version/commit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:u,author:"user",kind:"major"})});if(!v.ok)throw new Error(await v.text());g(ln,""),await _i(),It("已提交版本","ok")}catch(v){It(`提交失败: ${v instanceof Error?v.message:"未知错误"}`,"error")}}async function Es(u){if(!(!s()||!u))try{const v=await fetch(`/api/doc/${s()}/version/checkout`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({version_id:u})});if(!v.ok)throw new Error(await v.text());const E=await v.json(),y=String(E.doc_text||"");zi(y),g(le,y),await _i(),It("已切换版本","ok")}catch(v){It(`切换失败: ${v instanceof Error?v.message:"未知错误"}`,"error")}}async function lo(u,v){if(!(!s()||!u||!v)){g(tn,"");try{const E=await fetch(`/api/doc/${s()}/version/diff?from_version=${u}&to_version=${v}`);if(!E.ok)throw new Error(await E.text());const y=await E.json(),x=Array.isArray(y.diff)?y.diff:[];g(tn,x.join(`
`))}catch(E){g(tn,E instanceof Error?E.message:"对比失败")}}}async function Ts(u){if(!u)return;const v=lr.find(E=>E.is_current);!v||v.version_id===u||await lo(v.version_id,u)}function co(){s()&&(It("正在生成PDF...","info"),window.location.href=`/download/${s()}.pdf`)}function uo(u){g(ne,!1),window.location.href=`/workbench/${u}`}function fo(){s()&&(It("正在生成Word文档...","info"),window.location.href=`/download/${s()}.docx`)}async function Vi(u){var E;if(a())return;const v=String(u||"").trim();if(v){if(!s()){const y="缺少文档ID，请刷新或从 /workbench/{id} 进入";Kn.set(`已中止: ${y}`),on("中止",y,new Date().toLocaleTimeString()),It(y,"info");return}Ji+=1,se(),ii("user",v),Ii.set(""),Eo.set(!0),He.set(!0),et=!0,Zi.set("分析"),Kn.set("生成中…"),Nt=Date.now(),Lt="",Tt="",ee=!1,Ut=!1,Dt=!1,Pt=Date.now(),nt=!1,g(rt,{current:0,total:0,percent:0,etaS:0,section:""}),_t=Date.now(),Ft=[],ce=0,g(Ct,[]),on("启动","开始生成",new Date().toLocaleTimeString()),B=new AbortController,yo.set(!1),_e&&clearInterval(_e),_e=setInterval(()=>{if(!a())return;const y=Date.now()-Pt,x=Ft.length>0?Math.round(Ft.reduce((D,W)=>D+W,0)/Ft.length):0;let N=Math.max(ve,x*6||0,ce*3||0,9e4);N=Math.min(6e5,N),(/model preparing/i.test(Tt)||/解析中/.test(Tt)||Lt==="analysis")&&(N=Math.max(N,18e4)),y>N&&!nt&&(nt=!0,B==null||B.abort(`客户端超时：${Math.round(y/1e3)}秒无事件，切换非流式生成`))},1e3);try{if(await st(`/api/doc/${s()}/generate/stream`,{instruction:v,text:n()||""},(y,x)=>{const N=Date.now();if(Lt=String(y||""),Pt>0&&(St=N-Pt,St>0&&St<12e4&&(Ft=[...Ft,St].slice(-8)),St>ce&&St<6e5&&(ce=St)),Pt=N,y==="state"){const C=gn(String(x.name||""));Zi.set(C||f()),on("流程",C,zt());return}if(y==="delta"){const C=String(x.delta||"").trim();C&&(Kn.set(C),Tt=C,on("进度",C,zt()));return}if(y==="plan"){const C=String(x.title||"自动生成文档"),D=Array.isArray(x.sections)?x.sections:[];on("大纲",`标题：${C}；章节：${D.join(" / ")}`,zt());const W=eo(n(),C,D);Xe.set(W),me(W);return}if(y==="section"){if(String(x.phase||"")==="delta"){Dt=!0;const C=String(x.block_id||""),D=String(x.section||""),W=String(x.block_type||"");if(C){O(D,C);return}const Y=String(x.delta||"");Y&&Gr(D,Y,{raw:!D&&!W})}return}if(y==="progress"){const C=Number(x.current||0),D=Number(x.total||0),W=Number(x.percent||0),Y=String(x.section||""),xt=Number(x.elapsed_s||0);if(_t===0&&(_t=Date.now()),C>0){const ke=(xt>0?xt:Math.max(1,Math.round((Date.now()-_t)/1e3)))/C,vt=Math.max(0,Math.round(ke*Math.max(0,D-C)));g(rt,{current:C,total:D,percent:W,etaS:vt,section:Y})}else g(rt,{current:C,total:D,percent:W,etaS:0,section:Y});return}if(y==="section_error"){const C=String(x.section||""),D=String(x.reason||"unknown");C&&(g(Ct,[...i(Ct),{section:C,reason:D}]),It(`章节失败: ${C}`,"bad"));return}if(y==="analysis"){const C=String(x.summary||""),D=Array.isArray(x.steps)?x.steps:[],W=Array.isArray(x.missing)?x.missing:[];if(Od.set(C||"等待解析…"),Ld.set(D),Dd.set(W),on("解析",C||"解析完成",zt()),x.raw){const Y=JSON.stringify(x.raw,null,2).slice(0,600);on("解析JSON",Y,zt())}return}if(y==="final"){const C=String(x.text||"");if(Dt){const D=x.doc_ir&&typeof x.doc_ir=="object"?x.doc_ir:null;Zs(C,D)}else{const D=x.doc_ir&&typeof x.doc_ir=="object"?x.doc_ir:null;to(C,{finalDocIr:D})}Kn.set("完成"),Zi.set("完成"),ee=!0,ii("system","已完成生成。"),on("完成","生成完成",zt()),It("生成完成","ok"),Jt().catch(()=>{});return}if(y==="error"){const C=String(x.message||x.reason||x.detail||"服务端未返回具体原因"),W=String(x.code||x.type||"").toLowerCase().includes("abort")||/aborted|stopped|取消|中止/i.test(C);Ut=!0,Kn.set(W?`已中止: ${C}`:`生成失败: ${C}`),ii("system",C),on(W?"中止":"错误",C,zt()),It(C,W?"info":"bad")}},B.signal),!ee&&!Ut){const y=Tt?`流式结束但未完成，最后进度: ${Tt}`:Lt?`流式结束但未完成，最后事件: ${Lt}`:"流式结束但未完成，服务端未返回原因";Kn.set(`已中止: ${y}`),ii("system",y),on("中止",y,zt()),It(y,"info")}}catch(y){if(String((y==null?void 0:y.name)||"")==="AbortError"){const x=((E=B==null?void 0:B.signal)==null?void 0:E.reason)||(y==null?void 0:y.message)||"用户中止";if(String(x).includes("切换非流式生成")){on("中止",String(x),zt()),It(String(x),"info");try{const N=await fetch(`/api/doc/${s()}/generate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({instruction:v,text:n()||""})});if(!N.ok){const W=await N.text();throw new Error(`HTTP ${N.status}: ${W||N.statusText}`)}const C=await N.json(),D=String(C.text||"");if(Dt){const W=C.doc_ir&&typeof C.doc_ir=="object"?C.doc_ir:null;Zs(D,W)}else{const W=C.doc_ir&&typeof C.doc_ir=="object"?C.doc_ir:null;to(D,{finalDocIr:W})}Kn.set("完成"),Zi.set("完成"),ii("system","已完成生成（非流式兜底）。"),on("完成","非流式生成完成",zt()),It("生成完成（非流式）","ok"),Jt().catch(()=>{})}catch(N){const C=(N==null?void 0:N.message)||"非流式生成失败";Kn.set(`生成失败: ${C}`),ii("system",C),on("错误",String(C),zt()),It(String(C),"bad")}}else Kn.set(`已中止: ${x}`),ii("system",`已中止生成：${x}`),on("中止",String(x),zt()),It(String(x),"info")}else{const x=(y==null?void 0:y.message)||"生成失败，请检查模型是否运行。";Kn.set(`生成失败: ${x}`),ii("system",x),on("错误",String(x),zt()),It(String(x),"bad")}}finally{if(Eo.set(!1),yo.set(!1),et=!1,ft&&(clearTimeout(ft),ft=null),_e&&(clearInterval(_e),_e=null),ce>0&&typeof localStorage<"u"){const y=Math.min(6e5,Math.max(ve,ce*3,9e4));ve=y;try{localStorage.setItem("wa_idle_base_ms",String(y))}catch{}}B=null}}}function vo(){B&&B.abort("用户点击停止")}function rn(u){La.set(u)}Ys(()=>{const u=localStorage.getItem("darkMode")==="true";rc.set(u),u&&document.body.classList.add("dark");const v=localStorage.getItem("wa_idle_base_ms");if(v){const N=Number(v);Number.isFinite(N)&&N>0&&(ve=N)}nn();const E=N=>{if(!vn)return;const C=document.querySelector(".grid");if(!C)return;const D=C.getBoundingClientRect(),W=Math.min(Math.max(N.clientX-D.left,220),D.width-260);Math.round(W/D.width*100)},y=()=>{vn=!1,document.body.style.cursor=""},x=()=>{Xr()};if(window.addEventListener("mousemove",E),window.addEventListener("mouseup",y),window.addEventListener("resize",x),window.addEventListener("scroll",x,!0),window.addEventListener("keydown",oo),!s()){const N=Un();N&&(Vr.set(N),at().then(()=>Promise.all([Fd(),Bd()])).catch(()=>{}))}return()=>{xs(),window.removeEventListener("mousemove",E),window.removeEventListener("mouseup",y),window.removeEventListener("resize",x),window.removeEventListener("scroll",x,!0),window.removeEventListener("keydown",oo),i($n)&&clearTimeout(i($n))}}),rs(()=>(i(ge),i(re)),()=>{i(ge)>=i(re).length&&g(ge,0)}),rs(()=>(i(re),i(ge)),()=>{g(jn,i(re)[i(ge)]||null)}),rs(()=>(n(),i(le),a(),i($n)),()=>{n()&&n()!==i(le)&&!a()&&(i($n)&&clearTimeout(i($n)),g($n,setTimeout(()=>{Jt().catch(()=>{})},3e3)))}),Wo();var na={$set:ar,$on:(u,v)=>or(e,u,v)};bi();var As=Mp(),yi=Ee(As);let qs;var Ki=w(yi),Cs=h(w(Ki),4),Gi=w(Cs),js=h(w(Gi),2),po=w(js,!0);_(js),_(Gi);var Is=h(Gi,2),ra=w(Is);_(Is);var Qt=h(Is,2),oe=h(Qt,2),Ne=h(oe,2),xe=h(Ne,2);Au(xe,{}),_(Cs),_(Ki);var Vt=h(Ki,2),$r=w(Vt),Ms=h(w($r),2),ho=h(Ms,2),Ou=h(ho,2);_($r);var ia=h($r,2),sa=w(ia),oa=w(sa),aa=w(oa),fl=h(w(aa),2),dl=h(fl,2),vl=h(dl,2),pl=h(vl,4),hl=h(pl,2),Lu=h(hl,2);_(aa);var la=h(aa,2),gl=h(w(la),2),ml=h(gl,2),bl=h(ml,2),_l=h(bl,2),yl=h(_l,2),Du=h(yl,2);_(la);var wl=h(la,2),Sl=h(w(wl),2),xl=h(Sl,2),kl=h(xl,2),Fu=h(kl,2);_(wl),_(oa);var $l=h(oa,2),El=w($l),ca=h(w(El),2),Tl=h(ca,2);_(El),_($l),_(sa);var Al=h(sa,2);{var Bu=u=>{var v=up(),E=w(v);_(v),pt(y=>ct(E,`生成中 ${i(rt),z(()=>i(rt).current)??""}/${i(rt),z(()=>i(rt).total)??""} · ${i(rt),z(()=>i(rt).percent)??""}% · 预计剩余 ${y??""} 分 ${i(rt),z(()=>i(rt).etaS%60)??""} 秒`),[()=>(i(rt),z(()=>Math.ceil(i(rt).etaS/60)))]),P(u,v)};gt(Al,u=>{a(),i(rt),z(()=>a()&&i(rt).total>0)&&u(Bu)})}var ql=h(Al,2);{var Ru=u=>{var v=dp(),E=h(w(v),2);ze(E,1,()=>i(Ct),Qe,(y,x)=>{var N=fp(),C=w(N),D=w(C,!0);_(C);var W=h(C,2);_(N),pt(()=>ct(D,(i(x),z(()=>i(x).section)))),T("click",W,()=>retrySection(i(x).section)),P(y,N)}),_(v),P(u,v)};gt(ql,u=>{i(Ct),z(()=>i(Ct).length>0)&&u(Ru)})}var Cl=h(ql,2),Pu=w(Cl);{var Hu=u=>{Cu(u,{})},zu=u=>{ku(u,{showToolbar:!1,paper:!0,$$events:{blockedit:Zo,blockselect:Ui}})};gt(Pu,u=>{$()?u(Hu):u(zu,!1)})}_(Cl),_(ia);var jl=h(ia,2),Il=w(jl),ua=w(Il),Ju=h(w(ua),2);_(ua);var fa=h(ua,2),da=w(fa);Zn(da);var Uu=h(da,2);_(fa);var Ml=h(fa,2);{var Wu=u=>{var v=vp();P(u,v)},Vu=u=>{var v=mr(),E=Ee(v);{var y=N=>{var C=pp(),D=w(C,!0);_(C),pt(()=>ct(D,i(Tn))),P(N,C)},x=N=>{var C=mr(),D=Ee(C);{var W=xt=>{var Bt=hp();P(xt,Bt)},Y=xt=>{var Bt=wp();ze(Bt,5,()=>i(wr),Qe,(ke,vt)=>{var Ve=yp(),sn=w(Ve),Re=w(sn),ae=w(Re),kt=w(ae,!0);_(ae);var fr=h(ae,2),Wn=w(fr,!0);_(fr),_(Re);var wi=h(Re,2),Zt=w(wi),be=w(Zt,!0);_(Zt);var $e=h(Zt,2),Ae=w($e,!0);_($e),_(wi);var _n=h(wi,2);{var In=At=>{var te=gp(),Ot=w(te,!0);_(te),pt(Kt=>ct(Ot,Kt),[()=>(i(vt),z(()=>{var Kt;return kr((Kt=i(vt).major)==null?void 0:Kt.summary)}))]),P(At,te)};gt(_n,At=>{i(vt),z(()=>{var te;return kr((te=i(vt).major)==null?void 0:te.summary)})&&At(In)})}var yn=h(_n,2),Mn=w(yn),dr=h(Mn,2);_(yn),_(sn);var Nn=h(sn,2);{var Oe=At=>{var te=_p();ze(te,5,()=>(i(vt),z(()=>i(vt).minors)),Qe,(Ot,Kt)=>{var On=bp(),Vn=w(On),Ln=w(Vn),Yr=w(Ln,!0);_(Ln);var Qr=h(Ln,2);{var Zr=Ns=>{var pa=mp(),sf=w(pa,!0);_(pa),pt(of=>ct(sf,of),[()=>(i(Kt),z(()=>kr(i(Kt).summary)))]),P(Ns,pa)};gt(Qr,Ns=>{i(Kt),z(()=>kr(i(Kt).summary))&&Ns(Zr)})}var ti=h(Qr,2),Xi=w(ti,!0);_(ti),_(Vn);var ei=h(Vn,2),va=w(ei),Bl=h(va,2);_(ei),_(On),pt(Ns=>{un(On,1,(i(Kt),z(()=>`version-minor ${i(Kt).is_current?"current":""}`)),"svelte-1n46o8q"),ct(Yr,(i(Kt),z(()=>i(Kt).message||"未命名"))),ct(Xi,Ns),va.disabled=(i(Kt),z(()=>i(Kt).is_current)),Bl.disabled=(i(Kt),z(()=>i(Kt).is_current))},[()=>(i(Kt),z(()=>bn(i(Kt).timestamp)))]),T("click",va,()=>Es(i(Kt).version_id)),T("click",Bl,()=>Ts(i(Kt).version_id)),P(Ot,On)}),_(te),P(At,te)};gt(Nn,At=>{i(vt),z(()=>i(vt).minors&&i(vt).minors.length)&&At(Oe)})}_(Ve),pt((At,te)=>{un(sn,1,(i(vt),z(()=>{var Ot;return`version-major ${(Ot=i(vt).major)!=null&&Ot.is_current?"current":""}`})),"svelte-1n46o8q"),ct(kt,(i(vt),z(()=>{var Ot;return((Ot=i(vt).major)==null?void 0:Ot.message)||"未命名"}))),un(fr,1,(i(vt),z(()=>{var Ot;return`badge ${((Ot=i(vt).major)==null?void 0:Ot.kind)==="major"?"major":"minor"}`})),"svelte-1n46o8q"),ct(Wn,(i(vt),z(()=>{var Ot;return((Ot=i(vt).major)==null?void 0:Ot.kind)==="major"?"大版本":"小版本"}))),ct(be,At),ct(Ae,te),Mn.disabled=(i(vt),z(()=>{var Ot;return(Ot=i(vt).major)==null?void 0:Ot.is_current})),dr.disabled=(i(vt),z(()=>{var Ot;return(Ot=i(vt).major)==null?void 0:Ot.is_current}))},[()=>(i(vt),z(()=>{var At;return bn(((At=i(vt).major)==null?void 0:At.timestamp)||0)})),()=>(i(vt),z(()=>{var At;return String(((At=i(vt).major)==null?void 0:At.version_id)||"").slice(0,7)}))]),T("click",Mn,()=>{var At;return Es((At=i(vt).major)==null?void 0:At.version_id)}),T("click",dr,()=>{var At;return Ts((At=i(vt).major)==null?void 0:At.version_id)}),P(ke,Ve)}),_(Bt),P(xt,Bt)};gt(D,xt=>{i(wr),z(()=>i(wr).length===0)?xt(W):xt(Y,!1)},!0)}P(N,C)};gt(E,N=>{i(Tn)?N(y):N(x,!1)},!0)}P(u,v)};gt(Ml,u=>{i(En)?u(Wu):u(Vu,!1)})}var Nl=h(Ml,2),Ol=h(w(Nl),2),Ku=w(Ol,!0);_(Ol),_(Nl),_(Il),_(jl),_(Vt);var Ll=h(Vt,2);{var Gu=u=>{var v=Sp(),E=w(v),y=w(E);Ps(),_(E);var x=h(E,2),N=w(x),C=h(N,2),D=h(C,2),W=h(D,2),Y=h(W,2);_(x),_(v),pt(()=>{ui(v,`left:${i(Gt)}px;top:${i(Yt)}px;`),ct(y,`已选中 ${i(ue),z(()=>i(ue).length)??""} 个块 `)}),T("click",N,()=>ur("rewrite","down")),T("click",C,()=>ur("style","down")),T("click",D,()=>ur("assistant","down")),T("click",W,()=>ur(i(Xt),"up")),T("click",Y,()=>ur(i(Xt),"down")),P(u,v)};gt(Ll,u=>{i(ue),i(cr),z(()=>i(ue).length>0&&i(cr))&&u(Gu)})}var Dl=h(Ll,2);{var Xu=u=>{var v=jp(),E=w(v),y=h(w(E),2),x=w(y),N=h(x,2),C=h(N,2);_(y),_(E);var D=h(E,2),W=w(D),Y=h(W,2),xt=h(Y,2);_(D);var Bt=h(D,2);ze(Bt,5,()=>i(pn),Qe,(Zt,be,$e)=>{var Ae=xp();Ae.textContent=`块${$e+1}`,pt(()=>is(Ae,"title",(i(be),z(()=>i(be).text)))),P(Zt,Ae)}),_(Bt);var ke=h(Bt,2);{var vt=Zt=>{var be=kp(),$e=Ee(be),Ae=h(w($e),2);pt(()=>{i(hn),xo(()=>{})});var _n=w(Ae);_n.value=_n.__value="";var In=h(_n);In.value=In.__value="宋体";var yn=h(In);yn.value=yn.__value="黑体";var Mn=h(yn);Mn.value=Mn.__value="微软雅黑";var dr=h(Mn);dr.value=dr.__value="楷体";var Nn=h(dr);Nn.value=Nn.__value="仿宋",_(Ae);var Oe=h(Ae,4);pt(()=>{i(en),xo(()=>{})});var At=w(Oe);At.value=At.__value="";var te=h(At);te.value=te.__value="12pt";var Ot=h(te);Ot.value=Ot.__value="14pt";var Kt=h(Ot);Kt.value=Kt.__value="16pt";var On=h(Kt);On.value=On.__value="18pt";var Vn=h(On);Vn.value=Vn.__value="20pt",_(Oe);var Ln=h(Oe,4);pt(()=>{i(cn),xo(()=>{})});var Yr=w(Ln);Yr.value=Yr.__value="";var Qr=h(Yr);Qr.value=Qr.__value="1.2";var Zr=h(Qr);Zr.value=Zr.__value="1.5";var ti=h(Zr);ti.value=ti.__value="1.75";var Xi=h(ti);Xi.value=Xi.__value="2",_(Ln),_($e),Ps(2),$o(Ae,()=>i(hn),ei=>g(hn,ei)),T("change",Ae,()=>ks({fontFamily:i(hn)})),$o(Oe,()=>i(en),ei=>g(en,ei)),T("change",Oe,()=>ks({fontSize:i(en)})),$o(Ln,()=>i(cn),ei=>g(cn,ei)),T("change",Ln,()=>ks({lineHeight:i(cn)})),P(Zt,be)};gt(ke,Zt=>{i(Xt)==="style"&&Zt(vt)})}var Ve=h(ke,2);{var sn=Zt=>{var be=$p(),$e=h(w(be),2);hi($e);var Ae=h($e,2),_n=w(Ae),In=h(_n,2);_(Ae),_(be),Je($e,()=>i(Jn),yn=>g(Jn,yn)),T("click",_n,()=>{g(ye,i(Jn).trim()),g(Xt,"rewrite")}),T("click",In,()=>ta(i(Jn))),P(Zt,be)};gt(Ve,Zt=>{i(Xt)==="assistant"&&Zt(sn)})}var Re=h(Ve,2);{var ae=Zt=>{var be=Ep(),$e=Ee(be),Ae=w($e),_n=h(Ae,2),In=h(_n,2),yn=h(In,2);_($e);var Mn=h($e,2),dr=w(Mn);hi(dr),_(Mn);var Nn=h(Mn,2),Oe=w(Nn),At=h(Oe,2),te=w(At,!0);_(At),_(Nn),pt(Ot=>{At.disabled=Ot,ct(te,i(Cn)?"正在生成建议...":"生成建议（不改原文）")},[()=>(i(Cn),i(ye),z(()=>i(Cn)||!i(ye).trim()))]),T("click",Ae,()=>Wi("语气更正式，保留原意")),T("click",_n,()=>Wi("压缩到更简洁，控制在80字左右")),T("click",In,()=>Wi("增加解释细节，但不要扩展事实")),T("click",yn,()=>Wi("保持术语不变，仅调整表达")),Je(dr,()=>i(ye),Ot=>g(ye,Ot)),T("click",Oe,()=>ur("assistant",i(We))),T("click",At,so),P(Zt,be)};gt(Re,Zt=>{i(Xt)==="rewrite"&&Zt(ae)})}var kt=h(Re,2);{var fr=Zt=>{var be=Tp(),$e=w(be,!0);_(be),pt(()=>ct($e,i(De))),P(Zt,be)};gt(kt,Zt=>{i(De)&&Zt(fr)})}var Wn=h(kt,2);{var wi=Zt=>{var be=Cp(),$e=w(be),Ae=h(w($e),2),_n=w(Ae,!0);_(Ae),_($e);var In=h($e,2),yn=w(In);ze(yn,5,()=>i(re),Qe,(Nn,Oe,At)=>{var te=Ap(),Ot=w(te),Kt=w(Ot,!0);_(Ot);var On=h(Ot,2),Vn=w(On,!0);_(On),_(te),pt(Ln=>{un(te,1,`candidate-switch ${i(ge)===At?"active":""}`,"svelte-1n46o8q"),ct(Kt,(i(Oe),z(()=>i(Oe).label))),ct(Vn,Ln)},[()=>(i(Oe),z(()=>d(i(Oe))))]),T("click",te,()=>g(ge,At)),P(Nn,te)}),_(yn);var Mn=h(yn,2);{var dr=Nn=>{var Oe=qp(),At=w(Oe),te=w(At),Ot=w(te,!0);_(te);var Kt=h(te,2),On=w(Kt,!0);_(Kt),_(At);var Vn=h(At,2),Ln=w(Vn),Yr=h(Ln,2),Qr=h(Yr,2);_(Vn);var Zr=h(Vn,4),ti=w(Zr,!0);_(Zr),_(Oe),pt(Xi=>{ct(Ot,(i(jn),z(()=>i(jn).label))),ct(On,Xi),ct(ti,(i(jn),z(()=>i(jn).selectedAfter)))},[()=>(i(jn),z(()=>d(i(jn))))]),T("click",Ln,()=>k(i(ge))),T("click",Yr,so),T("click",Qr,b),P(Nn,Oe)};gt(Mn,Nn=>{i(jn)&&Nn(dr)})}_(In),_(be),pt(()=>ct(_n,i(he)||i(pe))),P(Zt,be)};gt(Wn,Zt=>{i(re),z(()=>i(re).length>0)&&Zt(wi)})}_(v),pt(()=>{un(v,1,`inline-edit-popover ${i(We)}`,"svelte-1n46o8q"),ui(v,`left:${i(yt)}px;top:${i(Fe)}px;`),un(W,1,`inline-tab ${i(Xt)==="rewrite"?"active":""}`,"svelte-1n46o8q"),un(Y,1,`inline-tab ${i(Xt)==="style"?"active":""}`,"svelte-1n46o8q"),un(xt,1,`inline-tab ${i(Xt)==="assistant"?"active":""}`,"svelte-1n46o8q")}),T("click",x,()=>ur(i(Xt),"up")),T("click",N,()=>ur(i(Xt),"down")),T("click",C,Qo),T("click",W,()=>g(Xt,"rewrite")),T("click",Y,()=>g(Xt,"style")),T("click",xt,()=>g(Xt,"assistant")),P(u,v)};gt(Dl,u=>{i(Ht),i(ue),z(()=>i(Ht)&&i(ue).length>0)&&u(Xu)})}var go=h(Dl,2),mo=w(go),Yu=w(mo,!0);_(mo);var Qu=h(mo,2);{var Zu=u=>{du(u,{variant:"assistant",$$events:{send:v=>Vi(v.detail)}})};gt(Qu,u=>{i(Wt)&&u(Zu)})}_(go);var tf=h(go,2);{var ef=u=>{ju(u,{indeterminate:!0})};gt(tf,u=>{a()&&u(ef)})}_(yi);var Fl=h(yi,2);$u(Fl,{get open(){return i(An)},get docId(){return s()},$$events:{close:()=>g(An,!1),insert:u=>L(u.detail.spec)}});var nf=h(Fl,2);Iu(nf,{children:(u,v)=>{var E=Ip(),y=Ee(E);Eu(y,{});var x=h(y,2);qu(x,{onSelect:uo,get visible(){return i(ne)},set visible(C){g(ne,C)},$$legacy:!0});var N=h(x,2);Mu(N,{get visible(){return i(Me)},set visible(C){g(Me,C)},$$legacy:!0}),P(u,E)},$$slots:{default:!0}}),pt(()=>{qs=un(yi,1,"app svelte-1n46o8q",null,qs,{dark:l()}),ct(po,p()||"未加载"),ct(ra,`字数 ${m()??""}`),ca.disabled=a(),Tl.disabled=!a(),ct(Ku,i(tn)||"请选择版本进行对比"),un(go,1,`assistant-dock ${i(Wt)?"open":""}`,"svelte-1n46o8q"),ct(Yu,i(Wt)?"收起助手":"打开助手")}),T("click",Qt,Jt),T("click",oe,fo),T("click",Ne,co),T("click",Ms,()=>g(An,!0)),T("click",ho,()=>g(Me,!0)),T("click",Ou,()=>g(ne,!0)),T("click",fl,()=>rn("undo")),T("click",dl,()=>rn("redo")),T("click",vl,()=>rn("clear-format")),T("click",pl,()=>rn("bold")),T("click",hl,()=>rn("italic")),T("click",Lu,()=>rn("underline")),T("click",gl,()=>rn("heading1")),T("click",ml,()=>rn("heading2")),T("click",bl,()=>rn("quote")),T("click",_l,()=>rn("code")),T("click",yl,()=>rn("list-bullet")),T("click",Du,()=>rn("list-number")),T("click",Sl,()=>rn("table")),T("click",xl,()=>rn("image")),T("click",kl,()=>g(An,!0)),T("click",Fu,()=>g(Me,!0)),T("click",ca,()=>Vi(S())),T("click",Tl,vo),T("click",Ju,_i),Je(da,()=>i(ln),u=>g(ln,u)),T("click",Uu,ao),T("click",mo,()=>g(Wt,!i(Wt))),P(t,As);var rf=zn(na);return M(),rf}const lc=document.getElementById("app");lc&&new Nu({target:lc});
