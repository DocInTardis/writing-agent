var Xu=Object.defineProperty;var Tl=t=>{throw TypeError(t)};var Yu=(t,e,n)=>e in t?Xu(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var lr=(t,e,n)=>Yu(t,typeof e!="symbol"?e+"":e,n),aa=(t,e,n)=>e.has(t)||Tl("Cannot "+n);var q=(t,e,n)=>(aa(t,e,"read from private field"),n?n.call(t):e.get(t)),Tt=(t,e,n)=>e.has(t)?Tl("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),wt=(t,e,n,r)=>(aa(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n),Le=(t,e,n)=>(aa(t,e,"access private method"),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const Xe=2,Ao=4,Ps=8,Xl=1<<24,zr=16,pr=32,Ai=64,Ma=128,Xn=512,Me=1024,dn=2048,Ar=4096,Ln=8192,Rr=16384,Fo=32768,ns=65536,El=1<<17,Yl=1<<18,ls=1<<19,Ql=1<<20,Br=1<<25,xi=32768,va=1<<21,Oa=1<<22,ti=1<<23,Pr=Symbol("$state"),Zl=Symbol("legacy props"),Qu=Symbol(""),Ji=new class extends Error{constructor(){super(...arguments);lr(this,"name","StaleReactionError");lr(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}},Ro=3,qi=8,pa=!1;var Hs=Array.isArray,Zu=Array.prototype.indexOf,rs=Array.prototype.includes,Po=Array.from,Da=Object.defineProperty,Wi=Object.getOwnPropertyDescriptor,tc=Object.getOwnPropertyDescriptors,tf=Object.prototype,ef=Array.prototype,La=Object.getPrototypeOf,Al=Object.isExtensible;const ei=()=>{};function nf(t){return t()}function qo(t){for(var e=0;e<t.length;e++)t[e]()}function ec(){var t,e,n=new Promise((r,i)=>{t=r,e=i});return{promise:n,resolve:t,reject:e}}function nc(t){return t===this.v}function rc(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function ic(t){return!rc(t,this.v)}function sc(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function rf(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function sf(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function of(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function af(t){throw new Error("https://svelte.dev/e/effect_orphan")}function lf(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function cf(){throw new Error("https://svelte.dev/e/hydration_failed")}function uf(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function ff(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function df(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function vf(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function pf(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}let cs=!1,hf=!1;function gf(){cs=!0}const mf=1,_f=2,oc=4,bf=8,yf=16,wf=2,Sf=8,xf=1,kf=2,ac="[",Ho="[!",Ba="]",ki={},Ue=Symbol(),$f="http://www.w3.org/1999/xhtml";let ce=null;function is(t){ce=t}function Bn(t,e=!1,n){ce={p:ce,i:!1,c:null,e:null,s:t,x:null,l:cs&&!e?{s:null,u:null,$:[]}:null}}function Fn(t){var e=ce,n=e.e;if(n!==null){e.e=null;for(var r of n)Dc(r)}return t!==void 0&&(e.x=t),e.i=!0,ce=e.p,t??{}}function Js(){return!cs||ce!==null&&ce.l===null}let di=[];function lc(){var t=di;di=[],qo(t)}function kr(t){if(di.length===0&&!Ns){var e=di;queueMicrotask(()=>{e===di&&lc()})}di.push(t)}function Tf(){for(;di.length>0;)lc()}function zs(t){console.warn("https://svelte.dev/e/hydration_mismatch")}function Ef(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Af(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}let Et=!1;function Fr(t){Et=t}let qt;function fn(t){if(t===null)throw zs(),ki;return qt=t}function $i(){return fn(hr(qt))}function b(t){if(Et){if(hr(qt)!==null)throw zs(),ki;qt=t}}function Co(t=1){if(Et){for(var e=t,n=qt;e--;)n=hr(n);qt=n}}function jo(t=!0){for(var e=0,n=qt;;){if(n.nodeType===qi){var r=n.data;if(r===Ba){if(e===0)return n;e-=1}else(r===ac||r===Ho)&&(e+=1)}var i=hr(n);t&&n.remove(),n=i}}function cc(t){if(!t||t.nodeType!==qi)throw zs(),ki;return t.data}function zi(t){if(typeof t!="object"||t===null||Pr in t)return t;const e=La(t);if(e!==tf&&e!==ef)return t;var n=new Map,r=Hs(t),i=Wr(0),s=yi,l=a=>{if(yi===s)return a();var u=It,v=yi;Zn(null),Ml(s);var g=a();return Zn(u),Ml(v),g};return r&&n.set("length",Wr(t.length)),new Proxy(t,{defineProperty(a,u,v){(!("value"in v)||v.configurable===!1||v.enumerable===!1||v.writable===!1)&&ff();var g=n.get(u);return g===void 0?g=l(()=>{var S=Wr(v.value);return n.set(u,S),S}):_(g,v.value,!0),!0},deleteProperty(a,u){var v=n.get(u);if(v===void 0){if(u in a){const g=l(()=>Wr(Ue));n.set(u,g),Ms(i)}}else _(v,Ue),Ms(i);return!0},get(a,u,v){var I;if(u===Pr)return t;var g=n.get(u),S=u in a;if(g===void 0&&(!S||(I=Wi(a,u))!=null&&I.writable)&&(g=l(()=>{var N=zi(S?a[u]:Ue),B=Wr(N);return B}),n.set(u,g)),g!==void 0){var $=o(g);return $===Ue?void 0:$}return Reflect.get(a,u,v)},getOwnPropertyDescriptor(a,u){var v=Reflect.getOwnPropertyDescriptor(a,u);if(v&&"value"in v){var g=n.get(u);g&&(v.value=o(g))}else if(v===void 0){var S=n.get(u),$=S==null?void 0:S.v;if(S!==void 0&&$!==Ue)return{enumerable:!0,configurable:!0,value:$,writable:!0}}return v},has(a,u){var $;if(u===Pr)return!0;var v=n.get(u),g=v!==void 0&&v.v!==Ue||Reflect.has(a,u);if(v!==void 0||Rt!==null&&(!g||($=Wi(a,u))!=null&&$.writable)){v===void 0&&(v=l(()=>{var I=g?zi(a[u]):Ue,N=Wr(I);return N}),n.set(u,v));var S=o(v);if(S===Ue)return!1}return g},set(a,u,v,g){var tt;var S=n.get(u),$=u in a;if(r&&u==="length")for(var I=v;I<S.v;I+=1){var N=n.get(I+"");N!==void 0?_(N,Ue):I in a&&(N=l(()=>Wr(Ue)),n.set(I+"",N))}if(S===void 0)(!$||(tt=Wi(a,u))!=null&&tt.writable)&&(S=l(()=>Wr(void 0)),_(S,zi(v)),n.set(u,S));else{$=S.v!==Ue;var B=l(()=>zi(v));_(S,B)}var j=Reflect.getOwnPropertyDescriptor(a,u);if(j!=null&&j.set&&j.set.call(g,v),!$){if(r&&typeof u=="string"){var U=n.get("length"),ft=Number(u);Number.isInteger(ft)&&ft>=U.v&&_(U,ft+1)}Ms(i)}return!0},ownKeys(a){o(i);var u=Reflect.ownKeys(a).filter(S=>{var $=n.get(S);return $===void 0||$.v!==Ue});for(var[v,g]of n)g.v!==Ue&&!(v in a)&&u.push(v);return u},setPrototypeOf(){df()}})}function ql(t){try{if(t!==null&&typeof t=="object"&&Pr in t)return t[Pr]}catch{}return t}function qf(t,e){return Object.is(ql(t),ql(e))}var Cl,uc,fc,dc;function ha(){if(Cl===void 0){Cl=window,uc=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,n=Text.prototype;fc=Wi(e,"firstChild").get,dc=Wi(e,"nextSibling").get,Al(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),Al(n)&&(n.__t=void 0)}}function Yn(t=""){return document.createTextNode(t)}function Kn(t){return fc.call(t)}function hr(t){return dc.call(t)}function y(t,e){if(!Et)return Kn(t);var n=Kn(qt);if(n===null)n=qt.appendChild(Yn());else if(e&&n.nodeType!==Ro){var r=Yn();return n==null||n.before(r),fn(r),r}return e&&Ra(n),fn(n),n}function he(t,e=!1){if(!Et){var n=Kn(t);return n instanceof Comment&&n.data===""?hr(n):n}if(e){if((qt==null?void 0:qt.nodeType)!==Ro){var r=Yn();return qt==null||qt.before(r),fn(r),r}Ra(qt)}return qt}function h(t,e=1,n=!1){let r=Et?qt:t;for(var i;e--;)i=r,r=hr(r);if(!Et)return r;if(n){if((r==null?void 0:r.nodeType)!==Ro){var s=Yn();return r===null?i==null||i.after(s):r.before(s),fn(s),s}Ra(r)}return fn(r),r}function Fa(t){t.textContent=""}function vc(){return!1}function Ra(t){if(t.nodeValue.length<65536)return;let e=t.nextSibling;for(;e!==null&&e.nodeType===Ro;)e.remove(),t.nodeValue+=e.nodeValue,e=t.nextSibling}function pc(t){var e=Rt;if(e===null)return It.f|=ti,t;if(e.f&Fo)ss(t,e);else{if(!(e.f&Ma))throw t;e.b.error(t)}}function ss(t,e){for(;e!==null;){if(e.f&Ma)try{e.b.error(t);return}catch(n){t=n}e=e.parent}throw t}const Cf=-7169;function Te(t,e){t.f=t.f&Cf|e}function Pa(t){t.f&Xn||t.deps===null?Te(t,Me):Te(t,Ar)}function hc(t){if(t!==null)for(const e of t)!(e.f&Xe)||!(e.f&xi)||(e.f^=xi,hc(e.deps))}function gc(t,e,n){t.f&dn?e.add(t):t.f&Ar&&n.add(t),hc(t.deps),Te(t,Me)}const _o=new Set;let xt=null,Io=null,Ge=null,Dn=[],Jo=null,ga=!1,Ns=!1;var Ki,Xi,pi,Yi,Ds,Ls,hi,Qi,Er,ma,_a,mc;const nl=class nl{constructor(){Tt(this,Er);lr(this,"committed",!1);lr(this,"current",new Map);lr(this,"previous",new Map);Tt(this,Ki,new Set);Tt(this,Xi,new Set);Tt(this,pi,0);Tt(this,Yi,0);Tt(this,Ds,null);Tt(this,Ls,new Set);Tt(this,hi,new Set);lr(this,"skipped_effects",new Set);lr(this,"is_fork",!1);Tt(this,Qi,!1)}is_deferred(){return this.is_fork||q(this,Yi)>0}process(e){var i;Dn=[],this.apply();var n=[],r=[];for(const s of e)Le(this,Er,ma).call(this,s,n,r);if(this.is_deferred()){Le(this,Er,_a).call(this,r),Le(this,Er,_a).call(this,n);for(const s of this.skipped_effects)wc(s)}else{for(const s of q(this,Ki))s();q(this,Ki).clear(),q(this,pi)===0&&Le(this,Er,mc).call(this),Io=this,xt=null,jl(r),jl(n),Io=null,(i=q(this,Ds))==null||i.resolve()}Ge=null}capture(e,n){n!==Ue&&!this.previous.has(e)&&this.previous.set(e,n),e.f&ti||(this.current.set(e,e.v),Ge==null||Ge.set(e,e.v))}activate(){xt=this,this.apply()}deactivate(){xt===this&&(xt=null,Ge=null)}flush(){if(this.activate(),Dn.length>0){if(_c(),xt!==null&&xt!==this)return}else q(this,pi)===0&&this.process([]);this.deactivate()}discard(){for(const e of q(this,Xi))e(this);q(this,Xi).clear()}increment(e){wt(this,pi,q(this,pi)+1),e&&wt(this,Yi,q(this,Yi)+1)}decrement(e){wt(this,pi,q(this,pi)-1),e&&wt(this,Yi,q(this,Yi)-1),!q(this,Qi)&&(wt(this,Qi,!0),kr(()=>{wt(this,Qi,!1),this.is_deferred()?Dn.length>0&&this.flush():this.revive()}))}revive(){for(const e of q(this,Ls))q(this,hi).delete(e),Te(e,dn),Hr(e);for(const e of q(this,hi))Te(e,Ar),Hr(e);this.flush()}oncommit(e){q(this,Ki).add(e)}ondiscard(e){q(this,Xi).add(e)}settled(){return(q(this,Ds)??wt(this,Ds,ec())).promise}static ensure(){if(xt===null){const e=xt=new nl;_o.add(xt),Ns||kr(()=>{xt===e&&e.flush()})}return xt}apply(){}};Ki=new WeakMap,Xi=new WeakMap,pi=new WeakMap,Yi=new WeakMap,Ds=new WeakMap,Ls=new WeakMap,hi=new WeakMap,Qi=new WeakMap,Er=new WeakSet,ma=function(e,n,r){e.f^=Me;for(var i=e.first,s=null;i!==null;){var l=i.f,a=(l&(pr|Ai))!==0,u=a&&(l&Me)!==0,v=u||(l&Ln)!==0||this.skipped_effects.has(i);if(!v&&i.fn!==null){a?i.f^=Me:s!==null&&l&(Ao|Ps|Xl)?s.b.defer_effect(i):l&Ao?n.push(i):us(i)&&(l&zr&&q(this,hi).add(i),os(i));var g=i.first;if(g!==null){i=g;continue}}var S=i.parent;for(i=i.next;i===null&&S!==null;)S===s&&(s=null),i=S.next,S=S.parent}},_a=function(e){for(var n=0;n<e.length;n+=1)gc(e[n],q(this,Ls),q(this,hi))},mc=function(){var i;if(_o.size>1){this.previous.clear();var e=Ge,n=!0;for(const s of _o){if(s===this){n=!1;continue}const l=[];for(const[u,v]of this.current){if(s.current.has(u))if(n&&v!==s.current.get(u))s.current.set(u,v);else continue;l.push(u)}if(l.length===0)continue;const a=[...s.current.keys()].filter(u=>!this.current.has(u));if(a.length>0){var r=Dn;Dn=[];const u=new Set,v=new Map;for(const g of l)bc(g,a,u,v);if(Dn.length>0){xt=s,s.apply();for(const g of Dn)Le(i=s,Er,ma).call(i,g,[],[]);s.deactivate()}Dn=r}}xt=null,Ge=e}this.committed=!0,_o.delete(this)};let ni=nl;function on(t){var e=Ns;Ns=!0;try{for(var n;;){if(Tf(),Dn.length===0&&(xt==null||xt.flush(),Dn.length===0))return Jo=null,n;_c()}}finally{Ns=e}}function _c(){ga=!0;var t=null;try{for(var e=0;Dn.length>0;){var n=ni.ensure();if(e++>1e3){var r,i;jf()}n.process(Dn),ri.clear()}}finally{ga=!1,Jo=null}}function jf(){try{lf()}catch(t){ss(t,Jo)}}let cr=null;function jl(t){var e=t.length;if(e!==0){for(var n=0;n<e;){var r=t[n++];if(!(r.f&(Rr|Ln))&&us(r)&&(cr=new Set,os(r),r.deps===null&&r.first===null&&r.nodes===null&&(r.teardown===null&&r.ac===null?Pc(r):r.fn=null),(cr==null?void 0:cr.size)>0)){ri.clear();for(const i of cr){if(i.f&(Rr|Ln))continue;const s=[i];let l=i.parent;for(;l!==null;)cr.has(l)&&(cr.delete(l),s.push(l)),l=l.parent;for(let a=s.length-1;a>=0;a--){const u=s[a];u.f&(Rr|Ln)||os(u)}}cr.clear()}}cr=null}}function bc(t,e,n,r){if(!n.has(t)&&(n.add(t),t.reactions!==null))for(const i of t.reactions){const s=i.f;s&Xe?bc(i,e,n,r):s&(Oa|zr)&&!(s&dn)&&yc(i,e,r)&&(Te(i,dn),Hr(i))}}function yc(t,e,n){const r=n.get(t);if(r!==void 0)return r;if(t.deps!==null)for(const i of t.deps){if(rs.call(e,i))return!0;if(i.f&Xe&&yc(i,e,n))return n.set(i,!0),!0}return n.set(t,!1),!1}function Hr(t){for(var e=Jo=t;e.parent!==null;){e=e.parent;var n=e.f;if(ga&&e===Rt&&n&zr&&!(n&Yl))return;if(n&(Ai|pr)){if(!(n&Me))return;e.f^=Me}}Dn.push(e)}function wc(t){if(!(t.f&pr&&t.f&Me)){Te(t,Me);for(var e=t.first;e!==null;)wc(e),e=e.next}}function If(t){let e=0,n=Ti(0),r;return()=>{Wa()&&(o(n),fs(()=>(e===0&&(r=J(()=>t(()=>Ms(n)))),e+=1,()=>{kr(()=>{e-=1,e===0&&(r==null||r(),r=void 0,Ms(n))})})))}}var Nf=ns|ls|Ma;function Mf(t,e,n){new Of(t,e,n)}var Mn,Bs,yr,gi,wr,Un,_n,Sr,Mr,Zr,mi,Or,Zi,_i,ts,es,Dr,Lo,$e,Sc,xc,ba,wo,So,ya;class Of{constructor(e,n,r){Tt(this,$e);lr(this,"parent");lr(this,"is_pending",!1);Tt(this,Mn);Tt(this,Bs,Et?qt:null);Tt(this,yr);Tt(this,gi);Tt(this,wr);Tt(this,Un,null);Tt(this,_n,null);Tt(this,Sr,null);Tt(this,Mr,null);Tt(this,Zr,null);Tt(this,mi,0);Tt(this,Or,0);Tt(this,Zi,!1);Tt(this,_i,!1);Tt(this,ts,new Set);Tt(this,es,new Set);Tt(this,Dr,null);Tt(this,Lo,If(()=>(wt(this,Dr,Ti(q(this,mi))),()=>{wt(this,Dr,null)})));wt(this,Mn,e),wt(this,yr,n),wt(this,gi,r),this.parent=Rt.b,this.is_pending=!!q(this,yr).pending,wt(this,wr,Va(()=>{if(Rt.b=this,Et){const s=q(this,Bs);$i(),s.nodeType===qi&&s.data===Ho?Le(this,$e,xc).call(this):(Le(this,$e,Sc).call(this),q(this,Or)===0&&(this.is_pending=!1))}else{var i=Le(this,$e,ba).call(this);try{wt(this,Un,Vn(()=>r(i)))}catch(s){this.error(s)}q(this,Or)>0?Le(this,$e,So).call(this):this.is_pending=!1}return()=>{var s;(s=q(this,Zr))==null||s.remove()}},Nf)),Et&&wt(this,Mn,qt)}defer_effect(e){gc(e,q(this,ts),q(this,es))}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!q(this,yr).pending}update_pending_count(e){Le(this,$e,ya).call(this,e),wt(this,mi,q(this,mi)+e),!(!q(this,Dr)||q(this,Zi))&&(wt(this,Zi,!0),kr(()=>{wt(this,Zi,!1),q(this,Dr)&&Ei(q(this,Dr),q(this,mi))}))}get_effect_pending(){return q(this,Lo).call(this),o(q(this,Dr))}error(e){var n=q(this,yr).onerror;let r=q(this,yr).failed;if(q(this,_i)||!n&&!r)throw e;q(this,Un)&&(wn(q(this,Un)),wt(this,Un,null)),q(this,_n)&&(wn(q(this,_n)),wt(this,_n,null)),q(this,Sr)&&(wn(q(this,Sr)),wt(this,Sr,null)),Et&&(fn(q(this,Bs)),Co(),fn(jo()));var i=!1,s=!1;const l=()=>{if(i){Af();return}i=!0,s&&pf(),ni.ensure(),wt(this,mi,0),q(this,Sr)!==null&&wi(q(this,Sr),()=>{wt(this,Sr,null)}),this.is_pending=this.has_pending_snippet(),wt(this,Un,Le(this,$e,wo).call(this,()=>(wt(this,_i,!1),Vn(()=>q(this,gi).call(this,q(this,Mn)))))),q(this,Or)>0?Le(this,$e,So).call(this):this.is_pending=!1};kr(()=>{try{s=!0,n==null||n(e,l),s=!1}catch(a){ss(a,q(this,wr)&&q(this,wr).parent)}r&&wt(this,Sr,Le(this,$e,wo).call(this,()=>{ni.ensure(),wt(this,_i,!0);try{return Vn(()=>{r(q(this,Mn),()=>e,()=>l)})}catch(a){return ss(a,q(this,wr).parent),null}finally{wt(this,_i,!1)}}))})}}Mn=new WeakMap,Bs=new WeakMap,yr=new WeakMap,gi=new WeakMap,wr=new WeakMap,Un=new WeakMap,_n=new WeakMap,Sr=new WeakMap,Mr=new WeakMap,Zr=new WeakMap,mi=new WeakMap,Or=new WeakMap,Zi=new WeakMap,_i=new WeakMap,ts=new WeakMap,es=new WeakMap,Dr=new WeakMap,Lo=new WeakMap,$e=new WeakSet,Sc=function(){try{wt(this,Un,Vn(()=>q(this,gi).call(this,q(this,Mn))))}catch(e){this.error(e)}},xc=function(){const e=q(this,yr).pending;e&&(wt(this,_n,Vn(()=>e(q(this,Mn)))),kr(()=>{var n=Le(this,$e,ba).call(this);wt(this,Un,Le(this,$e,wo).call(this,()=>(ni.ensure(),Vn(()=>q(this,gi).call(this,n))))),q(this,Or)>0?Le(this,$e,So).call(this):(wi(q(this,_n),()=>{wt(this,_n,null)}),this.is_pending=!1)}))},ba=function(){var e=q(this,Mn);return this.is_pending&&(wt(this,Zr,Yn()),q(this,Mn).before(q(this,Zr)),e=q(this,Zr)),e},wo=function(e){var n=Rt,r=It,i=ce;Tr(q(this,wr)),Zn(q(this,wr)),is(q(this,wr).ctx);try{return e()}catch(s){return pc(s),null}finally{Tr(n),Zn(r),is(i)}},So=function(){const e=q(this,yr).pending;q(this,Un)!==null&&(wt(this,Mr,document.createDocumentFragment()),q(this,Mr).append(q(this,Zr)),zc(q(this,Un),q(this,Mr))),q(this,_n)===null&&wt(this,_n,Vn(()=>e(q(this,Mn))))},ya=function(e){var n;if(!this.has_pending_snippet()){this.parent&&Le(n=this.parent,$e,ya).call(n,e);return}if(wt(this,Or,q(this,Or)+e),q(this,Or)===0){this.is_pending=!1;for(const r of q(this,ts))Te(r,dn),Hr(r);for(const r of q(this,es))Te(r,Ar),Hr(r);q(this,ts).clear(),q(this,es).clear(),q(this,_n)&&wi(q(this,_n),()=>{wt(this,_n,null)}),q(this,Mr)&&(q(this,Mn).before(q(this,Mr)),wt(this,Mr,null))}};function Df(t,e,n,r){const i=Js()?Ha:Ja;var s=t.filter($=>!$.settled);if(n.length===0&&s.length===0){r(e.map(i));return}var l=xt,a=Rt,u=Lf(),v=s.length===1?s[0].promise:s.length>1?Promise.all(s.map($=>$.promise)):null;function g($){u();try{r($)}catch(I){a.f&Rr||ss(I,a)}l==null||l.deactivate(),wa()}if(n.length===0){v.then(()=>g(e.map(i)));return}function S(){u(),Promise.all(n.map($=>Bf($))).then($=>g([...e.map(i),...$])).catch($=>ss($,a))}v?v.then(S):S()}function Lf(){var t=Rt,e=It,n=ce,r=xt;return function(s=!0){Tr(t),Zn(e),is(n),s&&(r==null||r.activate())}}function wa(){Tr(null),Zn(null),is(null)}function Ha(t){var e=Xe|dn,n=It!==null&&It.f&Xe?It:null;return Rt!==null&&(Rt.f|=ls),{ctx:ce,deps:null,effects:null,equals:nc,f:e,fn:t,reactions:null,rv:0,v:Ue,wv:0,parent:n??Rt,ac:null}}function Bf(t,e,n){let r=Rt;r===null&&rf();var i=r.b,s=void 0,l=Ti(Ue),a=!It,u=new Map;return Kf(()=>{var I;var v=ec();s=v.promise;try{Promise.resolve(t()).then(v.resolve,v.reject).then(()=>{g===xt&&g.committed&&g.deactivate(),wa()})}catch(N){v.reject(N),wa()}var g=xt;if(a){var S=i.is_rendered();i.update_pending_count(1),g.increment(S),(I=u.get(g))==null||I.reject(Ji),u.delete(g),u.set(g,v)}const $=(N,B=void 0)=>{if(g.activate(),B)B!==Ji&&(l.f|=ti,Ei(l,B));else{l.f&ti&&(l.f^=ti),Ei(l,N);for(const[j,U]of u){if(u.delete(j),j===g)break;U.reject(Ji)}}a&&(i.update_pending_count(-1),g.decrement(S))};v.promise.then($,N=>$(null,N||"unknown"))}),Wo(()=>{for(const v of u.values())v.reject(Ji)}),new Promise(v=>{function g(S){function $(){S===s?v(l):g(s)}S.then($,$)}g(s)})}function Ja(t){const e=Ha(t);return e.equals=ic,e}function kc(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)wn(e[n])}}function Ff(t){for(var e=t.parent;e!==null;){if(!(e.f&Xe))return e.f&Rr?null:e;e=e.parent}return null}function za(t){var e,n=Rt;Tr(Ff(t));try{t.f&=~xi,kc(t),e=Ic(t)}finally{Tr(n)}return e}function $c(t){var e=za(t);if(!t.equals(e)&&(t.wv=Cc(),(!(xt!=null&&xt.is_fork)||t.deps===null)&&(t.v=e,t.deps===null))){Te(t,Me);return}oi||(Ge!==null?(Wa()||xt!=null&&xt.is_fork)&&Ge.set(t,e):Pa(t))}let Sa=new Set;const ri=new Map;let Tc=!1;function Ti(t,e){var n={f:0,v:t,reactions:null,equals:nc,rv:0,wv:0};return n}function Wr(t,e){const n=Ti(t);return Hf(n),n}function Q(t,e=!1,n=!0){var i;const r=Ti(t);return e||(r.equals=ic),cs&&n&&ce!==null&&ce.l!==null&&((i=ce.l).s??(i.s=[])).push(r),r}function Yr(t,e){return _(t,J(()=>o(t))),e}function _(t,e,n=!1){It!==null&&(!fr||It.f&El)&&Js()&&It.f&(Xe|zr|Oa|El)&&(Qn===null||!rs.call(Qn,t))&&vf();let r=n?zi(e):e;return Ei(t,r)}function Ei(t,e){if(!t.equals(e)){var n=t.v;oi?ri.set(t,e):ri.set(t,n),t.v=e;var r=ni.ensure();if(r.capture(t,n),t.f&Xe){const i=t;t.f&dn&&za(i),Pa(i)}t.wv=Cc(),Ec(t,dn),Js()&&Rt!==null&&Rt.f&Me&&!(Rt.f&(pr|Ai))&&(zn===null?Jf([t]):zn.push(t)),!r.is_fork&&Sa.size>0&&!Tc&&Rf()}return e}function Rf(){Tc=!1;for(const t of Sa)t.f&Me&&Te(t,Ar),us(t)&&os(t);Sa.clear()}function Ms(t){_(t,t.v+1)}function Ec(t,e){var n=t.reactions;if(n!==null)for(var r=Js(),i=n.length,s=0;s<i;s++){var l=n[s],a=l.f;if(!(!r&&l===Rt)){var u=(a&dn)===0;if(u&&Te(l,e),a&Xe){var v=l;Ge==null||Ge.delete(v),a&xi||(a&Xn&&(l.f|=xi),Ec(v,Ar))}else u&&(a&zr&&cr!==null&&cr.add(l),Hr(l))}}}let Qr=null;function Pf(t){var e=Qr;try{if(Qr=new Set,J(t),e!==null)for(var n of Qr)e.add(n);return Qr}finally{Qr=e}}function xo(t){for(var e of Pf(t))Ei(e,e.v)}function ii(t){Et&&Kn(t)!==null&&Fa(t)}let Il=!1;function Ac(){Il||(Il=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{var e;if(!t.defaultPrevented)for(const n of t.target.elements)(e=n.__on_r)==null||e.call(n)})},{capture:!0}))}function zo(t){var e=It,n=Rt;Zn(null),Tr(null);try{return t()}finally{Zn(e),Tr(n)}}function Ua(t,e,n,r=n){t.addEventListener(e,()=>zo(n));const i=t.__on_r;i?t.__on_r=()=>{i(),r(!0)}:t.__on_r=()=>r(!0),Ac()}let ko=!1,oi=!1;function Nl(t){oi=t}let It=null,fr=!1;function Zn(t){It=t}let Rt=null;function Tr(t){Rt=t}let Qn=null;function Hf(t){It!==null&&(Qn===null?Qn=[t]:Qn.push(t))}let yn=null,Nn=0,zn=null;function Jf(t){zn=t}let qc=1,vi=0,yi=vi;function Ml(t){yi=t}function Cc(){return++qc}function us(t){var e=t.f;if(e&dn)return!0;if(e&Xe&&(t.f&=~xi),e&Ar){for(var n=t.deps,r=n.length,i=0;i<r;i++){var s=n[i];if(us(s)&&$c(s),s.wv>t.wv)return!0}e&Xn&&Ge===null&&Te(t,Me)}return!1}function jc(t,e,n=!0){var r=t.reactions;if(r!==null&&!(Qn!==null&&rs.call(Qn,t)))for(var i=0;i<r.length;i++){var s=r[i];s.f&Xe?jc(s,e,!1):e===s&&(n?Te(s,dn):s.f&Me&&Te(s,Ar),Hr(s))}}function Ic(t){var B;var e=yn,n=Nn,r=zn,i=It,s=Qn,l=ce,a=fr,u=yi,v=t.f;yn=null,Nn=0,zn=null,It=v&(pr|Ai)?null:t,Qn=null,is(t.ctx),fr=!1,yi=++vi,t.ac!==null&&(zo(()=>{t.ac.abort(Ji)}),t.ac=null);try{t.f|=va;var g=t.fn,S=g(),$=t.deps,I=xt==null?void 0:xt.is_fork;if(yn!==null){var N;if(I||No(t,Nn),$!==null&&Nn>0)for($.length=Nn+yn.length,N=0;N<yn.length;N++)$[Nn+N]=yn[N];else t.deps=$=yn;if(Wa()&&t.f&Xn)for(N=Nn;N<$.length;N++)((B=$[N]).reactions??(B.reactions=[])).push(t)}else!I&&$!==null&&Nn<$.length&&(No(t,Nn),$.length=Nn);if(Js()&&zn!==null&&!fr&&$!==null&&!(t.f&(Xe|Ar|dn)))for(N=0;N<zn.length;N++)jc(zn[N],t);if(i!==null&&i!==t){if(vi++,i.deps!==null)for(let j=0;j<n;j+=1)i.deps[j].rv=vi;if(e!==null)for(const j of e)j.rv=vi;zn!==null&&(r===null?r=zn:r.push(...zn))}return t.f&ti&&(t.f^=ti),S}catch(j){return pc(j)}finally{t.f^=va,yn=e,Nn=n,zn=r,It=i,Qn=s,is(l),fr=a,yi=u}}function zf(t,e){let n=e.reactions;if(n!==null){var r=Zu.call(n,t);if(r!==-1){var i=n.length-1;i===0?n=e.reactions=null:(n[r]=n[i],n.pop())}}if(n===null&&e.f&Xe&&(yn===null||!rs.call(yn,e))){var s=e;s.f&Xn&&(s.f^=Xn,s.f&=~xi),Pa(s),kc(s),No(s,0)}}function No(t,e){var n=t.deps;if(n!==null)for(var r=e;r<n.length;r++)zf(t,n[r])}function os(t){var e=t.f;if(!(e&Rr)){Te(t,Me);var n=Rt,r=ko;Rt=t,ko=!0;try{e&(zr|Xl)?Xf(t):Fc(t),Bc(t);var i=Ic(t);t.teardown=typeof i=="function"?i:null,t.wv=qc;var s;pa&&hf&&t.f&dn&&t.deps}finally{ko=r,Rt=n}}}async function Uf(){await Promise.resolve(),on()}function o(t){var e=t.f,n=(e&Xe)!==0;if(Qr==null||Qr.add(t),It!==null&&!fr){var r=Rt!==null&&(Rt.f&Rr)!==0;if(!r&&(Qn===null||!rs.call(Qn,t))){var i=It.deps;if(It.f&va)t.rv<vi&&(t.rv=vi,yn===null&&i!==null&&i[Nn]===t?Nn++:yn===null?yn=[t]:yn.push(t));else{(It.deps??(It.deps=[])).push(t);var s=t.reactions;s===null?t.reactions=[It]:rs.call(s,It)||s.push(It)}}}if(oi&&ri.has(t))return ri.get(t);if(n){var l=t;if(oi){var a=l.v;return(!(l.f&Me)&&l.reactions!==null||Mc(l))&&(a=za(l)),ri.set(l,a),a}var u=(l.f&Xn)===0&&!fr&&It!==null&&(ko||(It.f&Xn)!==0),v=l.deps===null;us(l)&&(u&&(l.f|=Xn),$c(l)),u&&!v&&Nc(l)}if(Ge!=null&&Ge.has(t))return Ge.get(t);if(t.f&ti)throw t.v;return t.v}function Nc(t){if(t.deps!==null){t.f|=Xn;for(const e of t.deps)(e.reactions??(e.reactions=[])).push(t),e.f&Xe&&!(e.f&Xn)&&Nc(e)}}function Mc(t){if(t.v===Ue)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(ri.has(e)||e.f&Xe&&Mc(e))return!0;return!1}function J(t){var e=fr;try{return fr=!0,t()}finally{fr=e}}function Uo(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(Pr in t)xa(t);else if(!Array.isArray(t))for(let e in t){const n=t[e];typeof n=="object"&&n&&Pr in n&&xa(n)}}}function xa(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let r in t)try{xa(t[r],e)}catch{}const n=La(t);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=tc(n);for(let i in r){const s=r[i].get;if(s)try{s.call(t)}catch{}}}}}function Oc(t){Rt===null&&(It===null&&af(),of()),oi&&sf()}function Wf(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function qr(t,e,n){var r=Rt;r!==null&&r.f&Ln&&(t|=Ln);var i={ctx:ce,deps:null,nodes:null,f:t|dn|Xn,first:null,fn:e,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,wv:0,ac:null};if(n)try{os(i),i.f|=Fo}catch(a){throw wn(i),a}else e!==null&&Hr(i);var s=i;if(n&&s.deps===null&&s.teardown===null&&s.nodes===null&&s.first===s.last&&!(s.f&ls)&&(s=s.first,t&zr&&t&ns&&s!==null&&(s.f|=ns)),s!==null&&(s.parent=r,r!==null&&Wf(s,r),It!==null&&It.f&Xe&&!(t&Ai))){var l=It;(l.effects??(l.effects=[])).push(s)}return i}function Wa(){return It!==null&&!fr}function Wo(t){const e=qr(Ps,null,!1);return Te(e,Me),e.teardown=t,e}function ka(t){Oc();var e=Rt.f,n=!It&&(e&pr)!==0&&(e&Fo)===0;if(n){var r=ce;(r.e??(r.e=[])).push(t)}else return Dc(t)}function Dc(t){return qr(Ao|Ql,t,!1)}function Vf(t){return Oc(),qr(Ps|Ql,t,!0)}function Gf(t){ni.ensure();const e=qr(Ai|ls,t,!0);return(n={})=>new Promise(r=>{n.outro?wi(e,()=>{wn(e),r(void 0)}):(wn(e),r(void 0))})}function Lc(t){return qr(Ao,t,!1)}function Vi(t,e){var n=ce,r={effect:null,ran:!1,deps:t};n.l.$.push(r),r.effect=fs(()=>{t(),!r.ran&&(r.ran=!0,J(e))})}function Vo(){var t=ce;fs(()=>{for(var e of t.l.$){e.deps();var n=e.effect;n.f&Me&&n.deps!==null&&Te(n,Ar),us(n)&&os(n),e.ran=!1}})}function Kf(t){return qr(Oa|ls,t,!0)}function fs(t,e=0){return qr(Ps|e,t,!0)}function ht(t,e=[],n=[],r=[]){Df(r,e,n,i=>{qr(Ps,()=>t(...i.map(o)),!0)})}function Va(t,e=0){var n=qr(zr|e,t,!0);return n}function Vn(t){return qr(pr|ls,t,!0)}function Bc(t){var e=t.teardown;if(e!==null){const n=oi,r=It;Nl(!0),Zn(null);try{e.call(null)}finally{Nl(n),Zn(r)}}}function Fc(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const i=n.ac;i!==null&&zo(()=>{i.abort(Ji)});var r=n.next;n.f&Ai?n.parent=null:wn(n,e),n=r}}function Xf(t){for(var e=t.first;e!==null;){var n=e.next;e.f&pr||wn(e),e=n}}function wn(t,e=!0){var n=!1;(e||t.f&Yl)&&t.nodes!==null&&t.nodes.end!==null&&(Rc(t.nodes.start,t.nodes.end),n=!0),Fc(t,e&&!n),No(t,0),Te(t,Rr);var r=t.nodes&&t.nodes.t;if(r!==null)for(const s of r)s.stop();Bc(t);var i=t.parent;i!==null&&i.first!==null&&Pc(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function Rc(t,e){for(;t!==null;){var n=t===e?null:hr(t);t.remove(),t=n}}function Pc(t){var e=t.parent,n=t.prev,r=t.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),e!==null&&(e.first===t&&(e.first=r),e.last===t&&(e.last=n))}function wi(t,e,n=!0){var r=[];Hc(t,r,!0);var i=()=>{n&&wn(t),e&&e()},s=r.length;if(s>0){var l=()=>--s||i();for(var a of r)a.out(l)}else i()}function Hc(t,e,n){if(!(t.f&Ln)){t.f^=Ln;var r=t.nodes&&t.nodes.t;if(r!==null)for(const a of r)(a.is_global||n)&&e.push(a);for(var i=t.first;i!==null;){var s=i.next,l=(i.f&ns)!==0||(i.f&pr)!==0&&(t.f&zr)!==0;Hc(i,e,l?n:!1),i=s}}}function Ga(t){Jc(t,!0)}function Jc(t,e){if(t.f&Ln){t.f^=Ln,t.f&Me||(Te(t,dn),Hr(t));for(var n=t.first;n!==null;){var r=n.next,i=(n.f&ns)!==0||(n.f&pr)!==0;Jc(n,i?e:!1),n=r}var s=t.nodes&&t.nodes.t;if(s!==null)for(const l of s)(l.is_global||e)&&l.in()}}function zc(t,e){if(t.nodes)for(var n=t.nodes.start,r=t.nodes.end;n!==null;){var i=n===r?null:hr(n);e.append(n),n=i}}const Yf=new Set,Ol=new Set;function Qf(t,e,n,r={}){function i(s){if(r.capture||js.call(e,s),!s.cancelBubble)return zo(()=>n==null?void 0:n.call(this,s))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?kr(()=>{e.addEventListener(t,i,r)}):e.addEventListener(t,i,r),i}function A(t,e,n,r,i){var s={capture:r,passive:i},l=Qf(t,e,n,s);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&Wo(()=>{e.removeEventListener(t,l,s)})}let Dl=null;function js(t){var j;var e=this,n=e.ownerDocument,r=t.type,i=((j=t.composedPath)==null?void 0:j.call(t))||[],s=i[0]||t.target;Dl=t;var l=0,a=Dl===t&&t.__root;if(a){var u=i.indexOf(a);if(u!==-1&&(e===document||e===window)){t.__root=e;return}var v=i.indexOf(e);if(v===-1)return;u<=v&&(l=u)}if(s=i[l]||t.target,s!==e){Da(t,"currentTarget",{configurable:!0,get(){return s||n}});var g=It,S=Rt;Zn(null),Tr(null);try{for(var $,I=[];s!==null;){var N=s.assignedSlot||s.parentNode||s.host||null;try{var B=s["__"+r];B!=null&&(!s.disabled||t.target===s)&&B.call(s,t)}catch(U){$?I.push(U):$=U}if(t.cancelBubble||N===e||N===null)break;s=N}if($){for(let U of I)queueMicrotask(()=>{throw U});throw $}}finally{t.__root=e,delete t.currentTarget,Zn(g),Tr(S)}}}function Uc(t){var e=document.createElement("template");return e.innerHTML=t.replaceAll("<!>","<!---->"),e.content}function si(t,e){var n=Rt;n.nodes===null&&(n.nodes={start:t,end:e,a:null,t:null})}function V(t,e){var n=(e&xf)!==0,r=(e&kf)!==0,i,s=!t.startsWith("<!>");return()=>{if(Et)return si(qt,null),qt;i===void 0&&(i=Uc(s?t:"<!>"+t),n||(i=Kn(i)));var l=r||uc?document.importNode(i,!0):i.cloneNode(!0);if(n){var a=Kn(l),u=l.lastChild;si(a,u)}else si(l,l);return l}}function dr(){if(Et)return si(qt,null),qt;var t=document.createDocumentFragment(),e=document.createComment(""),n=Yn();return t.append(e,n),si(e,n),t}function P(t,e){if(Et){var n=Rt;(!(n.f&Fo)||n.nodes.end===null)&&(n.nodes.end=qt),$i();return}t!==null&&t.before(e)}const Zf=["touchstart","touchmove"];function td(t){return Zf.includes(t)}function ct(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??(t.__t=t.nodeValue))&&(t.__t=n,t.nodeValue=n+"")}function Wc(t,e){return Vc(t,e)}function ed(t,e){ha(),e.intro=e.intro??!1;const n=e.target,r=Et,i=qt;try{for(var s=Kn(n);s&&(s.nodeType!==qi||s.data!==ac);)s=hr(s);if(!s)throw ki;Fr(!0),fn(s);const l=Vc(t,{...e,anchor:s});return Fr(!1),l}catch(l){if(l instanceof Error&&l.message.split(`
`).some(a=>a.startsWith("https://svelte.dev/e/")))throw l;return l!==ki&&console.warn("Failed to hydrate: ",l),e.recover===!1&&cf(),ha(),Fa(n),Fr(!1),Wc(t,e)}finally{Fr(r),fn(i)}}const Ri=new Map;function Vc(t,{target:e,anchor:n,props:r={},events:i,context:s,intro:l=!0}){ha();var a=new Set,u=S=>{for(var $=0;$<S.length;$++){var I=S[$];if(!a.has(I)){a.add(I);var N=td(I);e.addEventListener(I,js,{passive:N});var B=Ri.get(I);B===void 0?(document.addEventListener(I,js,{passive:N}),Ri.set(I,1)):Ri.set(I,B+1)}}};u(Po(Yf)),Ol.add(u);var v=void 0,g=Gf(()=>{var S=n??e.appendChild(Yn());return Mf(S,{pending:()=>{}},$=>{if(s){Bn({});var I=ce;I.c=s}if(i&&(r.$$events=i),Et&&si($,null),v=t($,r)||{},Et&&(Rt.nodes.end=qt,qt===null||qt.nodeType!==qi||qt.data!==Ba))throw zs(),ki;s&&Fn()}),()=>{var N;for(var $ of a){e.removeEventListener($,js);var I=Ri.get($);--I===0?(document.removeEventListener($,js),Ri.delete($)):Ri.set($,I)}Ol.delete(u),S!==n&&((N=S.parentNode)==null||N.removeChild(S))}});return $a.set(v,g),v}let $a=new WeakMap;function nd(t,e){const n=$a.get(t);return n?($a.delete(t),n(e)):Promise.resolve()}function Gc(t){return function(...e){var n=e[0];n.target===this&&(t==null||t.apply(this,e))}}function Kc(t){return function(...e){var n=e[0];return n.stopPropagation(),t==null?void 0:t.apply(this,e)}}function tr(t){return new rd(t)}var Lr,Wn;class rd{constructor(e){Tt(this,Lr);Tt(this,Wn);var s;var n=new Map,r=(l,a)=>{var u=Q(a,!1,!1);return n.set(l,u),u};const i=new Proxy({...e.props||{},$$events:{}},{get(l,a){return o(n.get(a)??r(a,Reflect.get(l,a)))},has(l,a){return a===Zl?!0:(o(n.get(a)??r(a,Reflect.get(l,a))),Reflect.has(l,a))},set(l,a,u){return _(n.get(a)??r(a,u),u),Reflect.set(l,a,u)}});wt(this,Wn,(e.hydrate?ed:Wc)(e.component,{target:e.target,anchor:e.anchor,props:i,context:e.context,intro:e.intro??!1,recover:e.recover})),(!((s=e==null?void 0:e.props)!=null&&s.$$host)||e.sync===!1)&&on(),wt(this,Lr,i.$$events);for(const l of Object.keys(q(this,Wn)))l==="$set"||l==="$destroy"||l==="$on"||Da(this,l,{get(){return q(this,Wn)[l]},set(a){q(this,Wn)[l]=a},enumerable:!0});q(this,Wn).$set=l=>{Object.assign(i,l)},q(this,Wn).$destroy=()=>{nd(q(this,Wn))}}$set(e){q(this,Wn).$set(e)}$on(e,n){q(this,Lr)[e]=q(this,Lr)[e]||[];const r=(...i)=>n.call(this,...i);return q(this,Lr)[e].push(r),()=>{q(this,Lr)[e]=q(this,Lr)[e].filter(i=>i!==r)}}$destroy(){q(this,Wn).$destroy()}}Lr=new WeakMap,Wn=new WeakMap;const id="5";var Kl;typeof window<"u"&&((Kl=window.__svelte??(window.__svelte={})).v??(Kl.v=new Set)).add(id);gf();var ur,xr,On,bi,Fs,Rs,Bo;class sd{constructor(e,n=!0){lr(this,"anchor");Tt(this,ur,new Map);Tt(this,xr,new Map);Tt(this,On,new Map);Tt(this,bi,new Set);Tt(this,Fs,!0);Tt(this,Rs,()=>{var e=xt;if(q(this,ur).has(e)){var n=q(this,ur).get(e),r=q(this,xr).get(n);if(r)Ga(r),q(this,bi).delete(n);else{var i=q(this,On).get(n);i&&(q(this,xr).set(n,i.effect),q(this,On).delete(n),i.fragment.lastChild.remove(),this.anchor.before(i.fragment),r=i.effect)}for(const[s,l]of q(this,ur)){if(q(this,ur).delete(s),s===e)break;const a=q(this,On).get(l);a&&(wn(a.effect),q(this,On).delete(l))}for(const[s,l]of q(this,xr)){if(s===n||q(this,bi).has(s))continue;const a=()=>{if(Array.from(q(this,ur).values()).includes(s)){var v=document.createDocumentFragment();zc(l,v),v.append(Yn()),q(this,On).set(s,{effect:l,fragment:v})}else wn(l);q(this,bi).delete(s),q(this,xr).delete(s)};q(this,Fs)||!r?(q(this,bi).add(s),wi(l,a,!1)):a()}}});Tt(this,Bo,e=>{q(this,ur).delete(e);const n=Array.from(q(this,ur).values());for(const[r,i]of q(this,On))n.includes(r)||(wn(i.effect),q(this,On).delete(r))});this.anchor=e,wt(this,Fs,n)}ensure(e,n){var r=xt,i=vc();if(n&&!q(this,xr).has(e)&&!q(this,On).has(e))if(i){var s=document.createDocumentFragment(),l=Yn();s.append(l),q(this,On).set(e,{effect:Vn(()=>n(l)),fragment:s})}else q(this,xr).set(e,Vn(()=>n(this.anchor)));if(q(this,ur).set(r,e),i){for(const[a,u]of q(this,xr))a===e?r.skipped_effects.delete(u):r.skipped_effects.add(u);for(const[a,u]of q(this,On))a===e?r.skipped_effects.delete(u.effect):r.skipped_effects.add(u.effect);r.oncommit(q(this,Rs)),r.ondiscard(q(this,Bo))}else Et&&(this.anchor=qt),q(this,Rs).call(this)}}ur=new WeakMap,xr=new WeakMap,On=new WeakMap,bi=new WeakMap,Fs=new WeakMap,Rs=new WeakMap,Bo=new WeakMap;function Us(t){ce===null&&sc(),cs&&ce.l!==null?ad(ce).m.push(t):ka(()=>{const e=J(t);if(typeof e=="function")return e})}function od(t,e,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:r})}function Ka(){const t=ce;return t===null&&sc(),(e,n,r)=>{var s;const i=(s=t.s.$$events)==null?void 0:s[e];if(i){const l=Hs(i)?i.slice():[i],a=od(e,n,r);for(const u of l)u.call(t.x,a);return!a.defaultPrevented}return!0}}function ad(t){var e=t.l;return e.u??(e.u={a:[],b:[],m:[]})}function _t(t,e,n=!1){Et&&$i();var r=new sd(t),i=n?ns:0;function s(l,a){if(Et){const v=cc(t)===Ho;if(l===v){var u=jo();fn(u),r.anchor=u,Fr(!1),r.ensure(l,a),Fr(!0);return}}r.ensure(l,a)}Va(()=>{var l=!1;e((a,u=!0)=>{l=!0,s(u,a)}),l||s(!1,null)},i)}function Ke(t,e){return e}function ld(t,e,n){for(var r=[],i=e.length,s,l=e.length,a=0;a<i;a++){let S=e[a];wi(S,()=>{if(s){if(s.pending.delete(S),s.done.add(S),s.pending.size===0){var $=t.outrogroups;Ta(Po(s.done)),$.delete(s),$.size===0&&(t.outrogroups=null)}}else l-=1},!1)}if(l===0){var u=r.length===0&&n!==null;if(u){var v=n,g=v.parentNode;Fa(g),g.append(v),t.items.clear()}Ta(e,!u)}else s={pending:new Set(e),done:new Set},(t.outrogroups??(t.outrogroups=new Set)).add(s)}function Ta(t,e=!0){for(var n=0;n<t.length;n++)wn(t[n],e)}var Ll;function Fe(t,e,n,r,i,s=null){var l=t,a=new Map,u=(e&oc)!==0;if(u){var v=t;l=Et?fn(Kn(v)):v.appendChild(Yn())}Et&&$i();var g=null,S=Ja(()=>{var U=n();return Hs(U)?U:U==null?[]:Po(U)}),$,I=!0;function N(){j.fallback=g,cd(j,$,l,e,r),g!==null&&($.length===0?g.f&Br?(g.f^=Br,Is(g,null,l)):Ga(g):wi(g,()=>{g=null}))}var B=Va(()=>{$=o(S);var U=$.length;let ft=!1;if(Et){var tt=cc(l)===Ho;tt!==(U===0)&&(l=jo(),fn(l),Fr(!1),ft=!0)}for(var ot=new Set,K=xt,bt=vc(),rt=0;rt<U;rt+=1){Et&&qt.nodeType===qi&&qt.data===Ba&&(l=qt,ft=!0,Fr(!1));var F=$[rt],ut=r(F,rt),W=I?null:a.get(ut);W?(W.v&&Ei(W.v,F),W.i&&Ei(W.i,rt),bt&&K.skipped_effects.delete(W.e)):(W=ud(a,I?l:Ll??(Ll=Yn()),F,ut,rt,i,e,n),I||(W.e.f|=Br),a.set(ut,W)),ot.add(ut)}if(U===0&&s&&!g&&(I?g=Vn(()=>s(l)):(g=Vn(()=>s(Ll??(Ll=Yn()))),g.f|=Br)),Et&&U>0&&fn(jo()),!I)if(bt){for(const[lt,dt]of a)ot.has(lt)||K.skipped_effects.add(dt.e);K.oncommit(N),K.ondiscard(()=>{})}else N();ft&&Fr(!0),o(S)}),j={effect:B,items:a,outrogroups:null,fallback:g};I=!1,Et&&(l=qt)}function Cs(t){for(;t!==null&&!(t.f&pr);)t=t.next;return t}function cd(t,e,n,r,i){var W,lt,dt,Nt,Ot,At,Zt,Jt,Dt;var s=(r&bf)!==0,l=e.length,a=t.items,u=Cs(t.effect.first),v,g=null,S,$=[],I=[],N,B,j,U;if(s)for(U=0;U<l;U+=1)N=e[U],B=i(N,U),j=a.get(B).e,j.f&Br||((lt=(W=j.nodes)==null?void 0:W.a)==null||lt.measure(),(S??(S=new Set)).add(j));for(U=0;U<l;U+=1){if(N=e[U],B=i(N,U),j=a.get(B).e,t.outrogroups!==null)for(const Pt of t.outrogroups)Pt.pending.delete(j),Pt.done.delete(j);if(j.f&Br)if(j.f^=Br,j===u)Is(j,null,n);else{var ft=g?g.next:u;j===t.effect.last&&(t.effect.last=j.prev),j.prev&&(j.prev.next=j.next),j.next&&(j.next.prev=j.prev),Vr(t,g,j),Vr(t,j,ft),Is(j,ft,n),g=j,$=[],I=[],u=Cs(g.next);continue}if(j.f&Ln&&(Ga(j),s&&((Nt=(dt=j.nodes)==null?void 0:dt.a)==null||Nt.unfix(),(S??(S=new Set)).delete(j))),j!==u){if(v!==void 0&&v.has(j)){if($.length<I.length){var tt=I[0],ot;g=tt.prev;var K=$[0],bt=$[$.length-1];for(ot=0;ot<$.length;ot+=1)Is($[ot],tt,n);for(ot=0;ot<I.length;ot+=1)v.delete(I[ot]);Vr(t,K.prev,bt.next),Vr(t,g,K),Vr(t,bt,tt),u=tt,g=bt,U-=1,$=[],I=[]}else v.delete(j),Is(j,u,n),Vr(t,j.prev,j.next),Vr(t,j,g===null?t.effect.first:g.next),Vr(t,g,j),g=j;continue}for($=[],I=[];u!==null&&u!==j;)(v??(v=new Set)).add(u),I.push(u),u=Cs(u.next);if(u===null)continue}j.f&Br||$.push(j),g=j,u=Cs(j.next)}if(t.outrogroups!==null){for(const Pt of t.outrogroups)Pt.pending.size===0&&(Ta(Po(Pt.done)),(Ot=t.outrogroups)==null||Ot.delete(Pt));t.outrogroups.size===0&&(t.outrogroups=null)}if(u!==null||v!==void 0){var rt=[];if(v!==void 0)for(j of v)j.f&Ln||rt.push(j);for(;u!==null;)!(u.f&Ln)&&u!==t.fallback&&rt.push(u),u=Cs(u.next);var F=rt.length;if(F>0){var ut=r&oc&&l===0?n:null;if(s){for(U=0;U<F;U+=1)(Zt=(At=rt[U].nodes)==null?void 0:At.a)==null||Zt.measure();for(U=0;U<F;U+=1)(Dt=(Jt=rt[U].nodes)==null?void 0:Jt.a)==null||Dt.fix()}ld(t,rt,ut)}}s&&kr(()=>{var Pt,kt;if(S!==void 0)for(j of S)(kt=(Pt=j.nodes)==null?void 0:Pt.a)==null||kt.apply()})}function ud(t,e,n,r,i,s,l,a){var u=l&mf?l&yf?Ti(n):Q(n,!1,!1):null,v=l&_f?Ti(i):null;return{v:u,i:v,e:Vn(()=>(s(e,u??n,v??i,a),()=>{t.delete(r)}))}}function Is(t,e,n){if(t.nodes)for(var r=t.nodes.start,i=t.nodes.end,s=e&&!(e.f&Br)?e.nodes.start:n;r!==null;){var l=hr(r);if(s.before(r),r===i)return;r=l}}function Vr(t,e,n){e===null?t.effect.first=n:e.next=n,n===null?t.effect.last=e:n.prev=e}function fd(t,e,n=!1,r=!1,i=!1){var s=t,l="";ht(()=>{var a=Rt;if(l===(l=e()??"")){Et&&$i();return}if(a.nodes!==null&&(Rc(a.nodes.start,a.nodes.end),a.nodes=null),l!==""){if(Et){qt.data;for(var u=$i(),v=u;u!==null&&(u.nodeType!==qi||u.data!=="");)v=u,u=hr(u);if(u===null)throw zs(),ki;si(qt,v),s=fn(u);return}var g=l+"";n?g=`<svg>${g}</svg>`:r&&(g=`<math>${g}</math>`);var S=Uc(g);if((n||r)&&(S=Kn(S)),si(Kn(S),S.lastChild),n||r)for(;Kn(S);)s.before(Kn(S));else s.before(S)}})}function Xc(t,e,n,r,i){var a;Et&&$i();var s=(a=e.$$slots)==null?void 0:a[n],l=!1;s===!0&&(s=e.children,l=!0),s===void 0||s(t,l?()=>r:r)}const Bl=[...` 	
\r\f \v\uFEFF`];function dd(t,e,n){var r=t==null?"":""+t;if(e&&(r=r?r+" "+e:e),n){for(var i in n)if(n[i])r=r?r+" "+i:i;else if(r.length)for(var s=i.length,l=0;(l=r.indexOf(i,l))>=0;){var a=l+s;(l===0||Bl.includes(r[l-1]))&&(a===r.length||Bl.includes(r[a]))?r=(l===0?"":r.substring(0,l))+r.substring(a+1):l=a}}return r===""?null:r}function vd(t,e){return t==null?null:String(t)}function bn(t,e,n,r,i,s){var l=t.__className;if(Et||l!==n||l===void 0){var a=dd(n,r,s);(!Et||a!==t.getAttribute("class"))&&(a==null?t.removeAttribute("class"):t.className=a),t.__className=n}else if(s&&i!==s)for(var u in s){var v=!!s[u];(i==null||v!==!!i[u])&&t.classList.toggle(u,v)}return s}function Ui(t,e,n,r){var i=t.__style;if(Et||i!==e){var s=vd(e);(!Et||s!==t.getAttribute("style"))&&(s==null?t.removeAttribute("style"):t.style.cssText=s),t.__style=e}return r}function Yc(t,e,n=!1){if(t.multiple){if(e==null)return;if(!Hs(e))return Ef();for(var r of t.options)r.selected=e.includes(Os(r));return}for(r of t.options){var i=Os(r);if(qf(i,e)){r.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function pd(t){var e=new MutationObserver(()=>{Yc(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Wo(()=>{e.disconnect()})}function $o(t,e,n=e){var r=new WeakSet,i=!0;Ua(t,"change",s=>{var l=s?"[selected]":":checked",a;if(t.multiple)a=[].map.call(t.querySelectorAll(l),Os);else{var u=t.querySelector(l)??t.querySelector("option:not([disabled])");a=u&&Os(u)}n(a),xt!==null&&r.add(xt)}),Lc(()=>{var s=e();if(t===document.activeElement){var l=Io??xt;if(r.has(l))return}if(Yc(t,s,i),i&&s===void 0){var a=t.querySelector(":checked");a!==null&&(s=Os(a),n(s))}t.__value=s,i=!1}),pd(t)}function Os(t){return"__value"in t?t.__value:t.value}const hd=Symbol("is custom element"),gd=Symbol("is html");function Gn(t){if(Et){var e=!1,n=()=>{if(!e){if(e=!0,t.hasAttribute("value")){var r=t.value;Gi(t,"value",null),t.value=r}if(t.hasAttribute("checked")){var i=t.checked;Gi(t,"checked",null),t.checked=i}}};t.__on_r=n,kr(n),Ac()}}function Gi(t,e,n,r){var i=md(t);Et&&(i[e]=t.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&t.nodeName==="LINK")||i[e]!==(i[e]=n)&&(e==="loading"&&(t[Qu]=n),n==null?t.removeAttribute(e):typeof n!="string"&&_d(t).includes(e)?t[e]=n:t.setAttribute(e,n))}function md(t){return t.__attributes??(t.__attributes={[hd]:t.nodeName.includes("-"),[gd]:t.namespaceURI===$f})}var Fl=new Map;function _d(t){var e=t.getAttribute("is")||t.nodeName,n=Fl.get(e);if(n)return n;Fl.set(e,n=[]);for(var r,i=t,s=Element.prototype;s!==i;){r=tc(i);for(var l in r)r[l].set&&n.push(l);i=La(i)}return n}function Re(t,e,n=e){var r=new WeakSet;Ua(t,"input",async i=>{var s=i?t.defaultValue:t.value;if(s=la(t)?ca(s):s,n(s),xt!==null&&r.add(xt),await Uf(),s!==(s=e())){var l=t.selectionStart,a=t.selectionEnd,u=t.value.length;if(t.value=s??"",a!==null){var v=t.value.length;l===a&&a===u&&v>u?(t.selectionStart=v,t.selectionEnd=v):(t.selectionStart=l,t.selectionEnd=Math.min(a,v))}}}),(Et&&t.defaultValue!==t.value||J(e)==null&&t.value)&&(n(la(t)?ca(t.value):t.value),xt!==null&&r.add(xt)),fs(()=>{var i=e();if(t===document.activeElement){var s=Io??xt;if(r.has(s))return}la(t)&&i===ca(t.value)||t.type==="date"&&!i&&!t.value||i!==t.value&&(t.value=i??"")})}function Rl(t,e,n=e){Ua(t,"change",r=>{var i=r?t.defaultChecked:t.checked;n(i)}),(Et&&t.defaultChecked!==t.checked||J(e)==null)&&n(t.checked),fs(()=>{var r=e();t.checked=!!r})}function la(t){var e=t.type;return e==="number"||e==="range"}function ca(t){return t===""?null:+t}function Pl(t,e){return t===e||(t==null?void 0:t[Pr])===e}function bd(t={},e,n,r){return Lc(()=>{var i,s;return fs(()=>{i=s,s=[],J(()=>{t!==n(...s)&&(e(t,...s),i&&Pl(n(...i),t)&&e(null,...i))})}),()=>{kr(()=>{s&&Pl(n(...s),t)&&e(null,...s)})}}),t}function ai(t=!1){const e=ce,n=e.l.u;if(!n)return;let r=()=>Uo(e.s);if(t){let i=0,s={};const l=Ha(()=>{let a=!1;const u=e.s;for(const v in u)u[v]!==s[v]&&(s[v]=u[v],a=!0);return a&&i++,i});r=()=>o(l)}n.b.length&&Vf(()=>{Hl(e,r),qo(n.b)}),ka(()=>{const i=J(()=>n.m.map(nf));return()=>{for(const s of i)typeof s=="function"&&s()}}),n.a.length&&ka(()=>{Hl(e,r),qo(n.a)})}function Hl(t,e){if(t.l.s)for(const n of t.l.s)o(n);e()}function Qc(t,e){var s;var n=(s=t.$$events)==null?void 0:s[e.type],r=Hs(n)?n.slice():n==null?[]:[n];for(var i of r)i.call(this,e)}function er(t,e,n){var r;t.$$events||(t.$$events={}),(r=t.$$events)[e]||(r[e]=[]),t.$$events[e].push(n)}function nr(t){for(var e in t)e in this&&(this[e]=t[e])}function Xa(t,e,n){if(t==null)return e(void 0),n&&n(void 0),ei;const r=J(()=>t.subscribe(e,n));return r.unsubscribe?()=>r.unsubscribe():r}const Pi=[];function yd(t,e){return{subscribe:Ee(t,e).subscribe}}function Ee(t,e=ei){let n=null;const r=new Set;function i(a){if(rc(t,a)&&(t=a,n)){const u=!Pi.length;for(const v of r)v[1](),Pi.push(v,t);if(u){for(let v=0;v<Pi.length;v+=2)Pi[v][0](Pi[v+1]);Pi.length=0}}}function s(a){i(a(t))}function l(a,u=ei){const v=[a,u];return r.add(v),r.size===1&&(n=e(i,s)||ei),a(t),()=>{r.delete(v),r.size===0&&n&&(n(),n=null)}}return{set:i,update:s,subscribe:l}}function wd(t,e,n){const r=!Array.isArray(t),i=r?[t]:t;if(!i.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const s=e.length<2;return yd(n,(l,a)=>{let u=!1;const v=[];let g=0,S=ei;const $=()=>{if(g)return;S();const N=e(r?v[0]:v,l,a);s?l(N):S=typeof N=="function"?N:ei},I=i.map((N,B)=>Xa(N,j=>{v[B]=j,g&=~(1<<B),u&&$()},()=>{g|=1<<B}));return u=!0,$(),function(){qo(I),S(),u=!1}})}function vr(t){let e;return Xa(t,n=>e=n)(),e}let bo=!1,Ea=Symbol();function ke(t,e,n){const r=n[e]??(n[e]={store:null,source:Q(void 0),unsubscribe:ei});if(r.store!==t&&!(Ea in n))if(r.unsubscribe(),r.store=t??null,t==null)r.source.v=void 0,r.unsubscribe=ei;else{var i=!0;r.unsubscribe=Xa(t,s=>{i?r.source.v=s:_(r.source,s)}),i=!1}return t&&Ea in n?vr(t):o(r.source)}function Sd(t,e){return t.set(e),e}function ds(){const t={};function e(){Wo(()=>{for(var n in t)t[n].unsubscribe();Da(t,Ea,{enumerable:!1,value:!0})})}return[t,e]}function xd(t){var e=bo;try{return bo=!1,[t(),bo]}finally{bo=e}}function Sn(t,e,n,r){var ft;var i=!cs||(n&wf)!==0,s=(n&Sf)!==0,l=r,a=!0,u=()=>(a&&(a=!1,l=r),l),v;{var g=Pr in t||Zl in t;v=((ft=Wi(t,e))==null?void 0:ft.set)??(g&&e in t?tt=>t[e]=tt:void 0)}var S,$=!1;[S,$]=xd(()=>t[e]),S===void 0&&r!==void 0&&(S=u(),v&&(i&&uf(),v(S)));var I;if(i?I=()=>{var tt=t[e];return tt===void 0?u():(a=!0,tt)}:I=()=>{var tt=t[e];return tt!==void 0&&(l=void 0),tt===void 0?l:tt},v){var N=t.$$legacy;return function(tt,ot){return arguments.length>0?((!i||!ot||N||$)&&v(ot?I():tt),tt):I()}}var B=!1,j=Ja(()=>(B=!1,I()));o(j);var U=Rt;return function(tt,ot){if(arguments.length>0){const K=ot?o(j):i&&s?zi(tt):tt;return _(j,K),B=!0,l!==void 0&&(l=K),tt}return oi&&B||U.f&Rr?j.v:o(j)}}const Jr=Ee(""),Si=Ee(""),Ve=Ee(""),We=Ee(null),Be=Ee(!1),Hi=Ee("就绪"),Jn=Ee("就绪"),Ya=Ee([]),kd=Ee("等待解析…"),$d=Ee([]),Td=Ee([]),Qa=Ee([]),To=Ee(!1),Aa=Ee(null),Za=Ee([]),as=Ee(-1),tl=wd(Ve,t=>String(t||"").replace(/\s/g,"").length),qa=Ee([]),Jl=Ee(!1),yo=Ee(!1);let ua=null,fa=null;typeof window<"u"&&(window.__waGetStore=t=>{const n={docId:Jr,instruction:Si,sourceText:Ve,docIr:We,docIrDirty:Be,flowStatus:Hi,docStatus:Jn,generating:To,wordCount:tl}[t];return n?vr(n):void 0});async function Ed(){const t=vr(Jr);if(!t)return;const e=await fetch(`/api/doc/${t}/chat`);if(!e.ok)return;const n=await e.json(),r=Array.isArray(n.items)?n.items:[];Ya.set(r)}async function Ad(){const t=vr(Jr);if(!t)return;const e=await fetch(`/api/doc/${t}/thoughts`);if(!e.ok)return;const n=await e.json(),r=Array.isArray(n.items)?n.items:[];Qa.set(r)}async function qd(t){const e=vr(Jr);e&&await fetch(`/api/doc/${e}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:t.slice(-200)})})}async function Cd(t){const e=vr(Jr);e&&await fetch(`/api/doc/${e}/thoughts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:t.slice(-200)})})}function Gr(t,e){const n={role:t,text:String(e||"").trim()};n.text&&Ya.update(r=>{const i=[...r,n];return ua&&clearTimeout(ua),ua=setTimeout(()=>{qd(i).catch(()=>{})},300),i})}function sn(t,e,n){const r={label:t,detail:e,time:n||new Date().toLocaleTimeString()};Qa.update(i=>{const s=[...i,r].slice(-200);return fa&&clearTimeout(fa),fa=setTimeout(()=>{Cd(s).catch(()=>{})},300),s})}function jt(t,e="info"){const n=Date.now(),r={id:n,message:t,type:e};qa.update(i=>[...i,r]),setTimeout(()=>{qa.update(i=>i.filter(s=>s.id!==n))},2600)}function jd(t){const e=String(t||"");Za.update(n=>{const r=n.slice(0,vr(as)+1);if(r[r.length-1]===e)return n;r.push(e);const i=r.slice(-50);return as.set(i.length-1),i})}function Id(){const t=vr(as);if(t<=0)return;as.set(t-1);const e=vr(Za);Ve.set(e[t-1]||""),Be.set(!0)}function Nd(){const t=vr(as),e=vr(Za);t>=e.length-1||(as.set(t+1),Ve.set(e[t+1]||""),Be.set(!0))}var Md=V('<div class="assistant-header svelte-191yngm"><div class="assistant-title svelte-191yngm"><span class="assistant-dot svelte-191yngm"></span> 智能助手</div> <button class="assistant-toggle svelte-191yngm"> </button></div>'),Od=V('<div class="panel-title svelte-191yngm">对话写作</div>'),Dd=V('<div class="thought-item svelte-191yngm"><div class="thought-meta svelte-191yngm"><span class="label"> </span> <span class="time"> </span></div> <div class="detail svelte-191yngm"> </div></div>'),Ld=V('<div class="thoughts svelte-191yngm"><div class="thoughts-title svelte-191yngm">思考链</div> <div class="thought-list svelte-191yngm"></div></div>'),Bd=V('<div><div class="chat-bubble svelte-191yngm"> </div></div>'),Fd=V('<div><!> <!> <div class="chat-history svelte-191yngm"></div> <div class="composer svelte-191yngm"><textarea rows="3" placeholder="输入需求或修改指令" class="svelte-191yngm"></textarea> <button class="send-btn svelte-191yngm">发送</button></div></div>');function Zc(t,e){if(new.target)return tr({component:Zc,...t});Bn(e,!1);const n=()=>ke(Si,"$instruction",s),r=()=>ke(Qa,"$thoughtLog",s),i=()=>ke(Ya,"$chat",s),[s,l]=ds(),a=Ka();let u=Sn(e,"variant",12,"panel"),v=Q(!0);function g(){const W=n().trim();W&&(a("send",W),Si.set(""),I())}function S(W){W.key==="Enter"&&!W.shiftKey&&(W.preventDefault(),g())}function $(){_(v,!o(v)),I()}function I(){queueMicrotask(()=>{const W=document.querySelector(".chat-history");W&&(W.scrollTop=W.scrollHeight);const lt=document.querySelector(".thought-list");lt&&(lt.scrollTop=lt.scrollHeight)})}var N={get variant(){return u()},set variant(W){u(W),on()},$set:nr,$on:(W,lt)=>er(e,W,lt)};ai();var B=Fd(),j=y(B);{var U=W=>{var lt=Md(),dt=h(y(lt),2),Nt=y(dt,!0);b(dt),b(lt),ht(()=>ct(Nt,o(v)?"隐藏思考":"思考链")),A("click",dt,$),P(W,lt)},ft=W=>{var lt=Od();P(W,lt)};_t(j,W=>{u()==="assistant"?W(U):W(ft,!1)})}var tt=h(j,2);{var ot=W=>{var lt=Ld(),dt=h(y(lt),2);Fe(dt,5,r,Ke,(Nt,Ot)=>{var At=Dd(),Zt=y(At),Jt=y(Zt),Dt=y(Jt,!0);b(Jt);var Pt=h(Jt,2),kt=y(Pt,!0);b(Pt),b(Zt);var oe=h(Zt,2),ue=y(oe,!0);b(oe),b(At),ht(()=>{ct(Dt,(o(Ot),J(()=>o(Ot).label))),ct(kt,(o(Ot),J(()=>o(Ot).time))),ct(ue,(o(Ot),J(()=>o(Ot).detail)))}),P(Nt,At)}),b(dt),b(lt),P(W,lt)};_t(tt,W=>{o(v)&&W(ot)})}var K=h(tt,2);Fe(K,5,i,Ke,(W,lt)=>{var dt=Bd(),Nt=y(dt),Ot=y(Nt,!0);b(Nt),b(dt),ht(()=>{bn(dt,1,`chat-msg ${o(lt),J(()=>o(lt).role)??""}`,"svelte-191yngm"),ct(Ot,(o(lt),J(()=>o(lt).text)))}),P(W,dt)}),b(K);var bt=h(K,2),rt=y(bt);ii(rt);var F=h(rt,2);b(bt),b(B),ht(()=>bn(B,1,`chat-shell ${u()}`,"svelte-191yngm")),Re(rt,n,W=>Sd(Si,W)),A("keydown",rt,S),A("click",F,g),P(t,B);var ut=Fn(N);return l(),ut}function Rd(t){const e=String(t||"").replace(/\r\n/g,`
`).replace(/\r/g,`
`);if(!e.trim())return"";const n=Hd(e)||e,r=uu(n.split(`
`));let i="",s=!1,l="";const a=[],u=()=>{l&&(a.push(l==="ol"?"</ol>":"</ul>"),l="")};for(const v of r){const g=v.trim();if(g.startsWith("```")){s?(a.push("</code></pre>"),s=!1):(u(),a.push('<pre class="code"><code>'),s=!0);continue}if(s){a.push(`${_e(v)}
`);continue}if(/^#{1,6}$/.test(g))continue;if(g===":::left"){u(),i="left";continue}if(g===":::center"){u(),i="center";continue}if(g===":::right"){u(),i="right";continue}if(g===":::"){u(),i="";continue}const S=g.match(/^\[\[(FIGURE|TABLE)\s*:\s*(\{[\s\S]*\})\s*\]\]$/i);if(S){u();const j=String(S[1]||"").toLowerCase();let U=j==="figure"?"图示":"表格";try{const ft=JSON.parse(S[2]);ft&&typeof ft.caption=="string"&&ft.caption.trim()&&(U=ft.caption.trim())}catch{}j==="figure"?a.push(`<figure class="wa-figure" data-wa-figure="1"><div class="wa-figure-box">图</div><figcaption>${_e(U)}</figcaption></figure>`):a.push(`<div class="wa-table" data-wa-table="1"><div class="wa-table-box">表</div><div class="wa-table-caption">${_e(U)}</div></div>`);continue}const $=g.match(/^(#{1,3})\s*(.+?)\s*$/);if($){u();const j=Math.min(3,$[1].length);a.push(`<h${j}>${$r($[2])}</h${j}>`);continue}if(!g){if(l)continue;u(),a.push("<p><br/></p>");continue}const I=g.match(/^-\s+(.+)/),N=g.match(/^\d+\.\s+(.+)/);if(I||N){const j=I?"ul":"ol";l?l!==j&&(u(),l=j,a.push(j==="ol"?"<ol>":"<ul>")):(l=j,a.push(j==="ol"?"<ol>":"<ul>"));const U=(I||N)[1];a.push(`<li>${$r(U)}</li>`);continue}u();const B=i?` style="text-align:${i};"`:"";a.push(`<p${B}>${$r(v)}</p>`)}return u(),a.join("")}function Pd(t,e,n){const r=String(t||""),i=zd(r);if(i)return i;if(!n){const s=Ud(e);if(s)return s}return Rd(r)}function Ca(t){let e=String(t||"").replace(/\r\n/g,`
`).replace(/\r/g,`
`);if(!e.endsWith(`
`)){const $=e.lastIndexOf(`
`),I=$>=0?e.slice($+1):e;I.trim().length<=4&&(/^#{1,6}\s*\S*$/.test(I)||/^[-*•·]\s*\S*$/.test(I))&&(e=$>=0?e.slice(0,$+1):"")}if(!e.trim())return null;const n=uu(e.split(`
`)),r=[];let i="",s=[],l=[],a=null;const u=()=>{if(!s.length)return;const $=s.join(" ").replace(/\s+/g," ").trim();$&&r.push({type:"paragraph",text:$}),s=[]},v=()=>{l.length&&(r.push({type:"list",items:l.slice(),ordered:!!a}),l=[],a=null)};let g=!0;for(const $ of n){const N=String($||"").trim();if(!N){u(),v(),g=!0;continue}if(/^#{1,6}$/.test(N))continue;const B=/^(#{1,3})\s*(.+)$/.exec(N);if(B){u(),v();const ot=Math.min(3,Math.max(1,B[1].length));let K=String(B[2]||"").trim(),bt="";const rt=Ul(K);rt&&(K=rt.heading,bt=rt.rest),ot===1&&!i&&K&&(i=K),r.push({type:"heading",level:ot,text:K||"章节"}),bt&&r.push({type:"paragraph",text:bt}),g=!1;continue}const j=/^(\d+(?:\.\d+){0,3})[\.、\)]?\s+(.+)$/.exec(N);if(j){const ot=String(j[1]||"");let K=String(j[2]||"").trim();const bt=(ot.match(/\./g)||[]).length,rt=Math.min(6,2+bt),F=Ul(K),ut=K.length<=16&&!Xr.test(K),W=lu.some(dt=>K.startsWith(dt)),lt=g||!s.length&&!l.length||F||ut||W;if(K&&lt){u(),v();let dt="";F&&(K=F.heading,dt=F.rest),rt===1&&!i&&K&&(i=K),r.push({type:"heading",level:rt,text:K||"章节"}),dt&&r.push({type:"paragraph",text:dt}),g=!1;continue}}const U=N.match(/^\[\[(FIGURE|TABLE)\s*:\s*(\{[\s\S]*\})\s*\]\]$/i);if(U){u(),v();const ot=String(U[1]||"").toLowerCase(),K=Ws(U[2])||{raw:U[2]};ot==="table"?r.push({type:"table",table:K}):r.push({type:"figure",figure:K});continue}const ft=N.match(/^[-*•·]\s+(.*)$/),tt=N.match(/^\d+[\.\)]\s+(.*)$/);if(ft||tt){u();const ot=!!tt;a===null&&(a=ot),a!==ot&&(v(),a=ot);const K=String((tt==null?void 0:tt[1])||(ft==null?void 0:ft[1])||"").trim();K&&l.push(K),g=!1;continue}v(),s.push(N),g=!1}u(),v();const S=i||el(r)||"自动生成文档";return tv(r,S)}function Hd(t){const e=String(t||"").trim();if(!e||/^#{1,3}\s+/m.test(e))return null;const n=tu(e);if(n){const i=Ws(n);if(i!==null){const s=Jd(i);if(s)return s}}const r=eu(e);return r.length>0?Ia(r):null}function tu(t){let e=String(t||"").trim();return e?(e.startsWith("```")&&(e=e.replace(/^```json/i,"").replace(/^```/,""),e.endsWith("```")&&(e=e.slice(0,-3)),e=e.trim()),e.startsWith("{")||e.startsWith("[")?e:null):null}function Ws(t){try{return JSON.parse(t)}catch{return null}}function eu(t){const e=[],n=String(t||"").split(`
`);for(const r of n){const i=r.trim();if(!i)continue;const s=Ws(i);s&&typeof s=="object"&&!Array.isArray(s)&&e.push(s)}return e}function Jd(t){if(!t||typeof t!="object")return null;const e=t;return e.doc_ir&&typeof e.doc_ir=="object"?Mo(e.doc_ir):Array.isArray(t)?Ia(t):Array.isArray(e.blocks)?Ia(e.blocks):Array.isArray(e.sections)?e.sections.some(i=>i&&(i.blocks||i.children))?Mo(e):Wd(e):null}function zd(t){const e=String(t||"").trim();if(!e)return null;const n=tu(e);if(n){const i=Ws(n);if(i!==null){const s=ja(i);if(s)return s}}const r=eu(e);if(r.length>0){const i=Na(r);if(i)return i}return null}function Ud(t){if(!t)return null;if(typeof t=="string"){const e=Ws(t);return e?ja(e):null}return typeof t!="object"?null:ja(t)}function ja(t){if(!t||typeof t!="object")return null;const e=t;return e.doc_ir&&typeof e.doc_ir=="object"?zl(e.doc_ir):Array.isArray(t)?Na(t):Array.isArray(e.blocks)?Na(e.blocks,String(e.title||"").trim()):Array.isArray(e.sections)?zl(e):null}function Mo(t){const e=cu(t),n=Array.isArray(t.sections)?t.sections:[],r=[];e&&r.push(`# ${e}`);for(const i of n)ru(i,r);return r.length?r.join(`

`).trim():null}function zl(t){const e=cu(t),n=Array.isArray(t.sections)?t.sections:[];if(!e&&n.length===0)return null;const r=['<div class="wa-doc">'],i=e;r.push(`<div class="wa-header" contenteditable="false">${_e(i)}</div>`),r.push('<div class="wa-body">');const s=Do(e);e&&r.push(`<div class="wa-title">${$r(e)}</div>`);for(const l of n)r.push(nu(l,s));return r.push("</div>"),r.push('<div class="wa-footer" contenteditable="false">Page 1</div>'),r.push("</div>"),r.join("")}function nu(t,e){const n=String(t.title||"").trim(),r=Math.min(6,Math.max(1,Number(t.level||2))),i=String(t.id||"").trim(),s=i?` data-section-id="${_e(i)}" data-section-level="${r}"`:"",l=iu({style:t.style}),a=`${s}${l}`,u=[];n&&(r===1&&e&&Do(n)===e||u.push(Oo(r,n,a)));const v=Array.isArray(t.blocks)?t.blocks:[];for(const S of v){const $=ou(S);$&&u.push($)}const g=Array.isArray(t.children)?t.children:[];for(const S of g)u.push(nu(S,e));return u.join("")}function ru(t,e){const n=String(t.title||"").trim();if(n){const s=Math.min(6,Math.max(1,Number(t.level||2)));e.push(`${"#".repeat(s)} ${n}`)}const r=Array.isArray(t.blocks)?t.blocks:[];for(const s of r)e.push(...su(s));const i=Array.isArray(t.children)?t.children:[];for(const s of i)ru(s,e)}function Wd(t){const e=String(t.title||"").trim(),n=Array.isArray(t.sections)?t.sections:[],r=[];e&&r.push(`# ${e}`);for(const i of n){const s=String(i.title||i.name||i.section||"").trim();if(!s)continue;r.push(`## ${s}`);let l=i.content??i.text??i.body;Array.isArray(l)&&(l=l.map(u=>String(u||"").trim()).filter(Boolean).join(`

`));const a=String(l||"").trim();a&&r.push(a)}return r.length?r.join(`

`).trim():null}function Ia(t){const e=[];let n="";for(const r of t){const i=String(r.section_id||r.section_title||"").trim();if(i&&i!==n){const s=Vd(i);s&&e.push(s),n=i}e.push(...su(r))}return e.length?e.join(`

`).trim():null}function Na(t,e){const n=['<div class="wa-doc">'],r=String(e||"").trim()||el(t),i=r;n.push(`<div class="wa-header" contenteditable="false">${_e(i)}</div>`),n.push('<div class="wa-body">'),r&&n.push(`<div class="wa-title">${$r(r)}</div>`);let s="",l=!1;for(const a of t){const u=String(a.section_id||a.section_title||"").trim();if(u&&u!==s){const S=Gd(u);S&&n.push(S),s=u}const v=String(a.type||"").toLowerCase();if(!l&&r&&v==="heading"&&Number(a.level||0)===1){const S=String(a.text||"").trim();if(Do(S)===Do(r)){l=!0;continue}}const g=ou(a);g&&n.push(g)}return n.push("</div>"),n.push('<div class="wa-footer" contenteditable="false">Page 1</div>'),n.push("</div>"),n.length>2?n.join(""):null}function Vd(t){const e=/^H([1-6])::(.+)$/.exec(t);if(e){const n=Math.min(6,Math.max(1,Number(e[1]||2))),r=String(e[2]||"").trim();if(r)return`${"#".repeat(n)} ${r}`}return`## ${t}`}function Gd(t){const e=/^H([1-6])::(.+)$/.exec(t);if(e){const n=Math.min(6,Math.max(1,Number(e[1]||2))),r=String(e[2]||"").trim();if(r)return Oo(n,r)}return Oo(2,t)}function Kd(t){const e=String(t.id||"").trim();return e?` data-block-id="${_e(e)}"`:""}function iu(t){const e=t.style;if(!e||typeof e!="object")return"";const n=[],r=String(e.align||e.textAlign||"").trim();["left","center","right","justify"].includes(r)&&n.push(`text-align:${r}`);const i=String(e.lineHeight||"").trim();/^\d+(\.\d+)?$/.test(i)&&n.push(`line-height:${i}`);const s=String(e.indent||e.textIndent||"").trim();/^\d+(\.\d+)?(px|pt|em|rem)?$/.test(s)&&n.push(`text-indent:${s}`);const l=String(e.marginTop||"").trim();/^\d+(\.\d+)?(px|pt|em|rem)?$/.test(l)&&n.push(`margin-top:${l}`);const a=String(e.marginBottom||"").trim();/^\d+(\.\d+)?(px|pt|em|rem)?$/.test(a)&&n.push(`margin-bottom:${a}`);const u=String(e.fontFamily||"").trim();u&&u.length<80&&n.push(`font-family:${_e(u)}`);const v=String(e.fontSize||"").trim();/^\d+(\.\d+)?(px|pt|em|rem)?$/.test(v)&&n.push(`font-size:${v}`);const g=String(e.color||"").trim();(/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(g)||g.startsWith("rgb("))&&n.push(`color:${_e(g)}`);const S=String(e.background||e.backgroundColor||"").trim();return(/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(S)||S.startsWith("rgb("))&&n.push(`background-color:${_e(S)}`),n.length?` style="${n.join(";")}"`:""}function su(t){const e=String(t.type||"paragraph").toLowerCase();if(e==="paragraph"||e==="text"||e==="p"){const r=Array.isArray(t.runs)?t.runs:null,s=(r&&r.length?r.map(l=>String(l.text||"")).join(""):String(t.text||"")).trim();return s?[s]:[]}if(e==="list"||e==="bullets"||e==="bullet"){const r=!!t.ordered,i=Array.isArray(t.items)?t.items:[];if(i.length){const a=i.map(u=>String(u||"").trim()).filter(Boolean);return r?a.map((u,v)=>`${v+1}. ${u}`):a.map(u=>`- ${u}`)}const s=String(t.text||"").trim();if(!s)return[];const l=s.split(/\n+/).map(a=>a.trim()).filter(Boolean);return r?l.map((a,u)=>{const v=a.replace(/^\d+[\.\)]\s+/,"");return`${u+1}. ${v}`}):l.map(a=>a.startsWith("-")?a:`- ${a}`)}if(e==="table"||e==="figure"){const r={};return typeof t.caption=="string"&&(r.caption=t.caption),Array.isArray(t.columns)&&(r.columns=t.columns),Array.isArray(t.rows)&&(r.rows=t.rows),t.data&&typeof t.data=="object"&&(r.data=t.data),[`[[${e==="table"?"TABLE":"FIGURE"}:${JSON.stringify(r)}]]`]}if(e==="reference"||e==="ref"){const r=String(t.text||"").trim();return r?[r]:(Array.isArray(t.items)?t.items:[]).map(s=>String(s||"").trim()).filter(Boolean)}const n=String(t.text||"").trim();return n?[n]:[]}function ou(t){const e=Kd(t),n=iu(t),r=String(t.type||"paragraph").toLowerCase();if(r==="heading"){const s=Math.min(6,Math.max(1,Number(t.level||1))),l=String(t.text||""),a=Array.isArray(t.runs)?t.runs:null,u=l.trim(),v=`${e}${n}`;if(a&&a.length){const g=Wl(a);return`<h${s}${v}>${g||"<br/>"}</h${s}>`}return u?Oo(s,l,v):v?`<h${s}${v}><br/></h${s}>`:""}if(r==="paragraph"||r==="text"||r==="p"){const s=String(t.text||""),l=Array.isArray(t.runs)?t.runs:null,a=s.trim(),u=`${e}${n}`;if(l&&l.length){const v=Wl(l);return`<p${u}>${v||"<br/>"}</p>`}return a?`<p${u}>${$r(s).replace(/\n/g,"<br/>")}</p>`:u?`<p${u}><br/></p>`:""}if(r==="list"||r==="bullets"||r==="bullet"){let s=!!t.ordered;const l=Array.isArray(t.items)?t.items:[],a=l.length>0;let u=l.length?l.map(S=>String(S??"")):String(t.text||"").split(/\n+/).map(S=>S.trim()).filter(Boolean);if(!u.length&&!a)return"";if(!s){const S=/^\d+[\.\)]\s+/;u.filter(I=>S.test(I)).length===u.length&&(s=!0,u=u.map(I=>I.replace(S,"")))}const v=u.map(S=>{const $=String(S??"");return $.trim()?`<li>${$r($)}</li>`:"<li><br/></li>"}).join(""),g=`${e}${n}`;return s?`<ol${g}>${v}</ol>`:`<ul${g}>${v}</ul>`}if(r==="table"){const s=Yd(t),l=s.caption||"Table",a=s.columns.length?s.columns:["Col 1","Col 2"],u=s.rows.length?s.rows:[["",""]],v=a.map($=>`<th>${_e($)}</th>`).join(""),g=u.map($=>{const I=Array.isArray($)?$:[$];return`<tr>${a.map((B,j)=>`<td>${_e(String(I[j]??""))}</td>`).join("")}</tr>`}).join("");return`<figure class="wa-table"${`${e}${n}`}><figcaption>${_e(l)}</figcaption><table><thead><tr>${v}</tr></thead><tbody>${g}</tbody></table></figure>`}if(r==="figure"){const s=Qd(t),l=s.caption||"??",a=`${e}${n}`,u=s.spec&&typeof s.spec=="object"?s.spec:null,v=u?encodeURIComponent(JSON.stringify(u)):"",g=v?` data-figure-spec="${_e(v)}"`:"";return`<figure class="wa-figure"${a}${g}><div class="wa-figure-box">?</div><figcaption>${_e(l)}</figcaption></figure>`}if(r==="quote"){const s=String(t.text||"").trim();return s?`<blockquote>${$r(s)}</blockquote>`:""}const i=String(t.text||"").trim();return i?Xd(i):""}function Oo(t,e,n=""){const r=$r(e),i=Math.min(6,Math.max(1,Number(t||1)));return`<h${i}${n}>${r}</h${i}>`}function Xd(t){return`<p>${$r(t).replace(/\n/g,"<br/>")}</p>`}function Yd(t){const e={caption:"",columns:[],rows:[]},n=t.table,r=typeof n=="object"&&n?n:t.data,i=typeof r=="object"&&r?r:t,s=String(i.caption||"").trim();e.caption=s;const l=i.columns;Array.isArray(l)&&(e.columns=l.map(u=>String(u)));const a=i.rows;return Array.isArray(a)&&(e.rows=a),e}function Qd(t){const e=t.figure,n=typeof e=="object"&&e?e:null,i=String((n||t).caption||"").trim(),s=n?{...n}:{};return i&&(s.caption=i),{caption:i,spec:s}}function Do(t){return String(t||"").trim().toLowerCase()}function au(t){for(const e of t){const n=String(e.title||"").trim(),r=Number(e.level||0);if(n&&r<=1)return n;const i=Array.isArray(e.children)?e.children:[],s=au(i);if(s)return s}return""}function el(t){for(const e of t)if(String(e.type||"").toLowerCase()==="heading"&&Number(e.level||0)===1){const r=String(e.text||"").trim();if(r)return r}for(const e of t)if(String(e.type||"")==="paragraph"){const n=String(e.text||"").trim();if(n)return n.slice(0,24)}return""}const lu=["摘要","引言","绪论","背景","研究背景","目标","范围","术语","定义","需求","需求分析","总体设计","系统设计","架构设计","详细设计","模块设计","实现","关键技术","应用","方法","数据","分析","讨论","评估","结果","结论","总结","展望","风险","问题","计划","本周工作","下周计划","问题与风险","需协助事项","参考文献","附录","致谢"],Xr=/[。！？!?；;，、]/,Zd=["本文","本研究","本项目","随着","本周","本次","本节","我们","由于","因此","此外","同时","首先","其次","最后"];function Ul(t){const e=String(t||"").trim();if(!e||e.length<=12&&!Xr.test(e))return null;const n=/^(.{1,12})[:：](.+)$/.exec(e);if(n){const l=String(n[1]||"").trim(),a=String(n[2]||"").trim();if(l&&a&&(Xr.test(a)||a.length>=12))return{heading:l.replace(/[：:、\-—\s]+$/g,""),rest:a.replace(/^[：:、\-—\s]+/g,"")}}const r=/^(.{2,10})\s*\1(.+)$/.exec(e);if(r){const l=String(r[1]||"").trim(),a=String(r[2]||"").trim();if(l&&a&&(Xr.test(a)||a.length>=6))return{heading:l.replace(/[：:、\-—\s]+$/g,""),rest:a.replace(/^[：:、\-—\s]+/g,"")}}const i=lu.slice().sort((l,a)=>a.length-l.length);for(const l of i)if(e.startsWith(l)&&e.length>l.length+1){const a=e.slice(l.length).trim().replace(/^[：:、\-—\s]+/g,"");if(a&&(Xr.test(a)||a.length>=12))return{heading:l,rest:a}}for(const l of i){const a=e.indexOf(l);if(a<=0)continue;const u=a+l.length;if(u>10)continue;const v=e.slice(0,u).trim(),g=e.slice(u).trim().replace(/^[：:、\-—\s]+/g,"");if(v&&g&&(Xr.test(g)||g.length>=12))return{heading:v.replace(/[：:、\-—\s]+$/g,""),rest:g}}const s=e.search(/\b\d+(?:\.\d+)+\b/);if(s>0&&s<=12){const l=e.slice(0,s).trim(),a=e.slice(s).trim().replace(/^[：:、\-—\s]+/g,"");if(l&&a&&(Xr.test(a)||a.length>=12))return{heading:l.replace(/[：:、\-—\s]+$/g,""),rest:a}}for(const l of Zd){const a=e.indexOf(l);if(a>0&&a<=10){const u=e.slice(0,a).trim(),v=e.slice(a).trim().replace(/^[：:、\-—\s]+/g,"");if(u&&v&&v.length>=6&&!Xr.test(u))return{heading:u.replace(/[：:、\-—\s]+$/g,""),rest:v}}}return null}function tv(t,e){const n=String(e).trim()||"自动生成文档",r=[],i=[];let s=[];const l=()=>{if(!s.length)return;const a={id:Eo(),title:n,level:1,blocks:s,children:[]};r.push(a),i.push({level:1,node:a}),s=[]};for(const a of t){if(String(a.type||"").toLowerCase()==="heading"){const g=Math.min(6,Math.max(1,Number(a.level||1))),S=String(a.text||"").trim()||"章节",$={id:Eo(),title:S,level:g,blocks:[],children:[]};for(s.length&&i.length===0&&l();i.length&&i[i.length-1].level>=g;)i.pop();i.length?i[i.length-1].node.children.push($):r.push($),i.push({level:g,node:$});continue}const v=ev(a);v&&(i.length?i[i.length-1].node.blocks.push(v):s.push(v))}return s.length&&!r.length&&r.push({id:Eo(),title:n,level:1,blocks:s,children:[]}),{title:n,sections:r}}function ev(t){const e=String(t.type||"paragraph").toLowerCase(),r=String(t.id||"").trim()||Eo();if(e==="paragraph"){const s=String(t.text||"").trim();return s?{id:r,type:"paragraph",text:s}:null}if(e==="list"){const s=Array.isArray(t.items)?t.items.map(a=>String(a||"").trim()).filter(Boolean):[];if(!s.length)return null;const l=!!t.ordered;return{id:r,type:"list",items:s,ordered:l}}if(e==="table")return{id:r,type:"table",table:t.table||{}};if(e==="figure")return{id:r,type:"figure",figure:t.figure||{}};const i=String(t.text||"").trim();return i?{id:r,type:"paragraph",text:i}:null}function Eo(){return typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID().replace(/-/g,""):`b${Math.random().toString(16).slice(2)}${Date.now().toString(16)}`}function cu(t){const e=String(t.title||"").trim();if(e)return e;const n=Array.isArray(t.sections)?t.sections:[],r=au(n);if(r)return r;if(n.length===1){const s=n[0],l=Number(s.level||0),a=String(s.title||"").trim();if(a&&l<=1)return a}const i=Array.isArray(t.blocks)?t.blocks:[];return el(i)}function uu(t){const e=[];let n=[],r=!1;const i=()=>{n.length>=4?e.push(n.join("")):e.push(...n),n=[]};for(const s of t){const l=s.trim();if(!l){i(),r||(e.push(""),r=!0);continue}r=!1;const a=l.length<=1,u=/[\u4e00-\u9fa5A-Za-z0-9\.\-\u3000-\u303F]/.test(l);if(a&&u){n.push(l);continue}i(),e.push(s)}return i(),e}function $r(t){let e=_e(t);return e=e.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/\*(.+?)\*/g,"<em>$1</em>"),e=e.replace(/~~(.+?)~~/g,"<del>$1</del>"),e=e.replace(/==(.+?)==/g,"<mark>$1</mark>"),e=e.replace(/\+\+(.+?)\+\+/g,"<u>$1</u>"),e=e.replace(/\[(.+?)\]\((.+?)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>'),e}function nv(t){const e=[],n=String(t.color||"").trim();(/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(n)||n.startsWith("rgb("))&&e.push(`color:${_e(n)}`);const r=String(t.background||"").trim();(/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(r)||r.startsWith("rgb("))&&e.push(`background-color:${_e(r)}`);const i=String(t.font||"").trim();i&&i.length<80&&e.push(`font-family:${_e(i)}`);const s=String(t.size||"").trim();return/^\d+(\.\d+)?(px|pt|em|rem)?$/.test(s)&&e.push(`font-size:${s}`),e.length?` style="${e.join(";")}"`:""}function Wl(t){const e=[];return t.forEach(n=>{const r=String(n.text||"");if(!r)return;let i=_e(r).replace(/\n/g,"<br/>");n.bold&&(i=`<strong>${i}</strong>`),n.italic&&(i=`<em>${i}</em>`),n.underline&&(i=`<u>${i}</u>`),n.strike&&(i=`<del>${i}</del>`);const s=String(n.link||"").trim();s&&(i=`<a href="${_e(s)}" target="_blank" rel="noopener">${i}</a>`);const l=nv(n);l&&(i=`<span${l}>${i}</span>`),e.push(i)}),e.join("")}function _e(t){return String(t||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var rv=V('<button class="dropdown-item svelte-1ctqrjb"> </button>'),iv=V('<div class="dropdown-panel svelte-1ctqrjb"></div>'),sv=V("<option> </option>"),ov=V('<button class="color-item svelte-1ctqrjb"></button>'),av=V('<div class="dropdown-panel color-grid svelte-1ctqrjb"></div>'),lv=V('<button class="color-item svelte-1ctqrjb"></button>'),cv=V('<div class="dropdown-panel color-grid svelte-1ctqrjb"></div>'),uv=V('<button class="dropdown-item svelte-1ctqrjb"> </button>'),fv=V('<div class="dropdown-panel svelte-1ctqrjb"></div>'),dv=V('<div class="dropdown-panel svelte-1ctqrjb"><button class="dropdown-item svelte-1ctqrjb">插入表格</button> <button class="dropdown-item svelte-1ctqrjb">合并单元格</button> <button class="dropdown-item svelte-1ctqrjb">插入行</button> <button class="dropdown-item svelte-1ctqrjb">插入列</button> <button class="dropdown-item svelte-1ctqrjb">删除行</button> <button class="dropdown-item svelte-1ctqrjb">删除列</button></div>'),vv=V('<div class="panel-header svelte-1ctqrjb"><div class="panel-title">正文编辑</div> <div class="editor-stats svelte-1ctqrjb"><span> </span> <span>·</span> <span> </span></div></div> <div class="extended-toolbar svelte-1ctqrjb"><div class="toolbar-group svelte-1ctqrjb"><button class="tool-btn svelte-1ctqrjb" title="字体"><span style="font-family: serif;">A</span></button> <!></div> <div class="toolbar-group svelte-1ctqrjb"><select class="tool-select svelte-1ctqrjb"><option>字号</option><!></select></div> <div class="toolbar-group svelte-1ctqrjb"><button class="tool-btn svelte-1ctqrjb" title="文字颜色"><span style="color: #FF0000;">A</span></button> <!></div> <div class="toolbar-group svelte-1ctqrjb"><button class="tool-btn svelte-1ctqrjb" title="背景颜色"><span style="background: #FFFF00;">█</span></button> <!></div> <span class="separator svelte-1ctqrjb"></span> <button class="tool-btn svelte-1ctqrjb" title="左对齐">≡</button> <button class="tool-btn svelte-1ctqrjb" title="居中">≡</button> <button class="tool-btn svelte-1ctqrjb" title="右对齐">≡</button> <button class="tool-btn svelte-1ctqrjb" title="两端对齐">≡</button> <span class="separator svelte-1ctqrjb"></span> <button class="tool-btn svelte-1ctqrjb" title="上标">x²</button> <button class="tool-btn svelte-1ctqrjb" title="下标">x₂</button> <button class="tool-btn svelte-1ctqrjb" title="水平线">—</button> <span class="separator svelte-1ctqrjb"></span> <div class="toolbar-group svelte-1ctqrjb"><button class="tool-btn svelte-1ctqrjb" title="行距">≣</button> <!></div> <button class="tool-btn svelte-1ctqrjb" title="首行缩进">¶</button> <button class="tool-btn svelte-1ctqrjb" title="段间距">⇕</button> <span class="separator svelte-1ctqrjb"></span> <button class="tool-btn svelte-1ctqrjb" title="行内公式">𝑓(𝑥)</button> <button class="tool-btn svelte-1ctqrjb" title="公式块">∫</button> <span class="separator svelte-1ctqrjb"></span> <button class="tool-btn svelte-1ctqrjb" title="插入脚注">※</button> <button class="tool-btn svelte-1ctqrjb" title="生成目录">☰</button> <span class="separator svelte-1ctqrjb"></span> <div class="toolbar-group svelte-1ctqrjb"><button class="tool-btn svelte-1ctqrjb" title="表格">⊞</button> <!></div></div>',1),pv=V('<div class="block-marquee svelte-1ctqrjb" aria-hidden="true"></div>'),hv=V('<div class="find-replace-panel svelte-1ctqrjb"><div class="find-replace-row svelte-1ctqrjb"><input type="text" placeholder="查找..." class="svelte-1ctqrjb"/> <button class="btn-small svelte-1ctqrjb">下一个</button> <button class="btn-small svelte-1ctqrjb">✕</button></div> <div class="find-replace-row svelte-1ctqrjb"><input type="text" placeholder="替换为..." class="svelte-1ctqrjb"/> <button class="btn-small svelte-1ctqrjb">替换</button> <button class="btn-small svelte-1ctqrjb">全部替换</button></div></div>'),gv=V('<div><!> <div class="editable svelte-1ctqrjb" contenteditable="false" role="region" aria-label="文档编辑区"></div> <!> <!></div>');function fu(t,e){if(new.target)return tr({component:fu,...t});Bn(e,!1);const n=()=>ke(Ve,"$sourceText",s),r=()=>ke(We,"$docIr",s),i=()=>ke(tl,"$wordCount",s),[s,l]=ds();let a=Q(null),u="",v=Q("text"),g=null,S=null,$=null,I=Sn(e,"showToolbar",12,!0),N=Sn(e,"paper",12,!0);const B=Ka();let j=null,U=!1,ft=null,tt="",ot=null,K=[],bt=[],rt="",F=null,ut=Q(!1),W=Q({left:0,top:0,width:0,height:0}),lt=!1;function dt(c){if(!o(a))return;const d=!String(c||"").trim();Yr(a,o(a).dataset.empty=d?"1":"0")}function Nt(){if(!o(a))return;const c=String(n()||""),d=r(),m=!!(d&&typeof d=="object"),x=!m,E=m?`doc:${Ot(d)}`:`text:${c}`;if(j&&o(a).contains(j)&&E!==u){ft=E;return}E!==u&&(g&&clearTimeout(g),g=setTimeout(()=>{if(Yr(a,o(a).innerHTML=Pd(c,d,x)),_(v,x?"text":"doc"),u=E,ft=null,dt(c),Zt(),An(),tt){const D=o(a).querySelector(`[data-block-id="${CSS.escape(tt)}"]`);tt="",D&&D.focus()}no(),Ii(),Ko()},100))}function Ot(c){try{return JSON.stringify(c)||""}catch{return""}}function At(c){c.setAttribute("contenteditable","true"),c.setAttribute("spellcheck","false"),c.dataset.waEdit="1"}function Zt(){if(!o(a))return;const c=o(a).querySelector(".wa-title");c&&(c.dataset.docTitle="1",At(c)),o(a).querySelectorAll("[data-section-id]").forEach(d=>{At(d)}),o(a).querySelectorAll("[data-block-id]").forEach(d=>{const m=d,x=m.tagName.toLowerCase();if(x==="figure"||x==="table"){m.setAttribute("contenteditable","false");return}At(m)})}function Jt(c){if(!c||!(c instanceof HTMLElement)||!o(a))return null;const d=c.closest('[data-wa-edit="1"]');return!d||!o(a).contains(d)?null:d}function Dt(c){let d=String(c||"").replace(/\r/g,"");return d=d.replace(/[ \t]+/g," "),d=d.replace(/[ \t]*\n[ \t]*/g,`
`),d=d.replace(/\n{3,}/g,`

`),d.trim()}function Pt(c){if(c.nodeType===Node.TEXT_NODE)return c.textContent||"";if(!(c instanceof HTMLElement))return"";const d=c.tagName.toLowerCase();if(d==="br")return`
`;if(d==="strong"||d==="b")return`**${kt(c)}**`;if(d==="em"||d==="i")return`*${kt(c)}*`;if(d==="u")return`++${kt(c)}++`;if(d==="del"||d==="s")return`~~${kt(c)}~~`;if(d==="mark")return`==${kt(c)}==`;if(d==="code")return"`"+(c.textContent||"")+"`";if(d==="a"){const m=c.getAttribute("href")||"",x=kt(c);return m?`[${x}](${m})`:x}return kt(c)}function kt(c){const d=[];return c.childNodes.forEach(m=>d.push(Pt(m))),Dt(d.join(""))}function oe(c){if(c.nodeType===Node.TEXT_NODE)return c.textContent||"";if(!(c instanceof HTMLElement))return"";if(c.tagName.toLowerCase()==="br")return`
`;const m=[];return c.childNodes.forEach(x=>m.push(oe(x))),m.join("")}function ue(c){const d=[];return c.childNodes.forEach(m=>d.push(oe(m))),d.join("")}function ge(c){const d=document.createElement("div");return d.appendChild(c),kt(d)}function et(c){const d=window.getSelection();if(!d||d.rangeCount===0)return null;const m=d.getRangeAt(0);if(!c.contains(m.startContainer))return null;const x=m.cloneRange();x.selectNodeContents(c),x.setEnd(m.startContainer,m.startOffset);const E=m.cloneRange();E.selectNodeContents(c),E.setStart(m.startContainer,m.startOffset);const D=ge(x.cloneContents()),R=ge(E.cloneContents());return{before:D,after:R}}function nt(c){if(c.nodeType===Node.TEXT_NODE)return(c.textContent||"").length;if(!(c instanceof HTMLElement))return 0;if(c.tagName.toLowerCase()==="br")return 1;let m=0;return c.childNodes.forEach(x=>{m+=nt(x)}),m}function St(c){const d=window.getSelection();if(!d||d.rangeCount===0)return null;const m=d.getRangeAt(0),x=m.startContainer;if(!c.contains(x))return null;let E=0,D=!1;const R=H=>{if(!D){if(H===x){if(H.nodeType===Node.TEXT_NODE)E+=m.startOffset;else if(H instanceof HTMLElement){const Y=Array.from(H.childNodes);for(let M=0;M<m.startOffset;M++)E+=nt(Y[M])}D=!0;return}if(H.nodeType===Node.TEXT_NODE||H instanceof HTMLElement&&H.tagName.toLowerCase()==="br"){E+=nt(H);return}H.childNodes.forEach(Y=>R(Y))}};return R(c),E}function Lt(c){const d=c.style,m={},x=d.textAlign||c.getAttribute("align")||"";x&&(m.align=x);const E=d.lineHeight;E&&(m.lineHeight=E);const D=d.textIndent;D&&(m.indent=D);const R=d.marginTop;R&&(m.marginTop=R);const H=d.marginBottom;H&&(m.marginBottom=H);const Y=d.fontFamily;Y&&(m.fontFamily=Y);const M=d.fontSize;M&&(m.fontSize=M);const z=d.color;z&&(m.color=z);const X=d.backgroundColor;return X&&(m.background=X),Object.keys(m).length?m:null}function Ct(c){const d=[],m=(M,z)=>{M&&d.push({text:M,bold:z.bold,italic:z.italic,underline:z.underline,strike:z.strike,color:z.color,background:z.background,font:z.font,size:z.size,link:z.link})},x=M=>{const z=String(M||"").trim();return z?z.split(",")[0].replace(/["']/g,"").trim():""},E=(M,z)=>{if(M.nodeType===Node.TEXT_NODE){m(M.textContent||"",z);return}if(!(M instanceof HTMLElement))return;const X=M.tagName.toLowerCase();if(X==="br"){m(`
`,z);return}const G={...z};if((X==="strong"||X==="b")&&(G.bold=!0),(X==="em"||X==="i")&&(G.italic=!0),X==="u"&&(G.underline=!0),(X==="s"||X==="del"||X==="strike")&&(G.strike=!0),X==="a"){const at=M.getAttribute("href")||"";at&&(G.link=at)}if(X==="font"){const at=M.getAttribute("color");at&&(G.color=at);const gt=M.getAttribute("face");gt&&(G.font=x(gt));const Mt=M.getAttribute("size");Mt&&(G.size=String(Mt))}const it=M.style;if(it){it.color&&(G.color=it.color),it.backgroundColor&&(G.background=it.backgroundColor),it.fontFamily&&(G.font=x(it.fontFamily)),it.fontSize&&(G.size=it.fontSize);const at=it.textDecoration;at&&at.includes("underline")&&(G.underline=!0),at&&at.includes("line-through")&&(G.strike=!0)}M.childNodes.forEach(at=>E(at,G))};E(c,{});const D=[],R=M=>[M.bold?"b":"",M.italic?"i":"",M.underline?"u":"",M.strike?"s":"",M.color||"",M.background||"",M.font||"",M.size||"",M.link||""].join("|");d.forEach(M=>{const z=D[D.length-1];z&&R(z)===R(M)?z.text+=M.text:D.push({...M})});const H=Dt(D.map(M=>M.text).join("")),Y=D.some(M=>Object.keys(M).some(z=>z!=="text"&&M[z]));return{text:H,runs:Y?D:null}}function vn(c){if(c.dataset.docTitle==="1")return{kind:"title",text:kt(c)};const d=String(c.dataset.sectionId||"").trim();if(d)return{kind:"section",id:d,text:kt(c),style:Lt(c)};const m=String(c.dataset.blockId||"").trim();if(!m)return null;const x=c.tagName.toLowerCase();if(x==="ul"||x==="ol"){const M={type:"list",items:Array.from(c.querySelectorAll(":scope > li")).map(X=>Dt(kt(X))),ordered:x==="ol"},z=Lt(c);return z&&(M.style=z),{kind:"block",id:m,payload:M}}if(/^h[1-6]$/.test(x)){const Y=Number(x.slice(1)),M=Ct(c),z=M.text.replace(/\n+/g," ").trim(),X={type:"heading",level:Y,text:z};M.runs&&(X.runs=M.runs);const G=Lt(c);return G&&(X.style=G),{kind:"block",id:m,payload:X}}const E=Ct(c),R={type:"paragraph",text:E.text};E.runs&&(R.runs=E.runs);const H=Lt(c);return H&&(R.style=H),{kind:"block",id:m,payload:R}}function xn(c){S&&clearTimeout(S),S=setTimeout(()=>{const d=Mo(c)||"";Ve.set(d),dt(d),jd(d)},180)}function ie(c){We.set(c),Be.set(!1),u=`doc:${Ot(c)}`,xn(c)}function Pe(c,d){const m=String(d||"").trim()||"自动生成文档",x=String(c.title||"").trim();let E=!1;m!==x&&(E=!0);const D=Y=>{let M=!1;const z=Y.map(X=>{let G=!1,it=X;String(X.title||"").trim()===x&&(it={...X,title:m},G=!0);const at=Array.isArray(X.children)?X.children:[];if(at.length){const gt=D(at);gt!==at&&(it={...it,children:gt},G=!0)}return G&&(M=!0),it});return M&&(E=!0),M?z:Y},R=Array.isArray(c.sections)?c.sections:[],H=D(R);return E?{...c,title:m,sections:H}:null}function te(c,d,m,x){const E=String(m||"").trim()||"章节";let D=!1;const R=M=>{let z=!1;const X=M.map(G=>{let it=!1,at=G;String(G.id||"")===d&&(at={...G,title:E},x&&Object.keys(x).length&&(at={...at,style:x}),it=!0);const gt=Array.isArray(G.children)?G.children:[];if(gt.length){const Mt=R(gt);Mt!==gt&&(at={...at,children:Mt},it=!0)}return it&&(z=!0),at});return z&&(D=!0),z?X:M},H=Array.isArray(c.sections)?c.sections:[],Y=R(H);return D?{...c,sections:Y}:null}function Ae(c,d,m){let x=!1;const E=H=>{let Y=!1;const M=H.map(z=>{let X=!1,G=z;const it=Array.isArray(z.blocks)?z.blocks:[];if(it.length){const gt=it.findIndex(Mt=>String(Mt.id||"")===d);if(gt>=0){const Mt=it[gt]||{},Bt={...Mt,...m,id:Mt.id||d},Je=it.slice();Je[gt]=Bt,G={...G,blocks:Je},X=!0}}const at=Array.isArray(z.children)?z.children:[];if(at.length){const gt=E(at);gt!==at&&(G={...G,children:gt},X=!0)}return X&&(Y=!0),G});return Y&&(x=!0),Y?M:H},D=Array.isArray(c.sections)?c.sections:[],R=E(D);return x?{...c,sections:R}:null}function kn(c,d,m){let x=!1;const E=H=>{let Y=!1;const M=H.map(z=>{let X=!1,G=z;const it=Array.isArray(z.blocks)?z.blocks:[];if(it.length){const gt=it.findIndex(Mt=>String(Mt.id||"")===d);if(gt>=0){const Mt=it.slice();Mt.splice(gt+1,0,m),G={...G,blocks:Mt},X=!0}}const at=Array.isArray(z.children)?z.children:[];if(at.length){const gt=E(at);gt!==at&&(G={...G,children:gt},X=!0)}return X&&(Y=!0),G});return Y&&(x=!0),Y?M:H},D=Array.isArray(c.sections)?c.sections:[],R=E(D);return x?{...c,sections:R}:null}function rr(c,d,m){let x=!1;const E=H=>{let Y=!1;const M=H.map(z=>{let X=!1,G=z;const it=Array.isArray(z.blocks)?z.blocks:[];if(it.length){const gt=it.findIndex(Mt=>String(Mt.id||"")===d);if(gt>=0){const Mt=it.slice();Mt.splice(gt,0,m),G={...G,blocks:Mt},X=!0}}const at=Array.isArray(z.children)?z.children:[];if(at.length){const gt=E(at);gt!==at&&(G={...G,children:gt},X=!0)}return X&&(Y=!0),G});return Y&&(x=!0),Y?M:H},D=Array.isArray(c.sections)?c.sections:[],R=E(D);return x?{...c,sections:R}:null}function gr(c,d,m){let x=!1;const E=M=>{const z=String(M.type||"paragraph").toLowerCase();if(z==="list"){const X=Array.isArray(M.items)?M.items:[],G=X.map(it=>String(it??"").replace(d,m));return G.join("")!==X.join("")?(x=!0,{...M,items:G}):M}if(z==="table"){const X=typeof M.table=="object"&&M.table?M.table:null;if(X&&typeof X.caption=="string"){const G=String(X.caption||"").replace(d,m);if(G!==X.caption)return x=!0,{...M,table:{...X,caption:G}}}return M}if(z==="figure"){const X=typeof M.figure=="object"&&M.figure?M.figure:null;if(X&&typeof X.caption=="string"){const G=String(X.caption||"").replace(d,m);if(G!==X.caption)return x=!0,{...M,figure:{...X,caption:G}}}return M}if(typeof M.text=="string"){const X=String(M.text||"").replace(d,m);if(X!==M.text)return x=!0,{...M,text:X}}return M},D=M=>{let z=!1;const X=M.map(G=>{let it=!1,at=G;if(typeof G.title=="string"){const Bt=String(G.title||"").replace(d,m);Bt!==G.title&&(at={...at,title:Bt},it=!0,x=!0)}const gt=Array.isArray(G.blocks)?G.blocks:[];if(gt.length){const Bt=gt.map(Je=>E(Je));Bt.some((Je,Xt)=>Je!==gt[Xt])&&(at={...at,blocks:Bt},it=!0)}const Mt=Array.isArray(G.children)?G.children:[];if(Mt.length){const Bt=D(Mt);Bt!==Mt&&(at={...at,children:Bt},it=!0)}return it&&(z=!0),it?at:G});return z?X:M},R={...c};if(typeof R.title=="string"){const M=String(R.title||"").replace(d,m);M!==R.title&&(R.title=M,x=!0)}const H=Array.isArray(R.sections)?R.sections:[],Y=D(H);return Y!==H&&(R.sections=Y),x?R:null}function Ye(c,d=160){ot&&clearTimeout(ot),ot=setTimeout(()=>{an(c)},d)}function an(c){const d=r();if(!d||typeof d!="object")return;const m=vn(c);if(!m)return;let x=null;m.kind==="title"?x=Pe(d,String(m.text||"")):m.kind==="section"?x=te(d,String(m.id||""),String(m.text||""),m.style||null):m.kind==="block"&&(x=Ae(d,String(m.id||""),m.payload||{})),x&&ie(x)}function $n(){return o(a)?Array.from(o(a).querySelectorAll("[data-block-id]")):[]}function zt(c){return String((c==null?void 0:c.dataset.blockId)||"").trim()}function Tn(c){return!o(a)||!c?null:o(a).querySelector(`[data-block-id="${CSS.escape(c)}"]`)}function En(c){const d=new Set,m=[];for(const x of c){const E=String(x||"").trim();!E||d.has(E)||(d.add(E),m.push(E))}return m}function qe(c){const d=new Set(En(c)),m=[];for(const x of $n()){const E=zt(x);E&&d.has(E)&&m.push(E)}return m}function pn(){const c=bt.map(D=>{const R=zt(D),H=ue(D);return{id:R,text:H,style:Lt(D)||{}}});if(!c.length){B("blockselect",{blockId:"",blockIds:[],blocks:[],text:"",rect:null,style:{}});return}const d=bt[0],m=zt(d),x=ue(d),E=d.getBoundingClientRect();B("blockselect",{blockId:m,blockIds:K.slice(),blocks:c,text:x,rect:{top:E.top,left:E.left,width:E.width,height:E.height},style:Lt(d)||{}})}function me(c,d){for(const m of bt)m.classList.remove("wa-block-selected");K=qe(c),bt=K.map(m=>Tn(m)).filter(m=>!!m);for(const m of bt)m.classList.add("wa-block-selected");d&&K.includes(d)?rt=d:K.length===1?rt=K[0]:K.length||(rt=""),pn()}function hn(){me([])}function An(){!o(a)||!K.length||me(K,rt)}function Rn(c){const m=$n().map(Y=>zt(Y)).filter(Boolean),x=rt&&m.includes(rt)?rt:m[0]||"",E=m.indexOf(x),D=m.indexOf(c);if(E<0||D<0){me([c],c);return}const[R,H]=E<=D?[E,D]:[D,E];me(m.slice(R,H+1),x)}function be(c){const d=K.includes(c),m=d?K.filter(x=>x!==c):[...K,c];me(m,d?rt:c)}function Ce(c,d){const m=Math.min(c.x,d.x),x=Math.min(c.y,d.y),E=Math.abs(c.x-d.x),D=Math.abs(c.y-d.y);return{left:m,top:x,width:E,height:D}}function Pn(c,d){const m=c.left+c.width,x=c.top+c.height,E=d.left+d.width,D=d.top+d.height;return!(m<d.left||E<c.left||x<d.top||D<c.top)}function ln(c){const d=[];for(const m of $n()){const x=zt(m);x&&Pn(c,m.getBoundingClientRect())&&d.push(x)}return d}function Oe(c){var E;if(!F)return;const d={x:c.clientX,y:c.clientY},m=Ce(F,d);if(!o(ut)){if(m.width<10&&m.height<10)return;_(ut,!0),lt=!0,(E=window.getSelection())==null||E.removeAllRanges()}c.preventDefault(),_(W,m);const x=ln(m);x.length?me(x,x[0]):me([])}function ae(){F=null,_(ut,!1),_(W,{left:0,top:0,width:0,height:0}),window.removeEventListener("mousemove",Oe),window.removeEventListener("mouseup",je)}function je(){ae()}function qn(c){if(!o(a)||c.button!==0)return;const d=c.target;!d||!o(a).contains(d)||d.closest('a,button,input,textarea,select,[data-wa-no-marquee="1"]')||(F={x:c.clientX,y:c.clientY},_(ut,!1),_(W,{left:c.clientX,top:c.clientY,width:0,height:0}),window.addEventListener("mousemove",Oe),window.addEventListener("mouseup",je))}function Cn(c){if(lt){lt=!1;return}const d=c.target;if(!d||!o(a))return;const m=d.closest("[data-block-id]");if(!m||!o(a).contains(m)){hn();return}const x=zt(m);if(!x){hn();return}const E=c.ctrlKey||c.metaKey;if(c.shiftKey){Rn(x);return}if(E){be(x);return}me([x],x)}function ir(c){const d=Jt(c.target);d&&(j=d,String(d.dataset.blockId||d.dataset.sectionId||d.dataset.docTitle||""))}function li(c){const d=Jt(c.target);d&&(an(d),j===d&&(j=null),ft&&ft!==u&&Nt())}function Ci(c){if(U)return;const d=Jt(c.target);d&&Ye(d)}function Kt(){U=!0}function $t(c){U=!1,Ci(c)}function le(){return typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID().replace(/-/g,""):`b${Math.random().toString(16).slice(2)}${Date.now().toString(16)}`}function cn(){if(!o(a))return null;const c=document.activeElement;if(c&&o(a).contains(c)&&c.isContentEditable)return c;const d=bt[0]||null;if(d&&d.isContentEditable)return d.focus(),d;const m=o(a).querySelector('[data-wa-edit="1"]');return m?(m.focus(),m):null}function yt(c){if(cn()){if(c==="bold")return document.execCommand("bold");if(c==="italic")return document.execCommand("italic");if(c==="underline")return document.execCommand("underline");if(c==="strikethrough")return document.execCommand("strikeThrough");if(c==="superscript")return document.execCommand("superscript");if(c==="subscript")return document.execCommand("subscript");if(c==="heading1")return document.execCommand("formatBlock",!1,"H1");if(c==="heading2")return document.execCommand("formatBlock",!1,"H2");if(c==="heading3")return document.execCommand("formatBlock",!1,"H3");if(c==="paragraph")return document.execCommand("formatBlock",!1,"P");if(c==="list-bullet")return document.execCommand("insertUnorderedList");if(c==="list-number")return document.execCommand("insertOrderedList");if(c==="indent")return document.execCommand("indent");if(c==="outdent")return document.execCommand("outdent");if(c==="quote")return document.execCommand("formatBlock",!1,"BLOCKQUOTE");if(c==="align-left")return document.execCommand("justifyLeft");if(c==="align-center")return document.execCommand("justifyCenter");if(c==="align-right")return document.execCommand("justifyRight");if(c==="align-justify")return document.execCommand("justifyFull");if(c.startsWith("line-height:")){const d=c.slice(12),m=window.getSelection();if(m&&m.rangeCount){let E=m.getRangeAt(0).commonAncestorContainer;if(E.nodeType===Node.TEXT_NODE&&(E=E.parentElement),E instanceof HTMLElement){let D=E.closest("p, div, h1, h2, h3, blockquote");D instanceof HTMLElement&&(D.style.lineHeight=d)}}return}if(c.startsWith("margin:")){const d=c.slice(7),m=window.getSelection();if(m&&m.rangeCount){let E=m.getRangeAt(0).commonAncestorContainer;if(E.nodeType===Node.TEXT_NODE&&(E=E.parentElement),E instanceof HTMLElement){let D=E.closest("p, div, h1, h2, h3");D instanceof HTMLElement&&(D.style.margin=d)}}return}if(c==="indent-first"){const d=window.getSelection();if(d&&d.rangeCount){let x=d.getRangeAt(0).commonAncestorContainer;if(x.nodeType===Node.TEXT_NODE&&(x=x.parentElement),x instanceof HTMLElement){let E=x.closest("p, div");E instanceof HTMLElement&&(E.style.textIndent="2em")}}return}if(c.startsWith("color:")){const d=c.slice(6);return document.execCommand("foreColor",!1,d)}if(c.startsWith("bgcolor:")){const d=c.slice(8);return document.execCommand("hiliteColor",!1,d)}if(c.startsWith("font:")){const d=c.slice(5);return document.execCommand("fontName",!1,d)}if(c.startsWith("size:")){const d=c.slice(5),m=window.getSelection();if(m&&m.rangeCount){const x=m.getRangeAt(0),E=document.createElement("span");E.style.fontSize=d+"px",x.surroundContents(E)}return}if(c==="code"){const d=window.getSelection(),m=d&&d.rangeCount?d.getRangeAt(0).toString():"";return document.execCommand("insertHTML",!1,`<pre><code>${hs(m||"")}</code></pre>`)}if(c==="image"){const d=document.createElement("input");d.type="file",d.accept="image/*",d.onchange=async m=>{var D;const x=(D=m.target.files)==null?void 0:D[0];if(!x)return;const E=new FileReader;E.onload=R=>{var Y;const H=(Y=R.target)==null?void 0:Y.result;document.execCommand("insertHTML",!1,`<img src="${H}" alt="图片" style="max-width:100%;height:auto;" />`)},E.readAsDataURL(x)},d.click();return}if(c==="table"){const d=prompt("行数：","3"),m=prompt("列数：","3");if(!d||!m)return;let x='<table style="border-collapse:collapse;width:100%;margin:10px 0;">';for(let E=0;E<parseInt(d);E++){x+="<tr>";for(let D=0;D<parseInt(m);D++)x+='<td style="border:1px solid #ccc;padding:8px;min-width:80px;">　</td>';x+="</tr>"}return x+="</table>",document.execCommand("insertHTML",!1,x)}if(c==="link"){const d=prompt("请输入链接地址：","https://");d&&document.execCommand("createLink",!1,d);return}if(c==="hr")return document.execCommand("insertHTML",!1,'<hr style="border:none;border-top:1px solid #ddd;margin:16px 0;" />');if(c==="math-inline"){const d=prompt("输入行内公式（LaTeX）：","x^2 + y^2 = r^2");d&&document.execCommand("insertHTML",!1,`<span class="math-inline" data-latex="${hs(d)}">$${d}$</span>`);return}if(c==="math-block"){const d=prompt("输入公式块（LaTeX）：","\\int_{-\\infty}^{\\infty} e^{-x^2} dx = \\sqrt{\\pi}");d&&document.execCommand("insertHTML",!1,`<div class="math-block" data-latex="${hs(d)}">$$${d}$$</div>`);return}if(c==="footnote"){const d=prompt("脚注内容：");if(!d)return;const m="fn-"+Date.now(),x=`<sup><a href="#${m}" id="ref-${m}" style="color:#a5722a;text-decoration:none;">[${Zs()}]</a></sup>`;document.execCommand("insertHTML",!1,x),to(m,d,Zs());return}if(c==="toc"){const d=eo();document.execCommand("insertHTML",!1,d);return}if(c==="undo")return Id();if(c==="redo")return Nd();if(c==="clear-format")return document.execCommand("removeFormat")}}function He(c){const d=c.ctrlKey||c.metaKey;if(d&&c.key==="b"&&(c.preventDefault(),yt("bold")),d&&c.key==="i"&&(c.preventDefault(),yt("italic")),d&&c.key==="u"&&(c.preventDefault(),yt("underline")),d&&c.shiftKey&&c.key==="X"&&(c.preventDefault(),yt("strikethrough")),d&&c.key==="z"&&(c.preventDefault(),yt("undo")),d&&c.key==="y"&&(c.preventDefault(),yt("redo")),d&&c.key==="k"&&(c.preventDefault(),yt("link")),d&&c.key==="f"&&(c.preventDefault(),_(fe,!0)),c.key==="Enter"&&!c.shiftKey){const m=Jt(c.target);if(m&&m.dataset.blockId){const x=m.tagName.toLowerCase();if(x==="ul"||x==="ol"){c.preventDefault();const E=r();if(!E||typeof E!="object")return;const D=String(m.dataset.blockId),R=window.getSelection(),H=R==null?void 0:R.anchorNode,Y=H instanceof HTMLElement?H:H==null?void 0:H.parentElement,M=Y?Y.closest("li"):null;if(!M||!m.contains(M))return;const z=Array.from(m.querySelectorAll(":scope > li")),X=z.indexOf(M);if(X<0)return;let G="",it="";const at=et(M);if(at)G=at.before,it=at.after;else{const Xt=ue(M),Ht=St(M),gn=Ht==null?Xt.length:Math.max(0,Math.min(Xt.length,Ht));G=Xt.slice(0,gn),it=Xt.slice(gn)}const gt=Dt(G),Mt=Dt(it);if(!gt&&!Mt){const Xt=z.map((Ht,gn)=>gn===X?null:Dt(kt(Ht))).filter(Ht=>Ht!==null);if(Xt.length){const Ht=Ae(E,D,{type:"list",items:Xt,ordered:x==="ol"});if(Ht){const gn={id:le(),type:"paragraph",text:""},jr=kn(Ht,D,gn);if(jr){tt=String(gn.id||""),ie(jr);return}ie(Ht)}}else{const Ht=Ae(E,D,{type:"paragraph",text:"",items:[],ordered:!1});Ht&&(tt=D,ie(Ht))}return}const Bt=z.map((Xt,Ht)=>Ht===X?gt:Dt(kt(Xt)));Bt.splice(X+1,0,Mt);const Je=Ae(E,D,{type:"list",items:Bt,ordered:x==="ol"});Je&&(tt=D,ie(Je));return}if(x==="p"||/^h[1-6]$/.test(x)){c.preventDefault();const E=r();if(!E||typeof E!="object")return;const D=String(m.dataset.blockId),R=ue(m),H=St(m),Y=H==null?R.length:Math.max(0,Math.min(R.length,H)),M=R.slice(0,Y),z=R.slice(Y),X=Dt(M),G=Dt(z),it=Lt(m),at=/^h[1-6]$/.test(x);if(Y===0){const Xt={id:le(),type:"paragraph",text:""};it&&x==="p"&&(Xt.style=it);const Ht=rr(E,D,Xt);Ht&&(tt=String(Xt.id||""),ie(Ht));return}if(Y>=R.length){const Xt={id:le(),type:"paragraph",text:""};it&&x==="p"&&(Xt.style=it);const Ht=kn(E,D,Xt);Ht&&(tt=String(Xt.id||""),ie(Ht));return}let gt=null;if(at){const Ht={type:"heading",level:Number(x.slice(1)),text:X.replace(/\n+/g," ").trim()};it&&(Ht.style=it),gt=Ae(E,D,Ht)}else{const Xt={type:"paragraph",text:X};it&&(Xt.style=it),gt=Ae(E,D,Xt)}const Mt={id:le(),type:"paragraph",text:G};!at&&it&&(Mt.style=it);const Je=kn(gt||E,D,Mt);Je&&(tt=String(Mt.id||""),ie(Je))}}}}let fe=Q(!1),Qe=Q(""),jn=Q(""),ye=Q(!1),un=Q(!1),de=Q(!1),we=Q(!1),Wt=Q(!1);const sr=new Map,ci=["宋体","黑体","微软雅黑","楷体","Arial","Times New Roman","Courier New","Georgia","Verdana"],vs=[12,14,16,18,20,22,24,28,32,36,42,48,56,64,72],Cr=["#000000","#333333","#666666","#999999","#CCCCCC","#FFFFFF","#FF0000","#FF6600","#FFCC00","#00FF00","#00CCFF","#0000FF","#9900FF","#FF00FF"],ui=[1,1.15,1.5,2,2.5,3];function Vs(){o(Qe)&&window.find(o(Qe),!1,!1,!0,!1,!0,!1)}function Go(){if(!o(Qe))return;const c=window.getSelection();c&&c.toString().toLowerCase()===o(Qe).toLowerCase()&&document.execCommand("insertHTML",!1,o(jn)),Vs()}function ps(){const c=new RegExp(Gs(o(Qe)),"gi");if(!o(Qe))return;if(r()&&typeof r()=="object"){const m=gr(r(),c,o(jn));m&&ie(m),_(fe,!1);return}if(!o(a))return;let d=o(a).innerHTML;d=d.replace(c,o(jn)),Yr(a,o(a).innerHTML=d),Zt(),_(fe,!1)}function Gs(c){return c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ks(){var E,D;const c=window.getSelection();if(!c||!c.rangeCount)return;const d=(D=(E=c.anchorNode)==null?void 0:E.parentElement)==null?void 0:D.closest("td, th");if(!d)return alert("请先选中表格单元格");const m=d.nextElementSibling;if(!m||m.tagName!=="TD"&&m.tagName!=="TH")return alert("无法合并：需要选中相邻单元格");const x=parseInt(d.getAttribute("colspan")||"1");d.setAttribute("colspan",String(x+1)),m.remove()}function Xs(){var E,D,R;const c=window.getSelection();if(!c||!c.rangeCount)return;const d=(D=(E=c.anchorNode)==null?void 0:E.parentElement)==null?void 0:D.closest("td, th");if(!d)return alert("请先选中表格单元格");const m=d.parentElement,x=m.cloneNode(!0);x.querySelectorAll("td, th").forEach(H=>H.textContent="　"),(R=m.parentElement)==null||R.insertBefore(x,m.nextSibling)}function Ys(){var E,D,R;const c=window.getSelection();if(!c||!c.rangeCount)return;const d=(D=(E=c.anchorNode)==null?void 0:E.parentElement)==null?void 0:D.closest("td, th");if(!d)return alert("请先选中表格单元格");const m=Array.from(((R=d.parentElement)==null?void 0:R.children)||[]).indexOf(d),x=d.closest("table");x&&x.querySelectorAll("tr").forEach(H=>{const Y=document.createElement(d.tagName.toLowerCase());Y.textContent="　",Y.style.cssText=d.style.cssText,H.insertBefore(Y,H.children[m+1])})}function ji(){var E,D;const c=window.getSelection();if(!c||!c.rangeCount)return;const d=(D=(E=c.anchorNode)==null?void 0:E.parentElement)==null?void 0:D.closest("td, th");if(!d)return alert("请先选中表格单元格");const m=d.parentElement;if(!m)return;const x=m.parentElement;if(x&&x.children.length<=1)return alert("无法删除：表格至少需要一行");m.remove()}function Qs(){var D,R,H;const c=window.getSelection();if(!c||!c.rangeCount)return;const d=(R=(D=c.anchorNode)==null?void 0:D.parentElement)==null?void 0:R.closest("td, th");if(!d)return alert("请先选中表格单元格");const m=Array.from(((H=d.parentElement)==null?void 0:H.children)||[]).indexOf(d),x=d.closest("table");if(!x)return;const E=x.querySelector("tr");if(E&&E.children.length<=1)return alert("无法删除：表格至少需要一列");x.querySelectorAll("tr").forEach(Y=>{var M;(M=Y.children[m])==null||M.remove()})}function Zs(){return o(a)?o(a).querySelectorAll('[id^="ref-fn-"]').length+1:1}function to(c,d,m){if(!o(a))return;let x=o(a).querySelector(".footnotes-section");x||(x=document.createElement("div"),x.className="footnotes-section",x.innerHTML='<hr style="margin-top:40px;border:none;border-top:1px solid #ddd;" /><h3>脚注</h3>',o(a).appendChild(x));const E=document.createElement("div");E.className="footnote-item",E.id=c,E.innerHTML=`<sup>[${m}]</sup> ${d}`,x.appendChild(E)}function eo(){if(!o(a))return"";const c=o(a).querySelectorAll("h1, h2, h3");if(c.length===0)return"<p>未找到标题</p>";let d='<div class="toc-section" style="border:1px solid #ddd;padding:16px;border-radius:8px;background:rgba(255,255,255,0.5);margin:20px 0;"><h3>目录</h3><ul style="list-style:none;padding-left:0;">';return c.forEach((m,x)=>{const E=parseInt(m.tagName[1]),D=m.textContent||"",R="heading-"+x;m.id=R;const H=(E-1)*20;d+=`<li style="margin-left:${H}px;margin-top:8px;"><a href="#${R}" style="color:#a5722a;text-decoration:none;">${D}</a></li>`}),d+="</ul></div>",d}function hs(c){return String(c||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function no(){if(!(!o(a)||!window.renderMathInElement))try{window.renderMathInElement(o(a),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})}catch(c){console.error("Math rendering error:",c)}}function Ii(){!o(a)||!window.Prism||o(a).querySelectorAll("pre code").forEach(c=>{window.Prism.highlightElement(c)})}async function Ko(){if(!o(a))return;const c=Array.from(o(a).querySelectorAll(".wa-figure[data-figure-spec]"));for(const d of c){if(d.dataset.figureRendered==="1")continue;const m=d.dataset.figureSpec||"";if(!m)continue;d.dataset.figureRendered="1";let x=null;try{x=JSON.parse(decodeURIComponent(m))}catch{x=null}if(!x)continue;const E=JSON.stringify(x);let D=sr.get(E);const R=d.querySelector(".wa-figure-box");if(R&&(R.innerHTML='<div class="wa-figure-loading">渲染中...</div>'),!D)try{const H=await fetch("/api/figure/render",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({spec:x})});if(!H.ok)throw new Error(await H.text());const Y=await H.json();D=String(Y.svg||""),D&&sr.set(E,D)}catch{D=""}R&&(R.innerHTML=D||'<div class="wa-figure-loading">渲染失败</div>')}}const gs=Aa.subscribe(c=>{c&&(yt(c),Aa.set(null))});Us(()=>{if(Nt(),!r()){const R=String(n()||"").trim(),H=R?Ca(R):null;if(H)We.set(H),Be.set(!1);else{const Y="自动生成文档";We.set({title:Y,sections:[{id:le(),title:Y,level:1,blocks:[{id:le(),type:"paragraph",text:""}],children:[]}]}),Be.set(!1)}}$=Ve.subscribe(()=>Nt()),We.subscribe(()=>Nt());const c=document.createElement("link");c.rel="stylesheet",c.href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css",document.head.appendChild(c);const d=document.createElement("script");d.src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js",d.onload=()=>{const R=document.createElement("script");R.src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js",R.onload=()=>{no()},document.head.appendChild(R)},document.head.appendChild(d);const m=document.createElement("link");m.rel="stylesheet",m.href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css",document.head.appendChild(m);const x=document.createElement("script");x.src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js",x.onload=()=>{const R=["https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-clike.min.js","https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-c.min.js","https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-cpp.min.js","https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-java.min.js","https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-javascript.min.js","https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-python.min.js","https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-sql.min.js"],H=Y=>new Promise(M=>{const z=document.createElement("script");z.src=Y,z.async=!1,z.onload=()=>M(),z.onerror=()=>M(),document.head.appendChild(z)});(async()=>{for(const Y of R)await H(Y);setTimeout(()=>Ii(),500)})()},document.head.appendChild(x);const E=new IntersectionObserver(R=>{R.forEach(H=>{if(H.isIntersecting&&H.target instanceof HTMLImageElement){const Y=H.target;Y.dataset.src&&(Y.src=Y.dataset.src,Y.removeAttribute("data-src"))}})}),D=new MutationObserver(()=>{var R;(R=o(a))==null||R.querySelectorAll("img[data-src]").forEach(H=>E.observe(H))});return o(a)&&D.observe(o(a),{childList:!0,subtree:!0}),()=>{ae(),gs(),$&&$(),E.disconnect(),D.disconnect(),g&&clearTimeout(g)}}),Vi(()=>{},()=>{Nt()}),Vo();var Xo={get showToolbar(){return I()},set showToolbar(c){I(c),on()},get paper(){return N()},set paper(c){N(c),on()},$set:nr,$on:(c,d)=>er(e,c,d)};ai();var Ni=gv(),ro=y(Ni);{var ms=c=>{var d=vv(),m=he(d),x=h(y(m),2),E=y(x),D=y(E);b(E);var R=h(E,4),H=y(R);b(R),b(x),b(m);var Y=h(m,2),M=y(Y),z=y(M),X=h(z,2);{var G=Yt=>{var se=iv();Fe(se,5,()=>ci,Ke,(Se,ve)=>{var Vt=rv(),Ir=y(Vt,!0);b(Vt),ht(()=>{Ui(Vt,`font-family: ${o(ve)??""}`),ct(Ir,o(ve))}),A("click",Vt,()=>{yt("font:"+o(ve)),_(ye,!1)}),P(Se,Vt)}),b(se),P(Yt,se)};_t(X,Yt=>{o(ye)&&Yt(G)})}b(M);var it=h(M,2),at=y(it),gt=y(at);gt.value=gt.__value="";var Mt=h(gt);Fe(Mt,1,()=>vs,Ke,(Yt,se)=>{var Se=sv(),ve=y(Se);b(Se);var Vt={};ht(()=>{ct(ve,`${o(se)??""}pt`),Vt!==(Vt=o(se))&&(Se.value=(Se.__value=o(se))??"")}),P(Yt,Se)}),b(at),b(it);var Bt=h(it,2),Je=y(Bt),Xt=h(Je,2);{var Ht=Yt=>{var se=av();Fe(se,5,()=>Cr,Ke,(Se,ve)=>{var Vt=ov();ht(()=>{Ui(Vt,`background: ${o(ve)??""};`),Gi(Vt,"aria-label",`文字颜色 ${o(ve)}`)}),A("click",Vt,()=>{yt("color:"+o(ve)),_(un,!1)}),P(Se,Vt)}),b(se),P(Yt,se)};_t(Xt,Yt=>{o(un)&&Yt(Ht)})}b(Bt);var gn=h(Bt,2),jr=y(gn),ao=h(jr,2);{var _s=Yt=>{var se=cv();Fe(se,5,()=>Cr,Ke,(Se,ve)=>{var Vt=lv();ht(()=>{Ui(Vt,`background: ${o(ve)??""};`),Gi(Vt,"aria-label",`背景颜色 ${o(ve)}`)}),A("click",Vt,()=>{yt("bgcolor:"+o(ve)),_(de,!1)}),P(Se,Vt)}),b(se),P(Yt,se)};_t(ao,Yt=>{o(de)&&Yt(_s)})}b(gn);var bs=h(gn,4),lo=h(bs,2),Mi=h(lo,2),co=h(Mi,2),ys=h(co,4),ws=h(ys,2),Ss=h(ws,2),xs=h(Ss,4),Oi=y(xs),ks=h(Oi,2);{var uo=Yt=>{var se=fv();Fe(se,5,()=>ui,Ke,(Se,ve)=>{var Vt=uv(),Ir=y(Vt);b(Vt),ht(()=>ct(Ir,`${o(ve)??""}倍行距`)),A("click",Vt,()=>{yt("line-height:"+o(ve)),_(we,!1)}),P(Se,Vt)}),b(se),P(Yt,se)};_t(ks,Yt=>{o(we)&&Yt(uo)})}b(xs);var $s=h(xs,2),fo=h($s,2),Di=h(fo,4),Li=h(Di,2),Bi=h(Li,4),Fi=h(Bi,2),Ts=h(Fi,4),Es=y(Ts),vo=h(Es,2);{var po=Yt=>{var se=dv(),Se=y(se),ve=h(Se,2),Vt=h(ve,2),Ir=h(Vt,2),As=h(Ir,2),ho=h(As,2);b(se),A("click",Se,()=>{yt("table"),_(Wt,!1)}),A("click",ve,()=>{Ks(),_(Wt,!1)}),A("click",Vt,()=>{Xs(),_(Wt,!1)}),A("click",Ir,()=>{Ys(),_(Wt,!1)}),A("click",As,()=>{ji(),_(Wt,!1)}),A("click",ho,()=>{Qs(),_(Wt,!1)}),P(Yt,se)};_t(vo,Yt=>{o(Wt)&&Yt(po)})}b(Ts),b(Y),ht(Yt=>{ct(D,`${i()??""} 字`),ct(H,`${Yt??""} 分钟阅读`)},[()=>(i(),J(()=>Math.ceil(i()/400)))]),A("click",z,()=>_(ye,!o(ye))),A("change",at,Yt=>yt("size:"+Yt.currentTarget.value)),A("click",Je,()=>_(un,!o(un))),A("click",jr,()=>_(de,!o(de))),A("click",bs,()=>yt("align-left")),A("click",lo,()=>yt("align-center")),A("click",Mi,()=>yt("align-right")),A("click",co,()=>yt("align-justify")),A("click",ys,()=>yt("superscript")),A("click",ws,()=>yt("subscript")),A("click",Ss,()=>yt("hr")),A("click",Oi,()=>_(we,!o(we))),A("click",$s,()=>yt("indent-first")),A("click",fo,()=>yt("margin:10px 0")),A("click",Di,()=>yt("math-inline")),A("click",Li,()=>yt("math-block")),A("click",Bi,()=>yt("footnote")),A("click",Fi,()=>yt("toc")),A("click",Es,()=>_(Wt,!o(Wt))),P(c,d)};_t(ro,c=>{I()&&c(ms)})}var In=h(ro,2);bd(In,c=>_(a,c),()=>o(a));var io=h(In,2);{var Yo=c=>{var d=pv();ht(()=>Ui(d,(o(W),J(()=>`left:${o(W).left}px;top:${o(W).top}px;width:${o(W).width}px;height:${o(W).height}px;`)))),P(c,d)};_t(io,c=>{o(ut)&&c(Yo)})}var Qo=h(io,2);{var so=c=>{var d=hv(),m=y(d),x=y(m);Gn(x);var E=h(x,2),D=h(E,2);b(m);var R=h(m,2),H=y(R);Gn(H);var Y=h(H,2),M=h(Y,2);b(R),b(d),Re(x,()=>o(Qe),z=>_(Qe,z)),A("click",E,Vs),A("click",D,()=>_(fe,!1)),Re(H,()=>o(jn),z=>_(jn,z)),A("click",Y,Go),A("click",M,ps),P(c,d)};_t(Qo,c=>{o(fe)&&c(so)})}b(Ni),ht(()=>{bn(Ni,1,`panel editor ${N()?"paper":""}`,"svelte-1ctqrjb"),Gi(In,"data-render-mode",o(v))}),A("mousedown",In,qn),A("input",In,Ci),A("focusin",In,ir),A("focusout",In,li),A("compositionstart",In,Kt),A("compositionend",In,$t),A("click",In,Cn),A("keydown",In,He),P(t,Ni);var oo=Fn(Xo);return l(),oo}var mv=V("<button> </button>"),_v=V('<button class="template-chip svelte-1ka5p0t"> </button>'),bv=V('<div class="kind-grid svelte-1ka5p0t"></div> <div class="template-list svelte-1ka5p0t"></div> <textarea class="prompt-box svelte-1ka5p0t" rows="5" placeholder="输入你要绘制的内容，例如：用户登录到下单的关键流程。"></textarea> <div class="canvas-actions svelte-1ka5p0t"><button class="btn primary svelte-1ka5p0t"> </button> <button class="btn ghost svelte-1ka5p0t">插入文档</button></div> <textarea class="prompt-box mini svelte-1ka5p0t" rows="3" placeholder="二次优化，例如：改成更简洁的 5 个节点，强调异常分支。"></textarea> <button class="btn ghost svelte-1ka5p0t">AI 二次优化</button>',1),yv=V('<textarea class="spec-editor svelte-1ka5p0t" rows="18" placeholder="可直接编辑 JSON 规范，例如：type=flow，caption=示例，data 包含 nodes/edges。"></textarea> <div class="canvas-actions svelte-1ka5p0t"><button class="btn primary svelte-1ka5p0t">应用规范</button> <button class="btn ghost svelte-1ka5p0t">复制规范</button></div>',1),wv=V('<div class="empty svelte-1ka5p0t">暂无历史记录</div>'),Sv=V('<button class="history-item svelte-1ka5p0t"><div class="svelte-1ka5p0t"> </div> <div class="svelte-1ka5p0t"> </div> <div class="svelte-1ka5p0t"> </div></button>'),xv=V('<div class="history-list svelte-1ka5p0t"><!></div>'),kv=V('<div class="error svelte-1ka5p0t"> </div>'),$v=V('<div class="svg-host svelte-1ka5p0t"><div class="svg-scale svelte-1ka5p0t"><!></div></div>'),Tv=V('<div class="placeholder svelte-1ka5p0t"><h4 class="svelte-1ka5p0t">画布预览区</h4> <p class="svelte-1ka5p0t">左侧输入描述后点击“生成图形”，或切换到 JSON 手动编辑规范。</p></div>'),Ev=V('<div class="canvas-backdrop svelte-1ka5p0t" role="button" tabindex="0" aria-label="关闭画布"><section class="canvas-shell svelte-1ka5p0t" aria-label="AI 画布系统"><header class="canvas-topbar svelte-1ka5p0t"><div class="title-wrap svelte-1ka5p0t"><h3 class="svelte-1ka5p0t">AI 画布系统</h3> <p class="svelte-1ka5p0t">同页完成生成、修改、预览、插入，支持流程图/ER 图/时序图/统计图。</p></div> <div class="top-actions svelte-1ka5p0t"><button class="btn ghost svelte-1ka5p0t">工作台</button> <button class="btn ghost svelte-1ka5p0t">JSON</button> <button class="btn ghost svelte-1ka5p0t">历史</button> <button class="btn ghost svelte-1ka5p0t">清空</button> <button class="close-btn svelte-1ka5p0t" aria-label="关闭">×</button></div></header> <div class="canvas-main svelte-1ka5p0t"><aside class="canvas-sidebar svelte-1ka5p0t"><div class="panel-title svelte-1ka5p0t"> </div> <!> <!> <!> <!></aside> <section class="canvas-stage svelte-1ka5p0t"><div class="stage-toolbar svelte-1ka5p0t"><div class="zoom-group svelte-1ka5p0t"><button class="btn ghost svelte-1ka5p0t">-</button> <span> </span> <button class="btn ghost svelte-1ka5p0t">+</button> <button class="btn ghost svelte-1ka5p0t">重置缩放</button></div> <div class="export-group svelte-1ka5p0t"><button class="btn ghost svelte-1ka5p0t">复制 SVG</button> <button class="btn ghost svelte-1ka5p0t">下载 SVG</button> <button class="btn primary svelte-1ka5p0t">插入正文</button></div></div> <div class="preview-wrap svelte-1ka5p0t"><!></div></section></div></section></div>');function du(t,e){if(new.target)return tr({component:du,...t});Bn(e,!1);let n=Sn(e,"open",12,!1),r=Sn(e,"docId",12,"");const i=Ka(),s=[{value:"flow",label:"流程图"},{value:"er",label:"ER 图"},{value:"sequence",label:"时序图"},{value:"timeline",label:"时间线"},{value:"bar",label:"柱状图"},{value:"line",label:"折线图"},{value:"pie",label:"饼图"}],l={flow:["需求分析 -> 方案设计 -> 开发实现 -> 测试验收 -> 上线运营","用户登录 -> 权限校验 -> 数据查询 -> 结果返回","问题发现 -> 原因定位 -> 修复验证 -> 发布回归"],er:["电商系统：用户、订单、商品、支付","教学系统：学生、课程、教师、选课记录","医院系统：患者、医生、挂号、检查报告"],sequence:["用户 -> 网关 -> 认证服务 -> 业务服务 -> 数据库","浏览器 -> 服务端 -> 缓存 -> 数据库","客户端 -> API -> 队列 -> Worker -> 存储"],timeline:["立项 -> 调研 -> 设计 -> 开发 -> 测试 -> 发布","需求冻结 -> 联调 -> 验收 -> 复盘","周一需求 -> 周三开发 -> 周五发布"],bar:["近 3 个月活跃用户对比","三种方案成本对比","各模块缺陷数统计"],line:["Q1-Q4 访问量变化趋势","模型版本准确率变化","系统响应时间趋势"],pie:["项目成本占比：人力、硬件、云资源、其他","问题类型占比：功能、性能、兼容性、体验","用户来源占比：自然、投放、活动、推荐"]};let a=Q("studio"),u=Q("flow"),v=Q(""),g=Q(""),S=Q(!1),$=Q(""),I=Q(""),N=Q(null),B=Q(""),j=Q(1),U=Q([]);function ft(et){return et==="json"?"规范编辑":et==="history"?"历史画布":"智能画布"}function tt(){i("close")}function ot(et){_(v,et)}function K(et){const nt=String(et||"").trim().toLowerCase();return nt==="er"?"er":nt==="sequence"?"sequence":nt==="timeline"?"timeline":nt==="bar"?"bar":nt==="line"?"line":nt==="pie"?"pie":"flow"}function bt(et){if(!et||typeof et!="object"||Array.isArray(et))throw new Error("图形规范不是对象");return et}function rt(et){return JSON.stringify(et,(nt,St)=>typeof St=="string"?St.replace(/\u0000/g,""):St,2)}function F(et,nt,St,Lt){_(U,[{id:Date.now(),kind:nt,prompt:et,spec:St,svg:Lt,ts:Date.now()},...o(U)].slice(0,40))}async function ut(et,nt,St){const Lt=await fetch("/api/figure/render",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({spec:et})});if(!Lt.ok)throw new Error(await Lt.text());const Ct=await Lt.json(),vn=String(Ct.svg||"");_(I,vn),_(N,et),_(B,rt(et)),F(nt,St,et,vn)}async function W(et){const nt=String(et||o(v)||"").trim();if(!r()){_($,"文档未加载");return}if(nt){_(S,!0),_($,"");try{const St=await fetch(`/api/doc/${r()}/diagram/generate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:nt,kind:o(u)})});if(!St.ok)throw new Error(await St.text());const Lt=await St.json(),Ct=bt(Lt.spec||{});await ut(Ct,nt,o(u)),_(a,"studio")}catch(St){_($,St instanceof Error?St.message:"图形生成失败")}finally{_(S,!1)}}}async function lt(){const et=o(g).trim();if(!et)return;if(!o(N)){await W(et);return}const nt=JSON.stringify(o(N)).slice(0,1800);await W(`在当前图基础上优化：${et}
当前规范：${nt}`)}async function dt(){const et=String(o(B)||"").trim();if(et){_(S,!0),_($,"");try{const nt=bt(JSON.parse(et)),St=K(nt.type);_(u,St),await ut(nt,"手动编辑规范",St),_(a,"studio")}catch(nt){_($,nt instanceof Error?nt.message:"规范解析失败")}finally{_(S,!1)}}}function Nt(et){_(u,et.kind),_(v,et.prompt),_(N,et.spec),_(I,et.svg),_(B,rt(et.spec)),_(a,"studio")}function Ot(){o(N)&&i("insert",{spec:o(N)})}async function At(){if(o(I))try{await navigator.clipboard.writeText(o(I))}catch{_($,"复制 SVG 失败，请检查浏览器权限")}}async function Zt(){if(o(B).trim())try{await navigator.clipboard.writeText(o(B))}catch{_($,"复制规范失败，请检查浏览器权限")}}function Jt(){if(!o(I))return;const et=new Blob([o(I)],{type:"image/svg+xml;charset=utf-8"}),nt=URL.createObjectURL(et),St=document.createElement("a");St.href=nt,St.download=`canvas-${Date.now()}.svg`,document.body.appendChild(St),St.click(),St.remove(),URL.revokeObjectURL(nt)}function Dt(){_(I,""),_(N,null),_(B,""),_(g,""),_($,""),_(j,1)}function Pt(et){et.key==="Escape"&&tt()}var kt={get open(){return n()},set open(et){n(et),on()},get docId(){return r()},set docId(et){r(et),on()},$set:nr,$on:(et,nt)=>er(e,et,nt)};ai();var oe=dr(),ue=he(oe);{var ge=et=>{var nt=Ev(),St=y(nt),Lt=y(St),Ct=h(y(Lt),2),vn=y(Ct),xn=h(vn,2),ie=h(xn,2),Pe=h(ie,2),te=h(Pe,2);b(Ct),b(Lt);var Ae=h(Lt,2),kn=y(Ae),rr=y(kn),gr=y(rr,!0);b(rr);var Ye=h(rr,2);{var an=Kt=>{var $t=bv(),le=he($t);Fe(le,5,()=>s,Ke,(de,we)=>{var Wt=mv(),sr=y(Wt,!0);b(Wt),ht(()=>{bn(Wt,1,(o(u),o(we),J(()=>`kind-chip ${o(u)===o(we).value?"active":""}`)),"svelte-1ka5p0t"),ct(sr,(o(we),J(()=>o(we).label)))}),A("click",Wt,()=>_(u,o(we).value)),P(de,Wt)}),b(le);var cn=h(le,2);Fe(cn,5,()=>(o(u),J(()=>l[o(u)])),Ke,(de,we)=>{var Wt=_v(),sr=y(Wt,!0);b(Wt),ht(()=>ct(sr,o(we))),A("click",Wt,()=>ot(o(we))),P(de,Wt)}),b(cn);var yt=h(cn,2);ii(yt);var He=h(yt,2),fe=y(He),Qe=y(fe,!0);b(fe);var jn=h(fe,2);b(He);var ye=h(He,2);ii(ye);var un=h(ye,2);ht((de,we)=>{fe.disabled=de,ct(Qe,o(S)?"生成中...":"生成图形"),jn.disabled=!o(N),un.disabled=we},[()=>(o(S),o(v),J(()=>o(S)||!o(v).trim())),()=>(o(S),o(g),J(()=>o(S)||!o(g).trim()))]),Re(yt,()=>o(v),de=>_(v,de)),A("click",fe,()=>W()),A("click",jn,Ot),Re(ye,()=>o(g),de=>_(g,de)),A("click",un,lt),P(Kt,$t)};_t(Ye,Kt=>{o(a)==="studio"&&Kt(an)})}var $n=h(Ye,2);{var zt=Kt=>{var $t=yv(),le=he($t);ii(le);var cn=h(le,2),yt=y(cn),He=h(yt,2);b(cn),ht((fe,Qe)=>{yt.disabled=fe,He.disabled=Qe},[()=>(o(S),o(B),J(()=>o(S)||!o(B).trim())),()=>(o(B),J(()=>!o(B).trim()))]),Re(le,()=>o(B),fe=>_(B,fe)),A("click",yt,dt),A("click",He,Zt),P(Kt,$t)};_t($n,Kt=>{o(a)==="json"&&Kt(zt)})}var Tn=h($n,2);{var En=Kt=>{var $t=xv(),le=y($t);{var cn=He=>{var fe=wv();P(He,fe)},yt=He=>{var fe=dr(),Qe=he(fe);Fe(Qe,1,()=>o(U),Ke,(jn,ye)=>{var un=Sv(),de=y(un),we=y(de,!0);b(de);var Wt=h(de,2),sr=y(Wt,!0);b(Wt);var ci=h(Wt,2),vs=y(ci,!0);b(ci),b(un),ht((Cr,ui)=>{ct(we,Cr),ct(sr,(o(ye),J(()=>o(ye).prompt||"无描述"))),ct(vs,ui)},[()=>(o(ye),J(()=>{var Cr;return((Cr=s.find(ui=>ui.value===o(ye).kind))==null?void 0:Cr.label)||o(ye).kind})),()=>(o(ye),J(()=>new Date(o(ye).ts).toLocaleString()))]),A("click",un,()=>Nt(o(ye))),P(jn,un)}),P(He,fe)};_t(le,He=>{o(U),J(()=>o(U).length===0)?He(cn):He(yt,!1)})}b($t),P(Kt,$t)};_t(Tn,Kt=>{o(a)==="history"&&Kt(En)})}var qe=h(Tn,2);{var pn=Kt=>{var $t=kv(),le=y($t,!0);b($t),ht(()=>ct(le,o($))),P(Kt,$t)};_t(qe,Kt=>{o($)&&Kt(pn)})}b(kn);var me=h(kn,2),hn=y(me),An=y(hn),Rn=y(An),be=h(Rn,2),Ce=y(be);b(be);var Pn=h(be,2),ln=h(Pn,2);b(An);var Oe=h(An,2),ae=y(Oe),je=h(ae,2),qn=h(je,2);b(Oe),b(hn);var Cn=h(hn,2),ir=y(Cn);{var li=Kt=>{var $t=$v(),le=y($t),cn=y(le);fd(cn,()=>o(I)),b(le),b($t),ht(()=>Ui(le,`transform: scale(${o(j)});`)),P(Kt,$t)},Ci=Kt=>{var $t=Tv();P(Kt,$t)};_t(ir,Kt=>{o(I)?Kt(li):Kt(Ci,!1)})}b(Cn),b(me),b(Ae),b(St),b(nt),ht((Kt,$t)=>{ct(gr,Kt),ct(Ce,`${$t??""}%`),ae.disabled=!o(I),je.disabled=!o(I),qn.disabled=!o(N)},[()=>(o(a),J(()=>ft(o(a)))),()=>(o(j),J(()=>Math.round(o(j)*100)))]),A("click",vn,()=>_(a,"studio")),A("click",xn,()=>_(a,"json")),A("click",ie,()=>_(a,"history")),A("click",Pe,Dt),A("click",te,tt),A("click",Rn,()=>_(j,Math.max(.4,Number((o(j)-.1).toFixed(1))))),A("click",Pn,()=>_(j,Math.min(2.2,Number((o(j)+.1).toFixed(1))))),A("click",ln,()=>_(j,1)),A("click",ae,At),A("click",je,Jt),A("click",qn,Ot),A("click",nt,Gc(tt)),A("keydown",nt,Pt),P(et,nt)};_t(ue,et=>{n()&&et(ge)})}return P(t,oe),Fn(kt)}var Av=V("<div> </div>"),qv=V('<div class="toast-root svelte-1cpok13"></div>');function vu(t,e){if(new.target)return tr({component:vu,...t});Bn(e,!1);const n=()=>ke(qa,"$toasts",r),[r,i]=ds();var s={$set:nr,$on:(u,v)=>er(e,u,v)},l=qv();Fe(l,5,n,u=>u.id,(u,v)=>{var g=Av(),S=y(g,!0);b(g),ht(()=>{bn(g,1,`toast ${o(v),J(()=>o(v).type)??""}`,"svelte-1cpok13"),ct(S,(o(v),J(()=>o(v).message)))}),P(u,g)}),b(l),P(t,l);var a=Fn(s);return i(),a}var Cv=V('<button type="button" class="modal-backdrop svelte-ta60gp" aria-label="关闭"></button> <div class="modal svelte-ta60gp" role="dialog" aria-modal="true"><div class="modal-header svelte-ta60gp"><div class="modal-title svelte-ta60gp"> </div> <button class="btn ghost">关闭</button></div> <div class="modal-body"><!></div></div>',1);function pu(t,e){if(new.target)return tr({component:pu,...t});Bn(e,!1);let n=Sn(e,"open",12,!1),r=Sn(e,"title",12,""),i=Sn(e,"onClose",12);var s={get open(){return n()},set open(v){n(v),on()},get title(){return r()},set title(v){r(v),on()},get onClose(){return i()},set onClose(v){i(v),on()},$set:nr,$on:(v,g)=>er(e,v,g)},l=dr(),a=he(l);{var u=v=>{var g=Cv(),S=he(g),$=h(S,2),I=y($),N=y(I),B=y(N,!0);b(N);var j=h(N,2);b(I);var U=h(I,2),ft=y(U);Xc(ft,e,"default",{}),b(U),b($),ht(()=>ct(B,r())),A("click",S,function(...tt){var ot;(ot=i())==null||ot.apply(this,tt)}),A("click",j,function(...tt){var ot;(ot=i())==null||ot.apply(this,tt)}),P(v,g)};_t(a,v=>{n()&&v(u)})}return P(t,l),Fn(s)}var jv=V('<div class="settings-row svelte-anx9w7"><label><input type="checkbox"/> 扩展大纲</label></div> <div class="settings-row svelte-anx9w7"><label><input type="checkbox"/> 需要引用</label></div> <div class="settings-row svelte-anx9w7"><label for="targetChars">目标字数</label> <input id="targetChars" type="number" min="100" max="10000" placeholder="例如 1000" class="svelte-anx9w7"/></div> <div class="settings-row svelte-anx9w7"><label for="styleTone">风格/语气</label> <input id="styleTone" type="text" placeholder="例如：正式、简洁、适度营销" class="svelte-anx9w7"/></div> <div class="settings-row svelte-anx9w7"><label for="outputFormat">输出格式</label> <select id="outputFormat" class="svelte-anx9w7"><option>Markdown</option><option>纯文本</option></select></div> <div class="settings-section svelte-anx9w7"><div class="section-title svelte-anx9w7">高级设置（可改所有默认值）</div> <label for="formattingJson">格式 formatting</label> <textarea id="formattingJson" rows="6" class="svelte-anx9w7"></textarea> <label for="prefsJson">生成偏好 generation_prefs</label> <textarea id="prefsJson" rows="6" class="svelte-anx9w7"></textarea></div> <div class="settings-actions svelte-anx9w7"><button class="btn primary">保存</button> <button class="btn ghost">取消</button></div>',1),Iv=V('<button class="btn ghost">设置</button> <!>',1);function hu(t,e){if(new.target)return tr({component:hu,...t});Bn(e,!1);const n=()=>ke(Jr,"$docId",r),[r,i]=ds();let s=Q(!1),l=Q(!1),a=Q(""),u=Q(""),v=Q(!1),g=Q("markdown"),S=Q(""),$=Q("");async function I(){const K=n();if(!K)return;const bt=await fetch(`/api/doc/${K}`);if(!bt.ok)return;const rt=await bt.json(),F=rt.generation_prefs||{},ut=rt.formatting||{};_(l,!!F.expand_outline),_(a,F.target_chars?Number(F.target_chars):""),_(u,String(ut.style||"")),_(v,!!F.citations_required),_(g,String(F.output_format||"markdown")),_(S,JSON.stringify(ut,null,2)),_($,JSON.stringify(F,null,2))}async function N(){const K=n();if(!K)return;let bt={},rt={};try{bt=o(S).trim()?JSON.parse(o(S)):{},rt=o($).trim()?JSON.parse(o($)):{}}catch{jt("高级设置 JSON 解析失败，请检查格式。","bad");return}const F={generation_prefs:{...rt,expand_outline:o(l),citations_required:o(v),output_format:o(g)},formatting:{...bt,style:o(u)}};o(a)&&(F.generation_prefs.target_chars=Number(o(a))),await fetch(`/api/doc/${K}/settings`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(F)}),jt("设置已保存","ok"),_(s,!1)}function B(){_(s,!0),I().catch(()=>{})}var j={$set:nr,$on:(K,bt)=>er(e,K,bt)};ai();var U=Iv(),ft=he(U),tt=h(ft,2);pu(tt,{get open(){return o(s)},title:"生成设置",onClose:()=>_(s,!1),children:(K,bt)=>{var rt=jv(),F=he(rt),ut=y(F),W=y(ut);Gn(W),Co(),b(ut),b(F);var lt=h(F,2),dt=y(lt),Nt=y(dt);Gn(Nt),Co(),b(dt),b(lt);var Ot=h(lt,2),At=h(y(Ot),2);Gn(At),b(Ot);var Zt=h(Ot,2),Jt=h(y(Zt),2);Gn(Jt),b(Zt);var Dt=h(Zt,2),Pt=h(y(Dt),2);ht(()=>{o(g),xo(()=>{})});var kt=y(Pt);kt.value=kt.__value="markdown";var oe=h(kt);oe.value=oe.__value="plain",b(Pt),b(Dt);var ue=h(Dt,2),ge=h(y(ue),4);ii(ge);var et=h(ge,4);ii(et),b(ue);var nt=h(ue,2),St=y(nt),Lt=h(St,2);b(nt),Rl(W,()=>o(l),Ct=>_(l,Ct)),Rl(Nt,()=>o(v),Ct=>_(v,Ct)),Re(At,()=>o(a),Ct=>_(a,Ct)),Re(Jt,()=>o(u),Ct=>_(u,Ct)),$o(Pt,()=>o(g),Ct=>_(g,Ct)),Re(ge,()=>o(S),Ct=>_(S,Ct)),Re(et,()=>o($),Ct=>_($,Ct)),A("click",St,N),A("click",Lt,()=>_(s,!1)),P(K,rt)},$$slots:{default:!0}}),A("click",ft,B),P(t,U);var ot=Fn(j);return i(),ot}var Nv=V('<div class="loading svelte-1bmythy">加载中...</div>'),Mv=V('<div class="empty svelte-1bmythy">暂无文档</div>'),Ov=V('<div class="doc-item svelte-1bmythy"><div class="doc-info svelte-1bmythy"><div class="doc-title svelte-1bmythy"> </div> <div class="doc-meta svelte-1bmythy"><span> </span> <span> </span></div> <div class="doc-preview svelte-1bmythy"> </div></div> <button class="delete-btn svelte-1bmythy">删除</button></div>'),Dv=V('<div class="doc-list svelte-1bmythy"></div>'),Lv=V('<div class="modal-backdrop svelte-1bmythy"><div class="modal-panel svelte-1bmythy"><div class="modal-header svelte-1bmythy"><h2 class="svelte-1bmythy">文档列表</h2> <button class="close-btn svelte-1bmythy">✕</button></div> <div class="modal-body svelte-1bmythy"><!></div></div></div>');function gu(t,e){if(new.target)return tr({component:gu,...t});Bn(e,!1);let n=Sn(e,"visible",12,!1),r=Sn(e,"onSelect",12,()=>{}),i=Q([]),s=Q(!1);async function l(){_(s,!0);try{const N=await fetch("/api/docs/list");if(!N.ok)throw new Error("加载失败");const B=await N.json();_(i,B.docs||[])}catch{jt("加载文档列表失败","error")}finally{_(s,!1)}}function a(N){try{return new Date(N).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return N}}function u(N,B){return(N||"").length>B?N.slice(0,B)+"...":N}async function v(N){if(confirm("确定删除此文档？"))try{await fetch(`/api/doc/${N}/delete`,{method:"POST"}),jt("已删除","ok"),await l()}catch{jt("删除失败","error")}}Us(()=>{n()&&l()}),Vi(()=>Uo(n()),()=>{n()&&l()}),Vo();var g={get visible(){return n()},set visible(N){n(N),on()},get onSelect(){return r()},set onSelect(N){r(N),on()},$set:nr,$on:(N,B)=>er(e,N,B)};ai();var S=dr(),$=he(S);{var I=N=>{var B=Lv(),j=y(B),U=y(j),ft=h(y(U),2);b(U);var tt=h(U,2),ot=y(tt);{var K=rt=>{var F=Nv();P(rt,F)},bt=rt=>{var F=dr(),ut=he(F);{var W=dt=>{var Nt=Mv();P(dt,Nt)},lt=dt=>{var Nt=Dv();Fe(Nt,5,()=>o(i),Ke,(Ot,At)=>{var Zt=Ov(),Jt=y(Zt),Dt=y(Jt),Pt=y(Dt,!0);b(Dt);var kt=h(Dt,2),oe=y(kt),ue=y(oe,!0);b(oe);var ge=h(oe,2),et=y(ge);b(ge),b(kt);var nt=h(kt,2),St=y(nt,!0);b(nt),b(Jt);var Lt=h(Jt,2);b(Zt),ht((Ct,vn)=>{ct(Pt,(o(At),J(()=>o(At).title||"自动生成文档"))),ct(ue,Ct),ct(et,`${o(At),J(()=>o(At).char_count||0)??""} 字`),ct(St,vn)},[()=>(o(At),J(()=>a(o(At).updated_at))),()=>(o(At),J(()=>u(o(At).text,80)))]),A("click",Jt,()=>r()(o(At).doc_id)),A("keydown",Jt,()=>{}),A("click",Lt,()=>v(o(At).doc_id)),P(Ot,Zt)}),b(Nt),P(dt,Nt)};_t(ut,dt=>{o(i),J(()=>o(i).length===0)?dt(W):dt(lt,!1)},!0)}P(rt,F)};_t(ot,rt=>{o(s)?rt(K):rt(bt,!1)})}b(tt),b(j),b(B),A("click",ft,()=>n(!1)),A("click",j,Kc(function(rt){Qc.call(this,e,rt)})),A("keydown",j,()=>{}),A("click",B,()=>n(!1)),A("keydown",B,()=>{}),P(N,B)};_t($,N=>{n()&&N(I)})}return P(t,S),Fn(g)}var Bv=V('<div class="skeleton-wrapper svelte-1bn1hqj"><div class="skeleton-header svelte-1bn1hqj"><div class="skeleton-line skeleton-title svelte-1bn1hqj"></div> <div class="skeleton-line skeleton-subtitle svelte-1bn1hqj"></div></div> <div class="skeleton-content svelte-1bn1hqj"><div class="skeleton-line svelte-1bn1hqj"></div> <div class="skeleton-line svelte-1bn1hqj"></div> <div class="skeleton-line short svelte-1bn1hqj"></div> <div class="skeleton-line svelte-1bn1hqj"></div> <div class="skeleton-line svelte-1bn1hqj"></div> <div class="skeleton-line short svelte-1bn1hqj"></div></div></div>');function mu(t,e){if(new.target)return tr({component:mu,...t});Bn(e,!1);var n={$set:nr,$on:(i,s)=>er(e,i,s)},r=Bv();return P(t,r),Fn(n)}var Fv=V('<div class="progress-bar indeterminate svelte-1qjgclg"></div>'),Rv=V('<div class="progress-bar svelte-1qjgclg"></div>'),Pv=V('<div class="progress-container svelte-1qjgclg"><!></div>');function _u(t,e){if(new.target)return tr({component:_u,...t});Bn(e,!1);let n=Sn(e,"progress",12,0),r=Sn(e,"indeterminate",12,!1);var i={get progress(){return n()},set progress(v){n(v),on()},get indeterminate(){return r()},set indeterminate(v){r(v),on()},$set:nr,$on:(v,g)=>er(e,v,g)},s=Pv(),l=y(s);{var a=v=>{var g=Fv();P(v,g)},u=v=>{var g=Rv();ht(S=>Ui(g,`width: ${S??""}%`),[()=>(Uo(n()),J(()=>Math.min(100,Math.max(0,n()))))]),P(v,g)};_t(l,v=>{r()?v(a):v(u,!1)})}return b(s),P(t,s),Fn(i)}var Hv=V('<div class="error-boundary svelte-1k3aqik"><div class="error-icon svelte-1k3aqik">⚠️</div> <h2 class="svelte-1k3aqik">抱歉，出现了一些问题</h2> <p class="error-message svelte-1k3aqik"> </p> <div class="error-suggestion svelte-1k3aqik">建议： <ul class="svelte-1k3aqik"><li class="svelte-1k3aqik">刷新页面重试</li> <li class="svelte-1k3aqik">检查网络连接</li> <li class="svelte-1k3aqik">清除浏览器缓存</li> <li class="svelte-1k3aqik">如问题持续，请联系技术支持</li></ul></div> <button class="btn-retry svelte-1k3aqik">重新加载</button></div>');function bu(t,e){if(new.target)return tr({component:bu,...t});Bn(e,!1);let n=Sn(e,"fallback",12,"出现错误，请刷新页面重试"),r=Q(!1),i=Q("");Us(()=>{const g=S=>{var $;_(r,!0),_(i,(($=S.error)==null?void 0:$.message)||S.message||"未知错误"),console.error("捕获到错误:",S.error)};return window.addEventListener("error",g),()=>{window.removeEventListener("error",g)}});var s={get fallback(){return n()},set fallback(g){n(g),on()},$set:nr,$on:(g,S)=>er(e,g,S)};ai();var l=dr(),a=he(l);{var u=g=>{var S=Hv(),$=h(y(S),4),I=y($,!0);b($);var N=h($,4);b(S),ht(()=>ct(I,o(i))),A("click",N,()=>window.location.reload()),P(g,S)},v=g=>{var S=dr(),$=he(S);Xc($,e,"default",{}),P(g,S)};_t(a,g=>{o(r)?g(u):g(v,!1)})}return P(t,l),Fn(s)}var Jv=V('<p class="empty svelte-13e776w">加载中...</p>'),zv=V('<p class="empty svelte-13e776w">暂无引用</p>'),Uv=V('<span class="source svelte-13e776w"> </span>'),Wv=V('<div class="citation-item svelte-13e776w"><div class="citation-info svelte-13e776w"><strong class="svelte-13e776w"> </strong> <span class="svelte-13e776w"> </span> <!></div> <div class="citation-actions svelte-13e776w"><button class="btn-copy svelte-13e776w">复制</button> <button class="btn-delete svelte-13e776w">删除</button></div></div>'),Vv=V('<div class="citation-list svelte-13e776w"></div>'),Gv=V('<div class="modal-backdrop svelte-13e776w"><div class="modal svelte-13e776w"><div class="modal-header svelte-13e776w"><h2 class="svelte-13e776w">引用管理</h2> <button class="close-btn svelte-13e776w">×</button></div> <div class="modal-body svelte-13e776w"><div class="add-section svelte-13e776w"><h3 class="svelte-13e776w">添加引用</h3> <div class="form-grid svelte-13e776w"><input type="text" placeholder="引用ID (如: smith2023)*" class="svelte-13e776w"/> <input type="text" placeholder="作者*" class="svelte-13e776w"/> <input type="text" placeholder="标题*" class="svelte-13e776w"/> <input type="text" placeholder="年份" class="svelte-13e776w"/> <input type="text" placeholder="来源（期刊/会议/出版社）" class="full-width svelte-13e776w"/></div> <button class="btn-add svelte-13e776w">添加引用</button></div> <div class="export-section svelte-13e776w"><h3 class="svelte-13e776w">导出参考文献</h3> <div class="export-btns svelte-13e776w"><button class="btn-export svelte-13e776w">APA格式</button> <button class="btn-export svelte-13e776w">MLA格式</button> <button class="btn-export svelte-13e776w">GB/T 7714</button></div></div> <div class="list-section svelte-13e776w"><h3 class="svelte-13e776w"> </h3> <!></div></div></div></div>');function yu(t,e){if(new.target)return tr({component:yu,...t});Bn(e,!1);const n=()=>ke(Jr,"$docId",r),[r,i]=ds();let s=Sn(e,"visible",12,!1),l=Q([]),a=Q(!1),u=Q(""),v=null,g=Q({id:"",author:"",title:"",year:"",source:""});async function S(){const F=n();if(F){_(a,!0);try{const ut=await fetch(`/api/doc/${F}/citations`);if(!ut.ok)throw new Error(await ut.text());const W=await ut.json();_(l,Array.isArray(W.items)?W.items:[])}catch(ut){console.error("Failed to load citations:",ut),jt("加载引用失败","error")}finally{_(a,!1)}}}async function $(){const F=n();F&&await fetch(`/api/doc/${F}/citations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:o(l)})})}function I(){v&&clearTimeout(v),v=setTimeout(()=>{$().catch(()=>{jt("保存引用失败","error")})},300)}function N(){if(!o(g).id||!o(g).author||!o(g).title){jt("请填写必填字段（ID、作者、标题）","bad");return}if(o(l).some(F=>F.id===o(g).id)){jt("引用ID已存在","bad");return}_(l,[...o(l),{...o(g)}]),I(),_(g,{id:"",author:"",title:"",year:"",source:""}),jt("已添加引用","ok")}function B(F){_(l,o(l).filter(ut=>ut.id!==F)),I(),jt("已删除引用","ok")}function j(F){navigator.clipboard.writeText(`[@${F}]`),jt("已复制引用标记","ok")}function U(F,ut){return ut==="apa"?`${F.author} (${F.year}). ${F.title}. ${F.source}.`:ut==="mla"?`${F.author}. "${F.title}." ${F.source}, ${F.year}.`:`${F.author}. ${F.title}[J]. ${F.source}, ${F.year}.`}function ft(F){const ut=o(l).map(Nt=>U(Nt,F)).join(`

`),W=new Blob([ut],{type:"text/plain"}),lt=URL.createObjectURL(W),dt=document.createElement("a");dt.href=lt,dt.download=`references_${F}.txt`,dt.click(),URL.revokeObjectURL(lt),jt(`已导出 ${F.toUpperCase()} 格式参考文献`,"ok")}Us(()=>{s()&&S()}),Vi(()=>(Uo(s()),n(),o(u)),()=>{if(s()){const F=n();F&&F!==o(u)&&(_(u,F),S())}}),Vo();var tt={get visible(){return s()},set visible(F){s(F),on()},$set:nr,$on:(F,ut)=>er(e,F,ut)};ai();var ot=dr(),K=he(ot);{var bt=F=>{var ut=Gv(),W=y(ut),lt=y(W),dt=h(y(lt),2);b(lt);var Nt=h(lt,2),Ot=y(Nt),At=h(y(Ot),2),Zt=y(At);Gn(Zt);var Jt=h(Zt,2);Gn(Jt);var Dt=h(Jt,2);Gn(Dt);var Pt=h(Dt,2);Gn(Pt);var kt=h(Pt,2);Gn(kt),b(At);var oe=h(At,2);b(Ot);var ue=h(Ot,2),ge=h(y(ue),2),et=y(ge),nt=h(et,2),St=h(nt,2);b(ge),b(ue);var Lt=h(ue,2),Ct=y(Lt),vn=y(Ct);b(Ct);var xn=h(Ct,2);{var ie=te=>{var Ae=Jv();P(te,Ae)},Pe=te=>{var Ae=dr(),kn=he(Ae);{var rr=Ye=>{var an=zv();P(Ye,an)},gr=Ye=>{var an=Vv();Fe(an,5,()=>o(l),Ke,($n,zt)=>{var Tn=Wv(),En=y(Tn),qe=y(En),pn=y(qe);b(qe);var me=h(qe,2),hn=y(me);b(me);var An=h(me,2);{var Rn=ln=>{var Oe=Uv(),ae=y(Oe,!0);b(Oe),ht(()=>ct(ae,(o(zt),J(()=>o(zt).source)))),P(ln,Oe)};_t(An,ln=>{o(zt),J(()=>o(zt).source)&&ln(Rn)})}b(En);var be=h(En,2),Ce=y(be),Pn=h(Ce,2);b(be),b(Tn),ht(()=>{ct(pn,`[@${o(zt),J(()=>o(zt).id)??""}]`),ct(hn,`${o(zt),J(()=>o(zt).author)??""} (${o(zt),J(()=>o(zt).year)??""}). ${o(zt),J(()=>o(zt).title)??""}`)}),A("click",Ce,()=>j(o(zt).id)),A("click",Pn,()=>B(o(zt).id)),P($n,Tn)}),b(an),P(Ye,an)};_t(kn,Ye=>{o(l),J(()=>o(l).length===0)?Ye(rr):Ye(gr,!1)},!0)}P(te,Ae)};_t(xn,te=>{o(a)?te(ie):te(Pe,!1)})}b(Lt),b(Nt),b(W),b(ut),ht(()=>ct(vn,`已有引用 (${o(l),J(()=>o(l).length)??""})`)),A("click",dt,()=>s(!1)),Re(Zt,()=>o(g).id,te=>Yr(g,o(g).id=te)),Re(Jt,()=>o(g).author,te=>Yr(g,o(g).author=te)),Re(Dt,()=>o(g).title,te=>Yr(g,o(g).title=te)),Re(Pt,()=>o(g).year,te=>Yr(g,o(g).year=te)),Re(kt,()=>o(g).source,te=>Yr(g,o(g).source=te)),A("click",oe,N),A("click",et,()=>ft("apa")),A("click",nt,()=>ft("mla")),A("click",St,()=>ft("gb")),A("click",W,Kc(function(te){Qc.call(this,e,te)})),A("click",ut,()=>s(!1)),P(F,ut)};_t(K,F=>{s()&&F(bt)})}P(t,ot);var rt=Fn(tt);return i(),rt}const Kv="modulepreload",Xv=function(t){return"/"+t},Vl={},Yv=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),a=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));i=Promise.allSettled(n.map(u=>{if(u=Xv(u),u in Vl)return;Vl[u]=!0;const v=u.endsWith(".css"),g=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${g}`))return;const S=document.createElement("link");if(S.rel=v?"stylesheet":Kv,v||(S.as="script"),S.crossOrigin="",S.href=u,a&&S.setAttribute("nonce",a),document.head.appendChild(S),v)return new Promise(($,I)=>{S.addEventListener("load",$),S.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${u}`)))})}))}function s(l){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=l,window.dispatchEvent(a),!a.defaultPrevented)throw l}return i.then(l=>{for(const a of l||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})};let Kr=null,da=null;async function Qv(){try{return da?!0:(Kr=await Yv(()=>import("./chunk-wa_bridge.js"),[]),Kr!=null&&Kr.default&&await Kr.default(),da=(Kr==null?void 0:Kr.WasmEditor)??null,da?(console.log("已加载 Rust WASM 引擎"),!0):(console.warn("未找到 Rust WASM 入口：WasmEditor"),!1))}catch(t){return console.warn("Rust WASM 加载失败，回退到 contenteditable：",t),!1}}var Zv=V('<div class="generation-banner svelte-1n46o8q"> </div>'),tp=V('<div class="failure-row svelte-1n46o8q"><span> </span> <button class="btn ghost svelte-1n46o8q">重试</button></div>'),ep=V('<section class="section-failures svelte-1n46o8q"><div class="panel-title svelte-1n46o8q">失败章节</div> <!></section>'),np=V('<div class="panel-empty svelte-1n46o8q">加载中...</div>'),rp=V('<div class="panel-empty svelte-1n46o8q"> </div>'),ip=V('<div class="panel-empty svelte-1n46o8q">暂无版本</div>'),sp=V('<div class="version-summary svelte-1n46o8q"> </div>'),op=V('<div class="version-summary svelte-1n46o8q"> </div>'),ap=V('<div><div><div class="minor-title svelte-1n46o8q"> </div> <!> <div class="minor-meta svelte-1n46o8q"> </div></div> <div class="minor-actions svelte-1n46o8q"><button class="btn ghost svelte-1n46o8q">切换</button> <button class="btn ghost svelte-1n46o8q">对比</button></div></div>'),lp=V('<div class="version-minors svelte-1n46o8q"></div>'),cp=V('<div class="version-group"><div><div class="version-title svelte-1n46o8q"><span> </span> <span> </span></div> <div class="version-meta svelte-1n46o8q"><span> </span> <span> </span></div> <!> <div class="version-actions svelte-1n46o8q"><button class="btn ghost svelte-1n46o8q">切换</button> <button class="btn ghost svelte-1n46o8q">对比</button></div></div> <!></div>'),up=V('<div class="version-groups svelte-1n46o8q"></div>'),fp=V('<span class="selected-chip svelte-1n46o8q"></span>'),dp=V('<div class="inline-style-row compact svelte-1n46o8q"><span>字体</span> <select class="svelte-1n46o8q"><option>默认</option><option>宋体</option><option>黑体</option><option>微软雅黑</option><option>楷体</option><option>仿宋</option></select> <span>字号</span> <select class="svelte-1n46o8q"><option>默认</option><option>12pt</option><option>14pt</option><option>16pt</option><option>18pt</option><option>20pt</option></select> <span>行距</span> <select class="svelte-1n46o8q"><option>默认</option><option>1.2</option><option>1.5</option><option>1.75</option><option>2.0</option></select></div> <div class="panel-empty svelte-1n46o8q">这些样式只作用于当前选中的段落块，不会影响全篇。</div>',1),vp=V('<div class="assistant-inline-tip svelte-1n46o8q"><div>用于处理这批选中段落的复杂修改需求。</div> <div class="assistant-inline-actions svelte-1n46o8q"><button class="btn ghost svelte-1n46o8q">呼出改动对话窗口</button> <button class="btn ghost svelte-1n46o8q">发到右下角全局助手</button></div></div>'),pp=V('<div class="inline-preset-row svelte-1n46o8q"><button class="preset-chip svelte-1n46o8q">更正式</button> <button class="preset-chip svelte-1n46o8q">更简洁</button> <button class="preset-chip svelte-1n46o8q">更详细</button> <button class="preset-chip svelte-1n46o8q">保留术语</button></div> <div class="inline-ai-row svelte-1n46o8q"><textarea class="inline-instruction svelte-1n46o8q" placeholder="例如：仅重写选中段落，语气更正式，减少20%字数。"></textarea></div> <div class="inline-action-row svelte-1n46o8q"><button class="btn ghost svelte-1n46o8q">改动对话窗口</button> <button class="btn primary svelte-1n46o8q"> </button></div>',1),hp=V('<div class="block-error svelte-1n46o8q"> </div>'),gp=V("<button><span> </span> <span> </span></button>"),mp=V('<div class="candidate-card svelte-1n46o8q"><div class="candidate-head svelte-1n46o8q"><span> </span> <span class="candidate-meta svelte-1n46o8q"> </span></div> <div class="candidate-actions svelte-1n46o8q"><button class="btn primary svelte-1n46o8q">采纳到正文</button> <button class="btn ghost svelte-1n46o8q">重新生成</button> <button class="btn ghost danger svelte-1n46o8q">忽略建议</button></div> <div class="candidate-label svelte-1n46o8q">建议文本</div> <div class="candidate-text svelte-1n46o8q"> </div></div>'),_p=V('<div class="candidate-compare compact svelte-1n46o8q"><div class="candidate-before svelte-1n46o8q"><div class="candidate-label svelte-1n46o8q">原文</div> <div class="candidate-text svelte-1n46o8q"> </div></div> <div class="candidate-panel svelte-1n46o8q"><div class="candidate-switches svelte-1n46o8q"></div> <!></div></div>'),bp=V('<div class="inline-tabs svelte-1n46o8q"><button>改写建议</button> <button>样式设置</button> <button>改动对话</button></div> <div class="selected-targets svelte-1n46o8q"></div> <!> <!> <!> <!> <!>',1),yp=V('<div class="panel-empty svelte-1n46o8q">选中段落后可做轻量修改。支持多选：鼠标拖动框选、`Ctrl/Cmd + 点击` 逐个添加、`Shift + 点击` 连续选择。</div>'),wp=V('<div class="block-dialog-backdrop svelte-1n46o8q" role="button" tabindex="0" aria-label="关闭改动对话窗口"><div class="block-dialog svelte-1n46o8q"><div class="block-dialog-head svelte-1n46o8q"><div><div class="panel-title svelte-1n46o8q">改动对话窗口</div> <div class="panel-sub svelte-1n46o8q">仅针对当前选中的段落块</div></div> <button class="btn ghost btn-sm svelte-1n46o8q">关闭</button></div> <textarea class="inline-instruction svelte-1n46o8q" placeholder="例如：将选中段落统一改为更正式的学术语气，并保持原结论。"></textarea> <div class="inline-action-row svelte-1n46o8q"><button class="btn ghost svelte-1n46o8q">取消</button> <button class="btn primary svelte-1n46o8q">发送到助手</button></div></div></div>'),Sp=V("<!> <!> <!>",1),xp=V('<main><header class="topbar svelte-1n46o8q"><div class="brand svelte-1n46o8q"><div class="logo svelte-1n46o8q">IR</div> <div class="brand-text"><div class="brand-title svelte-1n46o8q">写作引擎</div> <div class="brand-sub svelte-1n46o8q">Doc IR · 语义写作</div></div></div> <nav class="menu svelte-1n46o8q"><button class="menu-item svelte-1n46o8q">概览</button> <button class="menu-item svelte-1n46o8q">模板</button> <button class="menu-item svelte-1n46o8q">协作</button> <button class="menu-item svelte-1n46o8q">历史</button> <button class="menu-item svelte-1n46o8q">帮助</button></nav> <div class="top-actions svelte-1n46o8q"><div class="status-chip svelte-1n46o8q"><span class="dot svelte-1n46o8q"></span> <span> </span></div> <div class="status-chip light svelte-1n46o8q"> </div> <button class="btn ghost svelte-1n46o8q">保存</button> <button class="btn ghost svelte-1n46o8q">导出 Word</button> <button class="btn ghost svelte-1n46o8q">导出 PDF</button> <!></div></header> <div class="workspace svelte-1n46o8q"><aside class="nav-rail svelte-1n46o8q"><button class="nav-btn active svelte-1n46o8q" title="文档"><span>文档</span></button> <button class="nav-btn svelte-1n46o8q" title="画布"><span>画布</span></button> <button class="nav-btn svelte-1n46o8q" title="引用"><span>引用</span></button> <button class="nav-btn svelte-1n46o8q" title="文档库"><span>文档库</span></button></aside> <section class="doc-area svelte-1n46o8q"><div class="doc-toolbar svelte-1n46o8q"><div class="toolbar-line svelte-1n46o8q"><div class="toolbar-cluster svelte-1n46o8q"><span class="cluster-label svelte-1n46o8q">文本</span> <button class="tool-btn svelte-1n46o8q" title="撤销">↶</button> <button class="tool-btn svelte-1n46o8q" title="重做">↷</button> <button class="tool-btn svelte-1n46o8q" title="清除格式">Tx</button> <span class="tool-sep svelte-1n46o8q"></span> <button class="tool-btn svelte-1n46o8q" title="加粗">B</button> <button class="tool-btn svelte-1n46o8q" title="斜体">I</button> <button class="tool-btn svelte-1n46o8q" title="下划线">U</button></div> <div class="toolbar-cluster svelte-1n46o8q"><span class="cluster-label svelte-1n46o8q">结构</span> <button class="tool-btn svelte-1n46o8q">H1</button> <button class="tool-btn svelte-1n46o8q">H2</button> <button class="tool-btn svelte-1n46o8q">引用</button> <button class="tool-btn svelte-1n46o8q">代码</button> <button class="tool-btn svelte-1n46o8q">列表</button> <button class="tool-btn svelte-1n46o8q">1.</button></div> <div class="toolbar-cluster svelte-1n46o8q"><span class="cluster-label svelte-1n46o8q">插入</span> <button class="tool-btn svelte-1n46o8q">表格</button> <button class="tool-btn svelte-1n46o8q">图片</button> <button class="tool-btn svelte-1n46o8q">画布</button> <button class="tool-btn svelte-1n46o8q">引用</button></div></div> <div class="toolbar-line right svelte-1n46o8q"><div class="toolbar-cluster compact svelte-1n46o8q"><span class="cluster-label svelte-1n46o8q">智能写作</span> <button class="btn ghost svelte-1n46o8q">生成</button> <button class="btn ghost svelte-1n46o8q">停止</button></div></div></div> <!> <!> <div class="doc-stage svelte-1n46o8q"><!></div></section> <aside class="side-panel svelte-1n46o8q"><div class="panel-card version-panel svelte-1n46o8q"><div class="panel-header svelte-1n46o8q"><div><div class="panel-title svelte-1n46o8q">版本树</div> <div class="panel-sub svelte-1n46o8q">自动小版本 · 手动大版本</div></div> <button class="icon-btn svelte-1n46o8q" title="刷新">刷新</button></div> <div class="major-commit svelte-1n46o8q"><input class="version-input svelte-1n46o8q" placeholder="输入版本说明"/> <button class="btn primary svelte-1n46o8q">保存版本</button></div> <!> <div class="version-diff svelte-1n46o8q"><div class="panel-sub svelte-1n46o8q">对比结果</div> <pre class="svelte-1n46o8q"> </pre></div></div> <div class="panel-card block-panel svelte-1n46o8q"><div class="panel-header svelte-1n46o8q"><div><div class="panel-title svelte-1n46o8q">选中内容轻量修改</div> <div class="panel-sub svelte-1n46o8q"> </div></div></div> <!></div></aside></div> <div><button class="assistant-toggle svelte-1n46o8q"> </button> <!></div> <!></main> <!> <!> <!>',1);function wu(t,e){if(new.target)return tr({component:wu,...t});Bn(e,!1);const n=()=>ke(Ve,"$sourceText",I),r=()=>ke(We,"$docIr",I),i=()=>ke(Jr,"$docId",I),s=()=>ke(Be,"$docIrDirty",I),l=()=>ke(Jl,"$darkMode",I),a=()=>ke(To,"$generating",I),u=()=>ke(Hi,"$flowStatus",I),v=()=>ke(Jn,"$docStatus",I),g=()=>ke(tl,"$wordCount",I),S=()=>ke(Si,"$instruction",I),$=()=>ke(yo,"$isLoading",I),[I,N]=ds();let B=null,j="",U=null,ft=null,tt=!1,ot=!1,K=[],bt=null,rt=0,F=0,ut=!1,W=!1,lt=null,dt=null,Nt=0,Ot="",At="",Zt=!1,Jt=!1,Dt=!1,Pt=0,kt=0,oe=0,ue=9e4,ge=null,et=!1,nt=Q({current:0,total:0,percent:0,etaS:0,section:""}),St=0,Lt=[],Ct=Q([]),vn=!1,xn=Q(null),ie=Q(""),Pe=null,te=Q(!1),Ae=Q(!1),kn=Q(!1),rr=[],gr=Q([]),Ye=Q(""),an=Q(""),$n=Q(""),zt=Q(!0),Tn=Q(!1),En="",qe=Q([]),pn=Q([]),me=Q(""),hn=Q(""),An=Q(""),Rn=Q(""),be=Q(""),Ce=Q("rewrite"),Pn=Q(!1),ln=Q(""),Oe=Q(""),ae=Q([]),je=Q(0),qn=Q(null),Cn=Q(!1),ir=Q(""),li=null;typeof window<"u"&&document.body.setAttribute("data-engine","rust");function Ci(){return li||(li=Qv().then(f=>f).catch(()=>!1)),li}function Kt(){var w,k;const f=window;if(f.__DOC_ID__)return String(f.__DOC_ID__);const p=(w=document.body)==null?void 0:w.getAttribute("data-doc-id");return p||((k=document.querySelector('meta[name="doc-id"]'))==null?void 0:k.getAttribute("content"))||""}function $t(){if(!Nt)return new Date().toLocaleTimeString();const f=Date.now()-Nt,p=Math.max(0,Math.floor(f/1e3)),T=String(Math.floor(p/60)).padStart(2,"0"),w=String(p%60).padStart(2,"0");return`+${T}:${w}`}function le(f){const p=(f||"").toUpperCase();return p==="PLAN"?"规划":p==="WRITE"?"写作":p==="DONE"?"完成":p==="STOPPED"?"已停止":f}function cn(f){const p=String(f||"");p.trim()&&(p.length<8&&!/[\w\u4e00-\u9fa5]/.test(p)||(j+=p,U&&clearTimeout(U),U=setTimeout(()=>{const T=j.slice(-120);sn("写作",T,$t()),j="",U=null},500)))}function yt(f,p){if(!p&&!tt&&!ot)return;const T=String(f??n()??"");ft&&clearTimeout(ft),ft=setTimeout(()=>{if(!p&&!tt&&!ot)return;const w=Ca(T);w&&(We.set(w),Be.set(!1))},120)}function He(){K=[],F=0,ut=!1,W=!1,lt=null,dt=null,rt+=1,ot=!1,bt&&(clearTimeout(bt),bt=null)}function fe(){let f=26,p=14;return F>1600?(f=120,p=6):F>700?(f=72,p=8):F>260&&(f=46,p=11),ut&&(f=Math.max(f,140),p=Math.min(p,5)),{chunk:f,delayMs:p}}function Qe(f,p,T){Ve.update(w=>{const k=String(w||""),L=T?k+p:In(k,f,p);return yt(L),L}),cn(p)}function jn(f){if(f!==rt)return;if(!K.length){W=!1,ut=!1,lt!==null&&(de(lt,dt),lt=null,dt=null),ot=!1;return}const p=K[0],T=fe(),w=p.text.slice(0,T.chunk);p.text=p.text.slice(w.length),F=Math.max(0,F-w.length),p.text||K.shift(),w&&Qe(p.section,w,p.raw),bt=setTimeout(()=>jn(f),T.delayMs)}function ye(){if(W||!K.length)return;W=!0,ot=!0;const f=++rt;jn(f)}function un(f,p,T){const w=String(p||"");w&&(K.push({section:String(f||""),raw:!!(T!=null&&T.raw),text:w}),F+=w.length,ye())}function de(f,p){const T=String(f||"");if(Ve.set(T),p&&typeof p=="object")We.set(p),Be.set(!1);else{const w=Ca(T);w?(We.set(w),Be.set(!1)):(We.set(null),Be.set(!0))}}function we(f,p){if(lt=String(f||""),dt=p||null,!K.length&&!W){de(lt,dt),lt=null,dt=null;return}ut=!0,ye()}let Wt=0;async function sr(f,p){const T=++Wt,w=Math.max(10,(p==null?void 0:p.chunk)??36),k=Math.max(10,(p==null?void 0:p.delayMs)??18);ot=!0,Be.set(!0),Ve.set("");let L=0;for(;L<f.length;){if(T!==Wt)return;const C=f.slice(L,L+w);Ve.update(O=>{const Z=String(O||"")+C;return yt(Z),Z}),cn(C),L+=w,await new Promise(O=>setTimeout(O,k))}T===Wt&&(p!=null&&p.finalDocIr&&typeof p.finalDocIr=="object"?(We.set(p.finalDocIr),Be.set(!1)):yt(f,!0),ot=!1)}function ci(f,p,T){let w=String(f||"").replace(/\r/g,"");/^#\s+/m.test(w)||(w=`# ${p||"自动生成文档"}

`+w.trimStart());for(const k of T||[]){const L=String(k||"").trim();if(!L)continue;new RegExp(`^##\\s+${L.replace(/[.*+?^${}()|[\]\\\\]/g,"\\\\$&")}\\s*$`,"m").test(w)||(w=(w.trimEnd()+`

## ${L}

`).replace(/\n{4,}/g,`

`))}return w}function vs(f){const p=String(f||"").trim(),T=/^H[23]::(.*)$/.exec(p);return(T?T[1]:p).trim()}function Cr(f){return f.replace(/[.*+?^${}()|[\]\\/]/g,"\\$&")}function ui(f){const p=f.detail||{};if(p.docIr&&typeof p.docIr=="object"&&(We.set(p.docIr),Be.set(!1),Pe=p.docIr),p.text){const T=String(p.text||"");Ve.set(T),_(ie,T)}p.meta&&p.meta.action&&jt("Block updated","ok")}function Vs(f){const p=f.detail||{},T=Array.isArray(p.blockIds)?p.blockIds.map(O=>String(O||"").trim()).filter(Boolean):[],w=String(p.blockId||""),k=T.length?T:w?[w]:[];if(!k.length&&o(qe).length){const O=document.activeElement;if(O&&(O.closest(".selection-panel")||O.closest(".block-dialog")))return}const L=Array.isArray(p.blocks)?p.blocks.map(O=>({id:String((O==null?void 0:O.id)||"").trim(),text:String((O==null?void 0:O.text)||""),style:O!=null&&O.style&&typeof O.style=="object"?O.style:{}})).filter(O=>O.id):[];_(qe,k),_(pn,L.length?L:k.map(O=>({id:O,text:String(p.text||""),style:{}}))),En=k[0]||"",_(me,o(pn).length>1?o(pn).map((O,Z)=>`[块${Z+1}] ${O.text}`.trim()).join(`

`):String(p.text||"")),_(Oe,o(me)),_(ae,[]),_(je,0),_(Ce,"rewrite"),_(Cn,!1),_(ir,"");const C=p.style&&typeof p.style=="object"?p.style:{};_(hn,String(C.fontSize||"")),_(An,String(C.lineHeight||"")),_(Rn,String(C.fontFamily||"")),_(ln,"")}function Go(f,p,T){const w=new Set((p||[]).map(pt=>String(pt||"").trim()).filter(Boolean));if(!w.size)return null;const k=Array.isArray(f.sections)?f.sections:[];let L=!1;const C=pt=>{const Ft={...pt};for(const[ee,xe]of Object.entries(T)){const vt=String(xe||"").trim();vt?Ft[ee]=vt:delete Ft[ee]}return Ft},O=pt=>{let Ft=!1;const xe=(Array.isArray(pt==null?void 0:pt.blocks)?pt.blocks:[]).map(mt=>{if(!w.has(String((mt==null?void 0:mt.id)||"")))return mt;Ft=!0,L=!0;const st=mt!=null&&mt.style&&typeof mt.style=="object"?mt.style:{};return{...mt,style:C(st)}}),vt=Array.isArray(pt==null?void 0:pt.children)?pt.children:[],Ze=vt.map(mt=>O(mt)),tn=Ze.some((mt,st)=>mt!==vt[st]);if(!Ft&&!tn)return pt;const ze={...pt};return Ft&&(ze.blocks=xe),tn&&(ze.children=Ze),ze},Z=k.map(pt=>O(pt));return L?{...f,sections:Z}:null}function ps(f){const p=o(qe).length?o(qe):En?[En]:[];if(!p.length||!r())return;const T=Go(r(),p,f);T&&(Ii(T),x().catch(()=>{}))}function Gs(){return o(qe).length?o(qe).slice():En?[En]:[]}function Ks(){return o(pn).length>1?o(pn).map((f,p)=>`[块${p+1}] ${f.text}`.trim()).join(`

`):o(pn).length===1?String(o(pn)[0].text||""):o(me).trim()}function Xs(f){_(Ce,"assistant"),_(zt,!0);const p=Gs(),T=Ks(),w=String(f||"").trim();if(T&&p.length>0){const k=p.length>1?`请只修改我选中的 ${p.length} 个段落块，不要改其他段落。`:"请只修改我选中的这段内容，不要改其他段落。";Si.set(`${k}
${T}

修改要求：${w}`)}queueMicrotask(()=>{const k=document.querySelector(".assistant-dock .composer textarea");k&&k.focus()})}async function Ys(){const f=Gs();if(!i()||!f.length)return;const p=o(be).trim();if(p){_(Pn,!0),_(ln,""),_(ae,[]);try{if(!r()||typeof r()!="object")throw new Error("文档尚未就绪");const T=r();if(_(Oe,Ks()),f.length===1){const w={block_id:f[0],instruction:p};r()&&(w.doc_ir=r());const k=await fetch(`/api/doc/${i()}/block-edit/preview`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(w)});if(!k.ok)throw new Error(await k.text());const L=await k.json();_(Oe,String(L.before||o(me)||""));const C=Array.isArray(L.candidates)?L.candidates:[];_(ae,C.filter(O=>O&&typeof O=="object"&&O.doc_ir&&!O.error).map((O,Z)=>({label:String(O.label||`方案${Z+1}`),selectedAfter:to(String(O.selected_after||""),o(Oe)),selectedBefore:String(O.selected_before||o(Oe)||""),docIr:O.doc_ir,diff:O.diff})))}else{const w=[{label:"方案A",instruction:p},{label:"方案B",instruction:`${p}。请采用另一种表达方式，保持原意但在句式和组织上有明显差异。`}],k=[];for(const L of w){let C=JSON.parse(JSON.stringify(T));const O=[],Z=[];for(const pt of f){const Ft={block_id:pt,instruction:L.instruction,doc_ir:C,variants:[{label:L.label,instruction:L.instruction}]},ee=await fetch(`/api/doc/${i()}/block-edit/preview`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ft)});if(!ee.ok)throw new Error(await ee.text());const xe=await ee.json(),vt=Array.isArray(xe.candidates)?xe.candidates[0]:null;if(!vt||!vt.doc_ir)throw new Error(`未生成可用候选：${L.label}`);const Ze=String(xe.before||""),tn=to(String(vt.selected_after||""),Ze);Ze&&O.push(Ze),tn&&Z.push(tn),C=vt.doc_ir}k.push({label:L.label,selectedAfter:Z.join(`

`),selectedBefore:O.join(`

`)||o(Oe),docIr:C,diff:""})}_(ae,k)}if(!o(ae).length)throw new Error("没有生成可用候选版本");_(je,0)}catch(T){_(ln,T instanceof Error?T.message:"候选生成失败")}finally{_(Pn,!1)}}}function ji(f){const p=o(be).trim();_(be,p?`${p}；${f}`:f),_(Ce,"rewrite")}function Qs(){_(ir,o(be).trim()),_(Cn,!0)}function Zs(){const f=o(ir).trim();f&&(_(be,f),_(Cn,!1),Xs(f))}function to(f,p){const T=String(f||"").trim();if(!T)return"";const w=String(p||"").trim();let k=T.replace(/^\s*```[a-zA-Z0-9_-]*\s*/g,"").replace(/\s*```\s*$/g,"").trim();const L=/(?:改写后(?:的)?(?:文本|版本)?|优化后(?:的)?(?:文本|版本)?|重写后(?:的)?(?:文本|版本)?|润色后(?:的)?(?:文本|版本)?|rewritten\s*text|revised\s*version|final\s*version)\s*[:：]\s*/gi;let C=null;for(;;){const Z=L.exec(k);if(!Z)break;C=Z}if(C&&C.index>=0&&(k=k.slice(C.index+C[0].length).trim()),w&&k.startsWith(w)){const Z=k.slice(w.length).replace(/^[\s:：\-—]+/,"");Z.length>=4&&(k=Z)}const O=k.split(/\n{2,}/).map(Z=>Z.trim()).filter(Boolean);if(w&&O.length>=2){const Z=O.filter(pt=>pt!==w);Z.length&&Z.length<O.length&&(k=Z.join(`

`))}return k.trim()}function eo(f){const p=String((f==null?void 0:f.selectedAfter)||""),T=String((f==null?void 0:f.selectedBefore)||o(Oe)||""),w=p.length-T.length;return w===0?"长度不变":w>0?`增加 ${w} 字`:`减少 ${Math.abs(w)} 字`}function hs(){_(ae,[]),_(je,0),_(ln,""),jt("已忽略本轮建议","info")}async function no(f){const p=o(ae)[f];if(!p||!i()||!p.docIr)return;const T=p.docIr;Ii(T);try{await fetch(`/api/doc/${i()}/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({doc_ir:T})}),await fetch(`/api/doc/${i()}/version/commit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:`块修改:${p.label}`,author:"user",kind:"minor"})}),jt(`已应用${p.label}`,"ok"),_(ae,[]),_(je,0),_(be,""),await H()}catch(w){_(ln,w instanceof Error?w.message:"应用候选失败")}}function Ii(f){We.set(f),Be.set(!1),Pe=f;const p=Mo(f)||"";Ve.set(p),_(ie,p)}function Ko(f){if(!f||typeof f!="object")return;const p=r();if(!p||typeof p!="object")return;const T=Array.isArray(p.sections)?p.sections:[];if(!T.length)return;const w=T[0],k=Array.isArray(w.blocks)?w.blocks.slice():[],L={id:Math.random().toString(36).slice(2),type:"figure",figure:f};k.push(L);const C={...w,blocks:k},O=T.slice();O[0]=C;const Z={...p,sections:O};Ii(Z)}const gs=new Map;async function Xo(f){if(!f)return null;if(gs.has(f))return gs.get(f);try{const p=await fetch(`/api/text/${encodeURIComponent(f)}`);if(!p.ok)throw new Error(await p.text());const T=await p.json();return gs.set(f,T),T}catch{return null}}function Ni(f){if(!f)return"";const p=String(f.kind||""),T=String(f.format||"");if(T==="text")return String(f.text||"");if(T==="json"){const w=f.data||{};if(p==="list")return(Array.isArray(w.items)?w.items:[]).map(L=>`- ${String(L).trim()}`).join(`
`);if(p==="table")return`[[TABLE:${JSON.stringify(w)}]]`;if(p==="figure")return`[[FIGURE:${JSON.stringify(w)}]]`;if(w.text)return String(w.text)}return""}async function ro(f,p){const T=await Xo(p),w=Ni(T);w&&un(String(f||""),w,{raw:!f})}function ms(f){let p=String(f||"").replace(/\r/g,"");return p=p.replace(/(\n(?:-|\d+\.)[^\n]*)(?:\n{2,})(?=(?:-|\d+\.)\s)/g,`$1
`),p=p.replace(/\n{3,}/g,`

`),p}function In(f,p,T){const w=vs(p),k=String(T||"").replace(/\r/g,"");if(!k||!k.trim()&&!k.includes(`
`))return String(f||"");if(!w){const ze=String(f||"").replace(/\r/g,""),mt=ze+(ze.endsWith(`
`)||!ze?"":`
`)+k;return ms(mt)}let L=String(f||"").replace(/\r/g,"");const C=new RegExp(`^##\\s+${Cr(w)}\\s*$`,"m");C.test(L)||(L=ci(L,"",[w]));const O=C.exec(L);if(!O){const ze=L+(L.endsWith(`
`)?"":`
`)+delta;return ms(ze)}const Z=O.index+O[0].length,Ft=L.slice(Z).search(/^##\s+/m),ee=Ft>=0?Z+Ft:L.length,xe=L.slice(0,ee),vt=L.slice(ee),tn=xe.replace(/\s+$/,"")+`

${k}
`+vt;return ms(tn)}function io(f){const p=String(f||"").replace(/\r/g,"").split(`
`);let T="message";const w=[];for(const C of p)C.startsWith("event:")&&(T=C.slice(6).trim()),C.startsWith("data:")&&w.push(C.slice(5).trim());const k=w.join(`
`);let L={};try{L=k?JSON.parse(k):{}}catch{L={raw:k}}return{event:T,data:L}}async function Yo(f,p,T,w){const k=await fetch(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p),signal:w});if(!k.ok){const pt=await k.text()||k.statusText||"请求失败";throw new Error(`HTTP ${k.status}: ${pt}`)}if(!k.body)throw new Error("当前环境不支持流式输出");const L=k.body.getReader(),C=new TextDecoder("utf-8");let O="";for(;;){const{value:Z,done:pt}=await L.read();if(pt)break;O+=C.decode(Z,{stream:!0});let Ft=O.indexOf(`

`);for(;Ft>=0;){const ee=O.slice(0,Ft);if(O=O.slice(Ft+2),ee.trim()){const{event:xe,data:vt}=io(ee);T(xe,vt)}Ft=O.indexOf(`

`)}}}async function Qo(){const f=i();if(f)try{const p=await fetch(`/api/doc/${f}`);if(!p.ok)throw new Error(await p.text());const T=await p.json();Ve.set(String(T.text||"")),_(ie,String(T.text||"")),T.doc_ir&&typeof T.doc_ir=="object"?(We.set(T.doc_ir),Be.set(!1),Pe=T.doc_ir):(We.set(null),Pe=null),H().catch(()=>{})}catch(p){jt(`加载失败: ${p instanceof Error?p.message:"未知错误"}`,"error")}finally{yo.set(!1)}}function so(f){const p=[],T=Array.isArray(f==null?void 0:f.sections)?f.sections:[],w=k=>{p.push(k),(Array.isArray(k==null?void 0:k.children)?k.children:[]).forEach(C=>w(C))};return T.forEach(k=>w(k)),p}function oo(f){const p=Math.max(1,Math.min(6,Number((f==null?void 0:f.level)||1))),T=String((f==null?void 0:f.title)||"").trim(),w=f!=null&&f.style&&typeof f.style=="object"?JSON.stringify(f.style):"";return`${p}:${T}:${w}`}function c(f){const p=String((f==null?void 0:f.type)||"paragraph").toLowerCase(),T=f!=null&&f.style&&typeof f.style=="object"?f.style:null,w=Array.isArray(f==null?void 0:f.runs)?f.runs:null;if(p==="list"){const C=Array.isArray(f==null?void 0:f.items)?f.items:[],O=!!(f!=null&&f.ordered),Z={type:"list",items:C,ordered:O};return T&&(Z.style=T),w&&(Z.runs=w),Z}if(p==="table"){const C={type:"table",table:(f==null?void 0:f.table)||{}};return T&&(C.style=T),w&&(C.runs=w),C}if(p==="figure"){const C={type:"figure",figure:(f==null?void 0:f.figure)||{}};return T&&(C.style=T),w&&(C.runs=w),C}const L={type:"paragraph",text:String((f==null?void 0:f.text)||"")};return T&&(L.style=T),w&&(L.runs=w),L}function d(f){const p=String((f==null?void 0:f.type)||"paragraph").toLowerCase(),T=f!=null&&f.style?`:style=${JSON.stringify((f==null?void 0:f.style)||{})}`:"",w=f!=null&&f.runs?`:runs=${JSON.stringify((f==null?void 0:f.runs)||[])}`:"";return p==="list"?`list:${JSON.stringify((f==null?void 0:f.items)||[])}:${!!(f!=null&&f.ordered)}${T}`:p==="table"?`table:${JSON.stringify((f==null?void 0:f.table)||{})}${T}`:p==="figure"?`figure:${JSON.stringify((f==null?void 0:f.figure)||{})}${T}`:`paragraph:${String((f==null?void 0:f.text)||"")}${T}${w}`}function m(f,p){var L;if(!f||!p)return null;const T=so(f),w=so(p);if(T.length!==w.length)return null;for(let C=0;C<T.length;C++)if(oo(T[C])!==oo(w[C])||!((L=T[C])!=null&&L.id))return null;const k=[];for(let C=0;C<T.length;C++){const O=T[C],Z=w[C],pt=Array.isArray(O==null?void 0:O.blocks)?O.blocks:[],Ft=Array.isArray(Z==null?void 0:Z.blocks)?Z.blocks:[],ee=pt.map(st=>String((st==null?void 0:st.id)||"")).filter(Boolean),xe=Ft.map(st=>String((st==null?void 0:st.id)||"")).filter(Boolean),vt=new Set(ee),Ze=new Set(xe),tn=new Map(pt.map(st=>[String((st==null?void 0:st.id)||""),st]));for(const st of ee)Ze.has(st)||k.push({op:"delete",target_id:st});const ze=xe.filter(st=>vt.has(st)),mt=ee.filter(st=>Ze.has(st));ze.forEach((st,ne)=>{const Gt=mt.indexOf(st);Gt!==-1&&Gt!==ne&&(k.push({op:"move",target_id:st,parent_id:String(O.id),index:ne}),mt.splice(Gt,1),mt.splice(ne,0,st))}),Ft.forEach((st,ne)=>{const Gt=String((st==null?void 0:st.id)||"");if(Gt&&vt.has(Gt)){const nn=tn.get(Gt);nn&&d(nn)!==d(st)&&k.push({op:"update",target_id:Gt,payload:c(st)});return}const en=c(st);k.push({op:"insert",parent_id:String(O.id),index:ne,payload:en})})}return k}async function x(){const f=i();if(f)try{if(r()&&!s()&&Pe){const T=m(Pe,r());if(T&&T.length>0){const w=await fetch(`/api/doc/${f}/doc_ir/ops`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ops:T})});if(w.ok){const k=await w.json();if(k.doc_ir&&typeof k.doc_ir=="object"&&(We.set(k.doc_ir),Be.set(!1),Pe=k.doc_ir),k.text){const L=String(k.text||"");Ve.set(L),_(ie,L)}else _(ie,n());jt("已保存","ok");return}}else if(T&&T.length===0){_(ie,n()),Pe=r();return}}const p={text:n()};!s()&&r()&&(p.doc_ir=r()),await fetch(`/api/doc/${f}/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)}),_(ie,n()),!s()&&r()?Pe=r():Pe=null,jt("已保存","ok")}catch(p){jt(`保存失败: ${p instanceof Error?p.message:"未知错误"}`,"error")}}function E(f){if(!f)return"";try{return new Date(f*1e3).toLocaleString()}catch{return String(f)}}function D(f){if(!f||typeof f!="object")return"";const p=Number(f.insert||0),T=Number(f.delete||0),w=Number(f.replace||0),k=[];return p&&k.push(`新增${p}`),w&&k.push(`修改${w}`),T&&k.push(`删除${T}`),k.join(" / ")}function R(f){const p=[];let T=null;return f.forEach(w=>{const k=Array.isArray(w==null?void 0:w.tags)?w.tags:[];((w==null?void 0:w.kind)||(k.includes("major")?"major":k.includes("minor")?"minor":""))==="major"||!T?(T={major:w,minors:[]},p.push(T)):T.minors.push(w)}),p}async function H(){if(i()){_(kn,!0),_($n,"");try{const f=await fetch(`/api/doc/${i()}/version/log?branch=main&limit=50`);if(!f.ok)throw new Error(await f.text());const p=await f.json();rr=Array.isArray(p.versions)?p.versions:[],_(gr,R(rr))}catch(f){_($n,f instanceof Error?f.message:"加载失败")}finally{_(kn,!1)}}}async function Y(){if(!i())return;const f=o(an).trim()||"定稿版本";try{const p=await fetch(`/api/doc/${i()}/version/commit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:f,author:"user",kind:"major"})});if(!p.ok)throw new Error(await p.text());_(an,""),await H(),jt("已提交版本","ok")}catch(p){jt(`提交失败: ${p instanceof Error?p.message:"未知错误"}`,"error")}}async function M(f){if(!(!i()||!f))try{const p=await fetch(`/api/doc/${i()}/version/checkout`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({version_id:f})});if(!p.ok)throw new Error(await p.text());const T=await p.json(),w=String(T.doc_text||"");de(w),_(ie,w),await H(),jt("已切换版本","ok")}catch(p){jt(`切换失败: ${p instanceof Error?p.message:"未知错误"}`,"error")}}async function z(f,p){if(!(!i()||!f||!p)){_(Ye,"");try{const T=await fetch(`/api/doc/${i()}/version/diff?from_version=${f}&to_version=${p}`);if(!T.ok)throw new Error(await T.text());const w=await T.json(),k=Array.isArray(w.diff)?w.diff:[];_(Ye,k.join(`
`))}catch(T){_(Ye,T instanceof Error?T.message:"对比失败")}}}async function X(f){if(!f)return;const p=rr.find(T=>T.is_current);!p||p.version_id===f||await z(p.version_id,f)}function G(){i()&&(jt("正在生成PDF...","info"),window.location.href=`/download/${i()}.pdf`)}function it(f){_(te,!1),window.location.href=`/workbench/${f}`}function at(){i()&&(jt("正在生成Word文档...","info"),window.location.href=`/download/${i()}.docx`)}async function gt(f){var T;if(a())return;const p=String(f||"").trim();if(p){if(!i()){const w="缺少文档ID，请刷新或从 /workbench/{id} 进入";Jn.set(`已中止: ${w}`),sn("中止",w,new Date().toLocaleTimeString()),jt(w,"info");return}Wt+=1,He(),Gr("user",p),Si.set(""),To.set(!0),Be.set(!0),tt=!0,Hi.set("分析"),Jn.set("生成中…"),Nt=Date.now(),Ot="",At="",Zt=!1,Jt=!1,Dt=!1,Pt=Date.now(),et=!1,_(nt,{current:0,total:0,percent:0,etaS:0,section:""}),St=Date.now(),Lt=[],oe=0,_(Ct,[]),sn("启动","开始生成",new Date().toLocaleTimeString()),B=new AbortController,yo.set(!1),ge&&clearInterval(ge),ge=setInterval(()=>{if(!a())return;const w=Date.now()-Pt,k=Lt.length>0?Math.round(Lt.reduce((O,Z)=>O+Z,0)/Lt.length):0;let L=Math.max(ue,k*6||0,oe*3||0,9e4);L=Math.min(6e5,L),(/model preparing/i.test(At)||/解析中/.test(At)||Ot==="analysis")&&(L=Math.max(L,18e4)),w>L&&!et&&(et=!0,B==null||B.abort(`客户端超时：${Math.round(w/1e3)}秒无事件，切换非流式生成`))},1e3);try{if(await Yo(`/api/doc/${i()}/generate/stream`,{instruction:p,text:n()||""},(w,k)=>{const L=Date.now();if(Ot=String(w||""),Pt>0&&(kt=L-Pt,kt>0&&kt<12e4&&(Lt=[...Lt,kt].slice(-8)),kt>oe&&kt<6e5&&(oe=kt)),Pt=L,w==="state"){const C=le(String(k.name||""));Hi.set(C||u()),sn("流程",C,$t());return}if(w==="delta"){const C=String(k.delta||"").trim();C&&(Jn.set(C),At=C,sn("进度",C,$t()));return}if(w==="plan"){const C=String(k.title||"自动生成文档"),O=Array.isArray(k.sections)?k.sections:[];sn("大纲",`标题：${C}；章节：${O.join(" / ")}`,$t());const Z=ci(n(),C,O);Ve.set(Z),yt(Z);return}if(w==="section"){if(String(k.phase||"")==="delta"){Dt=!0;const C=String(k.block_id||""),O=String(k.section||""),Z=String(k.block_type||"");if(C){ro(O,C);return}const pt=String(k.delta||"");pt&&un(O,pt,{raw:!O&&!Z})}return}if(w==="progress"){const C=Number(k.current||0),O=Number(k.total||0),Z=Number(k.percent||0),pt=String(k.section||""),Ft=Number(k.elapsed_s||0);if(St===0&&(St=Date.now()),C>0){const xe=(Ft>0?Ft:Math.max(1,Math.round((Date.now()-St)/1e3)))/C,vt=Math.max(0,Math.round(xe*Math.max(0,O-C)));_(nt,{current:C,total:O,percent:Z,etaS:vt,section:pt})}else _(nt,{current:C,total:O,percent:Z,etaS:0,section:pt});return}if(w==="section_error"){const C=String(k.section||""),O=String(k.reason||"unknown");C&&(_(Ct,[...o(Ct),{section:C,reason:O}]),jt(`章节失败: ${C}`,"bad"));return}if(w==="analysis"){const C=String(k.summary||""),O=Array.isArray(k.steps)?k.steps:[],Z=Array.isArray(k.missing)?k.missing:[];if(kd.set(C||"等待解析…"),$d.set(O),Td.set(Z),sn("解析",C||"解析完成",$t()),k.raw){const pt=JSON.stringify(k.raw,null,2).slice(0,600);sn("解析JSON",pt,$t())}return}if(w==="final"){const C=String(k.text||"");if(Dt){const O=k.doc_ir&&typeof k.doc_ir=="object"?k.doc_ir:null;we(C,O)}else{const O=k.doc_ir&&typeof k.doc_ir=="object"?k.doc_ir:null;sr(C,{finalDocIr:O})}Jn.set("完成"),Hi.set("完成"),Zt=!0,Gr("system","已完成生成。"),sn("完成","生成完成",$t()),jt("生成完成","ok"),x().catch(()=>{});return}if(w==="error"){const C=String(k.message||k.reason||k.detail||"服务端未返回具体原因"),Z=String(k.code||k.type||"").toLowerCase().includes("abort")||/aborted|stopped|取消|中止/i.test(C);Jt=!0,Jn.set(Z?`已中止: ${C}`:`生成失败: ${C}`),Gr("system",C),sn(Z?"中止":"错误",C,$t()),jt(C,Z?"info":"bad")}},B.signal),!Zt&&!Jt){const w=At?`流式结束但未完成，最后进度: ${At}`:Ot?`流式结束但未完成，最后事件: ${Ot}`:"流式结束但未完成，服务端未返回原因";Jn.set(`已中止: ${w}`),Gr("system",w),sn("中止",w,$t()),jt(w,"info")}}catch(w){if(String((w==null?void 0:w.name)||"")==="AbortError"){const k=((T=B==null?void 0:B.signal)==null?void 0:T.reason)||(w==null?void 0:w.message)||"用户中止";if(String(k).includes("切换非流式生成")){sn("中止",String(k),$t()),jt(String(k),"info");try{const L=await fetch(`/api/doc/${i()}/generate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({instruction:p,text:n()||""})});if(!L.ok){const Z=await L.text();throw new Error(`HTTP ${L.status}: ${Z||L.statusText}`)}const C=await L.json(),O=String(C.text||"");if(Dt){const Z=C.doc_ir&&typeof C.doc_ir=="object"?C.doc_ir:null;we(O,Z)}else{const Z=C.doc_ir&&typeof C.doc_ir=="object"?C.doc_ir:null;sr(O,{finalDocIr:Z})}Jn.set("完成"),Hi.set("完成"),Gr("system","已完成生成（非流式兜底）。"),sn("完成","非流式生成完成",$t()),jt("生成完成（非流式）","ok"),x().catch(()=>{})}catch(L){const C=(L==null?void 0:L.message)||"非流式生成失败";Jn.set(`生成失败: ${C}`),Gr("system",C),sn("错误",String(C),$t()),jt(String(C),"bad")}}else Jn.set(`已中止: ${k}`),Gr("system",`已中止生成：${k}`),sn("中止",String(k),$t()),jt(String(k),"info")}else{const k=(w==null?void 0:w.message)||"生成失败，请检查模型是否运行。";Jn.set(`生成失败: ${k}`),Gr("system",k),sn("错误",String(k),$t()),jt(String(k),"bad")}}finally{if(To.set(!1),yo.set(!1),tt=!1,ft&&(clearTimeout(ft),ft=null),ge&&(clearInterval(ge),ge=null),oe>0&&typeof localStorage<"u"){const w=Math.min(6e5,Math.max(ue,oe*3,9e4));ue=w;try{localStorage.setItem("wa_idle_base_ms",String(w))}catch{}}B=null}}}function Mt(){B&&B.abort("用户点击停止")}function Bt(f){Aa.set(f)}Us(()=>{const f=localStorage.getItem("darkMode")==="true";Jl.set(f),f&&document.body.classList.add("dark");const p=localStorage.getItem("wa_idle_base_ms");if(p){const k=Number(p);Number.isFinite(k)&&k>0&&(ue=k)}Ci();const T=k=>{if(!vn)return;const L=document.querySelector(".grid");if(!L)return;const C=L.getBoundingClientRect(),O=Math.min(Math.max(k.clientX-C.left,220),C.width-260);Math.round(O/C.width*100)},w=()=>{vn=!1,document.body.style.cursor=""};if(window.addEventListener("mousemove",T),window.addEventListener("mouseup",w),!i()){const k=Kt();k&&(Jr.set(k),Qo().then(()=>Promise.all([Ed(),Ad()])).catch(()=>{}))}return()=>{window.removeEventListener("mousemove",T),window.removeEventListener("mouseup",w),o(xn)&&clearTimeout(o(xn))}}),Vi(()=>(o(je),o(ae)),()=>{o(je)>=o(ae).length&&_(je,0)}),Vi(()=>(o(ae),o(je)),()=>{_(qn,o(ae)[o(je)]||null)}),Vi(()=>(n(),o(ie),a(),o(xn)),()=>{n()&&n()!==o(ie)&&!a()&&(o(xn)&&clearTimeout(o(xn)),_(xn,setTimeout(()=>{x().catch(()=>{})},3e3)))}),Vo();var Je={$set:nr,$on:(f,p)=>er(e,f,p)};ai();var Xt=xp(),Ht=he(Xt);let gn;var jr=y(Ht),ao=h(y(jr),4),_s=y(ao),bs=h(y(_s),2),lo=y(bs,!0);b(bs),b(_s);var Mi=h(_s,2),co=y(Mi);b(Mi);var ys=h(Mi,2),ws=h(ys,2),Ss=h(ws,2),xs=h(Ss,2);hu(xs,{}),b(ao),b(jr);var Oi=h(jr,2),ks=y(Oi),uo=h(y(ks),2),$s=h(uo,2),fo=h($s,2);b(ks);var Di=h(ks,2),Li=y(Di),Bi=y(Li),Fi=y(Bi),Ts=h(y(Fi),2),Es=h(Ts,2),vo=h(Es,2),po=h(vo,4),Yt=h(po,2),se=h(Yt,2);b(Fi);var Se=h(Fi,2),ve=h(y(Se),2),Vt=h(ve,2),Ir=h(Vt,2),As=h(Ir,2),ho=h(As,2),Su=h(ho,2);b(Se);var rl=h(Se,2),il=h(y(rl),2),sl=h(il,2),ol=h(sl,2),xu=h(ol,2);b(rl),b(Bi);var al=h(Bi,2),ll=y(al),Zo=h(y(ll),2),cl=h(Zo,2);b(ll),b(al),b(Li);var ul=h(Li,2);{var ku=f=>{var p=Zv(),T=y(p);b(p),ht(w=>ct(T,`生成中 ${o(nt),J(()=>o(nt).current)??""}/${o(nt),J(()=>o(nt).total)??""} · ${o(nt),J(()=>o(nt).percent)??""}% · 预计剩余 ${w??""} 分 ${o(nt),J(()=>o(nt).etaS%60)??""} 秒`),[()=>(o(nt),J(()=>Math.ceil(o(nt).etaS/60)))]),P(f,p)};_t(ul,f=>{a(),o(nt),J(()=>a()&&o(nt).total>0)&&f(ku)})}var fl=h(ul,2);{var $u=f=>{var p=ep(),T=h(y(p),2);Fe(T,1,()=>o(Ct),Ke,(w,k)=>{var L=tp(),C=y(L),O=y(C,!0);b(C);var Z=h(C,2);b(L),ht(()=>ct(O,(o(k),J(()=>o(k).section)))),A("click",Z,()=>retrySection(o(k).section)),P(w,L)}),b(p),P(f,p)};_t(fl,f=>{o(Ct),J(()=>o(Ct).length>0)&&f($u)})}var dl=h(fl,2),Tu=y(dl);{var Eu=f=>{mu(f,{})},Au=f=>{fu(f,{showToolbar:!1,paper:!0,$$events:{blockedit:ui,blockselect:Vs}})};_t(Tu,f=>{$()?f(Eu):f(Au,!1)})}b(dl),b(Di);var vl=h(Di,2),ta=y(vl),ea=y(ta),qu=h(y(ea),2);b(ea);var na=h(ea,2),ra=y(na);Gn(ra);var Cu=h(ra,2);b(na);var pl=h(na,2);{var ju=f=>{var p=np();P(f,p)},Iu=f=>{var p=dr(),T=he(p);{var w=L=>{var C=rp(),O=y(C,!0);b(C),ht(()=>ct(O,o($n))),P(L,C)},k=L=>{var C=dr(),O=he(C);{var Z=Ft=>{var ee=ip();P(Ft,ee)},pt=Ft=>{var ee=up();Fe(ee,5,()=>o(gr),Ke,(xe,vt)=>{var Ze=cp(),tn=y(Ze),ze=y(tn),mt=y(ze),st=y(mt,!0);b(mt);var ne=h(mt,2),Gt=y(ne,!0);b(ne),b(ze);var en=h(ze,2),nn=y(en),or=y(nn,!0);b(nn);var Hn=h(nn,2),mr=y(Hn,!0);b(Hn),b(en);var mn=h(en,2);{var Ie=Ut=>{var pe=sp(),Qt=y(pe,!0);b(pe),ht(re=>ct(Qt,re),[()=>(o(vt),J(()=>{var re;return D((re=o(vt).major)==null?void 0:re.summary)}))]),P(Ut,pe)};_t(mn,Ut=>{o(vt),J(()=>{var pe;return D((pe=o(vt).major)==null?void 0:pe.summary)})&&Ut(Ie)})}var De=h(mn,2),Ne=y(De),rn=h(Ne,2);b(De),b(tn);var _r=h(tn,2);{var br=Ut=>{var pe=lp();Fe(pe,5,()=>(o(vt),J(()=>o(vt).minors)),Ke,(Qt,re)=>{var ar=ap(),Nr=y(ar),Ur=y(Nr),fi=y(Ur,!0);b(Ur);var Sl=h(Ur,2);{var Wu=qs=>{var oa=op(),Gu=y(oa,!0);b(oa),ht(Ku=>ct(Gu,Ku),[()=>(o(re),J(()=>D(o(re).summary)))]),P(qs,oa)};_t(Sl,qs=>{o(re),J(()=>D(o(re).summary))&&qs(Wu)})}var xl=h(Sl,2),Vu=y(xl,!0);b(xl),b(Nr);var kl=h(Nr,2),sa=y(kl),$l=h(sa,2);b(kl),b(ar),ht(qs=>{bn(ar,1,(o(re),J(()=>`version-minor ${o(re).is_current?"current":""}`)),"svelte-1n46o8q"),ct(fi,(o(re),J(()=>o(re).message||"未命名"))),ct(Vu,qs),sa.disabled=(o(re),J(()=>o(re).is_current)),$l.disabled=(o(re),J(()=>o(re).is_current))},[()=>(o(re),J(()=>E(o(re).timestamp)))]),A("click",sa,()=>M(o(re).version_id)),A("click",$l,()=>X(o(re).version_id)),P(Qt,ar)}),b(pe),P(Ut,pe)};_t(_r,Ut=>{o(vt),J(()=>o(vt).minors&&o(vt).minors.length)&&Ut(br)})}b(Ze),ht((Ut,pe)=>{bn(tn,1,(o(vt),J(()=>{var Qt;return`version-major ${(Qt=o(vt).major)!=null&&Qt.is_current?"current":""}`})),"svelte-1n46o8q"),ct(st,(o(vt),J(()=>{var Qt;return((Qt=o(vt).major)==null?void 0:Qt.message)||"未命名"}))),bn(ne,1,(o(vt),J(()=>{var Qt;return`badge ${((Qt=o(vt).major)==null?void 0:Qt.kind)==="major"?"major":"minor"}`})),"svelte-1n46o8q"),ct(Gt,(o(vt),J(()=>{var Qt;return((Qt=o(vt).major)==null?void 0:Qt.kind)==="major"?"大版本":"小版本"}))),ct(or,Ut),ct(mr,pe),Ne.disabled=(o(vt),J(()=>{var Qt;return(Qt=o(vt).major)==null?void 0:Qt.is_current})),rn.disabled=(o(vt),J(()=>{var Qt;return(Qt=o(vt).major)==null?void 0:Qt.is_current}))},[()=>(o(vt),J(()=>{var Ut;return E(((Ut=o(vt).major)==null?void 0:Ut.timestamp)||0)})),()=>(o(vt),J(()=>{var Ut;return String(((Ut=o(vt).major)==null?void 0:Ut.version_id)||"").slice(0,7)}))]),A("click",Ne,()=>{var Ut;return M((Ut=o(vt).major)==null?void 0:Ut.version_id)}),A("click",rn,()=>{var Ut;return X((Ut=o(vt).major)==null?void 0:Ut.version_id)}),P(xe,Ze)}),b(ee),P(Ft,ee)};_t(O,Ft=>{o(gr),J(()=>o(gr).length===0)?Ft(Z):Ft(pt,!1)},!0)}P(L,C)};_t(T,L=>{o($n)?L(w):L(k,!1)},!0)}P(f,p)};_t(pl,f=>{o(kn)?f(ju):f(Iu,!1)})}var hl=h(pl,2),gl=h(y(hl),2),Nu=y(gl,!0);b(gl),b(hl),b(ta);var ml=h(ta,2),ia=y(ml),_l=y(ia),bl=h(y(_l),2),Mu=y(bl,!0);b(bl),b(_l),b(ia);var Ou=h(ia,2);{var Du=f=>{var p=bp(),T=he(p),w=y(T),k=h(w,2),L=h(k,2);b(T);var C=h(T,2);Fe(C,5,()=>o(pn),Ke,(mt,st,ne)=>{var Gt=fp();Gt.textContent=`块${ne+1}`,ht(()=>Gi(Gt,"title",(o(st),J(()=>o(st).text)))),P(mt,Gt)}),b(C);var O=h(C,2);{var Z=mt=>{var st=dp(),ne=he(st),Gt=h(y(ne),2);ht(()=>{o(Rn),xo(()=>{})});var en=y(Gt);en.value=en.__value="";var nn=h(en);nn.value=nn.__value="宋体";var or=h(nn);or.value=or.__value="黑体";var Hn=h(or);Hn.value=Hn.__value="微软雅黑";var mr=h(Hn);mr.value=mr.__value="楷体";var mn=h(mr);mn.value=mn.__value="仿宋",b(Gt);var Ie=h(Gt,4);ht(()=>{o(hn),xo(()=>{})});var De=y(Ie);De.value=De.__value="";var Ne=h(De);Ne.value=Ne.__value="12pt";var rn=h(Ne);rn.value=rn.__value="14pt";var _r=h(rn);_r.value=_r.__value="16pt";var br=h(_r);br.value=br.__value="18pt";var Ut=h(br);Ut.value=Ut.__value="20pt",b(Ie);var pe=h(Ie,4);ht(()=>{o(An),xo(()=>{})});var Qt=y(pe);Qt.value=Qt.__value="";var re=h(Qt);re.value=re.__value="1.2";var ar=h(re);ar.value=ar.__value="1.5";var Nr=h(ar);Nr.value=Nr.__value="1.75";var Ur=h(Nr);Ur.value=Ur.__value="2",b(pe),b(ne),Co(2),$o(Gt,()=>o(Rn),fi=>_(Rn,fi)),A("change",Gt,()=>ps({fontFamily:o(Rn)})),$o(Ie,()=>o(hn),fi=>_(hn,fi)),A("change",Ie,()=>ps({fontSize:o(hn)})),$o(pe,()=>o(An),fi=>_(An,fi)),A("change",pe,()=>ps({lineHeight:o(An)})),P(mt,st)};_t(O,mt=>{o(Ce)==="style"&&mt(Z)})}var pt=h(O,2);{var Ft=mt=>{var st=vp(),ne=h(y(st),2),Gt=y(ne),en=h(Gt,2);b(ne),b(st),A("click",Gt,Qs),A("click",en,()=>Xs(o(be))),P(mt,st)};_t(pt,mt=>{o(Ce)==="assistant"&&mt(Ft)})}var ee=h(pt,2);{var xe=mt=>{var st=pp(),ne=he(st),Gt=y(ne),en=h(Gt,2),nn=h(en,2),or=h(nn,2);b(ne);var Hn=h(ne,2),mr=y(Hn);ii(mr),b(Hn);var mn=h(Hn,2),Ie=y(mn),De=h(Ie,2),Ne=y(De,!0);b(De),b(mn),ht(rn=>{De.disabled=rn,ct(Ne,o(Pn)?"正在生成建议...":"生成建议（不改原文）")},[()=>(o(Pn),o(be),J(()=>o(Pn)||!o(be).trim()))]),A("click",Gt,()=>ji("语气更正式，保留原意")),A("click",en,()=>ji("压缩到更简洁，控制在80字左右")),A("click",nn,()=>ji("增加解释细节，但不要扩展事实")),A("click",or,()=>ji("保持术语不变，仅调整表达")),Re(mr,()=>o(be),rn=>_(be,rn)),A("click",Ie,Qs),A("click",De,Ys),P(mt,st)};_t(ee,mt=>{o(Ce)==="rewrite"&&mt(xe)})}var vt=h(ee,2);{var Ze=mt=>{var st=hp(),ne=y(st,!0);b(st),ht(()=>ct(ne,o(ln))),P(mt,st)};_t(vt,mt=>{o(ln)&&mt(Ze)})}var tn=h(vt,2);{var ze=mt=>{var st=_p(),ne=y(st),Gt=h(y(ne),2),en=y(Gt,!0);b(Gt),b(ne);var nn=h(ne,2),or=y(nn);Fe(or,5,()=>o(ae),Ke,(mn,Ie,De)=>{var Ne=gp(),rn=y(Ne),_r=y(rn,!0);b(rn);var br=h(rn,2),Ut=y(br,!0);b(br),b(Ne),ht(pe=>{bn(Ne,1,`candidate-switch ${o(je)===De?"active":""}`,"svelte-1n46o8q"),ct(_r,(o(Ie),J(()=>o(Ie).label))),ct(Ut,pe)},[()=>(o(Ie),J(()=>eo(o(Ie))))]),A("click",Ne,()=>_(je,De)),P(mn,Ne)}),b(or);var Hn=h(or,2);{var mr=mn=>{var Ie=mp(),De=y(Ie),Ne=y(De),rn=y(Ne,!0);b(Ne);var _r=h(Ne,2),br=y(_r,!0);b(_r),b(De);var Ut=h(De,2),pe=y(Ut),Qt=h(pe,2),re=h(Qt,2);b(Ut);var ar=h(Ut,4),Nr=y(ar,!0);b(ar),b(Ie),ht(Ur=>{ct(rn,(o(qn),J(()=>o(qn).label))),ct(br,Ur),ct(Nr,(o(qn),J(()=>o(qn).selectedAfter)))},[()=>(o(qn),J(()=>eo(o(qn))))]),A("click",pe,()=>no(o(je))),A("click",Qt,Ys),A("click",re,hs),P(mn,Ie)};_t(Hn,mn=>{o(qn)&&mn(mr)})}b(nn),b(st),ht(()=>ct(en,o(Oe)||o(me))),P(mt,st)};_t(tn,mt=>{o(ae),J(()=>o(ae).length>0)&&mt(ze)})}ht(()=>{bn(w,1,`inline-tab ${o(Ce)==="rewrite"?"active":""}`,"svelte-1n46o8q"),bn(k,1,`inline-tab ${o(Ce)==="style"?"active":""}`,"svelte-1n46o8q"),bn(L,1,`inline-tab ${o(Ce)==="assistant"?"active":""}`,"svelte-1n46o8q")}),A("click",w,()=>_(Ce,"rewrite")),A("click",k,()=>_(Ce,"style")),A("click",L,()=>_(Ce,"assistant")),P(f,p)},Lu=f=>{var p=yp();P(f,p)};_t(Ou,f=>{o(qe),J(()=>o(qe).length>0)?f(Du):f(Lu,!1)})}b(ml),b(vl),b(Oi);var go=h(Oi,2),mo=y(go),Bu=y(mo,!0);b(mo);var Fu=h(mo,2);{var Ru=f=>{Zc(f,{variant:"assistant",$$events:{send:p=>gt(p.detail)}})};_t(Fu,f=>{o(zt)&&f(Ru)})}b(go);var Pu=h(go,2);{var Hu=f=>{_u(f,{indeterminate:!0})};_t(Pu,f=>{a()&&f(Hu)})}b(Ht);var yl=h(Ht,2);{var Ju=f=>{var p=wp(),T=y(p),w=y(T),k=h(y(w),2);b(w);var L=h(w,2);ii(L);var C=h(L,2),O=y(C),Z=h(O,2);b(C),b(T),b(p),ht(pt=>Z.disabled=pt,[()=>(o(ir),J(()=>!o(ir).trim()))]),A("click",k,()=>_(Cn,!1)),Re(L,()=>o(ir),pt=>_(ir,pt)),A("click",O,()=>_(Cn,!1)),A("click",Z,Zs),A("click",p,Gc(()=>_(Cn,!1))),A("keydown",p,pt=>{(pt.key==="Escape"||pt.key==="Enter"||pt.key===" ")&&_(Cn,!1)}),P(f,p)};_t(yl,f=>{o(Cn)&&f(Ju)})}var wl=h(yl,2);du(wl,{get open(){return o(Tn)},get docId(){return i()},$$events:{close:()=>_(Tn,!1),insert:f=>Ko(f.detail.spec)}});var zu=h(wl,2);bu(zu,{children:(f,p)=>{var T=Sp(),w=he(T);vu(w,{});var k=h(w,2);gu(k,{onSelect:it,get visible(){return o(te)},set visible(C){_(te,C)},$$legacy:!0});var L=h(k,2);yu(L,{get visible(){return o(Ae)},set visible(C){_(Ae,C)},$$legacy:!0}),P(f,T)},$$slots:{default:!0}}),ht(()=>{gn=bn(Ht,1,"app svelte-1n46o8q",null,gn,{dark:l()}),ct(lo,v()||"未加载"),ct(co,`字数 ${g()??""}`),Zo.disabled=a(),cl.disabled=!a(),ct(Nu,o(Ye)||"请选择版本进行对比"),ct(Mu,(o(qe),J(()=>o(qe).length>0?`已选中 ${o(qe).length} 个段落块`:"未选择段落"))),bn(go,1,`assistant-dock ${o(zt)?"open":""}`,"svelte-1n46o8q"),ct(Bu,o(zt)?"收起助手":"打开助手")}),A("click",ys,x),A("click",ws,at),A("click",Ss,G),A("click",uo,()=>_(Tn,!0)),A("click",$s,()=>_(Ae,!0)),A("click",fo,()=>_(te,!0)),A("click",Ts,()=>Bt("undo")),A("click",Es,()=>Bt("redo")),A("click",vo,()=>Bt("clear-format")),A("click",po,()=>Bt("bold")),A("click",Yt,()=>Bt("italic")),A("click",se,()=>Bt("underline")),A("click",ve,()=>Bt("heading1")),A("click",Vt,()=>Bt("heading2")),A("click",Ir,()=>Bt("quote")),A("click",As,()=>Bt("code")),A("click",ho,()=>Bt("list-bullet")),A("click",Su,()=>Bt("list-number")),A("click",il,()=>Bt("table")),A("click",sl,()=>Bt("image")),A("click",ol,()=>_(Tn,!0)),A("click",xu,()=>_(Ae,!0)),A("click",Zo,()=>gt(S())),A("click",cl,Mt),A("click",qu,H),Re(ra,()=>o(an),f=>_(an,f)),A("click",Cu,Y),A("click",mo,()=>_(zt,!o(zt))),P(t,Xt);var Uu=Fn(Je);return N(),Uu}const Gl=document.getElementById("app");Gl&&new wu({target:Gl});
