var lu=Object.defineProperty;var Fa=t=>{throw TypeError(t)};var cu=(t,e,n)=>e in t?lu(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var bn=(t,e,n)=>cu(t,typeof e!="symbol"?e+"":e,n),xo=(t,e,n)=>e.has(t)||Fa("Cannot "+n);var k=(t,e,n)=>(xo(t,e,"read from private field"),n?n.call(t):e.get(t)),_t=(t,e,n)=>e.has(t)?Fa("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),vt=(t,e,n,r)=>(xo(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n),fe=(t,e,n)=>(xo(t,e,"access private method"),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const be=2,Ms=4,Xi=8,ll=1<<24,rr=16,kn=32,Ur=64,Qo=128,an=512,ue=1024,Ee=2048,Fn=4096,ze=8192,Zn=16384,Ws=32768,pi=65536,Ra=1<<17,cl=1<<18,yi=1<<19,ul=1<<20,Yn=1<<25,Fr=32768,Co=1<<21,Zo=1<<22,mr=1<<23,tr=Symbol("$state"),fl=Symbol("legacy props"),uu=Symbol(""),ri=new class extends Error{constructor(){super(...arguments);bn(this,"name","StaleReactionError");bn(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}},zs=3,Jr=8,jo=!1;var Yi=Array.isArray,fu=Array.prototype.indexOf,hi=Array.prototype.includes,Vs=Array.from,ta=Object.defineProperty,si=Object.getOwnPropertyDescriptor,dl=Object.getOwnPropertyDescriptors,du=Object.prototype,vu=Array.prototype,ea=Object.getPrototypeOf,Ba=Object.isExtensible;const _r=()=>{};function pu(t){return t()}function Ds(t){for(var e=0;e<t.length;e++)t[e]()}function vl(){var t,e,n=new Promise((r,i)=>{t=r,e=i});return{promise:n,resolve:t,reject:e}}function pl(t){return t===this.v}function hl(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function gl(t){return!hl(t,this.v)}function ml(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function hu(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function gu(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function mu(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function _u(t){throw new Error("https://svelte.dev/e/effect_orphan")}function bu(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function yu(){throw new Error("https://svelte.dev/e/hydration_failed")}function wu(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function Su(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function xu(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function ku(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function $u(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}let wi=!1,Eu=!1;function Tu(){wi=!0}const Au=1,Cu=2,_l=4,ju=8,qu=16,Nu=2,Iu=8,Mu=1,Du=2,bl="[",Gs="[!",na="]",Rr={},he=Symbol(),Ou="http://www.w3.org/1999/xhtml";let Wt=null;function gi(t){Wt=t}function Ve(t,e=!1,n){Wt={p:Wt,i:!1,c:null,e:null,s:t,x:null,l:wi&&!e?{s:null,u:null,$:[]}:null}}function Ge(t){var e=Wt,n=e.e;if(n!==null){e.e=null;for(var r of n)Kl(r)}return t!==void 0&&(e.x=t),e.i=!0,Wt=e.p,t??{}}function Qi(){return!wi||Wt!==null&&Wt.l===null}let Ar=[];function yl(){var t=Ar;Ar=[],Ds(t)}function In(t){if(Ar.length===0&&!Hi){var e=Ar;queueMicrotask(()=>{e===Ar&&yl()})}Ar.push(t)}function Lu(){for(;Ar.length>0;)yl()}function Zi(t){console.warn("https://svelte.dev/e/hydration_mismatch")}function Fu(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Ru(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}let bt=!1;function Qn(t){bt=t}let yt;function $e(t){if(t===null)throw Zi(),Rr;return yt=t}function Br(){return $e($n(yt))}function w(t){if(bt){if($n(yt)!==null)throw Zi(),Rr;yt=t}}function qo(t=1){if(bt){for(var e=t,n=yt;e--;)n=$n(n);yt=n}}function Os(t=!0){for(var e=0,n=yt;;){if(n.nodeType===Jr){var r=n.data;if(r===na){if(e===0)return n;e-=1}else(r===bl||r===Gs)&&(e+=1)}var i=$n(n);t&&n.remove(),n=i}}function wl(t){if(!t||t.nodeType!==Jr)throw Zi(),Rr;return t.data}function ii(t){if(typeof t!="object"||t===null||tr in t)return t;const e=ea(t);if(e!==du&&e!==vu)return t;var n=new Map,r=Yi(t),i=cr(0),s=Or,a=o=>{if(Or===s)return o();var c=St,d=Or;un(null),za(s);var p=o();return un(c),za(d),p};return r&&n.set("length",cr(t.length)),new Proxy(t,{defineProperty(o,c,d){(!("value"in d)||d.configurable===!1||d.enumerable===!1||d.writable===!1)&&Su();var p=n.get(c);return p===void 0?p=a(()=>{var m=cr(d.value);return n.set(c,m),m}):A(p,d.value,!0),!0},deleteProperty(o,c){var d=n.get(c);if(d===void 0){if(c in o){const p=a(()=>cr(he));n.set(c,p),Ui(i)}}else A(d,he),Ui(i);return!0},get(o,c,d){var I;if(c===tr)return t;var p=n.get(c),m=c in o;if(p===void 0&&(!m||(I=si(o,c))!=null&&I.writable)&&(p=a(()=>{var q=ii(m?o[c]:he),P=cr(q);return P}),n.set(c,p)),p!==void 0){var b=l(p);return b===he?void 0:b}return Reflect.get(o,c,d)},getOwnPropertyDescriptor(o,c){var d=Reflect.getOwnPropertyDescriptor(o,c);if(d&&"value"in d){var p=n.get(c);p&&(d.value=l(p))}else if(d===void 0){var m=n.get(c),b=m==null?void 0:m.v;if(m!==void 0&&b!==he)return{enumerable:!0,configurable:!0,value:b,writable:!0}}return d},has(o,c){var b;if(c===tr)return!0;var d=n.get(c),p=d!==void 0&&d.v!==he||Reflect.has(o,c);if(d!==void 0||Tt!==null&&(!p||(b=si(o,c))!=null&&b.writable)){d===void 0&&(d=a(()=>{var I=p?ii(o[c]):he,q=cr(I);return q}),n.set(c,d));var m=l(d);if(m===he)return!1}return p},set(o,c,d,p){var G;var m=n.get(c),b=c in o;if(r&&c==="length")for(var I=d;I<m.v;I+=1){var q=n.get(I+"");q!==void 0?A(q,he):I in o&&(q=a(()=>cr(he)),n.set(I+"",q))}if(m===void 0)(!b||(G=si(o,c))!=null&&G.writable)&&(m=a(()=>cr(void 0)),A(m,ii(d)),n.set(c,m));else{b=m.v!==he;var P=a(()=>ii(d));A(m,P)}var T=Reflect.getOwnPropertyDescriptor(o,c);if(T!=null&&T.set&&T.set.call(p,d),!b){if(r&&typeof c=="string"){var O=n.get("length"),et=Number(c);Number.isInteger(et)&&et>=O.v&&A(O,et+1)}Ui(i)}return!0},ownKeys(o){l(i);var c=Reflect.ownKeys(o).filter(m=>{var b=n.get(m);return b===void 0||b.v!==he});for(var[d,p]of n)p.v!==he&&!(d in o)&&c.push(d);return c},setPrototypeOf(){xu()}})}function Pa(t){try{if(t!==null&&typeof t=="object"&&tr in t)return t[tr]}catch{}return t}function Bu(t,e){return Object.is(Pa(t),Pa(e))}var Ha,Sl,xl,kl;function No(){if(Ha===void 0){Ha=window,Sl=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,n=Text.prototype;xl=si(e,"firstChild").get,kl=si(e,"nextSibling").get,Ba(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),Ba(n)&&(n.__t=void 0)}}function ln(t=""){return document.createTextNode(t)}function on(t){return xl.call(t)}function $n(t){return kl.call(t)}function $(t,e){if(!bt)return on(t);var n=on(yt);if(n===null)n=yt.appendChild(ln());else if(e&&n.nodeType!==zs){var r=ln();return n==null||n.before(r),$e(r),r}return e&&ia(n),$e(n),n}function _e(t,e=!1){if(!bt){var n=on(t);return n instanceof Comment&&n.data===""?$n(n):n}if(e){if((yt==null?void 0:yt.nodeType)!==zs){var r=ln();return yt==null||yt.before(r),$e(r),r}ia(yt)}return yt}function _(t,e=1,n=!1){let r=bt?yt:t;for(var i;e--;)i=r,r=$n(r);if(!bt)return r;if(n){if((r==null?void 0:r.nodeType)!==zs){var s=ln();return r===null?i==null||i.after(s):r.before(s),$e(s),s}ia(r)}return $e(r),r}function ra(t){t.textContent=""}function $l(){return!1}function ia(t){if(t.nodeValue.length<65536)return;let e=t.nextSibling;for(;e!==null&&e.nodeType===zs;)e.remove(),t.nodeValue+=e.nodeValue,e=t.nextSibling}function El(t){var e=Tt;if(e===null)return St.f|=mr,t;if(e.f&Ws)mi(t,e);else{if(!(e.f&Qo))throw t;e.b.error(t)}}function mi(t,e){for(;e!==null;){if(e.f&Qo)try{e.b.error(t);return}catch(n){t=n}e=e.parent}throw t}const Pu=-7169;function oe(t,e){t.f=t.f&Pu|e}function sa(t){t.f&an||t.deps===null?oe(t,ue):oe(t,Fn)}function Tl(t){if(t!==null)for(const e of t)!(e.f&be)||!(e.f&Fr)||(e.f^=Fr,Tl(e.deps))}function Al(t,e,n){t.f&Ee?e.add(t):t.f&Fn&&n.add(t),Tl(t.deps),oe(t,ue)}const $s=new Set;let ht=null,Ls=null,me=null,Ue=[],Ks=null,Io=!1,Hi=!1;var ai,li,jr,ci,Wi,zi,qr,ui,Ln,Mo,Do,Cl;const Sa=class Sa{constructor(){_t(this,Ln);bn(this,"committed",!1);bn(this,"current",new Map);bn(this,"previous",new Map);_t(this,ai,new Set);_t(this,li,new Set);_t(this,jr,0);_t(this,ci,0);_t(this,Wi,null);_t(this,zi,new Set);_t(this,qr,new Set);bn(this,"skipped_effects",new Set);bn(this,"is_fork",!1);_t(this,ui,!1)}is_deferred(){return this.is_fork||k(this,ci)>0}process(e){var i;Ue=[],this.apply();var n=[],r=[];for(const s of e)fe(this,Ln,Mo).call(this,s,n,r);if(this.is_deferred()){fe(this,Ln,Do).call(this,r),fe(this,Ln,Do).call(this,n);for(const s of this.skipped_effects)Il(s)}else{for(const s of k(this,ai))s();k(this,ai).clear(),k(this,jr)===0&&fe(this,Ln,Cl).call(this),Ls=this,ht=null,Ua(r),Ua(n),Ls=null,(i=k(this,Wi))==null||i.resolve()}me=null}capture(e,n){n!==he&&!this.previous.has(e)&&this.previous.set(e,n),e.f&mr||(this.current.set(e,e.v),me==null||me.set(e,e.v))}activate(){ht=this,this.apply()}deactivate(){ht===this&&(ht=null,me=null)}flush(){if(this.activate(),Ue.length>0){if(jl(),ht!==null&&ht!==this)return}else k(this,jr)===0&&this.process([]);this.deactivate()}discard(){for(const e of k(this,li))e(this);k(this,li).clear()}increment(e){vt(this,jr,k(this,jr)+1),e&&vt(this,ci,k(this,ci)+1)}decrement(e){vt(this,jr,k(this,jr)-1),e&&vt(this,ci,k(this,ci)-1),!k(this,ui)&&(vt(this,ui,!0),In(()=>{vt(this,ui,!1),this.is_deferred()?Ue.length>0&&this.flush():this.revive()}))}revive(){for(const e of k(this,zi))k(this,qr).delete(e),oe(e,Ee),er(e);for(const e of k(this,qr))oe(e,Fn),er(e);this.flush()}oncommit(e){k(this,ai).add(e)}ondiscard(e){k(this,li).add(e)}settled(){return(k(this,Wi)??vt(this,Wi,vl())).promise}static ensure(){if(ht===null){const e=ht=new Sa;$s.add(ht),Hi||In(()=>{ht===e&&e.flush()})}return ht}apply(){}};ai=new WeakMap,li=new WeakMap,jr=new WeakMap,ci=new WeakMap,Wi=new WeakMap,zi=new WeakMap,qr=new WeakMap,ui=new WeakMap,Ln=new WeakSet,Mo=function(e,n,r){e.f^=ue;for(var i=e.first,s=null;i!==null;){var a=i.f,o=(a&(kn|Ur))!==0,c=o&&(a&ue)!==0,d=c||(a&ze)!==0||this.skipped_effects.has(i);if(!d&&i.fn!==null){o?i.f^=ue:s!==null&&a&(Ms|Xi|ll)?s.b.defer_effect(i):a&Ms?n.push(i):Si(i)&&(a&rr&&k(this,qr).add(i),_i(i));var p=i.first;if(p!==null){i=p;continue}}var m=i.parent;for(i=i.next;i===null&&m!==null;)m===s&&(s=null),i=m.next,m=m.parent}},Do=function(e){for(var n=0;n<e.length;n+=1)Al(e[n],k(this,zi),k(this,qr))},Cl=function(){var i;if($s.size>1){this.previous.clear();var e=me,n=!0;for(const s of $s){if(s===this){n=!1;continue}const a=[];for(const[c,d]of this.current){if(s.current.has(c))if(n&&d!==s.current.get(c))s.current.set(c,d);else continue;a.push(c)}if(a.length===0)continue;const o=[...s.current.keys()].filter(c=>!this.current.has(c));if(o.length>0){var r=Ue;Ue=[];const c=new Set,d=new Map;for(const p of a)ql(p,o,c,d);if(Ue.length>0){ht=s,s.apply();for(const p of Ue)fe(i=s,Ln,Mo).call(i,p,[],[]);s.deactivate()}Ue=r}}ht=null,me=e}this.committed=!0,$s.delete(this)};let br=Sa;function we(t){var e=Hi;Hi=!0;try{for(var n;;){if(Lu(),Ue.length===0&&(ht==null||ht.flush(),Ue.length===0))return Ks=null,n;jl()}}finally{Hi=e}}function jl(){Io=!0;var t=null;try{for(var e=0;Ue.length>0;){var n=br.ensure();if(e++>1e3){var r,i;Hu()}n.process(Ue),yr.clear()}}finally{Io=!1,Ks=null}}function Hu(){try{bu()}catch(t){mi(t,Ks)}}let yn=null;function Ua(t){var e=t.length;if(e!==0){for(var n=0;n<e;){var r=t[n++];if(!(r.f&(Zn|ze))&&Si(r)&&(yn=new Set,_i(r),r.deps===null&&r.first===null&&r.nodes===null&&(r.teardown===null&&r.ac===null?tc(r):r.fn=null),(yn==null?void 0:yn.size)>0)){yr.clear();for(const i of yn){if(i.f&(Zn|ze))continue;const s=[i];let a=i.parent;for(;a!==null;)yn.has(a)&&(yn.delete(a),s.push(a)),a=a.parent;for(let o=s.length-1;o>=0;o--){const c=s[o];c.f&(Zn|ze)||_i(c)}}yn.clear()}}yn=null}}function ql(t,e,n,r){if(!n.has(t)&&(n.add(t),t.reactions!==null))for(const i of t.reactions){const s=i.f;s&be?ql(i,e,n,r):s&(Zo|rr)&&!(s&Ee)&&Nl(i,e,r)&&(oe(i,Ee),er(i))}}function Nl(t,e,n){const r=n.get(t);if(r!==void 0)return r;if(t.deps!==null)for(const i of t.deps){if(hi.call(e,i))return!0;if(i.f&be&&Nl(i,e,n))return n.set(i,!0),!0}return n.set(t,!1),!1}function er(t){for(var e=Ks=t;e.parent!==null;){e=e.parent;var n=e.f;if(Io&&e===Tt&&n&rr&&!(n&cl))return;if(n&(Ur|kn)){if(!(n&ue))return;e.f^=ue}}Ue.push(e)}function Il(t){if(!(t.f&kn&&t.f&ue)){oe(t,ue);for(var e=t.first;e!==null;)Il(e),e=e.next}}function Uu(t){let e=0,n=Pr(0),r;return()=>{ua()&&(l(n),xi(()=>(e===0&&(r=Y(()=>t(()=>Ui(n)))),e+=1,()=>{In(()=>{e-=1,e===0&&(r==null||r(),r=void 0,Ui(n))})})))}}var Ju=pi|yi|Qo;function Wu(t,e,n){new zu(t,e,n)}var Pe,Vi,Cn,Nr,jn,en,je,qn,zn,gr,Ir,Vn,fi,Mr,di,vi,Gn,Us,se,Ml,Dl,Oo,As,Cs,Lo;class zu{constructor(e,n,r){_t(this,se);bn(this,"parent");bn(this,"is_pending",!1);_t(this,Pe);_t(this,Vi,bt?yt:null);_t(this,Cn);_t(this,Nr);_t(this,jn);_t(this,en,null);_t(this,je,null);_t(this,qn,null);_t(this,zn,null);_t(this,gr,null);_t(this,Ir,0);_t(this,Vn,0);_t(this,fi,!1);_t(this,Mr,!1);_t(this,di,new Set);_t(this,vi,new Set);_t(this,Gn,null);_t(this,Us,Uu(()=>(vt(this,Gn,Pr(k(this,Ir))),()=>{vt(this,Gn,null)})));vt(this,Pe,e),vt(this,Cn,n),vt(this,Nr,r),this.parent=Tt.b,this.is_pending=!!k(this,Cn).pending,vt(this,jn,fa(()=>{if(Tt.b=this,bt){const s=k(this,Vi);Br(),s.nodeType===Jr&&s.data===Gs?fe(this,se,Dl).call(this):(fe(this,se,Ml).call(this),k(this,Vn)===0&&(this.is_pending=!1))}else{var i=fe(this,se,Oo).call(this);try{vt(this,en,rn(()=>r(i)))}catch(s){this.error(s)}k(this,Vn)>0?fe(this,se,Cs).call(this):this.is_pending=!1}return()=>{var s;(s=k(this,gr))==null||s.remove()}},Ju)),bt&&vt(this,Pe,yt)}defer_effect(e){Al(e,k(this,di),k(this,vi))}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!k(this,Cn).pending}update_pending_count(e){fe(this,se,Lo).call(this,e),vt(this,Ir,k(this,Ir)+e),!(!k(this,Gn)||k(this,fi))&&(vt(this,fi,!0),In(()=>{vt(this,fi,!1),k(this,Gn)&&Hr(k(this,Gn),k(this,Ir))}))}get_effect_pending(){return k(this,Us).call(this),l(k(this,Gn))}error(e){var n=k(this,Cn).onerror;let r=k(this,Cn).failed;if(k(this,Mr)||!n&&!r)throw e;k(this,en)&&(Ne(k(this,en)),vt(this,en,null)),k(this,je)&&(Ne(k(this,je)),vt(this,je,null)),k(this,qn)&&(Ne(k(this,qn)),vt(this,qn,null)),bt&&($e(k(this,Vi)),qo(),$e(Os()));var i=!1,s=!1;const a=()=>{if(i){Ru();return}i=!0,s&&$u(),br.ensure(),vt(this,Ir,0),k(this,qn)!==null&&Lr(k(this,qn),()=>{vt(this,qn,null)}),this.is_pending=this.has_pending_snippet(),vt(this,en,fe(this,se,As).call(this,()=>(vt(this,Mr,!1),rn(()=>k(this,Nr).call(this,k(this,Pe)))))),k(this,Vn)>0?fe(this,se,Cs).call(this):this.is_pending=!1};In(()=>{try{s=!0,n==null||n(e,a),s=!1}catch(o){mi(o,k(this,jn)&&k(this,jn).parent)}r&&vt(this,qn,fe(this,se,As).call(this,()=>{br.ensure(),vt(this,Mr,!0);try{return rn(()=>{r(k(this,Pe),()=>e,()=>a)})}catch(o){return mi(o,k(this,jn).parent),null}finally{vt(this,Mr,!1)}}))})}}Pe=new WeakMap,Vi=new WeakMap,Cn=new WeakMap,Nr=new WeakMap,jn=new WeakMap,en=new WeakMap,je=new WeakMap,qn=new WeakMap,zn=new WeakMap,gr=new WeakMap,Ir=new WeakMap,Vn=new WeakMap,fi=new WeakMap,Mr=new WeakMap,di=new WeakMap,vi=new WeakMap,Gn=new WeakMap,Us=new WeakMap,se=new WeakSet,Ml=function(){try{vt(this,en,rn(()=>k(this,Nr).call(this,k(this,Pe))))}catch(e){this.error(e)}},Dl=function(){const e=k(this,Cn).pending;e&&(vt(this,je,rn(()=>e(k(this,Pe)))),In(()=>{var n=fe(this,se,Oo).call(this);vt(this,en,fe(this,se,As).call(this,()=>(br.ensure(),rn(()=>k(this,Nr).call(this,n))))),k(this,Vn)>0?fe(this,se,Cs).call(this):(Lr(k(this,je),()=>{vt(this,je,null)}),this.is_pending=!1)}))},Oo=function(){var e=k(this,Pe);return this.is_pending&&(vt(this,gr,ln()),k(this,Pe).before(k(this,gr)),e=k(this,gr)),e},As=function(e){var n=Tt,r=St,i=Wt;Dn(k(this,jn)),un(k(this,jn)),gi(k(this,jn).ctx);try{return e()}catch(s){return El(s),null}finally{Dn(n),un(r),gi(i)}},Cs=function(){const e=k(this,Cn).pending;k(this,en)!==null&&(vt(this,zn,document.createDocumentFragment()),k(this,zn).append(k(this,gr)),rc(k(this,en),k(this,zn))),k(this,je)===null&&vt(this,je,rn(()=>e(k(this,Pe))))},Lo=function(e){var n;if(!this.has_pending_snippet()){this.parent&&fe(n=this.parent,se,Lo).call(n,e);return}if(vt(this,Vn,k(this,Vn)+e),k(this,Vn)===0){this.is_pending=!1;for(const r of k(this,di))oe(r,Ee),er(r);for(const r of k(this,vi))oe(r,Fn),er(r);k(this,di).clear(),k(this,vi).clear(),k(this,je)&&Lr(k(this,je),()=>{vt(this,je,null)}),k(this,zn)&&(k(this,Pe).before(k(this,zn)),vt(this,zn,null))}};function Vu(t,e,n,r){const i=Qi()?oa:aa;var s=t.filter(b=>!b.settled);if(n.length===0&&s.length===0){r(e.map(i));return}var a=ht,o=Tt,c=Gu(),d=s.length===1?s[0].promise:s.length>1?Promise.all(s.map(b=>b.promise)):null;function p(b){c();try{r(b)}catch(I){o.f&Zn||mi(I,o)}a==null||a.deactivate(),Fo()}if(n.length===0){d.then(()=>p(e.map(i)));return}function m(){c(),Promise.all(n.map(b=>Ku(b))).then(b=>p([...e.map(i),...b])).catch(b=>mi(b,o))}d?d.then(m):m()}function Gu(){var t=Tt,e=St,n=Wt,r=ht;return function(s=!0){Dn(t),un(e),gi(n),s&&(r==null||r.activate())}}function Fo(){Dn(null),un(null),gi(null)}function oa(t){var e=be|Ee,n=St!==null&&St.f&be?St:null;return Tt!==null&&(Tt.f|=yi),{ctx:Wt,deps:null,effects:null,equals:pl,f:e,fn:t,reactions:null,rv:0,v:he,wv:0,parent:n??Tt,ac:null}}function Ku(t,e,n){let r=Tt;r===null&&hu();var i=r.b,s=void 0,a=Pr(he),o=!St,c=new Map;return af(()=>{var I;var d=vl();s=d.promise;try{Promise.resolve(t()).then(d.resolve,d.reject).then(()=>{p===ht&&p.committed&&p.deactivate(),Fo()})}catch(q){d.reject(q),Fo()}var p=ht;if(o){var m=i.is_rendered();i.update_pending_count(1),p.increment(m),(I=c.get(p))==null||I.reject(ri),c.delete(p),c.set(p,d)}const b=(q,P=void 0)=>{if(p.activate(),P)P!==ri&&(a.f|=mr,Hr(a,P));else{a.f&mr&&(a.f^=mr),Hr(a,q);for(const[T,O]of c){if(c.delete(T),T===p)break;O.reject(ri)}}o&&(i.update_pending_count(-1),p.decrement(m))};d.promise.then(b,q=>b(null,q||"unknown"))}),Qs(()=>{for(const d of c.values())d.reject(ri)}),new Promise(d=>{function p(m){function b(){m===s?d(a):p(s)}m.then(b,b)}p(s)})}function aa(t){const e=oa(t);return e.equals=gl,e}function Ol(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)Ne(e[n])}}function Xu(t){for(var e=t.parent;e!==null;){if(!(e.f&be))return e.f&Zn?null:e;e=e.parent}return null}function la(t){var e,n=Tt;Dn(Xu(t));try{t.f&=~Fr,Ol(t),e=Wl(t)}finally{Dn(n)}return e}function Ll(t){var e=la(t);if(!t.equals(e)&&(t.wv=Ul(),(!(ht!=null&&ht.is_fork)||t.deps===null)&&(t.v=e,t.deps===null))){oe(t,ue);return}Sr||(me!==null?(ua()||ht!=null&&ht.is_fork)&&me.set(t,e):sa(t))}let Ro=new Set;const yr=new Map;let Fl=!1;function Pr(t,e){var n={f:0,v:t,reactions:null,equals:pl,rv:0,wv:0};return n}function cr(t,e){const n=Pr(t);return Zu(n),n}function at(t,e=!1,n=!0){var i;const r=Pr(t);return e||(r.equals=gl),wi&&n&&Wt!==null&&Wt.l!==null&&((i=Wt.l).s??(i.s=[])).push(r),r}function pr(t,e){return A(t,Y(()=>l(t))),e}function A(t,e,n=!1){St!==null&&(!Sn||St.f&Ra)&&Qi()&&St.f&(be|rr|Zo|Ra)&&(cn===null||!hi.call(cn,t))&&ku();let r=n?ii(e):e;return Hr(t,r)}function Hr(t,e){if(!t.equals(e)){var n=t.v;Sr?yr.set(t,e):yr.set(t,n),t.v=e;var r=br.ensure();if(r.capture(t,n),t.f&be){const i=t;t.f&Ee&&la(i),sa(i)}t.wv=Ul(),Rl(t,Ee),Qi()&&Tt!==null&&Tt.f&ue&&!(Tt.f&(kn|Ur))&&(tn===null?tf([t]):tn.push(t)),!r.is_fork&&Ro.size>0&&!Fl&&Yu()}return e}function Yu(){Fl=!1;for(const t of Ro)t.f&ue&&oe(t,Fn),Si(t)&&_i(t);Ro.clear()}function Ui(t){A(t,t.v+1)}function Rl(t,e){var n=t.reactions;if(n!==null)for(var r=Qi(),i=n.length,s=0;s<i;s++){var a=n[s],o=a.f;if(!(!r&&a===Tt)){var c=(o&Ee)===0;if(c&&oe(a,e),o&be){var d=a;me==null||me.delete(d),o&Fr||(o&an&&(a.f|=Fr),Rl(d,Fn))}else c&&(o&rr&&yn!==null&&yn.add(a),er(a))}}}let hr=null;function Qu(t){var e=hr;try{if(hr=new Set,Y(t),e!==null)for(var n of hr)e.add(n);return hr}finally{hr=e}}function Bl(t){for(var e of Qu(t))Hr(e,e.v)}function Fs(t){bt&&on(t)!==null&&ra(t)}let Ja=!1;function Pl(){Ja||(Ja=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{var e;if(!t.defaultPrevented)for(const n of t.target.elements)(e=n.__on_r)==null||e.call(n)})},{capture:!0}))}function Xs(t){var e=St,n=Tt;un(null),Dn(null);try{return t()}finally{un(e),Dn(n)}}function ca(t,e,n,r=n){t.addEventListener(e,()=>Xs(n));const i=t.__on_r;i?t.__on_r=()=>{i(),r(!0)}:t.__on_r=()=>r(!0),Pl()}let js=!1,Sr=!1;function Wa(t){Sr=t}let St=null,Sn=!1;function un(t){St=t}let Tt=null;function Dn(t){Tt=t}let cn=null;function Zu(t){St!==null&&(cn===null?cn=[t]:cn.push(t))}let qe=null,Be=0,tn=null;function tf(t){tn=t}let Hl=1,Cr=0,Or=Cr;function za(t){Or=t}function Ul(){return++Hl}function Si(t){var e=t.f;if(e&Ee)return!0;if(e&be&&(t.f&=~Fr),e&Fn){for(var n=t.deps,r=n.length,i=0;i<r;i++){var s=n[i];if(Si(s)&&Ll(s),s.wv>t.wv)return!0}e&an&&me===null&&oe(t,ue)}return!1}function Jl(t,e,n=!0){var r=t.reactions;if(r!==null&&!(cn!==null&&hi.call(cn,t)))for(var i=0;i<r.length;i++){var s=r[i];s.f&be?Jl(s,e,!1):e===s&&(n?oe(s,Ee):s.f&ue&&oe(s,Fn),er(s))}}function Wl(t){var P;var e=qe,n=Be,r=tn,i=St,s=cn,a=Wt,o=Sn,c=Or,d=t.f;qe=null,Be=0,tn=null,St=d&(kn|Ur)?null:t,cn=null,gi(t.ctx),Sn=!1,Or=++Cr,t.ac!==null&&(Xs(()=>{t.ac.abort(ri)}),t.ac=null);try{t.f|=Co;var p=t.fn,m=p(),b=t.deps,I=ht==null?void 0:ht.is_fork;if(qe!==null){var q;if(I||Rs(t,Be),b!==null&&Be>0)for(b.length=Be+qe.length,q=0;q<qe.length;q++)b[Be+q]=qe[q];else t.deps=b=qe;if(ua()&&t.f&an)for(q=Be;q<b.length;q++)((P=b[q]).reactions??(P.reactions=[])).push(t)}else!I&&b!==null&&Be<b.length&&(Rs(t,Be),b.length=Be);if(Qi()&&tn!==null&&!Sn&&b!==null&&!(t.f&(be|Fn|Ee)))for(q=0;q<tn.length;q++)Jl(tn[q],t);if(i!==null&&i!==t){if(Cr++,i.deps!==null)for(let T=0;T<n;T+=1)i.deps[T].rv=Cr;if(e!==null)for(const T of e)T.rv=Cr;tn!==null&&(r===null?r=tn:r.push(...tn))}return t.f&mr&&(t.f^=mr),m}catch(T){return El(T)}finally{t.f^=Co,qe=e,Be=n,tn=r,St=i,cn=s,gi(a),Sn=o,Or=c}}function ef(t,e){let n=e.reactions;if(n!==null){var r=fu.call(n,t);if(r!==-1){var i=n.length-1;i===0?n=e.reactions=null:(n[r]=n[i],n.pop())}}if(n===null&&e.f&be&&(qe===null||!hi.call(qe,e))){var s=e;s.f&an&&(s.f^=an,s.f&=~Fr),sa(s),Ol(s),Rs(s,0)}}function Rs(t,e){var n=t.deps;if(n!==null)for(var r=e;r<n.length;r++)ef(t,n[r])}function _i(t){var e=t.f;if(!(e&Zn)){oe(t,ue);var n=Tt,r=js;Tt=t,js=!0;try{e&(rr|ll)?lf(t):Ql(t),Yl(t);var i=Wl(t);t.teardown=typeof i=="function"?i:null,t.wv=Hl;var s;jo&&Eu&&t.f&Ee&&t.deps}finally{js=r,Tt=n}}}async function nf(){await Promise.resolve(),we()}function l(t){var e=t.f,n=(e&be)!==0;if(hr==null||hr.add(t),St!==null&&!Sn){var r=Tt!==null&&(Tt.f&Zn)!==0;if(!r&&(cn===null||!hi.call(cn,t))){var i=St.deps;if(St.f&Co)t.rv<Cr&&(t.rv=Cr,qe===null&&i!==null&&i[Be]===t?Be++:qe===null?qe=[t]:qe.push(t));else{(St.deps??(St.deps=[])).push(t);var s=t.reactions;s===null?t.reactions=[St]:hi.call(s,St)||s.push(St)}}}if(Sr&&yr.has(t))return yr.get(t);if(n){var a=t;if(Sr){var o=a.v;return(!(a.f&ue)&&a.reactions!==null||Vl(a))&&(o=la(a)),yr.set(a,o),o}var c=(a.f&an)===0&&!Sn&&St!==null&&(js||(St.f&an)!==0),d=a.deps===null;Si(a)&&(c&&(a.f|=an),Ll(a)),c&&!d&&zl(a)}if(me!=null&&me.has(t))return me.get(t);if(t.f&mr)throw t.v;return t.v}function zl(t){if(t.deps!==null){t.f|=an;for(const e of t.deps)(e.reactions??(e.reactions=[])).push(t),e.f&be&&!(e.f&an)&&zl(e)}}function Vl(t){if(t.v===he)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(yr.has(e)||e.f&be&&Vl(e))return!0;return!1}function Y(t){var e=Sn;try{return Sn=!0,t()}finally{Sn=e}}function Ys(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(tr in t)Bo(t);else if(!Array.isArray(t))for(let e in t){const n=t[e];typeof n=="object"&&n&&tr in n&&Bo(n)}}}function Bo(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let r in t)try{Bo(t[r],e)}catch{}const n=ea(t);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=dl(n);for(let i in r){const s=r[i].get;if(s)try{s.call(t)}catch{}}}}}function Gl(t){Tt===null&&(St===null&&_u(),mu()),Sr&&gu()}function rf(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function Rn(t,e,n){var r=Tt;r!==null&&r.f&ze&&(t|=ze);var i={ctx:Wt,deps:null,nodes:null,f:t|Ee|an,first:null,fn:e,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,wv:0,ac:null};if(n)try{_i(i),i.f|=Ws}catch(o){throw Ne(i),o}else e!==null&&er(i);var s=i;if(n&&s.deps===null&&s.teardown===null&&s.nodes===null&&s.first===s.last&&!(s.f&yi)&&(s=s.first,t&rr&&t&pi&&s!==null&&(s.f|=pi)),s!==null&&(s.parent=r,r!==null&&rf(s,r),St!==null&&St.f&be&&!(t&Ur))){var a=St;(a.effects??(a.effects=[])).push(s)}return i}function ua(){return St!==null&&!Sn}function Qs(t){const e=Rn(Xi,null,!1);return oe(e,ue),e.teardown=t,e}function Po(t){Gl();var e=Tt.f,n=!St&&(e&kn)!==0&&(e&Ws)===0;if(n){var r=Wt;(r.e??(r.e=[])).push(t)}else return Kl(t)}function Kl(t){return Rn(Ms|ul,t,!1)}function sf(t){return Gl(),Rn(Xi|ul,t,!0)}function of(t){br.ensure();const e=Rn(Ur|yi,t,!0);return(n={})=>new Promise(r=>{n.outro?Lr(e,()=>{Ne(e),r(void 0)}):(Ne(e),r(void 0))})}function Xl(t){return Rn(Ms,t,!1)}function Zs(t,e){var n=Wt,r={effect:null,ran:!1,deps:t};n.l.$.push(r),r.effect=xi(()=>{t(),!r.ran&&(r.ran=!0,Y(e))})}function to(){var t=Wt;xi(()=>{for(var e of t.l.$){e.deps();var n=e.effect;n.f&ue&&n.deps!==null&&oe(n,Fn),Si(n)&&_i(n),e.ran=!1}})}function af(t){return Rn(Zo|yi,t,!0)}function xi(t,e=0){return Rn(Xi|e,t,!0)}function Et(t,e=[],n=[],r=[]){Vu(r,e,n,i=>{Rn(Xi,()=>t(...i.map(l)),!0)})}function fa(t,e=0){var n=Rn(rr|e,t,!0);return n}function rn(t){return Rn(kn|yi,t,!0)}function Yl(t){var e=t.teardown;if(e!==null){const n=Sr,r=St;Wa(!0),un(null);try{e.call(null)}finally{Wa(n),un(r)}}}function Ql(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const i=n.ac;i!==null&&Xs(()=>{i.abort(ri)});var r=n.next;n.f&Ur?n.parent=null:Ne(n,e),n=r}}function lf(t){for(var e=t.first;e!==null;){var n=e.next;e.f&kn||Ne(e),e=n}}function Ne(t,e=!0){var n=!1;(e||t.f&cl)&&t.nodes!==null&&t.nodes.end!==null&&(Zl(t.nodes.start,t.nodes.end),n=!0),Ql(t,e&&!n),Rs(t,0),oe(t,Zn);var r=t.nodes&&t.nodes.t;if(r!==null)for(const s of r)s.stop();Yl(t);var i=t.parent;i!==null&&i.first!==null&&tc(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function Zl(t,e){for(;t!==null;){var n=t===e?null:$n(t);t.remove(),t=n}}function tc(t){var e=t.parent,n=t.prev,r=t.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),e!==null&&(e.first===t&&(e.first=r),e.last===t&&(e.last=n))}function Lr(t,e,n=!0){var r=[];ec(t,r,!0);var i=()=>{n&&Ne(t),e&&e()},s=r.length;if(s>0){var a=()=>--s||i();for(var o of r)o.out(a)}else i()}function ec(t,e,n){if(!(t.f&ze)){t.f^=ze;var r=t.nodes&&t.nodes.t;if(r!==null)for(const o of r)(o.is_global||n)&&e.push(o);for(var i=t.first;i!==null;){var s=i.next,a=(i.f&pi)!==0||(i.f&kn)!==0&&(t.f&rr)!==0;ec(i,e,a?n:!1),i=s}}}function da(t){nc(t,!0)}function nc(t,e){if(t.f&ze){t.f^=ze,t.f&ue||(oe(t,Ee),er(t));for(var n=t.first;n!==null;){var r=n.next,i=(n.f&pi)!==0||(n.f&kn)!==0;nc(n,i?e:!1),n=r}var s=t.nodes&&t.nodes.t;if(s!==null)for(const a of s)(a.is_global||e)&&a.in()}}function rc(t,e){if(t.nodes)for(var n=t.nodes.start,r=t.nodes.end;n!==null;){var i=n===r?null:$n(n);e.append(n),n=i}}const cf=new Set,Va=new Set;function uf(t,e,n,r={}){function i(s){if(r.capture||Bi.call(e,s),!s.cancelBubble)return Xs(()=>n==null?void 0:n.call(this,s))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?In(()=>{e.addEventListener(t,i,r)}):e.addEventListener(t,i,r),i}function M(t,e,n,r,i){var s={capture:r,passive:i},a=uf(t,e,n,s);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&Qs(()=>{e.removeEventListener(t,a,s)})}let Ga=null;function Bi(t){var T;var e=this,n=e.ownerDocument,r=t.type,i=((T=t.composedPath)==null?void 0:T.call(t))||[],s=i[0]||t.target;Ga=t;var a=0,o=Ga===t&&t.__root;if(o){var c=i.indexOf(o);if(c!==-1&&(e===document||e===window)){t.__root=e;return}var d=i.indexOf(e);if(d===-1)return;c<=d&&(a=c)}if(s=i[a]||t.target,s!==e){ta(t,"currentTarget",{configurable:!0,get(){return s||n}});var p=St,m=Tt;un(null),Dn(null);try{for(var b,I=[];s!==null;){var q=s.assignedSlot||s.parentNode||s.host||null;try{var P=s["__"+r];P!=null&&(!s.disabled||t.target===s)&&P.call(s,t)}catch(O){b?I.push(O):b=O}if(t.cancelBubble||q===e||q===null)break;s=q}if(b){for(let O of I)queueMicrotask(()=>{throw O});throw b}}finally{t.__root=e,delete t.currentTarget,un(p),Dn(m)}}}function ic(t){var e=document.createElement("template");return e.innerHTML=t.replaceAll("<!>","<!---->"),e.content}function wr(t,e){var n=Tt;n.nodes===null&&(n.nodes={start:t,end:e,a:null,t:null})}function Z(t,e){var n=(e&Mu)!==0,r=(e&Du)!==0,i,s=!t.startsWith("<!>");return()=>{if(bt)return wr(yt,null),yt;i===void 0&&(i=ic(s?t:"<!>"+t),n||(i=on(i)));var a=r||Sl?document.importNode(i,!0):i.cloneNode(!0);if(n){var o=on(a),c=a.lastChild;wr(o,c)}else wr(a,a);return a}}function On(){if(bt)return wr(yt,null),yt;var t=document.createDocumentFragment(),e=document.createComment(""),n=ln();return t.append(e,n),wr(e,n),t}function z(t,e){if(bt){var n=Tt;(!(n.f&Ws)||n.nodes.end===null)&&(n.nodes.end=yt),Br();return}t!==null&&t.before(e)}const ff=["touchstart","touchmove"];function df(t){return ff.includes(t)}function gt(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??(t.__t=t.nodeValue))&&(t.__t=n,t.nodeValue=n+"")}function sc(t,e){return oc(t,e)}function vf(t,e){No(),e.intro=e.intro??!1;const n=e.target,r=bt,i=yt;try{for(var s=on(n);s&&(s.nodeType!==Jr||s.data!==bl);)s=$n(s);if(!s)throw Rr;Qn(!0),$e(s);const a=oc(t,{...e,anchor:s});return Qn(!1),a}catch(a){if(a instanceof Error&&a.message.split(`
`).some(o=>o.startsWith("https://svelte.dev/e/")))throw a;return a!==Rr&&console.warn("Failed to hydrate: ",a),e.recover===!1&&yu(),No(),ra(n),Qn(!1),sc(t,e)}finally{Qn(r),$e(i)}}const ti=new Map;function oc(t,{target:e,anchor:n,props:r={},events:i,context:s,intro:a=!0}){No();var o=new Set,c=m=>{for(var b=0;b<m.length;b++){var I=m[b];if(!o.has(I)){o.add(I);var q=df(I);e.addEventListener(I,Bi,{passive:q});var P=ti.get(I);P===void 0?(document.addEventListener(I,Bi,{passive:q}),ti.set(I,1)):ti.set(I,P+1)}}};c(Vs(cf)),Va.add(c);var d=void 0,p=of(()=>{var m=n??e.appendChild(ln());return Wu(m,{pending:()=>{}},b=>{if(s){Ve({});var I=Wt;I.c=s}if(i&&(r.$$events=i),bt&&wr(b,null),d=t(b,r)||{},bt&&(Tt.nodes.end=yt,yt===null||yt.nodeType!==Jr||yt.data!==na))throw Zi(),Rr;s&&Ge()}),()=>{var q;for(var b of o){e.removeEventListener(b,Bi);var I=ti.get(b);--I===0?(document.removeEventListener(b,Bi),ti.delete(b)):ti.set(b,I)}Va.delete(c),m!==n&&((q=m.parentNode)==null||q.removeChild(m))}});return Ho.set(d,p),d}let Ho=new WeakMap;function pf(t,e){const n=Ho.get(t);return n?(Ho.delete(t),n(e)):Promise.resolve()}function va(t){return function(...e){var n=e[0];return n.stopPropagation(),t==null?void 0:t.apply(this,e)}}function fn(t){return new hf(t)}var Kn,nn;class hf{constructor(e){_t(this,Kn);_t(this,nn);var s;var n=new Map,r=(a,o)=>{var c=at(o,!1,!1);return n.set(a,c),c};const i=new Proxy({...e.props||{},$$events:{}},{get(a,o){return l(n.get(o)??r(o,Reflect.get(a,o)))},has(a,o){return o===fl?!0:(l(n.get(o)??r(o,Reflect.get(a,o))),Reflect.has(a,o))},set(a,o,c){return A(n.get(o)??r(o,c),c),Reflect.set(a,o,c)}});vt(this,nn,(e.hydrate?vf:sc)(e.component,{target:e.target,anchor:e.anchor,props:i,context:e.context,intro:e.intro??!1,recover:e.recover})),(!((s=e==null?void 0:e.props)!=null&&s.$$host)||e.sync===!1)&&we(),vt(this,Kn,i.$$events);for(const a of Object.keys(k(this,nn)))a==="$set"||a==="$destroy"||a==="$on"||ta(this,a,{get(){return k(this,nn)[a]},set(o){k(this,nn)[a]=o},enumerable:!0});k(this,nn).$set=a=>{Object.assign(i,a)},k(this,nn).$destroy=()=>{pf(k(this,nn))}}$set(e){k(this,nn).$set(e)}$on(e,n){k(this,Kn)[e]=k(this,Kn)[e]||[];const r=(...i)=>n.call(this,...i);return k(this,Kn)[e].push(r),()=>{k(this,Kn)[e]=k(this,Kn)[e].filter(i=>i!==r)}}$destroy(){k(this,nn).$destroy()}}Kn=new WeakMap,nn=new WeakMap;const gf="5";var al;typeof window<"u"&&((al=window.__svelte??(window.__svelte={})).v??(al.v=new Set)).add(gf);Tu();var wn,Nn,He,Dr,Gi,Ki,Js;class mf{constructor(e,n=!0){bn(this,"anchor");_t(this,wn,new Map);_t(this,Nn,new Map);_t(this,He,new Map);_t(this,Dr,new Set);_t(this,Gi,!0);_t(this,Ki,()=>{var e=ht;if(k(this,wn).has(e)){var n=k(this,wn).get(e),r=k(this,Nn).get(n);if(r)da(r),k(this,Dr).delete(n);else{var i=k(this,He).get(n);i&&(k(this,Nn).set(n,i.effect),k(this,He).delete(n),i.fragment.lastChild.remove(),this.anchor.before(i.fragment),r=i.effect)}for(const[s,a]of k(this,wn)){if(k(this,wn).delete(s),s===e)break;const o=k(this,He).get(a);o&&(Ne(o.effect),k(this,He).delete(a))}for(const[s,a]of k(this,Nn)){if(s===n||k(this,Dr).has(s))continue;const o=()=>{if(Array.from(k(this,wn).values()).includes(s)){var d=document.createDocumentFragment();rc(a,d),d.append(ln()),k(this,He).set(s,{effect:a,fragment:d})}else Ne(a);k(this,Dr).delete(s),k(this,Nn).delete(s)};k(this,Gi)||!r?(k(this,Dr).add(s),Lr(a,o,!1)):o()}}});_t(this,Js,e=>{k(this,wn).delete(e);const n=Array.from(k(this,wn).values());for(const[r,i]of k(this,He))n.includes(r)||(Ne(i.effect),k(this,He).delete(r))});this.anchor=e,vt(this,Gi,n)}ensure(e,n){var r=ht,i=$l();if(n&&!k(this,Nn).has(e)&&!k(this,He).has(e))if(i){var s=document.createDocumentFragment(),a=ln();s.append(a),k(this,He).set(e,{effect:rn(()=>n(a)),fragment:s})}else k(this,Nn).set(e,rn(()=>n(this.anchor)));if(k(this,wn).set(r,e),i){for(const[o,c]of k(this,Nn))o===e?r.skipped_effects.delete(c):r.skipped_effects.add(c);for(const[o,c]of k(this,He))o===e?r.skipped_effects.delete(c.effect):r.skipped_effects.add(c.effect);r.oncommit(k(this,Ki)),r.ondiscard(k(this,Js))}else bt&&(this.anchor=yt),k(this,Ki).call(this)}}wn=new WeakMap,Nn=new WeakMap,He=new WeakMap,Dr=new WeakMap,Gi=new WeakMap,Ki=new WeakMap,Js=new WeakMap;function ts(t){Wt===null&&ml(),wi&&Wt.l!==null?bf(Wt).m.push(t):Po(()=>{const e=Y(t);if(typeof e=="function")return e})}function _f(t,e,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:r})}function pa(){const t=Wt;return t===null&&ml(),(e,n,r)=>{var s;const i=(s=t.s.$$events)==null?void 0:s[e];if(i){const a=Yi(i)?i.slice():[i],o=_f(e,n,r);for(const c of a)c.call(t.x,o);return!o.defaultPrevented}return!0}}function bf(t){var e=t.l;return e.u??(e.u={a:[],b:[],m:[]})}function $t(t,e,n=!1){bt&&Br();var r=new mf(t),i=n?pi:0;function s(a,o){if(bt){const d=wl(t)===Gs;if(a===d){var c=Os();$e(c),r.anchor=c,Qn(!1),r.ensure(a,o),Qn(!0);return}}r.ensure(a,o)}fa(()=>{var a=!1;e((o,c=!0)=>{a=!0,s(c,o)}),a||s(!1,null)},i)}function sn(t,e){return e}function yf(t,e,n){for(var r=[],i=e.length,s,a=e.length,o=0;o<i;o++){let m=e[o];Lr(m,()=>{if(s){if(s.pending.delete(m),s.done.add(m),s.pending.size===0){var b=t.outrogroups;Uo(Vs(s.done)),b.delete(s),b.size===0&&(t.outrogroups=null)}}else a-=1},!1)}if(a===0){var c=r.length===0&&n!==null;if(c){var d=n,p=d.parentNode;ra(p),p.append(d),t.items.clear()}Uo(e,!c)}else s={pending:new Set(e),done:new Set},(t.outrogroups??(t.outrogroups=new Set)).add(s)}function Uo(t,e=!0){for(var n=0;n<t.length;n++)Ne(t[n],e)}var Ka;function Je(t,e,n,r,i,s=null){var a=t,o=new Map,c=(e&_l)!==0;if(c){var d=t;a=bt?$e(on(d)):d.appendChild(ln())}bt&&Br();var p=null,m=aa(()=>{var O=n();return Yi(O)?O:O==null?[]:Vs(O)}),b,I=!0;function q(){T.fallback=p,wf(T,b,a,e,r),p!==null&&(b.length===0?p.f&Yn?(p.f^=Yn,Pi(p,null,a)):da(p):Lr(p,()=>{p=null}))}var P=fa(()=>{b=l(m);var O=b.length;let et=!1;if(bt){var G=wl(a)===Gs;G!==(O===0)&&(a=Os(),$e(a),Qn(!1),et=!0)}for(var tt=new Set,K=ht,st=$l(),nt=0;nt<O;nt+=1){bt&&yt.nodeType===Jr&&yt.data===na&&(a=yt,et=!0,Qn(!1));var L=b[nt],ct=r(L,nt),W=I?null:o.get(ct);W?(W.v&&Hr(W.v,L),W.i&&Hr(W.i,nt),st&&K.skipped_effects.delete(W.e)):(W=Sf(o,I?a:Ka??(Ka=ln()),L,ct,nt,i,e,n),I||(W.e.f|=Yn),o.set(ct,W)),tt.add(ct)}if(O===0&&s&&!p&&(I?p=rn(()=>s(a)):(p=rn(()=>s(Ka??(Ka=ln()))),p.f|=Yn)),bt&&O>0&&$e(Os()),!I)if(st){for(const[it,ot]of o)tt.has(it)||K.skipped_effects.add(ot.e);K.oncommit(q),K.ondiscard(()=>{})}else q();et&&Qn(!0),l(m)}),T={effect:P,items:o,outrogroups:null,fallback:p};I=!1,bt&&(a=yt)}function Ri(t){for(;t!==null&&!(t.f&kn);)t=t.next;return t}function wf(t,e,n,r,i){var W,it,ot,dt,jt,ut,Ft,Nt,Rt;var s=(r&ju)!==0,a=e.length,o=t.items,c=Ri(t.effect.first),d,p=null,m,b=[],I=[],q,P,T,O;if(s)for(O=0;O<a;O+=1)q=e[O],P=i(q,O),T=o.get(P).e,T.f&Yn||((it=(W=T.nodes)==null?void 0:W.a)==null||it.measure(),(m??(m=new Set)).add(T));for(O=0;O<a;O+=1){if(q=e[O],P=i(q,O),T=o.get(P).e,t.outrogroups!==null)for(const At of t.outrogroups)At.pending.delete(T),At.done.delete(T);if(T.f&Yn)if(T.f^=Yn,T===c)Pi(T,null,n);else{var et=p?p.next:c;T===t.effect.last&&(t.effect.last=T.prev),T.prev&&(T.prev.next=T.next),T.next&&(T.next.prev=T.prev),ur(t,p,T),ur(t,T,et),Pi(T,et,n),p=T,b=[],I=[],c=Ri(p.next);continue}if(T.f&ze&&(da(T),s&&((dt=(ot=T.nodes)==null?void 0:ot.a)==null||dt.unfix(),(m??(m=new Set)).delete(T))),T!==c){if(d!==void 0&&d.has(T)){if(b.length<I.length){var G=I[0],tt;p=G.prev;var K=b[0],st=b[b.length-1];for(tt=0;tt<b.length;tt+=1)Pi(b[tt],G,n);for(tt=0;tt<I.length;tt+=1)d.delete(I[tt]);ur(t,K.prev,st.next),ur(t,p,K),ur(t,st,G),c=G,p=st,O-=1,b=[],I=[]}else d.delete(T),Pi(T,c,n),ur(t,T.prev,T.next),ur(t,T,p===null?t.effect.first:p.next),ur(t,p,T),p=T;continue}for(b=[],I=[];c!==null&&c!==T;)(d??(d=new Set)).add(c),I.push(c),c=Ri(c.next);if(c===null)continue}T.f&Yn||b.push(T),p=T,c=Ri(T.next)}if(t.outrogroups!==null){for(const At of t.outrogroups)At.pending.size===0&&(Uo(Vs(At.done)),(jt=t.outrogroups)==null||jt.delete(At));t.outrogroups.size===0&&(t.outrogroups=null)}if(c!==null||d!==void 0){var nt=[];if(d!==void 0)for(T of d)T.f&ze||nt.push(T);for(;c!==null;)!(c.f&ze)&&c!==t.fallback&&nt.push(c),c=Ri(c.next);var L=nt.length;if(L>0){var ct=r&_l&&a===0?n:null;if(s){for(O=0;O<L;O+=1)(Ft=(ut=nt[O].nodes)==null?void 0:ut.a)==null||Ft.measure();for(O=0;O<L;O+=1)(Rt=(Nt=nt[O].nodes)==null?void 0:Nt.a)==null||Rt.fix()}yf(t,nt,ct)}}s&&In(()=>{var At,It;if(m!==void 0)for(T of m)(It=(At=T.nodes)==null?void 0:At.a)==null||It.apply()})}function Sf(t,e,n,r,i,s,a,o){var c=a&Au?a&qu?Pr(n):at(n,!1,!1):null,d=a&Cu?Pr(i):null;return{v:c,i:d,e:rn(()=>(s(e,c??n,d??i,o),()=>{t.delete(r)}))}}function Pi(t,e,n){if(t.nodes)for(var r=t.nodes.start,i=t.nodes.end,s=e&&!(e.f&Yn)?e.nodes.start:n;r!==null;){var a=$n(r);if(s.before(r),r===i)return;r=a}}function ur(t,e,n){e===null?t.effect.first=n:e.next=n,n===null?t.effect.last=e:n.prev=e}function xf(t,e,n=!1,r=!1,i=!1){var s=t,a="";Et(()=>{var o=Tt;if(a===(a=e()??"")){bt&&Br();return}if(o.nodes!==null&&(Zl(o.nodes.start,o.nodes.end),o.nodes=null),a!==""){if(bt){yt.data;for(var c=Br(),d=c;c!==null&&(c.nodeType!==Jr||c.data!=="");)d=c,c=$n(c);if(c===null)throw Zi(),Rr;wr(yt,d),s=$e(c);return}var p=a+"";n?p=`<svg>${p}</svg>`:r&&(p=`<math>${p}</math>`);var m=ic(p);if((n||r)&&(m=on(m)),wr(on(m),m.lastChild),n||r)for(;on(m);)s.before(on(m));else s.before(m)}})}function ac(t,e,n,r,i){var o;bt&&Br();var s=(o=e.$$slots)==null?void 0:o[n],a=!1;s===!0&&(s=e.children,a=!0),s===void 0||s(t,a?()=>r:r)}const Xa=[...` 	
\r\f \v\uFEFF`];function kf(t,e,n){var r=t==null?"":""+t;if(e&&(r=r?r+" "+e:e),n){for(var i in n)if(n[i])r=r?r+" "+i:i;else if(r.length)for(var s=i.length,a=0;(a=r.indexOf(i,a))>=0;){var o=a+s;(a===0||Xa.includes(r[a-1]))&&(o===r.length||Xa.includes(r[o]))?r=(a===0?"":r.substring(0,a))+r.substring(o+1):a=o}}return r===""?null:r}function $f(t,e){return t==null?null:String(t)}function Xn(t,e,n,r,i,s){var a=t.__className;if(bt||a!==n||a===void 0){var o=kf(n,r,s);(!bt||o!==t.getAttribute("class"))&&(o==null?t.removeAttribute("class"):t.className=o),t.__className=n}else if(s&&i!==s)for(var c in s){var d=!!s[c];(i==null||d!==!!i[c])&&t.classList.toggle(c,d)}return s}function qs(t,e,n,r){var i=t.__style;if(bt||i!==e){var s=$f(e);(!bt||s!==t.getAttribute("style"))&&(s==null?t.removeAttribute("style"):t.style.cssText=s),t.__style=e}return r}function lc(t,e,n=!1){if(t.multiple){if(e==null)return;if(!Yi(e))return Fu();for(var r of t.options)r.selected=e.includes(Ji(r));return}for(r of t.options){var i=Ji(r);if(Bu(i,e)){r.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function Ef(t){var e=new MutationObserver(()=>{lc(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Qs(()=>{e.disconnect()})}function cc(t,e,n=e){var r=new WeakSet,i=!0;ca(t,"change",s=>{var a=s?"[selected]":":checked",o;if(t.multiple)o=[].map.call(t.querySelectorAll(a),Ji);else{var c=t.querySelector(a)??t.querySelector("option:not([disabled])");o=c&&Ji(c)}n(o),ht!==null&&r.add(ht)}),Xl(()=>{var s=e();if(t===document.activeElement){var a=Ls??ht;if(r.has(a))return}if(lc(t,s,i),i&&s===void 0){var o=t.querySelector(":checked");o!==null&&(s=Ji(o),n(s))}t.__value=s,i=!1}),Ef(t)}function Ji(t){return"__value"in t?t.__value:t.value}const Tf=Symbol("is custom element"),Af=Symbol("is html");function We(t){if(bt){var e=!1,n=()=>{if(!e){if(e=!0,t.hasAttribute("value")){var r=t.value;Jo(t,"value",null),t.value=r}if(t.hasAttribute("checked")){var i=t.checked;Jo(t,"checked",null),t.checked=i}}};t.__on_r=n,In(n),Pl()}}function Jo(t,e,n,r){var i=Cf(t);bt&&(i[e]=t.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&t.nodeName==="LINK")||i[e]!==(i[e]=n)&&(e==="loading"&&(t[uu]=n),n==null?t.removeAttribute(e):typeof n!="string"&&jf(t).includes(e)?t[e]=n:t.setAttribute(e,n))}function Cf(t){return t.__attributes??(t.__attributes={[Tf]:t.nodeName.includes("-"),[Af]:t.namespaceURI===Ou})}var Ya=new Map;function jf(t){var e=t.getAttribute("is")||t.nodeName,n=Ya.get(e);if(n)return n;Ya.set(e,n=[]);for(var r,i=t,s=Element.prototype;s!==i;){r=dl(i);for(var a in r)r[a].set&&n.push(a);i=ea(i)}return n}function ke(t,e,n=e){var r=new WeakSet;ca(t,"input",async i=>{var s=i?t.defaultValue:t.value;if(s=ko(t)?$o(s):s,n(s),ht!==null&&r.add(ht),await nf(),s!==(s=e())){var a=t.selectionStart,o=t.selectionEnd,c=t.value.length;if(t.value=s??"",o!==null){var d=t.value.length;a===o&&o===c&&d>c?(t.selectionStart=d,t.selectionEnd=d):(t.selectionStart=a,t.selectionEnd=Math.min(o,d))}}}),(bt&&t.defaultValue!==t.value||Y(e)==null&&t.value)&&(n(ko(t)?$o(t.value):t.value),ht!==null&&r.add(ht)),xi(()=>{var i=e();if(t===document.activeElement){var s=Ls??ht;if(r.has(s))return}ko(t)&&i===$o(t.value)||t.type==="date"&&!i&&!t.value||i!==t.value&&(t.value=i??"")})}function Qa(t,e,n=e){ca(t,"change",r=>{var i=r?t.defaultChecked:t.checked;n(i)}),(bt&&t.defaultChecked!==t.checked||Y(e)==null)&&n(t.checked),xi(()=>{var r=e();t.checked=!!r})}function ko(t){var e=t.type;return e==="number"||e==="range"}function $o(t){return t===""?null:+t}function Za(t,e){return t===e||(t==null?void 0:t[tr])===e}function qf(t={},e,n,r){return Xl(()=>{var i,s;return xi(()=>{i=s,s=[],Y(()=>{t!==n(...s)&&(e(t,...s),i&&Za(n(...i),t)&&e(null,...i))})}),()=>{In(()=>{s&&Za(n(...s),t)&&e(null,...s)})}}),t}function xr(t=!1){const e=Wt,n=e.l.u;if(!n)return;let r=()=>Ys(e.s);if(t){let i=0,s={};const a=oa(()=>{let o=!1;const c=e.s;for(const d in c)c[d]!==s[d]&&(s[d]=c[d],o=!0);return o&&i++,i});r=()=>l(a)}n.b.length&&sf(()=>{tl(e,r),Ds(n.b)}),Po(()=>{const i=Y(()=>n.m.map(pu));return()=>{for(const s of i)typeof s=="function"&&s()}}),n.a.length&&Po(()=>{tl(e,r),Ds(n.a)})}function tl(t,e){if(t.l.s)for(const n of t.l.s)l(n);e()}function ha(t,e){var s;var n=(s=t.$$events)==null?void 0:s[e.type],r=Yi(n)?n.slice():n==null?[]:[n];for(var i of r)i.call(this,e)}function dn(t,e,n){var r;t.$$events||(t.$$events={}),(r=t.$$events)[e]||(r[e]=[]),t.$$events[e].push(n)}function vn(t){for(var e in t)e in this&&(this[e]=t[e])}function ga(t,e,n){if(t==null)return e(void 0),n&&n(void 0),_r;const r=Y(()=>t.subscribe(e,n));return r.unsubscribe?()=>r.unsubscribe():r}const ei=[];function Nf(t,e){return{subscribe:ae(t,e).subscribe}}function ae(t,e=_r){let n=null;const r=new Set;function i(o){if(hl(t,o)&&(t=o,n)){const c=!ei.length;for(const d of r)d[1](),ei.push(d,t);if(c){for(let d=0;d<ei.length;d+=2)ei[d][0](ei[d+1]);ei.length=0}}}function s(o){i(o(t))}function a(o,c=_r){const d=[o,c];return r.add(d),r.size===1&&(n=e(i,s)||_r),o(t),()=>{r.delete(d),r.size===0&&n&&(n(),n=null)}}return{set:i,update:s,subscribe:a}}function If(t,e,n){const r=!Array.isArray(t),i=r?[t]:t;if(!i.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const s=e.length<2;return Nf(n,(a,o)=>{let c=!1;const d=[];let p=0,m=_r;const b=()=>{if(p)return;m();const q=e(r?d[0]:d,a,o);s?a(q):m=typeof q=="function"?q:_r},I=i.map((q,P)=>ga(q,T=>{d[P]=T,p&=~(1<<P),c&&b()},()=>{p|=1<<P}));return c=!0,b(),function(){Ds(I),m(),c=!1}})}function xn(t){let e;return ga(t,n=>e=n)(),e}let Es=!1,Wo=Symbol();function ie(t,e,n){const r=n[e]??(n[e]={store:null,source:at(void 0),unsubscribe:_r});if(r.store!==t&&!(Wo in n))if(r.unsubscribe(),r.store=t??null,t==null)r.source.v=void 0,r.unsubscribe=_r;else{var i=!0;r.unsubscribe=ga(t,s=>{i?r.source.v=s:A(r.source,s)}),i=!1}return t&&Wo in n?xn(t):l(r.source)}function Mf(t,e){return t.set(e),e}function ki(){const t={};function e(){Qs(()=>{for(var n in t)t[n].unsubscribe();ta(t,Wo,{enumerable:!1,value:!0})})}return[t,e]}function Df(t){var e=Es;try{return Es=!1,[t(),Es]}finally{Es=e}}function Ie(t,e,n,r){var et;var i=!wi||(n&Nu)!==0,s=(n&Iu)!==0,a=r,o=!0,c=()=>(o&&(o=!1,a=r),a),d;{var p=tr in t||fl in t;d=((et=si(t,e))==null?void 0:et.set)??(p&&e in t?G=>t[e]=G:void 0)}var m,b=!1;[m,b]=Df(()=>t[e]),m===void 0&&r!==void 0&&(m=c(),d&&(i&&wu(),d(m)));var I;if(i?I=()=>{var G=t[e];return G===void 0?c():(o=!0,G)}:I=()=>{var G=t[e];return G!==void 0&&(a=void 0),G===void 0?a:G},d){var q=t.$$legacy;return function(G,tt){return arguments.length>0?((!i||!tt||q||b)&&d(tt?I():G),G):I()}}var P=!1,T=aa(()=>(P=!1,I()));l(T);var O=Tt;return function(G,tt){if(arguments.length>0){const K=tt?l(T):i&&s?ii(G):G;return A(T,K),P=!0,a!==void 0&&(a=K),G}return Sr&&P||O.f&Zn?T.v:l(T)}}const nr=ae(""),oi=ae(""),ve=ae(""),ge=ae(null),de=ae(!1),ni=ae("就绪"),Ze=ae("就绪"),ma=ae([]),Of=ae("等待解析…"),Lf=ae([]),Ff=ae([]),_a=ae([]),Ns=ae(!1),zo=ae(null),ba=ae([]),bi=ae(-1),ya=If(ve,t=>String(t||"").replace(/\s/g,"").length),Vo=ae([]),el=ae(!1),Ts=ae(!1);let Eo=null,To=null;typeof window<"u"&&(window.__waGetStore=t=>{const n={docId:nr,instruction:oi,sourceText:ve,docIr:ge,docIrDirty:de,flowStatus:ni,docStatus:Ze,generating:Ns,wordCount:ya}[t];return n?xn(n):void 0});async function Rf(){const t=xn(nr);if(!t)return;const e=await fetch(`/api/doc/${t}/chat`);if(!e.ok)return;const n=await e.json(),r=Array.isArray(n.items)?n.items:[];ma.set(r)}async function Bf(){const t=xn(nr);if(!t)return;const e=await fetch(`/api/doc/${t}/thoughts`);if(!e.ok)return;const n=await e.json(),r=Array.isArray(n.items)?n.items:[];_a.set(r)}async function Pf(t){const e=xn(nr);e&&await fetch(`/api/doc/${e}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:t.slice(-200)})})}async function Hf(t){const e=xn(nr);e&&await fetch(`/api/doc/${e}/thoughts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:t.slice(-200)})})}function fr(t,e){const n={role:t,text:String(e||"").trim()};n.text&&ma.update(r=>{const i=[...r,n];return Eo&&clearTimeout(Eo),Eo=setTimeout(()=>{Pf(i).catch(()=>{})},300),i})}function ye(t,e,n){const r={label:t,detail:e,time:n||new Date().toLocaleTimeString()};_a.update(i=>{const s=[...i,r].slice(-200);return To&&clearTimeout(To),To=setTimeout(()=>{Hf(s).catch(()=>{})},300),s})}function kt(t,e="info"){const n=Date.now(),r={id:n,message:t,type:e};Vo.update(i=>[...i,r]),setTimeout(()=>{Vo.update(i=>i.filter(s=>s.id!==n))},2600)}function Uf(t){const e=String(t||"");ba.update(n=>{const r=n.slice(0,xn(bi)+1);if(r[r.length-1]===e)return n;r.push(e);const i=r.slice(-50);return bi.set(i.length-1),i})}function Jf(){const t=xn(bi);if(t<=0)return;bi.set(t-1);const e=xn(ba);ve.set(e[t-1]||""),de.set(!0)}function Wf(){const t=xn(bi),e=xn(ba);t>=e.length-1||(bi.set(t+1),ve.set(e[t+1]||""),de.set(!0))}var zf=Z('<div class="assistant-header svelte-191yngm"><div class="assistant-title svelte-191yngm"><span class="assistant-dot svelte-191yngm"></span> 智能助手</div> <button class="assistant-toggle svelte-191yngm"> </button></div>'),Vf=Z('<div class="panel-title svelte-191yngm">对话写作</div>'),Gf=Z('<div class="thought-item svelte-191yngm"><div class="thought-meta svelte-191yngm"><span class="label"> </span> <span class="time"> </span></div> <div class="detail svelte-191yngm"> </div></div>'),Kf=Z('<div class="thoughts svelte-191yngm"><div class="thoughts-title svelte-191yngm">思考链</div> <div class="thought-list svelte-191yngm"></div></div>'),Xf=Z('<div><div class="chat-bubble svelte-191yngm"> </div></div>'),Yf=Z('<div><!> <!> <div class="chat-history svelte-191yngm"></div> <div class="composer svelte-191yngm"><textarea rows="3" placeholder="输入需求或修改指令" class="svelte-191yngm"></textarea> <button class="send-btn svelte-191yngm">发送</button></div></div>');function uc(t,e){if(new.target)return fn({component:uc,...t});Ve(e,!1);const n=()=>ie(oi,"$instruction",s),r=()=>ie(_a,"$thoughtLog",s),i=()=>ie(ma,"$chat",s),[s,a]=ki(),o=pa();let c=Ie(e,"variant",12,"panel"),d=at(c()==="panel");function p(){const W=n().trim();W&&(o("send",W),oi.set(""),I())}function m(W){W.key==="Enter"&&!W.shiftKey&&(W.preventDefault(),p())}function b(){A(d,!l(d)),I()}function I(){queueMicrotask(()=>{const W=document.querySelector(".chat-history");W&&(W.scrollTop=W.scrollHeight);const it=document.querySelector(".thought-list");it&&(it.scrollTop=it.scrollHeight)})}var q={get variant(){return c()},set variant(W){c(W),we()},$set:vn,$on:(W,it)=>dn(e,W,it)};xr();var P=Yf(),T=$(P);{var O=W=>{var it=zf(),ot=_($(it),2),dt=$(ot,!0);w(ot),w(it),Et(()=>gt(dt,l(d)?"隐藏思考":"思考链")),M("click",ot,b),z(W,it)},et=W=>{var it=Vf();z(W,it)};$t(T,W=>{c()==="assistant"?W(O):W(et,!1)})}var G=_(T,2);{var tt=W=>{var it=Kf(),ot=_($(it),2);Je(ot,5,r,sn,(dt,jt)=>{var ut=Gf(),Ft=$(ut),Nt=$(Ft),Rt=$(Nt,!0);w(Nt);var At=_(Nt,2),It=$(At,!0);w(At),w(Ft);var zt=_(Ft,2),pt=$(zt,!0);w(zt),w(ut),Et(()=>{gt(Rt,(l(jt),Y(()=>l(jt).label))),gt(It,(l(jt),Y(()=>l(jt).time))),gt(pt,(l(jt),Y(()=>l(jt).detail)))}),z(dt,ut)}),w(ot),w(it),z(W,it)};$t(G,W=>{l(d)&&W(tt)})}var K=_(G,2);Je(K,5,i,sn,(W,it)=>{var ot=Xf(),dt=$(ot),jt=$(dt,!0);w(dt),w(ot),Et(()=>{Xn(ot,1,`chat-msg ${l(it),Y(()=>l(it).role)??""}`,"svelte-191yngm"),gt(jt,(l(it),Y(()=>l(it).text)))}),z(W,ot)}),w(K);var st=_(K,2),nt=$(st);Fs(nt);var L=_(nt,2);w(st),w(P),Et(()=>Xn(P,1,`chat-shell ${c()}`,"svelte-191yngm")),ke(nt,n,W=>Mf(oi,W)),M("keydown",nt,m),M("click",L,p),z(t,P);var ct=Ge(q);return a(),ct}function Qf(t){const e=String(t||"").replace(/\r\n/g,`
`).replace(/\r/g,`
`);if(!e.trim())return"";const n=td(e)||e,r=wc(n.split(`
`));let i="",s=!1,a="";const o=[],c=()=>{a&&(o.push(a==="ol"?"</ol>":"</ul>"),a="")};for(const d of r){const p=d.trim();if(p.startsWith("```")){s?(o.push("</code></pre>"),s=!1):(c(),o.push('<pre class="code"><code>'),s=!0);continue}if(s){o.push(`${ne(d)}
`);continue}if(/^#{1,6}$/.test(p))continue;if(p===":::left"){c(),i="left";continue}if(p===":::center"){c(),i="center";continue}if(p===":::right"){c(),i="right";continue}if(p===":::"){c(),i="";continue}const m=p.match(/^\[\[(FIGURE|TABLE)\s*:\s*(\{[\s\S]*\})\s*\]\]$/i);if(m){c();const T=String(m[1]||"").toLowerCase();let O=T==="figure"?"图示":"表格";try{const et=JSON.parse(m[2]);et&&typeof et.caption=="string"&&et.caption.trim()&&(O=et.caption.trim())}catch{}T==="figure"?o.push(`<figure class="wa-figure" data-wa-figure="1"><div class="wa-figure-box">图</div><figcaption>${ne(O)}</figcaption></figure>`):o.push(`<div class="wa-table" data-wa-table="1"><div class="wa-table-box">表</div><div class="wa-table-caption">${ne(O)}</div></div>`);continue}const b=p.match(/^(#{1,3})\s*(.+?)\s*$/);if(b){c();const T=Math.min(3,b[1].length);o.push(`<h${T}>${Mn(b[2])}</h${T}>`);continue}if(!p){if(a)continue;c(),o.push("<p><br/></p>");continue}const I=p.match(/^-\s+(.+)/),q=p.match(/^\d+\.\s+(.+)/);if(I||q){const T=I?"ul":"ol";a?a!==T&&(c(),a=T,o.push(T==="ol"?"<ol>":"<ul>")):(a=T,o.push(T==="ol"?"<ol>":"<ul>"));const O=(I||q)[1];o.push(`<li>${Mn(O)}</li>`);continue}c();const P=i?` style="text-align:${i};"`:"";o.push(`<p${P}>${Mn(d)}</p>`)}return c(),o.join("")}function Zf(t,e,n){const r=String(t||""),i=nd(r);if(i)return i;if(!n){const s=rd(e);if(s)return s}return Qf(r)}function Go(t){let e=String(t||"").replace(/\r\n/g,`
`).replace(/\r/g,`
`);if(!e.endsWith(`
`)){const b=e.lastIndexOf(`
`),I=b>=0?e.slice(b+1):e;I.trim().length<=4&&(/^#{1,6}\s*\S*$/.test(I)||/^[-*•·]\s*\S*$/.test(I))&&(e=b>=0?e.slice(0,b+1):"")}if(!e.trim())return null;const n=wc(e.split(`
`)),r=[];let i="",s=[],a=[],o=null;const c=()=>{if(!s.length)return;const b=s.join(" ").replace(/\s+/g," ").trim();b&&r.push({type:"paragraph",text:b}),s=[]},d=()=>{a.length&&(r.push({type:"list",items:a.slice(),ordered:!!o}),a=[],o=null)};let p=!0;for(const b of n){const q=String(b||"").trim();if(!q){c(),d(),p=!0;continue}if(/^#{1,6}$/.test(q))continue;const P=/^(#{1,3})\s*(.+)$/.exec(q);if(P){c(),d();const tt=Math.min(3,Math.max(1,P[1].length));let K=String(P[2]||"").trim(),st="";const nt=rl(K);nt&&(K=nt.heading,st=nt.rest),tt===1&&!i&&K&&(i=K),r.push({type:"heading",level:tt,text:K||"章节"}),st&&r.push({type:"paragraph",text:st}),p=!1;continue}const T=/^(\d+(?:\.\d+){0,3})[\.、\)]?\s+(.+)$/.exec(q);if(T){const tt=String(T[1]||"");let K=String(T[2]||"").trim();const st=(tt.match(/\./g)||[]).length,nt=Math.min(6,2+st),L=rl(K),ct=K.length<=16&&!vr.test(K),W=bc.some(ot=>K.startsWith(ot)),it=p||!s.length&&!a.length||L||ct||W;if(K&&it){c(),d();let ot="";L&&(K=L.heading,ot=L.rest),nt===1&&!i&&K&&(i=K),r.push({type:"heading",level:nt,text:K||"章节"}),ot&&r.push({type:"paragraph",text:ot}),p=!1;continue}}const O=q.match(/^\[\[(FIGURE|TABLE)\s*:\s*(\{[\s\S]*\})\s*\]\]$/i);if(O){c(),d();const tt=String(O[1]||"").toLowerCase(),K=es(O[2])||{raw:O[2]};tt==="table"?r.push({type:"table",table:K}):r.push({type:"figure",figure:K});continue}const et=q.match(/^[-*•·]\s+(.*)$/),G=q.match(/^\d+[\.\)]\s+(.*)$/);if(et||G){c();const tt=!!G;o===null&&(o=tt),o!==tt&&(d(),o=tt);const K=String((G==null?void 0:G[1])||(et==null?void 0:et[1])||"").trim();K&&a.push(K),p=!1;continue}d(),s.push(q),p=!1}c(),d();const m=i||wa(r)||"自动生成文档";return dd(r,m)}function td(t){const e=String(t||"").trim();if(!e||/^#{1,3}\s+/m.test(e))return null;const n=fc(e);if(n){const i=es(n);if(i!==null){const s=ed(i);if(s)return s}}const r=dc(e);return r.length>0?Xo(r):null}function fc(t){let e=String(t||"").trim();return e?(e.startsWith("```")&&(e=e.replace(/^```json/i,"").replace(/^```/,""),e.endsWith("```")&&(e=e.slice(0,-3)),e=e.trim()),e.startsWith("{")||e.startsWith("[")?e:null):null}function es(t){try{return JSON.parse(t)}catch{return null}}function dc(t){const e=[],n=String(t||"").split(`
`);for(const r of n){const i=r.trim();if(!i)continue;const s=es(i);s&&typeof s=="object"&&!Array.isArray(s)&&e.push(s)}return e}function ed(t){if(!t||typeof t!="object")return null;const e=t;return e.doc_ir&&typeof e.doc_ir=="object"?Bs(e.doc_ir):Array.isArray(t)?Xo(t):Array.isArray(e.blocks)?Xo(e.blocks):Array.isArray(e.sections)?e.sections.some(i=>i&&(i.blocks||i.children))?Bs(e):id(e):null}function nd(t){const e=String(t||"").trim();if(!e)return null;const n=fc(e);if(n){const i=es(n);if(i!==null){const s=Ko(i);if(s)return s}}const r=dc(e);if(r.length>0){const i=Yo(r);if(i)return i}return null}function rd(t){if(!t)return null;if(typeof t=="string"){const e=es(t);return e?Ko(e):null}return typeof t!="object"?null:Ko(t)}function Ko(t){if(!t||typeof t!="object")return null;const e=t;return e.doc_ir&&typeof e.doc_ir=="object"?nl(e.doc_ir):Array.isArray(t)?Yo(t):Array.isArray(e.blocks)?Yo(e.blocks,String(e.title||"").trim()):Array.isArray(e.sections)?nl(e):null}function Bs(t){const e=yc(t),n=Array.isArray(t.sections)?t.sections:[],r=[];e&&r.push(`# ${e}`);for(const i of n)pc(i,r);return r.length?r.join(`

`).trim():null}function nl(t){const e=yc(t),n=Array.isArray(t.sections)?t.sections:[];if(!e&&n.length===0)return null;const r=['<div class="wa-doc">'],i=e;r.push(`<div class="wa-header" contenteditable="false">${ne(i)}</div>`),r.push('<div class="wa-body">');const s=Hs(e);e&&r.push(`<div class="wa-title">${Mn(e)}</div>`);for(const a of n)r.push(vc(a,s));return r.push("</div>"),r.push('<div class="wa-footer" contenteditable="false">Page 1</div>'),r.push("</div>"),r.join("")}function vc(t,e){const n=String(t.title||"").trim(),r=Math.min(6,Math.max(1,Number(t.level||2))),i=String(t.id||"").trim(),s=i?` data-section-id="${ne(i)}" data-section-level="${r}"`:"",a=hc({style:t.style}),o=`${s}${a}`,c=[];n&&(r===1&&e&&Hs(n)===e||c.push(Ps(r,n,o)));const d=Array.isArray(t.blocks)?t.blocks:[];for(const m of d){const b=mc(m);b&&c.push(b)}const p=Array.isArray(t.children)?t.children:[];for(const m of p)c.push(vc(m,e));return c.join("")}function pc(t,e){const n=String(t.title||"").trim();if(n){const s=Math.min(6,Math.max(1,Number(t.level||2)));e.push(`${"#".repeat(s)} ${n}`)}const r=Array.isArray(t.blocks)?t.blocks:[];for(const s of r)e.push(...gc(s));const i=Array.isArray(t.children)?t.children:[];for(const s of i)pc(s,e)}function id(t){const e=String(t.title||"").trim(),n=Array.isArray(t.sections)?t.sections:[],r=[];e&&r.push(`# ${e}`);for(const i of n){const s=String(i.title||i.name||i.section||"").trim();if(!s)continue;r.push(`## ${s}`);let a=i.content??i.text??i.body;Array.isArray(a)&&(a=a.map(c=>String(c||"").trim()).filter(Boolean).join(`

`));const o=String(a||"").trim();o&&r.push(o)}return r.length?r.join(`

`).trim():null}function Xo(t){const e=[];let n="";for(const r of t){const i=String(r.section_id||r.section_title||"").trim();if(i&&i!==n){const s=sd(i);s&&e.push(s),n=i}e.push(...gc(r))}return e.length?e.join(`

`).trim():null}function Yo(t,e){const n=['<div class="wa-doc">'],r=String(e||"").trim()||wa(t),i=r;n.push(`<div class="wa-header" contenteditable="false">${ne(i)}</div>`),n.push('<div class="wa-body">'),r&&n.push(`<div class="wa-title">${Mn(r)}</div>`);let s="",a=!1;for(const o of t){const c=String(o.section_id||o.section_title||"").trim();if(c&&c!==s){const m=od(c);m&&n.push(m),s=c}const d=String(o.type||"").toLowerCase();if(!a&&r&&d==="heading"&&Number(o.level||0)===1){const m=String(o.text||"").trim();if(Hs(m)===Hs(r)){a=!0;continue}}const p=mc(o);p&&n.push(p)}return n.push("</div>"),n.push('<div class="wa-footer" contenteditable="false">Page 1</div>'),n.push("</div>"),n.length>2?n.join(""):null}function sd(t){const e=/^H([1-6])::(.+)$/.exec(t);if(e){const n=Math.min(6,Math.max(1,Number(e[1]||2))),r=String(e[2]||"").trim();if(r)return`${"#".repeat(n)} ${r}`}return`## ${t}`}function od(t){const e=/^H([1-6])::(.+)$/.exec(t);if(e){const n=Math.min(6,Math.max(1,Number(e[1]||2))),r=String(e[2]||"").trim();if(r)return Ps(n,r)}return Ps(2,t)}function ad(t){const e=String(t.id||"").trim();return e?` data-block-id="${ne(e)}"`:""}function hc(t){const e=t.style;if(!e||typeof e!="object")return"";const n=[],r=String(e.align||e.textAlign||"").trim();["left","center","right","justify"].includes(r)&&n.push(`text-align:${r}`);const i=String(e.lineHeight||"").trim();/^\d+(\.\d+)?$/.test(i)&&n.push(`line-height:${i}`);const s=String(e.indent||e.textIndent||"").trim();/^\d+(\.\d+)?(px|pt|em|rem)?$/.test(s)&&n.push(`text-indent:${s}`);const a=String(e.marginTop||"").trim();/^\d+(\.\d+)?(px|pt|em|rem)?$/.test(a)&&n.push(`margin-top:${a}`);const o=String(e.marginBottom||"").trim();/^\d+(\.\d+)?(px|pt|em|rem)?$/.test(o)&&n.push(`margin-bottom:${o}`);const c=String(e.fontFamily||"").trim();c&&c.length<80&&n.push(`font-family:${ne(c)}`);const d=String(e.fontSize||"").trim();/^\d+(\.\d+)?(px|pt|em|rem)?$/.test(d)&&n.push(`font-size:${d}`);const p=String(e.color||"").trim();(/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(p)||p.startsWith("rgb("))&&n.push(`color:${ne(p)}`);const m=String(e.background||e.backgroundColor||"").trim();return(/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(m)||m.startsWith("rgb("))&&n.push(`background-color:${ne(m)}`),n.length?` style="${n.join(";")}"`:""}function gc(t){const e=String(t.type||"paragraph").toLowerCase();if(e==="paragraph"||e==="text"||e==="p"){const r=Array.isArray(t.runs)?t.runs:null,s=(r&&r.length?r.map(a=>String(a.text||"")).join(""):String(t.text||"")).trim();return s?[s]:[]}if(e==="list"||e==="bullets"||e==="bullet"){const r=!!t.ordered,i=Array.isArray(t.items)?t.items:[];if(i.length){const o=i.map(c=>String(c||"").trim()).filter(Boolean);return r?o.map((c,d)=>`${d+1}. ${c}`):o.map(c=>`- ${c}`)}const s=String(t.text||"").trim();if(!s)return[];const a=s.split(/\n+/).map(o=>o.trim()).filter(Boolean);return r?a.map((o,c)=>{const d=o.replace(/^\d+[\.\)]\s+/,"");return`${c+1}. ${d}`}):a.map(o=>o.startsWith("-")?o:`- ${o}`)}if(e==="table"||e==="figure"){const r={};return typeof t.caption=="string"&&(r.caption=t.caption),Array.isArray(t.columns)&&(r.columns=t.columns),Array.isArray(t.rows)&&(r.rows=t.rows),t.data&&typeof t.data=="object"&&(r.data=t.data),[`[[${e==="table"?"TABLE":"FIGURE"}:${JSON.stringify(r)}]]`]}if(e==="reference"||e==="ref"){const r=String(t.text||"").trim();return r?[r]:(Array.isArray(t.items)?t.items:[]).map(s=>String(s||"").trim()).filter(Boolean)}const n=String(t.text||"").trim();return n?[n]:[]}function mc(t){const e=ad(t),n=hc(t),r=String(t.type||"paragraph").toLowerCase();if(r==="heading"){const s=Math.min(6,Math.max(1,Number(t.level||1))),a=String(t.text||""),o=Array.isArray(t.runs)?t.runs:null,c=a.trim(),d=`${e}${n}`;if(o&&o.length){const p=il(o);return`<h${s}${d}>${p||"<br/>"}</h${s}>`}return c?Ps(s,a,d):d?`<h${s}${d}><br/></h${s}>`:""}if(r==="paragraph"||r==="text"||r==="p"){const s=String(t.text||""),a=Array.isArray(t.runs)?t.runs:null,o=s.trim(),c=`${e}${n}`;if(a&&a.length){const d=il(a);return`<p${c}>${d||"<br/>"}</p>`}return o?`<p${c}>${Mn(s).replace(/\n/g,"<br/>")}</p>`:c?`<p${c}><br/></p>`:""}if(r==="list"||r==="bullets"||r==="bullet"){let s=!!t.ordered;const a=Array.isArray(t.items)?t.items:[],o=a.length>0;let c=a.length?a.map(m=>String(m??"")):String(t.text||"").split(/\n+/).map(m=>m.trim()).filter(Boolean);if(!c.length&&!o)return"";if(!s){const m=/^\d+[\.\)]\s+/;c.filter(I=>m.test(I)).length===c.length&&(s=!0,c=c.map(I=>I.replace(m,"")))}const d=c.map(m=>{const b=String(m??"");return b.trim()?`<li>${Mn(b)}</li>`:"<li><br/></li>"}).join(""),p=`${e}${n}`;return s?`<ol${p}>${d}</ol>`:`<ul${p}>${d}</ul>`}if(r==="table"){const s=cd(t),a=s.caption||"Table",o=s.columns.length?s.columns:["Col 1","Col 2"],c=s.rows.length?s.rows:[["",""]],d=o.map(b=>`<th>${ne(b)}</th>`).join(""),p=c.map(b=>{const I=Array.isArray(b)?b:[b];return`<tr>${o.map((P,T)=>`<td>${ne(String(I[T]??""))}</td>`).join("")}</tr>`}).join("");return`<figure class="wa-table"${`${e}${n}`}><figcaption>${ne(a)}</figcaption><table><thead><tr>${d}</tr></thead><tbody>${p}</tbody></table></figure>`}if(r==="figure"){const s=ud(t),a=s.caption||"??",o=`${e}${n}`,c=s.spec&&typeof s.spec=="object"?s.spec:null,d=c?encodeURIComponent(JSON.stringify(c)):"",p=d?` data-figure-spec="${ne(d)}"`:"";return`<figure class="wa-figure"${o}${p}><div class="wa-figure-box">?</div><figcaption>${ne(a)}</figcaption></figure>`}if(r==="quote"){const s=String(t.text||"").trim();return s?`<blockquote>${Mn(s)}</blockquote>`:""}const i=String(t.text||"").trim();return i?ld(i):""}function Ps(t,e,n=""){const r=Mn(e),i=Math.min(6,Math.max(1,Number(t||1)));return`<h${i}${n}>${r}</h${i}>`}function ld(t){return`<p>${Mn(t).replace(/\n/g,"<br/>")}</p>`}function cd(t){const e={caption:"",columns:[],rows:[]},n=t.table,r=typeof n=="object"&&n?n:t.data,i=typeof r=="object"&&r?r:t,s=String(i.caption||"").trim();e.caption=s;const a=i.columns;Array.isArray(a)&&(e.columns=a.map(c=>String(c)));const o=i.rows;return Array.isArray(o)&&(e.rows=o),e}function ud(t){const e=t.figure,n=typeof e=="object"&&e?e:null,i=String((n||t).caption||"").trim(),s=n?{...n}:{};return i&&(s.caption=i),{caption:i,spec:s}}function Hs(t){return String(t||"").trim().toLowerCase()}function _c(t){for(const e of t){const n=String(e.title||"").trim(),r=Number(e.level||0);if(n&&r<=1)return n;const i=Array.isArray(e.children)?e.children:[],s=_c(i);if(s)return s}return""}function wa(t){for(const e of t)if(String(e.type||"").toLowerCase()==="heading"&&Number(e.level||0)===1){const r=String(e.text||"").trim();if(r)return r}for(const e of t)if(String(e.type||"")==="paragraph"){const n=String(e.text||"").trim();if(n)return n.slice(0,24)}return""}const bc=["摘要","引言","绪论","背景","研究背景","目标","范围","术语","定义","需求","需求分析","总体设计","系统设计","架构设计","详细设计","模块设计","实现","关键技术","应用","方法","数据","分析","讨论","评估","结果","结论","总结","展望","风险","问题","计划","本周工作","下周计划","问题与风险","需协助事项","参考文献","附录","致谢"],vr=/[。！？!?；;，、]/,fd=["本文","本研究","本项目","随着","本周","本次","本节","我们","由于","因此","此外","同时","首先","其次","最后"];function rl(t){const e=String(t||"").trim();if(!e||e.length<=12&&!vr.test(e))return null;const n=/^(.{1,12})[:：](.+)$/.exec(e);if(n){const a=String(n[1]||"").trim(),o=String(n[2]||"").trim();if(a&&o&&(vr.test(o)||o.length>=12))return{heading:a.replace(/[：:、\-—\s]+$/g,""),rest:o.replace(/^[：:、\-—\s]+/g,"")}}const r=/^(.{2,10})\s*\1(.+)$/.exec(e);if(r){const a=String(r[1]||"").trim(),o=String(r[2]||"").trim();if(a&&o&&(vr.test(o)||o.length>=6))return{heading:a.replace(/[：:、\-—\s]+$/g,""),rest:o.replace(/^[：:、\-—\s]+/g,"")}}const i=bc.slice().sort((a,o)=>o.length-a.length);for(const a of i)if(e.startsWith(a)&&e.length>a.length+1){const o=e.slice(a.length).trim().replace(/^[：:、\-—\s]+/g,"");if(o&&(vr.test(o)||o.length>=12))return{heading:a,rest:o}}for(const a of i){const o=e.indexOf(a);if(o<=0)continue;const c=o+a.length;if(c>10)continue;const d=e.slice(0,c).trim(),p=e.slice(c).trim().replace(/^[：:、\-—\s]+/g,"");if(d&&p&&(vr.test(p)||p.length>=12))return{heading:d.replace(/[：:、\-—\s]+$/g,""),rest:p}}const s=e.search(/\b\d+(?:\.\d+)+\b/);if(s>0&&s<=12){const a=e.slice(0,s).trim(),o=e.slice(s).trim().replace(/^[：:、\-—\s]+/g,"");if(a&&o&&(vr.test(o)||o.length>=12))return{heading:a.replace(/[：:、\-—\s]+$/g,""),rest:o}}for(const a of fd){const o=e.indexOf(a);if(o>0&&o<=10){const c=e.slice(0,o).trim(),d=e.slice(o).trim().replace(/^[：:、\-—\s]+/g,"");if(c&&d&&d.length>=6&&!vr.test(c))return{heading:c.replace(/[：:、\-—\s]+$/g,""),rest:d}}}return null}function dd(t,e){const n=String(e).trim()||"自动生成文档",r=[],i=[];let s=[];const a=()=>{if(!s.length)return;const o={id:Is(),title:n,level:1,blocks:s,children:[]};r.push(o),i.push({level:1,node:o}),s=[]};for(const o of t){if(String(o.type||"").toLowerCase()==="heading"){const p=Math.min(6,Math.max(1,Number(o.level||1))),m=String(o.text||"").trim()||"章节",b={id:Is(),title:m,level:p,blocks:[],children:[]};for(s.length&&i.length===0&&a();i.length&&i[i.length-1].level>=p;)i.pop();i.length?i[i.length-1].node.children.push(b):r.push(b),i.push({level:p,node:b});continue}const d=vd(o);d&&(i.length?i[i.length-1].node.blocks.push(d):s.push(d))}return s.length&&!r.length&&r.push({id:Is(),title:n,level:1,blocks:s,children:[]}),{title:n,sections:r}}function vd(t){const e=String(t.type||"paragraph").toLowerCase(),r=String(t.id||"").trim()||Is();if(e==="paragraph"){const s=String(t.text||"").trim();return s?{id:r,type:"paragraph",text:s}:null}if(e==="list"){const s=Array.isArray(t.items)?t.items.map(o=>String(o||"").trim()).filter(Boolean):[];if(!s.length)return null;const a=!!t.ordered;return{id:r,type:"list",items:s,ordered:a}}if(e==="table")return{id:r,type:"table",table:t.table||{}};if(e==="figure")return{id:r,type:"figure",figure:t.figure||{}};const i=String(t.text||"").trim();return i?{id:r,type:"paragraph",text:i}:null}function Is(){return typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID().replace(/-/g,""):`b${Math.random().toString(16).slice(2)}${Date.now().toString(16)}`}function yc(t){const e=String(t.title||"").trim();if(e)return e;const n=Array.isArray(t.sections)?t.sections:[],r=_c(n);if(r)return r;if(n.length===1){const s=n[0],a=Number(s.level||0),o=String(s.title||"").trim();if(o&&a<=1)return o}const i=Array.isArray(t.blocks)?t.blocks:[];return wa(i)}function wc(t){const e=[];let n=[],r=!1;const i=()=>{n.length>=4?e.push(n.join("")):e.push(...n),n=[]};for(const s of t){const a=s.trim();if(!a){i(),r||(e.push(""),r=!0);continue}r=!1;const o=a.length<=1,c=/[\u4e00-\u9fa5A-Za-z0-9\.\-\u3000-\u303F]/.test(a);if(o&&c){n.push(a);continue}i(),e.push(s)}return i(),e}function Mn(t){let e=ne(t);return e=e.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/\*(.+?)\*/g,"<em>$1</em>"),e=e.replace(/~~(.+?)~~/g,"<del>$1</del>"),e=e.replace(/==(.+?)==/g,"<mark>$1</mark>"),e=e.replace(/\+\+(.+?)\+\+/g,"<u>$1</u>"),e=e.replace(/\[(.+?)\]\((.+?)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>'),e}function pd(t){const e=[],n=String(t.color||"").trim();(/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(n)||n.startsWith("rgb("))&&e.push(`color:${ne(n)}`);const r=String(t.background||"").trim();(/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(r)||r.startsWith("rgb("))&&e.push(`background-color:${ne(r)}`);const i=String(t.font||"").trim();i&&i.length<80&&e.push(`font-family:${ne(i)}`);const s=String(t.size||"").trim();return/^\d+(\.\d+)?(px|pt|em|rem)?$/.test(s)&&e.push(`font-size:${s}`),e.length?` style="${e.join(";")}"`:""}function il(t){const e=[];return t.forEach(n=>{const r=String(n.text||"");if(!r)return;let i=ne(r).replace(/\n/g,"<br/>");n.bold&&(i=`<strong>${i}</strong>`),n.italic&&(i=`<em>${i}</em>`),n.underline&&(i=`<u>${i}</u>`),n.strike&&(i=`<del>${i}</del>`);const s=String(n.link||"").trim();s&&(i=`<a href="${ne(s)}" target="_blank" rel="noopener">${i}</a>`);const a=pd(n);a&&(i=`<span${a}>${i}</span>`),e.push(i)}),e.join("")}function ne(t){return String(t||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var hd=Z('<button class="dropdown-item svelte-1ctqrjb"> </button>'),gd=Z('<div class="dropdown-panel svelte-1ctqrjb"></div>'),md=Z("<option> </option>"),_d=Z('<button class="color-item svelte-1ctqrjb"></button>'),bd=Z('<div class="dropdown-panel color-grid svelte-1ctqrjb"></div>'),yd=Z('<button class="color-item svelte-1ctqrjb"></button>'),wd=Z('<div class="dropdown-panel color-grid svelte-1ctqrjb"></div>'),Sd=Z('<button class="dropdown-item svelte-1ctqrjb"> </button>'),xd=Z('<div class="dropdown-panel svelte-1ctqrjb"></div>'),kd=Z('<div class="dropdown-panel svelte-1ctqrjb"><button class="dropdown-item svelte-1ctqrjb">插入表格</button> <button class="dropdown-item svelte-1ctqrjb">合并单元格</button> <button class="dropdown-item svelte-1ctqrjb">插入行</button> <button class="dropdown-item svelte-1ctqrjb">插入列</button> <button class="dropdown-item svelte-1ctqrjb">删除行</button> <button class="dropdown-item svelte-1ctqrjb">删除列</button></div>'),$d=Z('<div class="panel-header svelte-1ctqrjb"><div class="panel-title">正文编辑</div> <div class="editor-stats svelte-1ctqrjb"><span> </span> <span>·</span> <span> </span></div></div> <div class="extended-toolbar svelte-1ctqrjb"><div class="toolbar-group svelte-1ctqrjb"><button class="tool-btn svelte-1ctqrjb" title="字体"><span style="font-family: serif;">A</span></button> <!></div> <div class="toolbar-group svelte-1ctqrjb"><select class="tool-select svelte-1ctqrjb"><option>字号</option><!></select></div> <div class="toolbar-group svelte-1ctqrjb"><button class="tool-btn svelte-1ctqrjb" title="文字颜色"><span style="color: #FF0000;">A</span></button> <!></div> <div class="toolbar-group svelte-1ctqrjb"><button class="tool-btn svelte-1ctqrjb" title="背景颜色"><span style="background: #FFFF00;">█</span></button> <!></div> <span class="separator svelte-1ctqrjb"></span> <button class="tool-btn svelte-1ctqrjb" title="左对齐">≡</button> <button class="tool-btn svelte-1ctqrjb" title="居中">≡</button> <button class="tool-btn svelte-1ctqrjb" title="右对齐">≡</button> <button class="tool-btn svelte-1ctqrjb" title="两端对齐">≡</button> <span class="separator svelte-1ctqrjb"></span> <button class="tool-btn svelte-1ctqrjb" title="上标">x²</button> <button class="tool-btn svelte-1ctqrjb" title="下标">x₂</button> <button class="tool-btn svelte-1ctqrjb" title="水平线">—</button> <span class="separator svelte-1ctqrjb"></span> <div class="toolbar-group svelte-1ctqrjb"><button class="tool-btn svelte-1ctqrjb" title="行距">≣</button> <!></div> <button class="tool-btn svelte-1ctqrjb" title="首行缩进">¶</button> <button class="tool-btn svelte-1ctqrjb" title="段间距">⇕</button> <span class="separator svelte-1ctqrjb"></span> <button class="tool-btn svelte-1ctqrjb" title="行内公式">𝑓(𝑥)</button> <button class="tool-btn svelte-1ctqrjb" title="公式块">∫</button> <span class="separator svelte-1ctqrjb"></span> <button class="tool-btn svelte-1ctqrjb" title="插入脚注">※</button> <button class="tool-btn svelte-1ctqrjb" title="生成目录">☰</button> <span class="separator svelte-1ctqrjb"></span> <div class="toolbar-group svelte-1ctqrjb"><button class="tool-btn svelte-1ctqrjb" title="表格">⊞</button> <!></div></div>',1),Ed=Z('<div class="find-replace-panel svelte-1ctqrjb"><div class="find-replace-row svelte-1ctqrjb"><input type="text" placeholder="查找..." class="svelte-1ctqrjb"/> <button class="btn-small svelte-1ctqrjb">下一个</button> <button class="btn-small svelte-1ctqrjb">✕</button></div> <div class="find-replace-row svelte-1ctqrjb"><input type="text" placeholder="替换为..." class="svelte-1ctqrjb"/> <button class="btn-small svelte-1ctqrjb">替换</button> <button class="btn-small svelte-1ctqrjb">全部替换</button></div></div>'),Td=Z('<div><!> <div class="editable svelte-1ctqrjb" contenteditable="false"></div> <!></div>');function Sc(t,e){if(new.target)return fn({component:Sc,...t});Ve(e,!1);const n=()=>ie(ve,"$sourceText",s),r=()=>ie(ge,"$docIr",s),i=()=>ie(ya,"$wordCount",s),[s,a]=ki();let o=at(null),c="",d=at("text"),p=null,m=null,b=null,I=Ie(e,"showToolbar",12,!0),q=Ie(e,"paper",12,!0);const P=pa();let T=null,O=!1,et=null,G="",tt=null,K="",st=null;function nt(u){if(!l(o))return;const v=!String(u||"").trim();pr(o,l(o).dataset.empty=v?"1":"0")}function L(){if(!l(o))return;const u=String(n()||""),v=r(),g=!!(v&&typeof v=="object"),S=!g,C=g?`doc:${ct(v)}`:`text:${u}`;if(T&&l(o).contains(T)&&C!==c){et=C;return}C!==c&&(p&&clearTimeout(p),p=setTimeout(()=>{if(pr(o,l(o).innerHTML=Zf(u,v,S)),A(d,S?"text":"doc"),c=C,et=null,nt(u),it(),sr(),G){const D=l(o).querySelector(`[data-block-id="${CSS.escape(G)}"]`);G="",D&&D.focus()}ls(),cs(),lo()},100))}function ct(u){try{return JSON.stringify(u)||""}catch{return""}}function W(u){u.setAttribute("contenteditable","true"),u.setAttribute("spellcheck","false"),u.dataset.waEdit="1"}function it(){if(!l(o))return;const u=l(o).querySelector(".wa-title");u&&(u.dataset.docTitle="1",W(u)),l(o).querySelectorAll("[data-section-id]").forEach(v=>{W(v)}),l(o).querySelectorAll("[data-block-id]").forEach(v=>{const g=v,S=g.tagName.toLowerCase();if(S==="figure"||S==="table"){g.setAttribute("contenteditable","false");return}W(g)})}function ot(u){if(!u||!(u instanceof HTMLElement)||!l(o))return null;const v=u.closest('[data-wa-edit="1"]');return!v||!l(o).contains(v)?null:v}function dt(u){let v=String(u||"").replace(/\r/g,"");return v=v.replace(/[ \t]+/g," "),v=v.replace(/[ \t]*\n[ \t]*/g,`
`),v=v.replace(/\n{3,}/g,`

`),v.trim()}function jt(u){if(u.nodeType===Node.TEXT_NODE)return u.textContent||"";if(!(u instanceof HTMLElement))return"";const v=u.tagName.toLowerCase();if(v==="br")return`
`;if(v==="strong"||v==="b")return`**${ut(u)}**`;if(v==="em"||v==="i")return`*${ut(u)}*`;if(v==="u")return`++${ut(u)}++`;if(v==="del"||v==="s")return`~~${ut(u)}~~`;if(v==="mark")return`==${ut(u)}==`;if(v==="code")return"`"+(u.textContent||"")+"`";if(v==="a"){const g=u.getAttribute("href")||"",S=ut(u);return g?`[${S}](${g})`:S}return ut(u)}function ut(u){const v=[];return u.childNodes.forEach(g=>v.push(jt(g))),dt(v.join(""))}function Ft(u){if(u.nodeType===Node.TEXT_NODE)return u.textContent||"";if(!(u instanceof HTMLElement))return"";if(u.tagName.toLowerCase()==="br")return`
`;const g=[];return u.childNodes.forEach(S=>g.push(Ft(S))),g.join("")}function Nt(u){const v=[];return u.childNodes.forEach(g=>v.push(Ft(g))),v.join("")}function Rt(u){const v=document.createElement("div");return v.appendChild(u),ut(v)}function At(u){const v=window.getSelection();if(!v||v.rangeCount===0)return null;const g=v.getRangeAt(0);if(!u.contains(g.startContainer))return null;const S=g.cloneRange();S.selectNodeContents(u),S.setEnd(g.startContainer,g.startOffset);const C=g.cloneRange();C.selectNodeContents(u),C.setStart(g.startContainer,g.startOffset);const D=Rt(S.cloneContents()),F=Rt(C.cloneContents());return{before:D,after:F}}function It(u){if(u.nodeType===Node.TEXT_NODE)return(u.textContent||"").length;if(!(u instanceof HTMLElement))return 0;if(u.tagName.toLowerCase()==="br")return 1;let g=0;return u.childNodes.forEach(S=>{g+=It(S)}),g}function zt(u){const v=window.getSelection();if(!v||v.rangeCount===0)return null;const g=v.getRangeAt(0),S=g.startContainer;if(!u.contains(S))return null;let C=0,D=!1;const F=H=>{if(!D){if(H===S){if(H.nodeType===Node.TEXT_NODE)C+=g.startOffset;else if(H instanceof HTMLElement){const V=Array.from(H.childNodes);for(let N=0;N<g.startOffset;N++)C+=It(V[N])}D=!0;return}if(H.nodeType===Node.TEXT_NODE||H instanceof HTMLElement&&H.tagName.toLowerCase()==="br"){C+=It(H);return}H.childNodes.forEach(V=>F(V))}};return F(u),C}function pt(u){const v=u.style,g={},S=v.textAlign||u.getAttribute("align")||"";S&&(g.align=S);const C=v.lineHeight;C&&(g.lineHeight=C);const D=v.textIndent;D&&(g.indent=D);const F=v.marginTop;F&&(g.marginTop=F);const H=v.marginBottom;H&&(g.marginBottom=H);const V=v.fontFamily;V&&(g.fontFamily=V);const N=v.fontSize;N&&(g.fontSize=N);const R=v.color;R&&(g.color=R);const J=v.backgroundColor;return J&&(g.background=J),Object.keys(g).length?g:null}function Mt(u){const v=[],g=(N,R)=>{N&&v.push({text:N,bold:R.bold,italic:R.italic,underline:R.underline,strike:R.strike,color:R.color,background:R.background,font:R.font,size:R.size,link:R.link})},S=N=>{const R=String(N||"").trim();return R?R.split(",")[0].replace(/["']/g,"").trim():""},C=(N,R)=>{if(N.nodeType===Node.TEXT_NODE){g(N.textContent||"",R);return}if(!(N instanceof HTMLElement))return;const J=N.tagName.toLowerCase();if(J==="br"){g(`
`,R);return}const U={...R};if((J==="strong"||J==="b")&&(U.bold=!0),(J==="em"||J==="i")&&(U.italic=!0),J==="u"&&(U.underline=!0),(J==="s"||J==="del"||J==="strike")&&(U.strike=!0),J==="a"){const rt=N.getAttribute("href")||"";rt&&(U.link=rt)}if(J==="font"){const rt=N.getAttribute("color");rt&&(U.color=rt);const lt=N.getAttribute("face");lt&&(U.font=S(lt));const xt=N.getAttribute("size");xt&&(U.size=String(xt))}const X=N.style;if(X){X.color&&(U.color=X.color),X.backgroundColor&&(U.background=X.backgroundColor),X.fontFamily&&(U.font=S(X.fontFamily)),X.fontSize&&(U.size=X.fontSize);const rt=X.textDecoration;rt&&rt.includes("underline")&&(U.underline=!0),rt&&rt.includes("line-through")&&(U.strike=!0)}N.childNodes.forEach(rt=>C(rt,U))};C(u,{});const D=[],F=N=>[N.bold?"b":"",N.italic?"i":"",N.underline?"u":"",N.strike?"s":"",N.color||"",N.background||"",N.font||"",N.size||"",N.link||""].join("|");v.forEach(N=>{const R=D[D.length-1];R&&F(R)===F(N)?R.text+=N.text:D.push({...N})});const H=dt(D.map(N=>N.text).join("")),V=D.some(N=>Object.keys(N).some(R=>R!=="text"&&N[R]));return{text:H,runs:V?D:null}}function pe(u){if(u.dataset.docTitle==="1")return{kind:"title",text:ut(u)};const v=String(u.dataset.sectionId||"").trim();if(v)return{kind:"section",id:v,text:ut(u),style:pt(u)};const g=String(u.dataset.blockId||"").trim();if(!g)return null;const S=u.tagName.toLowerCase();if(S==="ul"||S==="ol"){const N={type:"list",items:Array.from(u.querySelectorAll(":scope > li")).map(J=>dt(ut(J))),ordered:S==="ol"},R=pt(u);return R&&(N.style=R),{kind:"block",id:g,payload:N}}if(/^h[1-6]$/.test(S)){const V=Number(S.slice(1)),N=Mt(u),R=N.text.replace(/\n+/g," ").trim(),J={type:"heading",level:V,text:R};N.runs&&(J.runs=N.runs);const U=pt(u);return U&&(J.style=U),{kind:"block",id:g,payload:J}}const C=Mt(u),F={type:"paragraph",text:C.text};C.runs&&(F.runs=C.runs);const H=pt(u);return H&&(F.style=H),{kind:"block",id:g,payload:F}}function Pt(u){m&&clearTimeout(m),m=setTimeout(()=>{const v=Bs(u)||"";ve.set(v),nt(v),Uf(v)},180)}function Xt(u){ge.set(u),de.set(!1),c=`doc:${ct(u)}`,Pt(u)}function Se(u,v){const g=String(v||"").trim()||"自动生成文档",S=String(u.title||"").trim();let C=!1;g!==S&&(C=!0);const D=V=>{let N=!1;const R=V.map(J=>{let U=!1,X=J;String(J.title||"").trim()===S&&(X={...J,title:g},U=!0);const rt=Array.isArray(J.children)?J.children:[];if(rt.length){const lt=D(rt);lt!==rt&&(X={...X,children:lt},U=!0)}return U&&(N=!0),X});return N&&(C=!0),N?R:V},F=Array.isArray(u.sections)?u.sections:[],H=D(F);return C?{...u,title:g,sections:H}:null}function Dt(u,v,g,S){const C=String(g||"").trim()||"章节";let D=!1;const F=N=>{let R=!1;const J=N.map(U=>{let X=!1,rt=U;String(U.id||"")===v&&(rt={...U,title:C},S&&Object.keys(S).length&&(rt={...rt,style:S}),X=!0);const lt=Array.isArray(U.children)?U.children:[];if(lt.length){const xt=F(lt);xt!==lt&&(rt={...rt,children:xt},X=!0)}return X&&(R=!0),rt});return R&&(D=!0),R?J:N},H=Array.isArray(u.sections)?u.sections:[],V=F(H);return D?{...u,sections:V}:null}function Me(u,v,g){let S=!1;const C=H=>{let V=!1;const N=H.map(R=>{let J=!1,U=R;const X=Array.isArray(R.blocks)?R.blocks:[];if(X.length){const lt=X.findIndex(xt=>String(xt.id||"")===v);if(lt>=0){const xt=X[lt]||{},Yt={...xt,...g,id:xt.id||v},re=X.slice();re[lt]=Yt,U={...U,blocks:re},J=!0}}const rt=Array.isArray(R.children)?R.children:[];if(rt.length){const lt=C(rt);lt!==rt&&(U={...U,children:lt},J=!0)}return J&&(V=!0),U});return V&&(S=!0),V?N:H},D=Array.isArray(u.sections)?u.sections:[],F=C(D);return S?{...u,sections:F}:null}function Ke(u,v,g){let S=!1;const C=H=>{let V=!1;const N=H.map(R=>{let J=!1,U=R;const X=Array.isArray(R.blocks)?R.blocks:[];if(X.length){const lt=X.findIndex(xt=>String(xt.id||"")===v);if(lt>=0){const xt=X.slice();xt.splice(lt+1,0,g),U={...U,blocks:xt},J=!0}}const rt=Array.isArray(R.children)?R.children:[];if(rt.length){const lt=C(rt);lt!==rt&&(U={...U,children:lt},J=!0)}return J&&(V=!0),U});return V&&(S=!0),V?N:H},D=Array.isArray(u.sections)?u.sections:[],F=C(D);return S?{...u,sections:F}:null}function xe(u,v,g){let S=!1;const C=H=>{let V=!1;const N=H.map(R=>{let J=!1,U=R;const X=Array.isArray(R.blocks)?R.blocks:[];if(X.length){const lt=X.findIndex(xt=>String(xt.id||"")===v);if(lt>=0){const xt=X.slice();xt.splice(lt,0,g),U={...U,blocks:xt},J=!0}}const rt=Array.isArray(R.children)?R.children:[];if(rt.length){const lt=C(rt);lt!==rt&&(U={...U,children:lt},J=!0)}return J&&(V=!0),U});return V&&(S=!0),V?N:H},D=Array.isArray(u.sections)?u.sections:[],F=C(D);return S?{...u,sections:F}:null}function Te(u,v,g){let S=!1;const C=N=>{const R=String(N.type||"paragraph").toLowerCase();if(R==="list"){const J=Array.isArray(N.items)?N.items:[],U=J.map(X=>String(X??"").replace(v,g));return U.join("")!==J.join("")?(S=!0,{...N,items:U}):N}if(R==="table"){const J=typeof N.table=="object"&&N.table?N.table:null;if(J&&typeof J.caption=="string"){const U=String(J.caption||"").replace(v,g);if(U!==J.caption)return S=!0,{...N,table:{...J,caption:U}}}return N}if(R==="figure"){const J=typeof N.figure=="object"&&N.figure?N.figure:null;if(J&&typeof J.caption=="string"){const U=String(J.caption||"").replace(v,g);if(U!==J.caption)return S=!0,{...N,figure:{...J,caption:U}}}return N}if(typeof N.text=="string"){const J=String(N.text||"").replace(v,g);if(J!==N.text)return S=!0,{...N,text:J}}return N},D=N=>{let R=!1;const J=N.map(U=>{let X=!1,rt=U;if(typeof U.title=="string"){const Yt=String(U.title||"").replace(v,g);Yt!==U.title&&(rt={...rt,title:Yt},X=!0,S=!0)}const lt=Array.isArray(U.blocks)?U.blocks:[];if(lt.length){const Yt=lt.map(re=>C(re));Yt.some((re,Ot)=>re!==lt[Ot])&&(rt={...rt,blocks:Yt},X=!0)}const xt=Array.isArray(U.children)?U.children:[];if(xt.length){const Yt=D(xt);Yt!==xt&&(rt={...rt,children:Yt},X=!0)}return X&&(R=!0),X?rt:U});return R?J:N},F={...u};if(typeof F.title=="string"){const N=String(F.title||"").replace(v,g);N!==F.title&&(F.title=N,S=!0)}const H=Array.isArray(F.sections)?F.sections:[],V=D(H);return V!==H&&(F.sections=V),S?F:null}function Ht(u,v=160){tt&&clearTimeout(tt),tt=setTimeout(()=>{pn(u)},v)}function pn(u){const v=r();if(!v||typeof v!="object")return;const g=pe(u);if(!g)return;let S=null;g.kind==="title"?S=Se(v,String(g.text||"")):g.kind==="section"?S=Dt(v,String(g.id||""),String(g.text||""),g.style||null):g.kind==="block"&&(S=Me(v,String(g.id||""),g.payload||{})),S&&Xt(S)}function ir(u){st&&st!==u&&st.classList.remove("wa-block-selected"),st=u,st?(st.classList.add("wa-block-selected"),K=st.dataset.blockId||"",P("blockselect",{blockId:K,text:Nt(st)})):(K="",P("blockselect",{blockId:"",text:""}))}function kr(){st&&st.classList.remove("wa-block-selected"),st=null,K="",P("blockselect",{blockId:"",text:""})}function sr(){if(!l(o)||!K)return;const u=`[data-block-id="${CSS.escape(K)}"]`,v=l(o).querySelector(u);ir(v)}function De(u){const v=u.target;if(!v||!l(o))return;const g=v.closest("[data-block-id]");if(!g||!l(o).contains(g)){kr();return}g!==st&&ir(g)}function Xe(u){const v=ot(u.target);v&&(T=v,String(v.dataset.blockId||v.dataset.sectionId||v.dataset.docTitle||""))}function or(u){const v=ot(u.target);v&&(pn(v),T===v&&(T=null),et&&et!==c&&L())}function Gt(u){if(O)return;const v=ot(u.target);v&&Ht(v)}function Bn(){O=!0}function En(u){O=!1,Gt(u)}function Oe(){return typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID().replace(/-/g,""):`b${Math.random().toString(16).slice(2)}${Date.now().toString(16)}`}function hn(){if(!l(o))return null;const u=document.activeElement;if(u&&l(o).contains(u)&&u.isContentEditable)return u;if(st&&st.isContentEditable)return st.focus(),st;const v=l(o).querySelector('[data-wa-edit="1"]');return v?(v.focus(),v):null}function wt(u){if(hn()){if(u==="bold")return document.execCommand("bold");if(u==="italic")return document.execCommand("italic");if(u==="underline")return document.execCommand("underline");if(u==="strikethrough")return document.execCommand("strikeThrough");if(u==="superscript")return document.execCommand("superscript");if(u==="subscript")return document.execCommand("subscript");if(u==="heading1")return document.execCommand("formatBlock",!1,"H1");if(u==="heading2")return document.execCommand("formatBlock",!1,"H2");if(u==="heading3")return document.execCommand("formatBlock",!1,"H3");if(u==="paragraph")return document.execCommand("formatBlock",!1,"P");if(u==="list-bullet")return document.execCommand("insertUnorderedList");if(u==="list-number")return document.execCommand("insertOrderedList");if(u==="indent")return document.execCommand("indent");if(u==="outdent")return document.execCommand("outdent");if(u==="quote")return document.execCommand("formatBlock",!1,"BLOCKQUOTE");if(u==="align-left")return document.execCommand("justifyLeft");if(u==="align-center")return document.execCommand("justifyCenter");if(u==="align-right")return document.execCommand("justifyRight");if(u==="align-justify")return document.execCommand("justifyFull");if(u.startsWith("line-height:")){const v=u.slice(12),g=window.getSelection();if(g&&g.rangeCount){let C=g.getRangeAt(0).commonAncestorContainer;if(C.nodeType===Node.TEXT_NODE&&(C=C.parentElement),C instanceof HTMLElement){let D=C.closest("p, div, h1, h2, h3, blockquote");D instanceof HTMLElement&&(D.style.lineHeight=v)}}return}if(u.startsWith("margin:")){const v=u.slice(7),g=window.getSelection();if(g&&g.rangeCount){let C=g.getRangeAt(0).commonAncestorContainer;if(C.nodeType===Node.TEXT_NODE&&(C=C.parentElement),C instanceof HTMLElement){let D=C.closest("p, div, h1, h2, h3");D instanceof HTMLElement&&(D.style.margin=v)}}return}if(u==="indent-first"){const v=window.getSelection();if(v&&v.rangeCount){let S=v.getRangeAt(0).commonAncestorContainer;if(S.nodeType===Node.TEXT_NODE&&(S=S.parentElement),S instanceof HTMLElement){let C=S.closest("p, div");C instanceof HTMLElement&&(C.style.textIndent="2em")}}return}if(u.startsWith("color:")){const v=u.slice(6);return document.execCommand("foreColor",!1,v)}if(u.startsWith("bgcolor:")){const v=u.slice(8);return document.execCommand("hiliteColor",!1,v)}if(u.startsWith("font:")){const v=u.slice(5);return document.execCommand("fontName",!1,v)}if(u.startsWith("size:")){const v=u.slice(5),g=window.getSelection();if(g&&g.rangeCount){const S=g.getRangeAt(0),C=document.createElement("span");C.style.fontSize=v+"px",S.surroundContents(C)}return}if(u==="code"){const v=window.getSelection(),g=v&&v.rangeCount?v.getRangeAt(0).toString():"";return document.execCommand("insertHTML",!1,`<pre><code>${$r(g||"")}</code></pre>`)}if(u==="image"){const v=document.createElement("input");v.type="file",v.accept="image/*",v.onchange=async g=>{var D;const S=(D=g.target.files)==null?void 0:D[0];if(!S)return;const C=new FileReader;C.onload=F=>{var V;const H=(V=F.target)==null?void 0:V.result;document.execCommand("insertHTML",!1,`<img src="${H}" alt="图片" style="max-width:100%;height:auto;" />`)},C.readAsDataURL(S)},v.click();return}if(u==="table"){const v=prompt("行数：","3"),g=prompt("列数：","3");if(!v||!g)return;let S='<table style="border-collapse:collapse;width:100%;margin:10px 0;">';for(let C=0;C<parseInt(v);C++){S+="<tr>";for(let D=0;D<parseInt(g);D++)S+='<td style="border:1px solid #ccc;padding:8px;min-width:80px;">　</td>';S+="</tr>"}return S+="</table>",document.execCommand("insertHTML",!1,S)}if(u==="link"){const v=prompt("请输入链接地址：","https://");v&&document.execCommand("createLink",!1,v);return}if(u==="hr")return document.execCommand("insertHTML",!1,'<hr style="border:none;border-top:1px solid #ddd;margin:16px 0;" />');if(u==="math-inline"){const v=prompt("输入行内公式（LaTeX）：","x^2 + y^2 = r^2");v&&document.execCommand("insertHTML",!1,`<span class="math-inline" data-latex="${$r(v)}">$${v}$</span>`);return}if(u==="math-block"){const v=prompt("输入公式块（LaTeX）：","\\int_{-\\infty}^{\\infty} e^{-x^2} dx = \\sqrt{\\pi}");v&&document.execCommand("insertHTML",!1,`<div class="math-block" data-latex="${$r(v)}">$$${v}$$</div>`);return}if(u==="footnote"){const v=prompt("脚注内容：");if(!v)return;const g="fn-"+Date.now(),S=`<sup><a href="#${g}" id="ref-${g}" style="color:#a5722a;text-decoration:none;">[${Ei()}]</a></sup>`;document.execCommand("insertHTML",!1,S),oo(g,v,Ei());return}if(u==="toc"){const v=ao();document.execCommand("insertHTML",!1,v);return}if(u==="undo")return Jf();if(u==="redo")return Wf();if(u==="clear-format")return document.execCommand("removeFormat")}}function Pn(u){const v=u.ctrlKey||u.metaKey;if(v&&u.key==="b"&&(u.preventDefault(),wt("bold")),v&&u.key==="i"&&(u.preventDefault(),wt("italic")),v&&u.key==="u"&&(u.preventDefault(),wt("underline")),v&&u.shiftKey&&u.key==="X"&&(u.preventDefault(),wt("strikethrough")),v&&u.key==="z"&&(u.preventDefault(),wt("undo")),v&&u.key==="y"&&(u.preventDefault(),wt("redo")),v&&u.key==="k"&&(u.preventDefault(),wt("link")),v&&u.key==="f"&&(u.preventDefault(),A(gn,!0)),u.key==="Enter"&&!u.shiftKey){const g=ot(u.target);if(g&&g.dataset.blockId){const S=g.tagName.toLowerCase();if(S==="ul"||S==="ol"){u.preventDefault();const C=r();if(!C||typeof C!="object")return;const D=String(g.dataset.blockId),F=window.getSelection(),H=F==null?void 0:F.anchorNode,V=H instanceof HTMLElement?H:H==null?void 0:H.parentElement,N=V?V.closest("li"):null;if(!N||!g.contains(N))return;const R=Array.from(g.querySelectorAll(":scope > li")),J=R.indexOf(N);if(J<0)return;let U="",X="";const rt=At(N);if(rt)U=rt.before,X=rt.after;else{const Ot=Nt(N),qt=zt(N),Ae=qt==null?Ot.length:Math.max(0,Math.min(Ot.length,qt));U=Ot.slice(0,Ae),X=Ot.slice(Ae)}const lt=dt(U),xt=dt(X);if(!lt&&!xt){const Ot=R.map((qt,Ae)=>Ae===J?null:dt(ut(qt))).filter(qt=>qt!==null);if(Ot.length){const qt=Me(C,D,{type:"list",items:Ot,ordered:S==="ol"});if(qt){const Ae={id:Oe(),type:"paragraph",text:""},Hn=Ke(qt,D,Ae);if(Hn){G=String(Ae.id||""),Xt(Hn);return}Xt(qt)}}else{const qt=Me(C,D,{type:"paragraph",text:"",items:[],ordered:!1});qt&&(G=D,Xt(qt))}return}const Yt=R.map((Ot,qt)=>qt===J?lt:dt(ut(Ot)));Yt.splice(J+1,0,xt);const re=Me(C,D,{type:"list",items:Yt,ordered:S==="ol"});re&&(G=D,Xt(re));return}if(S==="p"||/^h[1-6]$/.test(S)){u.preventDefault();const C=r();if(!C||typeof C!="object")return;const D=String(g.dataset.blockId),F=Nt(g),H=zt(g),V=H==null?F.length:Math.max(0,Math.min(F.length,H)),N=F.slice(0,V),R=F.slice(V),J=dt(N),U=dt(R),X=pt(g),rt=/^h[1-6]$/.test(S);if(V===0){const Ot={id:Oe(),type:"paragraph",text:""};X&&S==="p"&&(Ot.style=X);const qt=xe(C,D,Ot);qt&&(G=String(Ot.id||""),Xt(qt));return}if(V>=F.length){const Ot={id:Oe(),type:"paragraph",text:""};X&&S==="p"&&(Ot.style=X);const qt=Ke(C,D,Ot);qt&&(G=String(Ot.id||""),Xt(qt));return}let lt=null;if(rt){const qt={type:"heading",level:Number(S.slice(1)),text:J.replace(/\n+/g," ").trim()};X&&(qt.style=X),lt=Me(C,D,qt)}else{const Ot={type:"paragraph",text:J};X&&(Ot.style=X),lt=Me(C,D,Ot)}const xt={id:Oe(),type:"paragraph",text:U};!rt&&X&&(xt.style=X);const re=Ke(lt||C,D,xt);re&&(G=String(xt.id||""),Xt(re))}}}}let gn=at(!1),Ye=at(""),Tn=at(""),Kt=at(!1),ar=at(!1),mn=at(!1),Le=at(!1),Fe=at(!1);const ns=new Map,eo=["宋体","黑体","微软雅黑","楷体","Arial","Times New Roman","Courier New","Georgia","Verdana"],rs=[12,14,16,18,20,22,24,28,32,36,42,48,56,64,72],$i=["#000000","#333333","#666666","#999999","#CCCCCC","#FFFFFF","#FF0000","#FF6600","#FFCC00","#00FF00","#00CCFF","#0000FF","#9900FF","#FF00FF"],is=[1,1.15,1.5,2,2.5,3];function Wr(){l(Ye)&&window.find(l(Ye),!1,!1,!0,!1,!0,!1)}function ss(){if(!l(Ye))return;const u=window.getSelection();u&&u.toString().toLowerCase()===l(Ye).toLowerCase()&&document.execCommand("insertHTML",!1,l(Tn)),Wr()}function zr(){const u=new RegExp(os(l(Ye)),"gi");if(!l(Ye))return;if(r()&&typeof r()=="object"){const g=Te(r(),u,l(Tn));g&&Xt(g),A(gn,!1);return}if(!l(o))return;let v=l(o).innerHTML;v=v.replace(u,l(Tn)),pr(o,l(o).innerHTML=v),it(),A(gn,!1)}function os(u){return u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function as(){var C,D;const u=window.getSelection();if(!u||!u.rangeCount)return;const v=(D=(C=u.anchorNode)==null?void 0:C.parentElement)==null?void 0:D.closest("td, th");if(!v)return alert("请先选中表格单元格");const g=v.nextElementSibling;if(!g||g.tagName!=="TD"&&g.tagName!=="TH")return alert("无法合并：需要选中相邻单元格");const S=parseInt(v.getAttribute("colspan")||"1");v.setAttribute("colspan",String(S+1)),g.remove()}function no(){var C,D,F;const u=window.getSelection();if(!u||!u.rangeCount)return;const v=(D=(C=u.anchorNode)==null?void 0:C.parentElement)==null?void 0:D.closest("td, th");if(!v)return alert("请先选中表格单元格");const g=v.parentElement,S=g.cloneNode(!0);S.querySelectorAll("td, th").forEach(H=>H.textContent="　"),(F=g.parentElement)==null||F.insertBefore(S,g.nextSibling)}function ro(){var C,D,F;const u=window.getSelection();if(!u||!u.rangeCount)return;const v=(D=(C=u.anchorNode)==null?void 0:C.parentElement)==null?void 0:D.closest("td, th");if(!v)return alert("请先选中表格单元格");const g=Array.from(((F=v.parentElement)==null?void 0:F.children)||[]).indexOf(v),S=v.closest("table");S&&S.querySelectorAll("tr").forEach(H=>{const V=document.createElement(v.tagName.toLowerCase());V.textContent="　",V.style.cssText=v.style.cssText,H.insertBefore(V,H.children[g+1])})}function io(){var C,D;const u=window.getSelection();if(!u||!u.rangeCount)return;const v=(D=(C=u.anchorNode)==null?void 0:C.parentElement)==null?void 0:D.closest("td, th");if(!v)return alert("请先选中表格单元格");const g=v.parentElement;if(!g)return;const S=g.parentElement;if(S&&S.children.length<=1)return alert("无法删除：表格至少需要一行");g.remove()}function so(){var D,F,H;const u=window.getSelection();if(!u||!u.rangeCount)return;const v=(F=(D=u.anchorNode)==null?void 0:D.parentElement)==null?void 0:F.closest("td, th");if(!v)return alert("请先选中表格单元格");const g=Array.from(((H=v.parentElement)==null?void 0:H.children)||[]).indexOf(v),S=v.closest("table");if(!S)return;const C=S.querySelector("tr");if(C&&C.children.length<=1)return alert("无法删除：表格至少需要一列");S.querySelectorAll("tr").forEach(V=>{var N;(N=V.children[g])==null||N.remove()})}function Ei(){return l(o)?l(o).querySelectorAll('[id^="ref-fn-"]').length+1:1}function oo(u,v,g){if(!l(o))return;let S=l(o).querySelector(".footnotes-section");S||(S=document.createElement("div"),S.className="footnotes-section",S.innerHTML='<hr style="margin-top:40px;border:none;border-top:1px solid #ddd;" /><h3>脚注</h3>',l(o).appendChild(S));const C=document.createElement("div");C.className="footnote-item",C.id=u,C.innerHTML=`<sup>[${g}]</sup> ${v}`,S.appendChild(C)}function ao(){if(!l(o))return"";const u=l(o).querySelectorAll("h1, h2, h3");if(u.length===0)return"<p>未找到标题</p>";let v='<div class="toc-section" style="border:1px solid #ddd;padding:16px;border-radius:8px;background:rgba(255,255,255,0.5);margin:20px 0;"><h3>目录</h3><ul style="list-style:none;padding-left:0;">';return u.forEach((g,S)=>{const C=parseInt(g.tagName[1]),D=g.textContent||"",F="heading-"+S;g.id=F;const H=(C-1)*20;v+=`<li style="margin-left:${H}px;margin-top:8px;"><a href="#${F}" style="color:#a5722a;text-decoration:none;">${D}</a></li>`}),v+="</ul></div>",v}function $r(u){return String(u||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function ls(){if(!(!l(o)||!window.renderMathInElement))try{window.renderMathInElement(l(o),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})}catch(u){console.error("Math rendering error:",u)}}function cs(){!l(o)||!window.Prism||l(o).querySelectorAll("pre code").forEach(u=>{window.Prism.highlightElement(u)})}async function lo(){if(!l(o))return;const u=Array.from(l(o).querySelectorAll(".wa-figure[data-figure-spec]"));for(const v of u){if(v.dataset.figureRendered==="1")continue;const g=v.dataset.figureSpec||"";if(!g)continue;v.dataset.figureRendered="1";let S=null;try{S=JSON.parse(decodeURIComponent(g))}catch{S=null}if(!S)continue;const C=JSON.stringify(S);let D=ns.get(C);const F=v.querySelector(".wa-figure-box");if(F&&(F.innerHTML='<div class="wa-figure-loading">渲染中...</div>'),!D)try{const H=await fetch("/api/figure/render",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({spec:S})});if(!H.ok)throw new Error(await H.text());const V=await H.json();D=String(V.svg||""),D&&ns.set(C,D)}catch{D=""}F&&(F.innerHTML=D||'<div class="wa-figure-loading">渲染失败</div>')}}const Ti=zo.subscribe(u=>{u&&(wt(u),zo.set(null))});ts(()=>{if(L(),!r()){const F=String(n()||"").trim(),H=F?Go(F):null;if(H)ge.set(H),de.set(!1);else{const V="自动生成文档";ge.set({title:V,sections:[{id:Oe(),title:V,level:1,blocks:[{id:Oe(),type:"paragraph",text:""}],children:[]}]}),de.set(!1)}}b=ve.subscribe(()=>L()),ge.subscribe(()=>L());const u=document.createElement("link");u.rel="stylesheet",u.href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css",document.head.appendChild(u);const v=document.createElement("script");v.src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js",v.onload=()=>{const F=document.createElement("script");F.src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js",F.onload=()=>{ls()},document.head.appendChild(F)},document.head.appendChild(v);const g=document.createElement("link");g.rel="stylesheet",g.href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css",document.head.appendChild(g);const S=document.createElement("script");S.src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js",S.onload=()=>{const F=["https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-clike.min.js","https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-c.min.js","https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-cpp.min.js","https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-java.min.js","https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-javascript.min.js","https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-python.min.js","https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-sql.min.js"],H=V=>new Promise(N=>{const R=document.createElement("script");R.src=V,R.async=!1,R.onload=()=>N(),R.onerror=()=>N(),document.head.appendChild(R)});(async()=>{for(const V of F)await H(V);setTimeout(()=>cs(),500)})()},document.head.appendChild(S);const C=new IntersectionObserver(F=>{F.forEach(H=>{if(H.isIntersecting&&H.target instanceof HTMLImageElement){const V=H.target;V.dataset.src&&(V.src=V.dataset.src,V.removeAttribute("data-src"))}})}),D=new MutationObserver(()=>{var F;(F=l(o))==null||F.querySelectorAll("img[data-src]").forEach(H=>C.observe(H))});return l(o)&&D.observe(l(o),{childList:!0,subtree:!0}),()=>{Ti(),b&&b(),C.disconnect(),D.disconnect(),p&&clearTimeout(p)}}),Zs(()=>{},()=>{L()}),to();var co={get showToolbar(){return I()},set showToolbar(u){I(u),we()},get paper(){return q()},set paper(u){q(u),we()},$set:vn,$on:(u,v)=>dn(e,u,v)};xr();var Vr=Td(),us=$(Vr);{var uo=u=>{var v=$d(),g=_e(v),S=_($(g),2),C=$(S),D=$(C);w(C);var F=_(C,4),H=$(F);w(F),w(S),w(g);var V=_(g,2),N=$(V),R=$(N),J=_(R,2);{var U=Lt=>{var Ut=gd();Je(Ut,5,()=>eo,sn,(le,Qt)=>{var Bt=hd(),Un=$(Bt,!0);w(Bt),Et(()=>{qs(Bt,`font-family: ${l(Qt)??""}`),gt(Un,l(Qt))}),M("click",Bt,()=>{wt("font:"+l(Qt)),A(Kt,!1)}),z(le,Bt)}),w(Ut),z(Lt,Ut)};$t(J,Lt=>{l(Kt)&&Lt(U)})}w(N);var X=_(N,2),rt=$(X),lt=$(rt);lt.value=lt.__value="";var xt=_(lt);Je(xt,1,()=>rs,sn,(Lt,Ut)=>{var le=md(),Qt=$(le);w(le);var Bt={};Et(()=>{gt(Qt,`${l(Ut)??""}pt`),Bt!==(Bt=l(Ut))&&(le.value=(le.__value=l(Ut))??"")}),z(Lt,le)}),w(rt),w(X);var Yt=_(X,2),re=$(Yt),Ot=_(re,2);{var qt=Lt=>{var Ut=bd();Je(Ut,5,()=>$i,sn,(le,Qt)=>{var Bt=_d();Et(()=>qs(Bt,`background: ${l(Qt)??""};`)),M("click",Bt,()=>{wt("color:"+l(Qt)),A(ar,!1)}),z(le,Bt)}),w(Ut),z(Lt,Ut)};$t(Ot,Lt=>{l(ar)&&Lt(qt)})}w(Yt);var Ae=_(Yt,2),Hn=$(Ae),ps=_(Hn,2);{var fo=Lt=>{var Ut=wd();Je(Ut,5,()=>$i,sn,(le,Qt)=>{var Bt=yd();Et(()=>qs(Bt,`background: ${l(Qt)??""};`)),M("click",Bt,()=>{wt("bgcolor:"+l(Qt)),A(mn,!1)}),z(le,Bt)}),w(Ut),z(Lt,Ut)};$t(ps,Lt=>{l(mn)&&Lt(fo)})}w(Ae);var Gr=_(Ae,4),hs=_(Gr,2),Ai=_(hs,2),Ci=_(Ai,2),ji=_(Ci,4),gs=_(ji,2),Kr=_(gs,2),Er=_(Kr,4),qi=$(Er),ms=_(qi,2);{var vo=Lt=>{var Ut=xd();Je(Ut,5,()=>is,sn,(le,Qt)=>{var Bt=Sd(),Un=$(Bt);w(Bt),Et(()=>gt(Un,`${l(Qt)??""}倍行距`)),M("click",Bt,()=>{wt("line-height:"+l(Qt)),A(Le,!1)}),z(le,Bt)}),w(Ut),z(Lt,Ut)};$t(ms,Lt=>{l(Le)&&Lt(vo)})}w(Er);var Xr=_(Er,2),Yr=_(Xr,2),Qr=_(Yr,4),Ni=_(Qr,2),Ii=_(Ni,4),Mi=_(Ii,2),Di=_(Mi,4),Oi=$(Di),_s=_(Oi,2);{var bs=Lt=>{var Ut=kd(),le=$(Ut),Qt=_(le,2),Bt=_(Qt,2),Un=_(Bt,2),ys=_(Un,2),ws=_(ys,2);w(Ut),M("click",le,()=>{wt("table"),A(Fe,!1)}),M("click",Qt,()=>{as(),A(Fe,!1)}),M("click",Bt,()=>{no(),A(Fe,!1)}),M("click",Un,()=>{ro(),A(Fe,!1)}),M("click",ys,()=>{io(),A(Fe,!1)}),M("click",ws,()=>{so(),A(Fe,!1)}),z(Lt,Ut)};$t(_s,Lt=>{l(Fe)&&Lt(bs)})}w(Di),w(V),Et(Lt=>{gt(D,`${i()??""} 字`),gt(H,`${Lt??""} 分钟阅读`)},[()=>(i(),Y(()=>Math.ceil(i()/400)))]),M("click",R,()=>A(Kt,!l(Kt))),M("change",rt,Lt=>wt("size:"+Lt.currentTarget.value)),M("click",re,()=>A(ar,!l(ar))),M("click",Hn,()=>A(mn,!l(mn))),M("click",Gr,()=>wt("align-left")),M("click",hs,()=>wt("align-center")),M("click",Ai,()=>wt("align-right")),M("click",Ci,()=>wt("align-justify")),M("click",ji,()=>wt("superscript")),M("click",gs,()=>wt("subscript")),M("click",Kr,()=>wt("hr")),M("click",qi,()=>A(Le,!l(Le))),M("click",Xr,()=>wt("indent-first")),M("click",Yr,()=>wt("margin:10px 0")),M("click",Qr,()=>wt("math-inline")),M("click",Ni,()=>wt("math-block")),M("click",Ii,()=>wt("footnote")),M("click",Mi,()=>wt("toc")),M("click",Oi,()=>A(Fe,!l(Fe))),z(u,v)};$t(us,u=>{I()&&u(uo)})}var Re=_(us,2);qf(Re,u=>A(o,u),()=>l(o));var fs=_(Re,2);{var ds=u=>{var v=Ed(),g=$(v),S=$(g);We(S);var C=_(S,2),D=_(C,2);w(g);var F=_(g,2),H=$(F);We(H);var V=_(H,2),N=_(V,2);w(F),w(v),ke(S,()=>l(Ye),R=>A(Ye,R)),M("click",C,Wr),M("click",D,()=>A(gn,!1)),ke(H,()=>l(Tn),R=>A(Tn,R)),M("click",V,ss),M("click",N,zr),z(u,v)};$t(fs,u=>{l(gn)&&u(ds)})}w(Vr),Et(()=>{Xn(Vr,1,`panel editor ${q()?"paper":""}`,"svelte-1ctqrjb"),Jo(Re,"data-render-mode",l(d))}),M("input",Re,Gt),M("focusin",Re,Xe),M("focusout",Re,or),M("compositionstart",Re,Bn),M("compositionend",Re,En),M("click",Re,De),M("keydown",Re,Pn),z(t,Vr);var vs=Ge(co);return a(),vs}var Ad=Z('<div class="error svelte-1ka5p0t"> </div>'),Cd=Z('<div class="svg-box svelte-1ka5p0t"><!></div>'),jd=Z('<div class="placeholder svelte-1ka5p0t">画布预览区</div>'),qd=Z('<div class="canvas-backdrop svelte-1ka5p0t"><div class="canvas-panel svelte-1ka5p0t"><header class="svelte-1ka5p0t"><div><h3 class="svelte-1ka5p0t">AI 画布</h3> <p class="svelte-1ka5p0t">输入描述即可生成流程图 / ER 图 / 时序图</p></div> <button class="close-btn svelte-1ka5p0t">×</button></header> <div class="canvas-controls svelte-1ka5p0t"><select class="svelte-1ka5p0t"><option>流程图</option><option>ER 图</option><option>时序图</option></select> <textarea rows="3" placeholder="例如：用户登录 -> 权限校验 -> 查询数据 -> 返回结果" class="svelte-1ka5p0t"></textarea> <div class="canvas-actions svelte-1ka5p0t"><button class="btn primary svelte-1ka5p0t"> </button> <button class="btn ghost svelte-1ka5p0t">插入文档</button></div> <!></div> <div class="canvas-preview svelte-1ka5p0t"><!></div></div></div>');function xc(t,e){if(new.target)return fn({component:xc,...t});Ve(e,!1);let n=Ie(e,"open",12,!1),r=Ie(e,"docId",12,"");const i=pa();let s=at(""),a=at("flow"),o=at(!1),c=at(""),d=at(""),p=at(null);async function m(){if(!(!r()||!l(s).trim())){A(o,!0),A(c,""),A(d,""),A(p,null);try{const O=await fetch(`/api/doc/${r()}/diagram/generate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:l(s),kind:l(a)})});if(!O.ok)throw new Error(await O.text());const et=await O.json();A(p,et.spec);const G=await fetch("/api/figure/render",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({spec:l(p)})});if(!G.ok)throw new Error(await G.text());const tt=await G.json();A(d,String(tt.svg||""))}catch(O){A(c,O instanceof Error?O.message:"生成失败")}finally{A(o,!1)}}}function b(){l(p)&&i("insert",{spec:l(p)})}var I={get open(){return n()},set open(O){n(O),we()},get docId(){return r()},set docId(O){r(O),we()},$set:vn,$on:(O,et)=>dn(e,O,et)};xr();var q=On(),P=_e(q);{var T=O=>{var et=qd(),G=$(et),tt=$(G),K=_($(tt),2);w(tt);var st=_(tt,2),nt=$(st);Et(()=>{l(a),Bl(()=>{})});var L=$(nt);L.value=L.__value="flow";var ct=_(L);ct.value=ct.__value="er";var W=_(ct);W.value=W.__value="sequence",w(nt);var it=_(nt,2);Fs(it);var ot=_(it,2),dt=$(ot),jt=$(dt,!0);w(dt);var ut=_(dt,2);w(ot);var Ft=_(ot,2);{var Nt=pt=>{var Mt=Ad(),pe=$(Mt,!0);w(Mt),Et(()=>gt(pe,l(c))),z(pt,Mt)};$t(Ft,pt=>{l(c)&&pt(Nt)})}w(st);var Rt=_(st,2),At=$(Rt);{var It=pt=>{var Mt=Cd(),pe=$(Mt);xf(pe,()=>l(d)),w(Mt),z(pt,Mt)},zt=pt=>{var Mt=jd();z(pt,Mt)};$t(At,pt=>{l(d)?pt(It):pt(zt,!1)})}w(Rt),w(G),w(et),Et(pt=>{dt.disabled=pt,gt(jt,l(o)?"生成中…":"生成画布"),ut.disabled=!l(p)},[()=>(l(o),l(s),Y(()=>l(o)||!l(s).trim()))]),M("click",K,()=>i("close")),cc(nt,()=>l(a),pt=>A(a,pt)),ke(it,()=>l(s),pt=>A(s,pt)),M("click",dt,m),M("click",ut,b),M("click",G,va(function(pt){ha.call(this,e,pt)})),M("click",et,()=>i("close")),z(O,et)};$t(P,O=>{n()&&O(T)})}return z(t,q),Ge(I)}var Nd=Z("<div> </div>"),Id=Z('<div class="toast-root svelte-1cpok13"></div>');function kc(t,e){if(new.target)return fn({component:kc,...t});Ve(e,!1);const n=()=>ie(Vo,"$toasts",r),[r,i]=ki();var s={$set:vn,$on:(c,d)=>dn(e,c,d)},a=Id();Je(a,5,n,c=>c.id,(c,d)=>{var p=Nd(),m=$(p,!0);w(p),Et(()=>{Xn(p,1,`toast ${l(d),Y(()=>l(d).type)??""}`,"svelte-1cpok13"),gt(m,(l(d),Y(()=>l(d).message)))}),z(c,p)}),w(a),z(t,a);var o=Ge(s);return i(),o}var Md=Z('<button type="button" class="modal-backdrop svelte-ta60gp" aria-label="关闭"></button> <div class="modal svelte-ta60gp" role="dialog" aria-modal="true"><div class="modal-header svelte-ta60gp"><div class="modal-title svelte-ta60gp"> </div> <button class="btn ghost">关闭</button></div> <div class="modal-body"><!></div></div>',1);function $c(t,e){if(new.target)return fn({component:$c,...t});Ve(e,!1);let n=Ie(e,"open",12,!1),r=Ie(e,"title",12,""),i=Ie(e,"onClose",12);var s={get open(){return n()},set open(d){n(d),we()},get title(){return r()},set title(d){r(d),we()},get onClose(){return i()},set onClose(d){i(d),we()},$set:vn,$on:(d,p)=>dn(e,d,p)},a=On(),o=_e(a);{var c=d=>{var p=Md(),m=_e(p),b=_(m,2),I=$(b),q=$(I),P=$(q,!0);w(q);var T=_(q,2);w(I);var O=_(I,2),et=$(O);ac(et,e,"default",{}),w(O),w(b),Et(()=>gt(P,r())),M("click",m,function(...G){var tt;(tt=i())==null||tt.apply(this,G)}),M("click",T,function(...G){var tt;(tt=i())==null||tt.apply(this,G)}),z(d,p)};$t(o,d=>{n()&&d(c)})}return z(t,a),Ge(s)}var Dd=Z('<div class="settings-row svelte-anx9w7"><label><input type="checkbox"/> 扩展大纲</label></div> <div class="settings-row svelte-anx9w7"><label><input type="checkbox"/> 需要引用</label></div> <div class="settings-row svelte-anx9w7"><label for="targetChars">目标字数</label> <input id="targetChars" type="number" min="100" max="10000" placeholder="例如 1000" class="svelte-anx9w7"/></div> <div class="settings-row svelte-anx9w7"><label for="styleTone">风格/语气</label> <input id="styleTone" type="text" placeholder="例如：正式、简洁、适度营销" class="svelte-anx9w7"/></div> <div class="settings-row svelte-anx9w7"><label for="outputFormat">输出格式</label> <select id="outputFormat" class="svelte-anx9w7"><option>Markdown</option><option>纯文本</option></select></div> <div class="settings-section svelte-anx9w7"><div class="section-title svelte-anx9w7">高级设置（可改所有默认值）</div> <label for="formattingJson">格式 formatting</label> <textarea id="formattingJson" rows="6" class="svelte-anx9w7"></textarea> <label for="prefsJson">生成偏好 generation_prefs</label> <textarea id="prefsJson" rows="6" class="svelte-anx9w7"></textarea></div> <div class="settings-actions svelte-anx9w7"><button class="btn primary">保存</button> <button class="btn ghost">取消</button></div>',1),Od=Z('<button class="btn ghost">设置</button> <!>',1);function Ec(t,e){if(new.target)return fn({component:Ec,...t});Ve(e,!1);const n=()=>ie(nr,"$docId",r),[r,i]=ki();let s=at(!1),a=at(!1),o=at(""),c=at(""),d=at(!1),p=at("markdown"),m=at(""),b=at("");async function I(){const K=n();if(!K)return;const st=await fetch(`/api/doc/${K}`);if(!st.ok)return;const nt=await st.json(),L=nt.generation_prefs||{},ct=nt.formatting||{};A(a,!!L.expand_outline),A(o,L.target_chars?Number(L.target_chars):""),A(c,String(ct.style||"")),A(d,!!L.citations_required),A(p,String(L.output_format||"markdown")),A(m,JSON.stringify(ct,null,2)),A(b,JSON.stringify(L,null,2))}async function q(){const K=n();if(!K)return;let st={},nt={};try{st=l(m).trim()?JSON.parse(l(m)):{},nt=l(b).trim()?JSON.parse(l(b)):{}}catch{kt("高级设置 JSON 解析失败，请检查格式。","bad");return}const L={generation_prefs:{...nt,expand_outline:l(a),citations_required:l(d),output_format:l(p)},formatting:{...st,style:l(c)}};l(o)&&(L.generation_prefs.target_chars=Number(l(o))),await fetch(`/api/doc/${K}/settings`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(L)}),kt("设置已保存","ok"),A(s,!1)}function P(){A(s,!0),I().catch(()=>{})}var T={$set:vn,$on:(K,st)=>dn(e,K,st)};xr();var O=Od(),et=_e(O),G=_(et,2);$c(G,{get open(){return l(s)},title:"生成设置",onClose:()=>A(s,!1),children:(K,st)=>{var nt=Dd(),L=_e(nt),ct=$(L),W=$(ct);We(W),qo(),w(ct),w(L);var it=_(L,2),ot=$(it),dt=$(ot);We(dt),qo(),w(ot),w(it);var jt=_(it,2),ut=_($(jt),2);We(ut),w(jt);var Ft=_(jt,2),Nt=_($(Ft),2);We(Nt),w(Ft);var Rt=_(Ft,2),At=_($(Rt),2);Et(()=>{l(p),Bl(()=>{})});var It=$(At);It.value=It.__value="markdown";var zt=_(It);zt.value=zt.__value="plain",w(At),w(Rt);var pt=_(Rt,2),Mt=_($(pt),4);Fs(Mt);var pe=_(Mt,4);Fs(pe),w(pt);var Pt=_(pt,2),Xt=$(Pt),Se=_(Xt,2);w(Pt),Qa(W,()=>l(a),Dt=>A(a,Dt)),Qa(dt,()=>l(d),Dt=>A(d,Dt)),ke(ut,()=>l(o),Dt=>A(o,Dt)),ke(Nt,()=>l(c),Dt=>A(c,Dt)),cc(At,()=>l(p),Dt=>A(p,Dt)),ke(Mt,()=>l(m),Dt=>A(m,Dt)),ke(pe,()=>l(b),Dt=>A(b,Dt)),M("click",Xt,q),M("click",Se,()=>A(s,!1)),z(K,nt)},$$slots:{default:!0}}),M("click",et,P),z(t,O);var tt=Ge(T);return i(),tt}var Ld=Z('<div class="loading svelte-1bmythy">加载中...</div>'),Fd=Z('<div class="empty svelte-1bmythy">暂无文档</div>'),Rd=Z('<div class="doc-item svelte-1bmythy"><div class="doc-info svelte-1bmythy"><div class="doc-title svelte-1bmythy"> </div> <div class="doc-meta svelte-1bmythy"><span> </span> <span> </span></div> <div class="doc-preview svelte-1bmythy"> </div></div> <button class="delete-btn svelte-1bmythy">删除</button></div>'),Bd=Z('<div class="doc-list svelte-1bmythy"></div>'),Pd=Z('<div class="modal-backdrop svelte-1bmythy"><div class="modal-panel svelte-1bmythy"><div class="modal-header svelte-1bmythy"><h2 class="svelte-1bmythy">文档列表</h2> <button class="close-btn svelte-1bmythy">✕</button></div> <div class="modal-body svelte-1bmythy"><!></div></div></div>');function Tc(t,e){if(new.target)return fn({component:Tc,...t});Ve(e,!1);let n=Ie(e,"visible",12,!1),r=Ie(e,"onSelect",12,()=>{}),i=at([]),s=at(!1);async function a(){A(s,!0);try{const q=await fetch("/api/docs/list");if(!q.ok)throw new Error("加载失败");const P=await q.json();A(i,P.docs||[])}catch{kt("加载文档列表失败","error")}finally{A(s,!1)}}function o(q){try{return new Date(q).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return q}}function c(q,P){return(q||"").length>P?q.slice(0,P)+"...":q}async function d(q){if(confirm("确定删除此文档？"))try{await fetch(`/api/doc/${q}/delete`,{method:"POST"}),kt("已删除","ok"),await a()}catch{kt("删除失败","error")}}ts(()=>{n()&&a()}),Zs(()=>Ys(n()),()=>{n()&&a()}),to();var p={get visible(){return n()},set visible(q){n(q),we()},get onSelect(){return r()},set onSelect(q){r(q),we()},$set:vn,$on:(q,P)=>dn(e,q,P)};xr();var m=On(),b=_e(m);{var I=q=>{var P=Pd(),T=$(P),O=$(T),et=_($(O),2);w(O);var G=_(O,2),tt=$(G);{var K=nt=>{var L=Ld();z(nt,L)},st=nt=>{var L=On(),ct=_e(L);{var W=ot=>{var dt=Fd();z(ot,dt)},it=ot=>{var dt=Bd();Je(dt,5,()=>l(i),sn,(jt,ut)=>{var Ft=Rd(),Nt=$(Ft),Rt=$(Nt),At=$(Rt,!0);w(Rt);var It=_(Rt,2),zt=$(It),pt=$(zt,!0);w(zt);var Mt=_(zt,2),pe=$(Mt);w(Mt),w(It);var Pt=_(It,2),Xt=$(Pt,!0);w(Pt),w(Nt);var Se=_(Nt,2);w(Ft),Et((Dt,Me)=>{gt(At,(l(ut),Y(()=>l(ut).title||"自动生成文档"))),gt(pt,Dt),gt(pe,`${l(ut),Y(()=>l(ut).char_count||0)??""} 字`),gt(Xt,Me)},[()=>(l(ut),Y(()=>o(l(ut).updated_at))),()=>(l(ut),Y(()=>c(l(ut).text,80)))]),M("click",Nt,()=>r()(l(ut).doc_id)),M("keydown",Nt,()=>{}),M("click",Se,()=>d(l(ut).doc_id)),z(jt,Ft)}),w(dt),z(ot,dt)};$t(ct,ot=>{l(i),Y(()=>l(i).length===0)?ot(W):ot(it,!1)},!0)}z(nt,L)};$t(tt,nt=>{l(s)?nt(K):nt(st,!1)})}w(G),w(T),w(P),M("click",et,()=>n(!1)),M("click",T,va(function(nt){ha.call(this,e,nt)})),M("keydown",T,()=>{}),M("click",P,()=>n(!1)),M("keydown",P,()=>{}),z(q,P)};$t(b,q=>{n()&&q(I)})}return z(t,m),Ge(p)}var Hd=Z('<div class="skeleton-wrapper svelte-1bn1hqj"><div class="skeleton-header svelte-1bn1hqj"><div class="skeleton-line skeleton-title svelte-1bn1hqj"></div> <div class="skeleton-line skeleton-subtitle svelte-1bn1hqj"></div></div> <div class="skeleton-content svelte-1bn1hqj"><div class="skeleton-line svelte-1bn1hqj"></div> <div class="skeleton-line svelte-1bn1hqj"></div> <div class="skeleton-line short svelte-1bn1hqj"></div> <div class="skeleton-line svelte-1bn1hqj"></div> <div class="skeleton-line svelte-1bn1hqj"></div> <div class="skeleton-line short svelte-1bn1hqj"></div></div></div>');function Ac(t,e){if(new.target)return fn({component:Ac,...t});Ve(e,!1);var n={$set:vn,$on:(i,s)=>dn(e,i,s)},r=Hd();return z(t,r),Ge(n)}var Ud=Z('<div class="progress-bar indeterminate svelte-1qjgclg"></div>'),Jd=Z('<div class="progress-bar svelte-1qjgclg"></div>'),Wd=Z('<div class="progress-container svelte-1qjgclg"><!></div>');function Cc(t,e){if(new.target)return fn({component:Cc,...t});Ve(e,!1);let n=Ie(e,"progress",12,0),r=Ie(e,"indeterminate",12,!1);var i={get progress(){return n()},set progress(d){n(d),we()},get indeterminate(){return r()},set indeterminate(d){r(d),we()},$set:vn,$on:(d,p)=>dn(e,d,p)},s=Wd(),a=$(s);{var o=d=>{var p=Ud();z(d,p)},c=d=>{var p=Jd();Et(m=>qs(p,`width: ${m??""}%`),[()=>(Ys(n()),Y(()=>Math.min(100,Math.max(0,n()))))]),z(d,p)};$t(a,d=>{r()?d(o):d(c,!1)})}return w(s),z(t,s),Ge(i)}var zd=Z('<div class="error-boundary svelte-1k3aqik"><div class="error-icon svelte-1k3aqik">⚠️</div> <h2 class="svelte-1k3aqik">抱歉，出现了一些问题</h2> <p class="error-message svelte-1k3aqik"> </p> <div class="error-suggestion svelte-1k3aqik">建议： <ul class="svelte-1k3aqik"><li class="svelte-1k3aqik">刷新页面重试</li> <li class="svelte-1k3aqik">检查网络连接</li> <li class="svelte-1k3aqik">清除浏览器缓存</li> <li class="svelte-1k3aqik">如问题持续，请联系技术支持</li></ul></div> <button class="btn-retry svelte-1k3aqik">重新加载</button></div>');function jc(t,e){if(new.target)return fn({component:jc,...t});Ve(e,!1);let n=Ie(e,"fallback",12,"出现错误，请刷新页面重试"),r=at(!1),i=at("");ts(()=>{const p=m=>{var b;A(r,!0),A(i,((b=m.error)==null?void 0:b.message)||m.message||"未知错误"),console.error("捕获到错误:",m.error)};return window.addEventListener("error",p),()=>{window.removeEventListener("error",p)}});var s={get fallback(){return n()},set fallback(p){n(p),we()},$set:vn,$on:(p,m)=>dn(e,p,m)};xr();var a=On(),o=_e(a);{var c=p=>{var m=zd(),b=_($(m),4),I=$(b,!0);w(b);var q=_(b,4);w(m),Et(()=>gt(I,l(i))),M("click",q,()=>window.location.reload()),z(p,m)},d=p=>{var m=On(),b=_e(m);ac(b,e,"default",{}),z(p,m)};$t(o,p=>{l(r)?p(c):p(d,!1)})}return z(t,a),Ge(s)}var Vd=Z('<p class="empty svelte-13e776w">加载中...</p>'),Gd=Z('<p class="empty svelte-13e776w">暂无引用</p>'),Kd=Z('<span class="source svelte-13e776w"> </span>'),Xd=Z('<div class="citation-item svelte-13e776w"><div class="citation-info svelte-13e776w"><strong class="svelte-13e776w"> </strong> <span class="svelte-13e776w"> </span> <!></div> <div class="citation-actions svelte-13e776w"><button class="btn-copy svelte-13e776w">复制</button> <button class="btn-delete svelte-13e776w">删除</button></div></div>'),Yd=Z('<div class="citation-list svelte-13e776w"></div>'),Qd=Z('<div class="modal-backdrop svelte-13e776w"><div class="modal svelte-13e776w"><div class="modal-header svelte-13e776w"><h2 class="svelte-13e776w">引用管理</h2> <button class="close-btn svelte-13e776w">×</button></div> <div class="modal-body svelte-13e776w"><div class="add-section svelte-13e776w"><h3 class="svelte-13e776w">添加引用</h3> <div class="form-grid svelte-13e776w"><input type="text" placeholder="引用ID (如: smith2023)*" class="svelte-13e776w"/> <input type="text" placeholder="作者*" class="svelte-13e776w"/> <input type="text" placeholder="标题*" class="svelte-13e776w"/> <input type="text" placeholder="年份" class="svelte-13e776w"/> <input type="text" placeholder="来源（期刊/会议/出版社）" class="full-width svelte-13e776w"/></div> <button class="btn-add svelte-13e776w">添加引用</button></div> <div class="export-section svelte-13e776w"><h3 class="svelte-13e776w">导出参考文献</h3> <div class="export-btns svelte-13e776w"><button class="btn-export svelte-13e776w">APA格式</button> <button class="btn-export svelte-13e776w">MLA格式</button> <button class="btn-export svelte-13e776w">GB/T 7714</button></div></div> <div class="list-section svelte-13e776w"><h3 class="svelte-13e776w"> </h3> <!></div></div></div></div>');function qc(t,e){if(new.target)return fn({component:qc,...t});Ve(e,!1);const n=()=>ie(nr,"$docId",r),[r,i]=ki();let s=Ie(e,"visible",12,!1),a=at([]),o=at(!1),c=at(""),d=null,p=at({id:"",author:"",title:"",year:"",source:""});async function m(){const L=n();if(L){A(o,!0);try{const ct=await fetch(`/api/doc/${L}/citations`);if(!ct.ok)throw new Error(await ct.text());const W=await ct.json();A(a,Array.isArray(W.items)?W.items:[])}catch(ct){console.error("Failed to load citations:",ct),kt("加载引用失败","error")}finally{A(o,!1)}}}async function b(){const L=n();L&&await fetch(`/api/doc/${L}/citations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:l(a)})})}function I(){d&&clearTimeout(d),d=setTimeout(()=>{b().catch(()=>{kt("保存引用失败","error")})},300)}function q(){if(!l(p).id||!l(p).author||!l(p).title){kt("请填写必填字段（ID、作者、标题）","bad");return}if(l(a).some(L=>L.id===l(p).id)){kt("引用ID已存在","bad");return}A(a,[...l(a),{...l(p)}]),I(),A(p,{id:"",author:"",title:"",year:"",source:""}),kt("已添加引用","ok")}function P(L){A(a,l(a).filter(ct=>ct.id!==L)),I(),kt("已删除引用","ok")}function T(L){navigator.clipboard.writeText(`[@${L}]`),kt("已复制引用标记","ok")}function O(L,ct){return ct==="apa"?`${L.author} (${L.year}). ${L.title}. ${L.source}.`:ct==="mla"?`${L.author}. "${L.title}." ${L.source}, ${L.year}.`:`${L.author}. ${L.title}[J]. ${L.source}, ${L.year}.`}function et(L){const ct=l(a).map(dt=>O(dt,L)).join(`

`),W=new Blob([ct],{type:"text/plain"}),it=URL.createObjectURL(W),ot=document.createElement("a");ot.href=it,ot.download=`references_${L}.txt`,ot.click(),URL.revokeObjectURL(it),kt(`已导出 ${L.toUpperCase()} 格式参考文献`,"ok")}ts(()=>{s()&&m()}),Zs(()=>(Ys(s()),n(),l(c)),()=>{if(s()){const L=n();L&&L!==l(c)&&(A(c,L),m())}}),to();var G={get visible(){return s()},set visible(L){s(L),we()},$set:vn,$on:(L,ct)=>dn(e,L,ct)};xr();var tt=On(),K=_e(tt);{var st=L=>{var ct=Qd(),W=$(ct),it=$(W),ot=_($(it),2);w(it);var dt=_(it,2),jt=$(dt),ut=_($(jt),2),Ft=$(ut);We(Ft);var Nt=_(Ft,2);We(Nt);var Rt=_(Nt,2);We(Rt);var At=_(Rt,2);We(At);var It=_(At,2);We(It),w(ut);var zt=_(ut,2);w(jt);var pt=_(jt,2),Mt=_($(pt),2),pe=$(Mt),Pt=_(pe,2),Xt=_(Pt,2);w(Mt),w(pt);var Se=_(pt,2),Dt=$(Se),Me=$(Dt);w(Dt);var Ke=_(Dt,2);{var xe=Ht=>{var pn=Vd();z(Ht,pn)},Te=Ht=>{var pn=On(),ir=_e(pn);{var kr=De=>{var Xe=Gd();z(De,Xe)},sr=De=>{var Xe=Yd();Je(Xe,5,()=>l(a),sn,(or,Gt)=>{var Bn=Xd(),En=$(Bn),Oe=$(En),hn=$(Oe);w(Oe);var wt=_(Oe,2),Pn=$(wt);w(wt);var gn=_(wt,2);{var Ye=mn=>{var Le=Kd(),Fe=$(Le,!0);w(Le),Et(()=>gt(Fe,(l(Gt),Y(()=>l(Gt).source)))),z(mn,Le)};$t(gn,mn=>{l(Gt),Y(()=>l(Gt).source)&&mn(Ye)})}w(En);var Tn=_(En,2),Kt=$(Tn),ar=_(Kt,2);w(Tn),w(Bn),Et(()=>{gt(hn,`[@${l(Gt),Y(()=>l(Gt).id)??""}]`),gt(Pn,`${l(Gt),Y(()=>l(Gt).author)??""} (${l(Gt),Y(()=>l(Gt).year)??""}). ${l(Gt),Y(()=>l(Gt).title)??""}`)}),M("click",Kt,()=>T(l(Gt).id)),M("click",ar,()=>P(l(Gt).id)),z(or,Bn)}),w(Xe),z(De,Xe)};$t(ir,De=>{l(a),Y(()=>l(a).length===0)?De(kr):De(sr,!1)},!0)}z(Ht,pn)};$t(Ke,Ht=>{l(o)?Ht(xe):Ht(Te,!1)})}w(Se),w(dt),w(W),w(ct),Et(()=>gt(Me,`已有引用 (${l(a),Y(()=>l(a).length)??""})`)),M("click",ot,()=>s(!1)),ke(Ft,()=>l(p).id,Ht=>pr(p,l(p).id=Ht)),ke(Nt,()=>l(p).author,Ht=>pr(p,l(p).author=Ht)),ke(Rt,()=>l(p).title,Ht=>pr(p,l(p).title=Ht)),ke(At,()=>l(p).year,Ht=>pr(p,l(p).year=Ht)),ke(It,()=>l(p).source,Ht=>pr(p,l(p).source=Ht)),M("click",zt,q),M("click",pe,()=>et("apa")),M("click",Pt,()=>et("mla")),M("click",Xt,()=>et("gb")),M("click",W,va(function(Ht){ha.call(this,e,Ht)})),M("click",ct,()=>s(!1)),z(L,ct)};$t(K,L=>{s()&&L(st)})}z(t,tt);var nt=Ge(G);return i(),nt}const Zd="modulepreload",tv=function(t){return"/"+t},sl={},ev=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));i=Promise.allSettled(n.map(c=>{if(c=tv(c),c in sl)return;sl[c]=!0;const d=c.endsWith(".css"),p=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${p}`))return;const m=document.createElement("link");if(m.rel=d?"stylesheet":Zd,d||(m.as="script"),m.crossOrigin="",m.href=c,o&&m.setAttribute("nonce",o),document.head.appendChild(m),d)return new Promise((b,I)=>{m.addEventListener("load",b),m.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return i.then(a=>{for(const o of a||[])o.status==="rejected"&&s(o.reason);return e().catch(s)})};let dr=null,Ao=null;async function nv(){try{return Ao?!0:(dr=await ev(()=>import("./chunk-wa_bridge.js"),[]),dr!=null&&dr.default&&await dr.default(),Ao=(dr==null?void 0:dr.WasmEditor)??null,Ao?(console.log("已加载 Rust WASM 引擎"),!0):(console.warn("未找到 Rust WASM 入口：WasmEditor"),!1))}catch(t){return console.warn("Rust WASM 加载失败，回退到 contenteditable：",t),!1}}var rv=Z('<div class="generation-banner svelte-1n46o8q"> </div>'),iv=Z('<div class="failure-row svelte-1n46o8q"><span> </span> <button class="btn ghost svelte-1n46o8q">??</button></div>'),sv=Z('<section class="section-failures svelte-1n46o8q"><div class="panel-title svelte-1n46o8q">????</div> <!></section>'),ov=Z('<div class="panel-empty svelte-1n46o8q">???...</div>'),av=Z('<div class="panel-empty svelte-1n46o8q"> </div>'),lv=Z('<div class="panel-empty svelte-1n46o8q">????</div>'),cv=Z('<div class="version-summary svelte-1n46o8q"> </div>'),uv=Z('<div class="version-summary svelte-1n46o8q"> </div>'),fv=Z('<div><div><div class="minor-title svelte-1n46o8q"> </div> <!> <div class="minor-meta svelte-1n46o8q"> </div></div> <div class="minor-actions svelte-1n46o8q"><button class="btn ghost svelte-1n46o8q">??</button> <button class="btn ghost svelte-1n46o8q">??</button></div></div>'),dv=Z('<div class="version-minors svelte-1n46o8q"></div>'),vv=Z('<div class="version-group"><div><div class="version-title svelte-1n46o8q"><span> </span> <span> </span></div> <div class="version-meta svelte-1n46o8q"><span> </span> <span> </span></div> <!> <div class="version-actions svelte-1n46o8q"><button class="btn ghost svelte-1n46o8q">??</button> <button class="btn ghost svelte-1n46o8q">??</button></div></div> <!></div>'),pv=Z('<div class="version-groups svelte-1n46o8q"></div>'),hv=Z('<div class="block-error svelte-1n46o8q"> </div>'),gv=Z('<div class="block-preview svelte-1n46o8q"> </div> <input class="block-input svelte-1n46o8q" placeholder="??????????????"/> <div class="block-actions svelte-1n46o8q"><button class="btn primary svelte-1n46o8q"> </button> <button class="btn ghost svelte-1n46o8q">??</button></div> <!>',1),mv=Z('<div class="panel-empty svelte-1n46o8q">???????????????????? AI ????</div>'),_v=Z("<!> <!> <!>",1),bv=Z('<main><header class="topbar svelte-1n46o8q"><div class="brand svelte-1n46o8q"><div class="logo svelte-1n46o8q">IR</div> <div class="brand-text"><div class="brand-title svelte-1n46o8q">??????</div> <div class="brand-sub svelte-1n46o8q">Doc IR ? ?????</div></div></div> <nav class="menu svelte-1n46o8q"><button class="menu-item svelte-1n46o8q">??</button> <button class="menu-item svelte-1n46o8q">??</button> <button class="menu-item svelte-1n46o8q">??</button> <button class="menu-item svelte-1n46o8q">??</button> <button class="menu-item svelte-1n46o8q">??</button></nav> <div class="top-actions svelte-1n46o8q"><div class="status-chip svelte-1n46o8q"><span class="dot svelte-1n46o8q"></span> <span> </span></div> <div class="status-chip light svelte-1n46o8q"> </div> <button class="btn ghost svelte-1n46o8q">??</button> <button class="btn ghost svelte-1n46o8q">?? Word</button> <button class="btn ghost svelte-1n46o8q">?? PDF</button> <!></div></header> <div class="workspace svelte-1n46o8q"><aside class="nav-rail svelte-1n46o8q"><button class="nav-btn active svelte-1n46o8q" title="??"><span>??</span></button> <button class="nav-btn svelte-1n46o8q" title="??"><span>??</span></button> <button class="nav-btn svelte-1n46o8q" title="??"><span>??</span></button> <button class="nav-btn svelte-1n46o8q" title="???"><span>???</span></button></aside> <section class="doc-area svelte-1n46o8q"><div class="doc-toolbar svelte-1n46o8q"><div class="tool-group svelte-1n46o8q"><button class="tool-btn svelte-1n46o8q">B</button> <button class="tool-btn svelte-1n46o8q">I</button> <button class="tool-btn svelte-1n46o8q">U</button> <button class="tool-btn svelte-1n46o8q">H1</button> <button class="tool-btn svelte-1n46o8q">H2</button> <button class="tool-btn svelte-1n46o8q">?</button> <button class="tool-btn svelte-1n46o8q">1.</button> <button class="tool-btn svelte-1n46o8q">??</button> <button class="tool-btn svelte-1n46o8q">??</button></div> <div class="tool-group right svelte-1n46o8q"><button class="btn ghost svelte-1n46o8q">??</button> <button class="btn ghost svelte-1n46o8q">??</button></div></div> <!> <!> <div class="doc-stage svelte-1n46o8q"><!></div></section> <aside class="side-panel svelte-1n46o8q"><div class="panel-card version-panel svelte-1n46o8q"><div class="panel-header svelte-1n46o8q"><div><div class="panel-title svelte-1n46o8q">???</div> <div class="panel-sub svelte-1n46o8q">???? ? ????</div></div> <button class="icon-btn svelte-1n46o8q" title="??">?</button></div> <div class="major-commit svelte-1n46o8q"><input class="version-input svelte-1n46o8q" placeholder="????????"/> <button class="btn primary svelte-1n46o8q">??</button></div> <!> <div class="version-diff svelte-1n46o8q"><div class="panel-sub svelte-1n46o8q">????</div> <pre class="svelte-1n46o8q"> </pre></div></div> <div class="panel-card block-panel svelte-1n46o8q"><div class="panel-header svelte-1n46o8q"><div><div class="panel-title svelte-1n46o8q">??????</div> <div class="panel-sub svelte-1n46o8q">????????</div></div></div> <!></div></aside></div> <div><button class="assistant-toggle svelte-1n46o8q"> </button> <!></div> <!></main> <!> <!>',1);function Nc(t,e){if(new.target)return fn({component:Nc,...t});Ve(e,!1);const n=()=>ie(ve,"$sourceText",I),r=()=>ie(nr,"$docId",I),i=()=>ie(ge,"$docIr",I),s=()=>ie(de,"$docIrDirty",I),a=()=>ie(el,"$darkMode",I),o=()=>ie(Ns,"$generating",I),c=()=>ie(ni,"$flowStatus",I),d=()=>ie(Ze,"$docStatus",I),p=()=>ie(ya,"$wordCount",I),m=()=>ie(oi,"$instruction",I),b=()=>ie(Ts,"$isLoading",I),[I,q]=ki();let P=null,T="",O=null,et=null,G=!1,tt=!1,K=[],st=null,nt=0,L=0,ct=!1,W=!1,it=null,ot=null,dt=0,jt="",ut="",Ft=!1,Nt=!1,Rt=!1,At=0,It=0,zt=0,pt=9e4,Mt=null,pe=!1,Pt=at({current:0,total:0,percent:0,etaS:0,section:""}),Xt=0,Se=[],Dt=at([]),Me=!1,Ke=at(null),xe=at(""),Te=null,Ht=at(!1),pn=at(!1),ir=at(!1),kr=[],sr=at([]),De=at(""),Xe=at(""),or=at(""),Gt=at(!0),Bn=at(!1),En=at(""),Oe=at(""),hn=at(""),wt=at(!1),Pn=at(""),gn=null;typeof window<"u"&&document.body.setAttribute("data-engine","rust");function Ye(){return gn||(gn=nv().then(f=>f).catch(()=>!1)),gn}function Tn(){var y,x;const f=window;if(f.__DOC_ID__)return String(f.__DOC_ID__);const h=(y=document.body)==null?void 0:y.getAttribute("data-doc-id");return h||((x=document.querySelector('meta[name="doc-id"]'))==null?void 0:x.getAttribute("content"))||""}function Kt(){if(!dt)return new Date().toLocaleTimeString();const f=Date.now()-dt,h=Math.max(0,Math.floor(f/1e3)),E=String(Math.floor(h/60)).padStart(2,"0"),y=String(h%60).padStart(2,"0");return`+${E}:${y}`}function ar(f){const h=(f||"").toUpperCase();return h==="PLAN"?"规划":h==="WRITE"?"写作":h==="DONE"?"完成":h==="STOPPED"?"已停止":f}function mn(f){const h=String(f||"");h.trim()&&(h.length<8&&!/[\w\u4e00-\u9fa5]/.test(h)||(T+=h,O&&clearTimeout(O),O=setTimeout(()=>{const E=T.slice(-120);ye("写作",E,Kt()),T="",O=null},500)))}function Le(f,h){if(!h&&!G&&!tt)return;const E=String(f??n()??"");et&&clearTimeout(et),et=setTimeout(()=>{if(!h&&!G&&!tt)return;const y=Go(E);y&&(ge.set(y),de.set(!1))},120)}function Fe(){K=[],L=0,ct=!1,W=!1,it=null,ot=null,nt+=1,tt=!1,st&&(clearTimeout(st),st=null)}function ns(){let f=26,h=14;return L>1600?(f=120,h=6):L>700?(f=72,h=8):L>260&&(f=46,h=11),ct&&(f=Math.max(f,140),h=Math.min(h,5)),{chunk:f,delayMs:h}}function eo(f,h,E){ve.update(y=>{const x=String(y||""),B=E?x+h:co(x,f,h);return Le(B),B}),mn(h)}function rs(f){if(f!==nt)return;if(!K.length){W=!1,ct=!1,it!==null&&(Wr(it,ot),it=null,ot=null),tt=!1;return}const h=K[0],E=ns(),y=h.text.slice(0,E.chunk);h.text=h.text.slice(y.length),L=Math.max(0,L-y.length),h.text||K.shift(),y&&eo(h.section,y,h.raw),st=setTimeout(()=>rs(f),E.delayMs)}function $i(){if(W||!K.length)return;W=!0,tt=!0;const f=++nt;rs(f)}function is(f,h,E){const y=String(h||"");y&&(K.push({section:String(f||""),raw:!!(E!=null&&E.raw),text:y}),L+=y.length,$i())}function Wr(f,h){const E=String(f||"");if(ve.set(E),h&&typeof h=="object")ge.set(h),de.set(!1);else{const y=Go(E);y?(ge.set(y),de.set(!1)):(ge.set(null),de.set(!0))}}function ss(f,h){if(it=String(f||""),ot=h||null,!K.length&&!W){Wr(it,ot),it=null,ot=null;return}ct=!0,$i()}let zr=0;async function os(f,h){const E=++zr,y=Math.max(10,(h==null?void 0:h.chunk)??36),x=Math.max(10,(h==null?void 0:h.delayMs)??18);tt=!0,de.set(!0),ve.set("");let B=0;for(;B<f.length;){if(E!==zr)return;const j=f.slice(B,B+y);ve.update(Q=>{const ft=String(Q||"")+j;return Le(ft),ft}),mn(j),B+=y,await new Promise(Q=>setTimeout(Q,x))}E===zr&&(h!=null&&h.finalDocIr&&typeof h.finalDocIr=="object"?(ge.set(h.finalDocIr),de.set(!1)):Le(f,!0),tt=!1)}function as(f,h,E){let y=String(f||"").replace(/\r/g,"");/^#\s+/m.test(y)||(y=`# ${h||"自动生成文档"}

`+y.trimStart());for(const x of E||[]){const B=String(x||"").trim();if(!B)continue;new RegExp(`^##\\s+${B.replace(/[.*+?^${}()|[\]\\\\]/g,"\\\\$&")}\\s*$`,"m").test(y)||(y=(y.trimEnd()+`

## ${B}

`).replace(/\n{4,}/g,`

`))}return y}function no(f){const h=String(f||"").trim(),E=/^H[23]::(.*)$/.exec(h);return(E?E[1]:h).trim()}function ro(f){return f.replace(/[.*+?^${}()|[\]\\/]/g,"\\$&")}function io(f){const h=f.detail||{};if(h.docIr&&typeof h.docIr=="object"&&(ge.set(h.docIr),de.set(!1),Te=h.docIr),h.text){const E=String(h.text||"");ve.set(E),A(xe,E)}h.meta&&h.meta.action&&kt("Block updated","ok")}function so(f){const h=f.detail||{};A(En,String(h.blockId||"")),A(Oe,String(h.text||"")),A(Pn,"")}function Ei(f){ge.set(f),de.set(!1),Te=f;const h=Bs(f)||"";ve.set(h),A(xe,h)}async function oo(){if(!r()||!l(En))return;const f=l(hn).trim();if(f){A(wt,!0),A(Pn,"");try{const h={block_id:l(En),instruction:f};i()&&(h.doc_ir=i());const E=await fetch(`/api/doc/${r()}/block-edit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)});if(!E.ok)throw new Error(await E.text());const y=await E.json();if(y.doc_ir&&typeof y.doc_ir=="object")Ei(y.doc_ir);else if(y.text){const x=String(y.text||"");ve.set(x),A(xe,x)}A(hn,""),kt("已应用修改","ok")}catch(h){A(Pn,h instanceof Error?h.message:"修改失败")}finally{A(wt,!1)}}}function ao(f){if(!f||typeof f!="object")return;const h=i();if(!h||typeof h!="object")return;const E=Array.isArray(h.sections)?h.sections:[];if(!E.length)return;const y=E[0],x=Array.isArray(y.blocks)?y.blocks.slice():[],B={id:Math.random().toString(36).slice(2),type:"figure",figure:f};x.push(B);const j={...y,blocks:x},Q=E.slice();Q[0]=j;const ft={...h,sections:Q};Ei(ft)}const $r=new Map;async function ls(f){if(!f)return null;if($r.has(f))return $r.get(f);try{const h=await fetch(`/api/text/${encodeURIComponent(f)}`);if(!h.ok)throw new Error(await h.text());const E=await h.json();return $r.set(f,E),E}catch{return null}}function cs(f){if(!f)return"";const h=String(f.kind||""),E=String(f.format||"");if(E==="text")return String(f.text||"");if(E==="json"){const y=f.data||{};if(h==="list")return(Array.isArray(y.items)?y.items:[]).map(B=>`- ${String(B).trim()}`).join(`
`);if(h==="table")return`[[TABLE:${JSON.stringify(y)}]]`;if(h==="figure")return`[[FIGURE:${JSON.stringify(y)}]]`;if(y.text)return String(y.text)}return""}async function lo(f,h){const E=await ls(h),y=cs(E);y&&is(String(f||""),y,{raw:!f})}function Ti(f){let h=String(f||"").replace(/\r/g,"");return h=h.replace(/(\n(?:-|\d+\.)[^\n]*)(?:\n{2,})(?=(?:-|\d+\.)\s)/g,`$1
`),h=h.replace(/\n{3,}/g,`

`),h}function co(f,h,E){const y=no(h),x=String(E||"").replace(/\r/g,"");if(!x||!x.trim()&&!x.includes(`
`))return String(f||"");if(!y){const _n=String(f||"").replace(/\r/g,""),Jn=_n+(_n.endsWith(`
`)||!_n?"":`
`)+x;return Ti(Jn)}let B=String(f||"").replace(/\r/g,"");const j=new RegExp(`^##\\s+${ro(y)}\\s*$`,"m");j.test(B)||(B=as(B,"",[y]));const Q=j.exec(B);if(!Q){const _n=B+(B.endsWith(`
`)?"":`
`)+delta;return Ti(_n)}const ft=Q.index+Q[0].length,Vt=B.slice(ft).search(/^##\s+/m),Jt=Vt>=0?ft+Vt:B.length,Ce=B.slice(0,Jt),mt=B.slice(Jt),lr=Ce.replace(/\s+$/,"")+`

${x}
`+mt;return Ti(lr)}function Vr(f){const h=String(f||"").replace(/\r/g,"").split(`
`);let E="message";const y=[];for(const j of h)j.startsWith("event:")&&(E=j.slice(6).trim()),j.startsWith("data:")&&y.push(j.slice(5).trim());const x=y.join(`
`);let B={};try{B=x?JSON.parse(x):{}}catch{B={raw:x}}return{event:E,data:B}}async function us(f,h,E,y){const x=await fetch(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h),signal:y});if(!x.ok){const ce=await x.text()||x.statusText||"请求失败";throw new Error(`HTTP ${x.status}: ${ce}`)}if(!x.body)throw new Error("当前环境不支持流式输出");const B=x.body.getReader(),j=new TextDecoder("utf-8");let Q="";for(;;){const{value:ft,done:ce}=await B.read();if(ce)break;Q+=j.decode(ft,{stream:!0});let Vt=Q.indexOf(`

`);for(;Vt>=0;){const Jt=Q.slice(0,Vt);if(Q=Q.slice(Vt+2),Jt.trim()){const{event:Ce,data:mt}=Vr(Jt);E(Ce,mt)}Vt=Q.indexOf(`

`)}}}async function uo(){const f=r();if(f)try{const h=await fetch(`/api/doc/${f}`);if(!h.ok)throw new Error(await h.text());const E=await h.json();ve.set(String(E.text||"")),A(xe,String(E.text||"")),E.doc_ir&&typeof E.doc_ir=="object"?(ge.set(E.doc_ir),de.set(!1),Te=E.doc_ir):(ge.set(null),Te=null),D().catch(()=>{})}catch(h){kt(`加载失败: ${h instanceof Error?h.message:"未知错误"}`,"error")}finally{Ts.set(!1)}}function Re(f){const h=[],E=Array.isArray(f==null?void 0:f.sections)?f.sections:[],y=x=>{h.push(x),(Array.isArray(x==null?void 0:x.children)?x.children:[]).forEach(j=>y(j))};return E.forEach(x=>y(x)),h}function fs(f){const h=Math.max(1,Math.min(6,Number((f==null?void 0:f.level)||1))),E=String((f==null?void 0:f.title)||"").trim(),y=f!=null&&f.style&&typeof f.style=="object"?JSON.stringify(f.style):"";return`${h}:${E}:${y}`}function ds(f){const h=String((f==null?void 0:f.type)||"paragraph").toLowerCase(),E=f!=null&&f.style&&typeof f.style=="object"?f.style:null,y=Array.isArray(f==null?void 0:f.runs)?f.runs:null;if(h==="list"){const j=Array.isArray(f==null?void 0:f.items)?f.items:[],Q=!!(f!=null&&f.ordered),ft={type:"list",items:j,ordered:Q};return E&&(ft.style=E),y&&(ft.runs=y),ft}if(h==="table"){const j={type:"table",table:(f==null?void 0:f.table)||{}};return E&&(j.style=E),y&&(j.runs=y),j}if(h==="figure"){const j={type:"figure",figure:(f==null?void 0:f.figure)||{}};return E&&(j.style=E),y&&(j.runs=y),j}const B={type:"paragraph",text:String((f==null?void 0:f.text)||"")};return E&&(B.style=E),y&&(B.runs=y),B}function vs(f){const h=String((f==null?void 0:f.type)||"paragraph").toLowerCase(),E=f!=null&&f.style?`:style=${JSON.stringify((f==null?void 0:f.style)||{})}`:"",y=f!=null&&f.runs?`:runs=${JSON.stringify((f==null?void 0:f.runs)||[])}`:"";return h==="list"?`list:${JSON.stringify((f==null?void 0:f.items)||[])}:${!!(f!=null&&f.ordered)}${E}`:h==="table"?`table:${JSON.stringify((f==null?void 0:f.table)||{})}${E}`:h==="figure"?`figure:${JSON.stringify((f==null?void 0:f.figure)||{})}${E}`:`paragraph:${String((f==null?void 0:f.text)||"")}${E}${y}`}function u(f,h){var B;if(!f||!h)return null;const E=Re(f),y=Re(h);if(E.length!==y.length)return null;for(let j=0;j<E.length;j++)if(fs(E[j])!==fs(y[j])||!((B=E[j])!=null&&B.id))return null;const x=[];for(let j=0;j<E.length;j++){const Q=E[j],ft=y[j],ce=Array.isArray(Q==null?void 0:Q.blocks)?Q.blocks:[],Vt=Array.isArray(ft==null?void 0:ft.blocks)?ft.blocks:[],Jt=ce.map(Ct=>String((Ct==null?void 0:Ct.id)||"")).filter(Boolean),Ce=Vt.map(Ct=>String((Ct==null?void 0:Ct.id)||"")).filter(Boolean),mt=new Set(Jt),Tr=new Set(Ce),lr=new Map(ce.map(Ct=>[String((Ct==null?void 0:Ct.id)||""),Ct]));for(const Ct of Jt)Tr.has(Ct)||x.push({op:"delete",target_id:Ct});const _n=Ce.filter(Ct=>mt.has(Ct)),Jn=Jt.filter(Ct=>Tr.has(Ct));_n.forEach((Ct,Wn)=>{const An=Jn.indexOf(Ct);An!==-1&&An!==Wn&&(x.push({op:"move",target_id:Ct,parent_id:String(Q.id),index:Wn}),Jn.splice(An,1),Jn.splice(Wn,0,Ct))}),Vt.forEach((Ct,Wn)=>{const An=String((Ct==null?void 0:Ct.id)||"");if(An&&mt.has(An)){const Zr=lr.get(An);Zr&&vs(Zr)!==vs(Ct)&&x.push({op:"update",target_id:An,payload:ds(Ct)});return}const Li=ds(Ct);x.push({op:"insert",parent_id:String(Q.id),index:Wn,payload:Li})})}return x}async function v(){const f=r();if(f)try{if(i()&&!s()&&Te){const E=u(Te,i());if(E&&E.length>0){const y=await fetch(`/api/doc/${f}/doc_ir/ops`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ops:E})});if(y.ok){const x=await y.json();if(x.doc_ir&&typeof x.doc_ir=="object"&&(ge.set(x.doc_ir),de.set(!1),Te=x.doc_ir),x.text){const B=String(x.text||"");ve.set(B),A(xe,B)}else A(xe,n());kt("已保存","ok");return}}else if(E&&E.length===0){A(xe,n()),Te=i();return}}const h={text:n()};!s()&&i()&&(h.doc_ir=i()),await fetch(`/api/doc/${f}/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)}),A(xe,n()),!s()&&i()?Te=i():Te=null,kt("已保存","ok")}catch(h){kt(`保存失败: ${h instanceof Error?h.message:"未知错误"}`,"error")}}function g(f){if(!f)return"";try{return new Date(f*1e3).toLocaleString()}catch{return String(f)}}function S(f){if(!f||typeof f!="object")return"";const h=Number(f.insert||0),E=Number(f.delete||0),y=Number(f.replace||0),x=[];return h&&x.push(`新增${h}`),y&&x.push(`修改${y}`),E&&x.push(`删除${E}`),x.join(" / ")}function C(f){const h=[];let E=null;return f.forEach(y=>{const x=Array.isArray(y==null?void 0:y.tags)?y.tags:[];((y==null?void 0:y.kind)||(x.includes("major")?"major":x.includes("minor")?"minor":""))==="major"||!E?(E={major:y,minors:[]},h.push(E)):E.minors.push(y)}),h}async function D(){if(r()){A(ir,!0),A(or,"");try{const f=await fetch(`/api/doc/${r()}/version/log?branch=main&limit=50`);if(!f.ok)throw new Error(await f.text());const h=await f.json();kr=Array.isArray(h.versions)?h.versions:[],A(sr,C(kr))}catch(f){A(or,f instanceof Error?f.message:"加载失败")}finally{A(ir,!1)}}}async function F(){if(!r())return;const f=l(Xe).trim()||"定稿版本";try{const h=await fetch(`/api/doc/${r()}/version/commit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:f,author:"user",kind:"major"})});if(!h.ok)throw new Error(await h.text());A(Xe,""),await D(),kt("已提交版本","ok")}catch(h){kt(`提交失败: ${h instanceof Error?h.message:"未知错误"}`,"error")}}async function H(f){if(!(!r()||!f))try{const h=await fetch(`/api/doc/${r()}/version/checkout`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({version_id:f})});if(!h.ok)throw new Error(await h.text());const E=await h.json(),y=String(E.doc_text||"");Wr(y),A(xe,y),await D(),kt("已切换版本","ok")}catch(h){kt(`切换失败: ${h instanceof Error?h.message:"未知错误"}`,"error")}}async function V(f,h){if(!(!r()||!f||!h)){A(De,"");try{const E=await fetch(`/api/doc/${r()}/version/diff?from_version=${f}&to_version=${h}`);if(!E.ok)throw new Error(await E.text());const y=await E.json(),x=Array.isArray(y.diff)?y.diff:[];A(De,x.join(`
`))}catch(E){A(De,E instanceof Error?E.message:"对比失败")}}}async function N(f){if(!f)return;const h=kr.find(E=>E.is_current);!h||h.version_id===f||await V(h.version_id,f)}function R(){r()&&(kt("正在生成PDF...","info"),window.location.href=`/download/${r()}.pdf`)}function J(f){A(Ht,!1),window.location.href=`/workbench/${f}`}function U(){r()&&(kt("正在生成Word文档...","info"),window.location.href=`/download/${r()}.docx`)}async function X(f){var E;if(o())return;const h=String(f||"").trim();if(h){if(!r()){const y="缺少文档ID，请刷新或从 /workbench/{id} 进入";Ze.set(`已中止: ${y}`),ye("中止",y,new Date().toLocaleTimeString()),kt(y,"info");return}zr+=1,Fe(),fr("user",h),oi.set(""),Ns.set(!0),de.set(!0),G=!0,ni.set("分析"),Ze.set("生成中…"),dt=Date.now(),jt="",ut="",Ft=!1,Nt=!1,Rt=!1,At=Date.now(),pe=!1,A(Pt,{current:0,total:0,percent:0,etaS:0,section:""}),Xt=Date.now(),Se=[],zt=0,A(Dt,[]),ye("启动","开始生成",new Date().toLocaleTimeString()),P=new AbortController,Ts.set(!1),Mt&&clearInterval(Mt),Mt=setInterval(()=>{if(!o())return;const y=Date.now()-At,x=Se.length>0?Math.round(Se.reduce((Q,ft)=>Q+ft,0)/Se.length):0;let B=Math.max(pt,x*6||0,zt*3||0,9e4);B=Math.min(6e5,B),(/model preparing/i.test(ut)||/解析中/.test(ut)||jt==="analysis")&&(B=Math.max(B,18e4)),y>B&&!pe&&(pe=!0,P==null||P.abort(`客户端超时：${Math.round(y/1e3)}秒无事件，切换非流式生成`))},1e3);try{if(await us(`/api/doc/${r()}/generate/stream`,{instruction:h,text:n()||""},(y,x)=>{const B=Date.now();if(jt=String(y||""),At>0&&(It=B-At,It>0&&It<12e4&&(Se=[...Se,It].slice(-8)),It>zt&&It<6e5&&(zt=It)),At=B,y==="state"){const j=ar(String(x.name||""));ni.set(j||c()),ye("流程",j,Kt());return}if(y==="delta"){const j=String(x.delta||"").trim();j&&(Ze.set(j),ut=j,ye("进度",j,Kt()));return}if(y==="plan"){const j=String(x.title||"自动生成文档"),Q=Array.isArray(x.sections)?x.sections:[];ye("大纲",`标题：${j}；章节：${Q.join(" / ")}`,Kt());const ft=as(n(),j,Q);ve.set(ft),Le(ft);return}if(y==="section"){if(String(x.phase||"")==="delta"){Rt=!0;const j=String(x.block_id||""),Q=String(x.section||""),ft=String(x.block_type||"");if(j){lo(Q,j);return}const ce=String(x.delta||"");ce&&is(Q,ce,{raw:!Q&&!ft})}return}if(y==="progress"){const j=Number(x.current||0),Q=Number(x.total||0),ft=Number(x.percent||0),ce=String(x.section||""),Vt=Number(x.elapsed_s||0);if(Xt===0&&(Xt=Date.now()),j>0){const Ce=(Vt>0?Vt:Math.max(1,Math.round((Date.now()-Xt)/1e3)))/j,mt=Math.max(0,Math.round(Ce*Math.max(0,Q-j)));A(Pt,{current:j,total:Q,percent:ft,etaS:mt,section:ce})}else A(Pt,{current:j,total:Q,percent:ft,etaS:0,section:ce});return}if(y==="section_error"){const j=String(x.section||""),Q=String(x.reason||"unknown");j&&(A(Dt,[...l(Dt),{section:j,reason:Q}]),kt(`章节失败: ${j}`,"bad"));return}if(y==="analysis"){const j=String(x.summary||""),Q=Array.isArray(x.steps)?x.steps:[],ft=Array.isArray(x.missing)?x.missing:[];if(Of.set(j||"等待解析…"),Lf.set(Q),Ff.set(ft),ye("解析",j||"解析完成",Kt()),x.raw){const ce=JSON.stringify(x.raw,null,2).slice(0,600);ye("解析JSON",ce,Kt())}return}if(y==="final"){const j=String(x.text||"");if(Rt){const Q=x.doc_ir&&typeof x.doc_ir=="object"?x.doc_ir:null;ss(j,Q)}else{const Q=x.doc_ir&&typeof x.doc_ir=="object"?x.doc_ir:null;os(j,{finalDocIr:Q})}Ze.set("完成"),ni.set("完成"),Ft=!0,fr("system","已完成生成。"),ye("完成","生成完成",Kt()),kt("生成完成","ok"),v().catch(()=>{});return}if(y==="error"){const j=String(x.message||x.reason||x.detail||"服务端未返回具体原因"),ft=String(x.code||x.type||"").toLowerCase().includes("abort")||/aborted|stopped|取消|中止/i.test(j);Nt=!0,Ze.set(ft?`已中止: ${j}`:`生成失败: ${j}`),fr("system",j),ye(ft?"中止":"错误",j,Kt()),kt(j,ft?"info":"bad")}},P.signal),!Ft&&!Nt){const y=ut?`流式结束但未完成，最后进度: ${ut}`:jt?`流式结束但未完成，最后事件: ${jt}`:"流式结束但未完成，服务端未返回原因";Ze.set(`已中止: ${y}`),fr("system",y),ye("中止",y,Kt()),kt(y,"info")}}catch(y){if(String((y==null?void 0:y.name)||"")==="AbortError"){const x=((E=P==null?void 0:P.signal)==null?void 0:E.reason)||(y==null?void 0:y.message)||"用户中止";if(String(x).includes("切换非流式生成")){ye("中止",String(x),Kt()),kt(String(x),"info");try{const B=await fetch(`/api/doc/${r()}/generate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({instruction:h,text:n()||""})});if(!B.ok){const ft=await B.text();throw new Error(`HTTP ${B.status}: ${ft||B.statusText}`)}const j=await B.json(),Q=String(j.text||"");if(Rt){const ft=j.doc_ir&&typeof j.doc_ir=="object"?j.doc_ir:null;ss(Q,ft)}else{const ft=j.doc_ir&&typeof j.doc_ir=="object"?j.doc_ir:null;os(Q,{finalDocIr:ft})}Ze.set("完成"),ni.set("完成"),fr("system","已完成生成（非流式兜底）。"),ye("完成","非流式生成完成",Kt()),kt("生成完成（非流式）","ok"),v().catch(()=>{})}catch(B){const j=(B==null?void 0:B.message)||"非流式生成失败";Ze.set(`生成失败: ${j}`),fr("system",j),ye("错误",String(j),Kt()),kt(String(j),"bad")}}else Ze.set(`已中止: ${x}`),fr("system",`已中止生成：${x}`),ye("中止",String(x),Kt()),kt(String(x),"info")}else{const x=(y==null?void 0:y.message)||"生成失败，请检查模型是否运行。";Ze.set(`生成失败: ${x}`),fr("system",x),ye("错误",String(x),Kt()),kt(String(x),"bad")}}finally{if(Ns.set(!1),Ts.set(!1),G=!1,et&&(clearTimeout(et),et=null),Mt&&(clearInterval(Mt),Mt=null),zt>0&&typeof localStorage<"u"){const y=Math.min(6e5,Math.max(pt,zt*3,9e4));pt=y;try{localStorage.setItem("wa_idle_base_ms",String(y))}catch{}}P=null}}}function rt(){P&&P.abort("用户点击停止")}function lt(f){zo.set(f)}ts(()=>{const f=localStorage.getItem("darkMode")==="true";el.set(f),f&&document.body.classList.add("dark");const h=localStorage.getItem("wa_idle_base_ms");if(h){const x=Number(h);Number.isFinite(x)&&x>0&&(pt=x)}Ye();const E=x=>{if(!Me)return;const B=document.querySelector(".grid");if(!B)return;const j=B.getBoundingClientRect(),Q=Math.min(Math.max(x.clientX-j.left,220),j.width-260);Math.round(Q/j.width*100)},y=()=>{Me=!1,document.body.style.cursor=""};if(window.addEventListener("mousemove",E),window.addEventListener("mouseup",y),!r()){const x=Tn();x&&(nr.set(x),uo().then(()=>Promise.all([Rf(),Bf()])).catch(()=>{}))}return()=>{window.removeEventListener("mousemove",E),window.removeEventListener("mouseup",y),l(Ke)&&clearTimeout(l(Ke))}}),Zs(()=>(n(),l(xe),o(),l(Ke)),()=>{n()&&n()!==l(xe)&&!o()&&(l(Ke)&&clearTimeout(l(Ke)),A(Ke,setTimeout(()=>{v().catch(()=>{})},3e3)))}),to();var xt={$set:vn,$on:(f,h)=>dn(e,f,h)};xr();var Yt=bv(),re=_e(Yt);let Ot;var qt=$(re),Ae=_($(qt),4),Hn=$(Ae),ps=_($(Hn),2),fo=$(ps,!0);w(ps),w(Hn);var Gr=_(Hn,2),hs=$(Gr);w(Gr);var Ai=_(Gr,2),Ci=_(Ai,2),ji=_(Ci,2),gs=_(ji,2);Ec(gs,{}),w(Ae),w(qt);var Kr=_(qt,2),Er=$(Kr),qi=_($(Er),2),ms=_(qi,2),vo=_(ms,2);w(Er);var Xr=_(Er,2),Yr=$(Xr),Qr=$(Yr),Ni=$(Qr),Ii=_(Ni,2),Mi=_(Ii,2),Di=_(Mi,2),Oi=_(Di,2),_s=_(Oi,2),bs=_(_s,2),Lt=_(bs,2),Ut=_(Lt,2);w(Qr);var le=_(Qr,2),Qt=$(le),Bt=_(Qt,2);w(le),w(Yr);var Un=_(Yr,2);{var ys=f=>{var h=rv(),E=$(h);w(h),Et(y=>gt(E,`????? ${l(Pt),Y(()=>l(Pt).current)??""}/${l(Pt),Y(()=>l(Pt).total)??""} ??${l(Pt),Y(()=>l(Pt).percent)??""}%????? ${y??""} ? ${l(Pt),Y(()=>l(Pt).etaS%60)??""} ?`),[()=>(l(Pt),Y(()=>Math.ceil(l(Pt).etaS/60)))]),z(f,h)};$t(Un,f=>{o(),l(Pt),Y(()=>o()&&l(Pt).total>0)&&f(ys)})}var ws=_(Un,2);{var Ic=f=>{var h=sv(),E=_($(h),2);Je(E,1,()=>l(Dt),sn,(y,x)=>{var B=iv(),j=$(B),Q=$(j,!0);w(j);var ft=_(j,2);w(B),Et(()=>gt(Q,(l(x),Y(()=>l(x).section)))),M("click",ft,()=>retrySection(l(x).section)),z(y,B)}),w(h),z(f,h)};$t(ws,f=>{l(Dt),Y(()=>l(Dt).length>0)&&f(Ic)})}var xa=_(ws,2),Mc=$(xa);{var Dc=f=>{Ac(f,{})},Oc=f=>{Sc(f,{showToolbar:!1,paper:!0,$$events:{blockedit:io,blockselect:so}})};$t(Mc,f=>{b()?f(Dc):f(Oc,!1)})}w(xa),w(Xr);var ka=_(Xr,2),po=$(ka),ho=$(po),Lc=_($(ho),2);w(ho);var go=_(ho,2),mo=$(go);We(mo);var Fc=_(mo,2);w(go);var $a=_(go,2);{var Rc=f=>{var h=ov();z(f,h)},Bc=f=>{var h=On(),E=_e(h);{var y=B=>{var j=av(),Q=$(j,!0);w(j),Et(()=>gt(Q,l(or))),z(B,j)},x=B=>{var j=On(),Q=_e(j);{var ft=Vt=>{var Jt=lv();z(Vt,Jt)},ce=Vt=>{var Jt=pv();Je(Jt,5,()=>l(sr),sn,(Ce,mt)=>{var Tr=vv(),lr=$(Tr),_n=$(lr),Jn=$(_n),Ct=$(Jn,!0);w(Jn);var Wn=_(Jn,2),An=$(Wn,!0);w(Wn),w(_n);var Li=_(_n,2),Zr=$(Li),Qc=$(Zr,!0);w(Zr);var ja=_(Zr,2),Zc=$(ja,!0);w(ja),w(Li);var qa=_(Li,2);{var tu=Zt=>{var Qe=cv(),te=$(Qe,!0);w(Qe),Et(ee=>gt(te,ee),[()=>(l(mt),Y(()=>{var ee;return S((ee=l(mt).major)==null?void 0:ee.summary)}))]),z(Zt,Qe)};$t(qa,Zt=>{l(mt),Y(()=>{var Qe;return S((Qe=l(mt).major)==null?void 0:Qe.summary)})&&Zt(tu)})}var Na=_(qa,2),_o=$(Na),Ia=_(_o,2);w(Na),w(lr);var eu=_(lr,2);{var nu=Zt=>{var Qe=dv();Je(Qe,5,()=>(l(mt),Y(()=>l(mt).minors)),sn,(te,ee)=>{var ks=fv(),bo=$(ks),yo=$(bo),ru=$(yo,!0);w(yo);var Ma=_(yo,2);{var iu=Fi=>{var So=uv(),ou=$(So,!0);w(So),Et(au=>gt(ou,au),[()=>(l(ee),Y(()=>S(l(ee).summary)))]),z(Fi,So)};$t(Ma,Fi=>{l(ee),Y(()=>S(l(ee).summary))&&Fi(iu)})}var Da=_(Ma,2),su=$(Da,!0);w(Da),w(bo);var Oa=_(bo,2),wo=$(Oa),La=_(wo,2);w(Oa),w(ks),Et(Fi=>{Xn(ks,1,(l(ee),Y(()=>`version-minor ${l(ee).is_current?"current":""}`)),"svelte-1n46o8q"),gt(ru,(l(ee),Y(()=>l(ee).message||"????"))),gt(su,Fi),wo.disabled=(l(ee),Y(()=>l(ee).is_current)),La.disabled=(l(ee),Y(()=>l(ee).is_current))},[()=>(l(ee),Y(()=>g(l(ee).timestamp)))]),M("click",wo,()=>H(l(ee).version_id)),M("click",La,()=>N(l(ee).version_id)),z(te,ks)}),w(Qe),z(Zt,Qe)};$t(eu,Zt=>{l(mt),Y(()=>l(mt).minors&&l(mt).minors.length)&&Zt(nu)})}w(Tr),Et((Zt,Qe)=>{Xn(lr,1,(l(mt),Y(()=>{var te;return`version-major ${(te=l(mt).major)!=null&&te.is_current?"current":""}`})),"svelte-1n46o8q"),gt(Ct,(l(mt),Y(()=>{var te;return((te=l(mt).major)==null?void 0:te.message)||"????"}))),Xn(Wn,1,(l(mt),Y(()=>{var te;return`badge ${((te=l(mt).major)==null?void 0:te.kind)==="major"?"major":"minor"}`})),"svelte-1n46o8q"),gt(An,(l(mt),Y(()=>{var te;return((te=l(mt).major)==null?void 0:te.kind)==="major","??"}))),gt(Qc,Zt),gt(Zc,Qe),_o.disabled=(l(mt),Y(()=>{var te;return(te=l(mt).major)==null?void 0:te.is_current})),Ia.disabled=(l(mt),Y(()=>{var te;return(te=l(mt).major)==null?void 0:te.is_current}))},[()=>(l(mt),Y(()=>{var Zt;return g(((Zt=l(mt).major)==null?void 0:Zt.timestamp)||0)})),()=>(l(mt),Y(()=>{var Zt;return String(((Zt=l(mt).major)==null?void 0:Zt.version_id)||"").slice(0,7)}))]),M("click",_o,()=>{var Zt;return H((Zt=l(mt).major)==null?void 0:Zt.version_id)}),M("click",Ia,()=>{var Zt;return N((Zt=l(mt).major)==null?void 0:Zt.version_id)}),z(Ce,Tr)}),w(Jt),z(Vt,Jt)};$t(Q,Vt=>{l(sr),Y(()=>l(sr).length===0)?Vt(ft):Vt(ce,!1)},!0)}z(B,j)};$t(E,B=>{l(or)?B(y):B(x,!1)},!0)}z(f,h)};$t($a,f=>{l(ir)?f(Rc):f(Bc,!1)})}var Ea=_($a,2),Ta=_($(Ea),2),Pc=$(Ta,!0);w(Ta),w(Ea),w(po);var Aa=_(po,2),Hc=_($(Aa),2);{var Uc=f=>{var h=gv(),E=_e(h),y=$(E,!0);w(E);var x=_(E,2);We(x);var B=_(x,2),j=$(B),Q=$(j,!0);Q.nodeValue="????",w(j);var ft=_(j,2);w(B);var ce=_(B,2);{var Vt=Jt=>{var Ce=hv(),mt=$(Ce,!0);w(Ce),Et(()=>gt(mt,l(Pn))),z(Jt,Ce)};$t(ce,Jt=>{l(Pn)&&Jt(Vt)})}Et(Jt=>{gt(y,l(Oe)||"?????"),j.disabled=Jt},[()=>(l(wt),l(hn),Y(()=>l(wt)||!l(hn).trim()))]),ke(x,()=>l(hn),Jt=>A(hn,Jt)),M("click",j,oo),M("click",ft,()=>{A(hn,"")}),z(f,h)},Jc=f=>{var h=mv();z(f,h)};$t(Hc,f=>{l(En)?f(Uc):f(Jc,!1)})}w(Aa),w(ka),w(Kr);var Ss=_(Kr,2),xs=$(Ss),Wc=$(xs,!0);Wc.nodeValue="????",w(xs);var zc=_(xs,2);{var Vc=f=>{uc(f,{variant:"assistant",$$events:{send:h=>X(h.detail)}})};$t(zc,f=>{l(Gt)&&f(Vc)})}w(Ss);var Gc=_(Ss,2);{var Kc=f=>{Cc(f,{indeterminate:!0})};$t(Gc,f=>{o()&&f(Kc)})}w(re);var Ca=_(re,2);xc(Ca,{get open(){return l(Bn)},get docId(){return r()},$$events:{close:()=>A(Bn,!1),insert:f=>ao(f.detail.spec)}});var Xc=_(Ca,2);jc(Xc,{children:(f,h)=>{var E=_v(),y=_e(E);kc(y,{});var x=_(y,2);Tc(x,{onSelect:J,get visible(){return l(Ht)},set visible(j){A(Ht,j)},$$legacy:!0});var B=_(x,2);qc(B,{get visible(){return l(pn)},set visible(j){A(pn,j)},$$legacy:!0}),z(f,E)},$$slots:{default:!0}}),Et(()=>{Ot=Xn(re,1,"app svelte-1n46o8q",null,Ot,{dark:a()}),gt(fo,d()||"???"),gt(hs,`?? ${p()??""}`),Qt.disabled=o(),Bt.disabled=!o(),gt(Pc,l(De)||"?????????"),Xn(Ss,1,`assistant-dock ${l(Gt)?"open":""}`,"svelte-1n46o8q")}),M("click",Ai,v),M("click",Ci,U),M("click",ji,R),M("click",qi,()=>A(Bn,!0)),M("click",ms,()=>A(pn,!0)),M("click",vo,()=>A(Ht,!0)),M("click",Ni,()=>lt("bold")),M("click",Ii,()=>lt("italic")),M("click",Mi,()=>lt("underline")),M("click",Di,()=>lt("heading1")),M("click",Oi,()=>lt("heading2")),M("click",_s,()=>lt("list-bullet")),M("click",bs,()=>lt("list-number")),M("click",Lt,()=>lt("table")),M("click",Ut,()=>lt("image")),M("click",Qt,()=>X(m())),M("click",Bt,rt),M("click",Lc,D),ke(mo,()=>l(Xe),f=>A(Xe,f)),M("click",Fc,F),M("click",xs,()=>A(Gt,!l(Gt))),z(t,Yt);var Yc=Ge(xt);return q(),Yc}const ol=document.getElementById("app");ol&&new Nc({target:ol});
