# 写作系统优化设计（草案）

## 目标
- 1 分钟内生成一版完整报告（可迭代优化）
- 偏学术写作风格，尽量保留引用原文与来源
- 低成本优先：小模型并行 + 强模型收敛

## 总体思路
用“分工 + 缓存 + 检索 + 轻量修订”的流程替代“单模型全量生成”。  
核心是将高成本模型的参与范围缩小到“统筹与润色”，并尽量复用可用文本。

## 模型分工（建议）
- **qwen2.5:3b**：主草稿模型，负责主体段落与核心论证。
- **qwen2.5:1.5b**：资料整理/引用摘要/补充段落，不写全篇草稿。
- **qwen2.5:7b**：统筹修订（结构统一、逻辑衔接、语言润色、引用格式）。
- **bge-m3**：向量化检索（引用库/网络文本相似度与去重）。

> 并行建议：3b + 1.5b 并行，但任务拆分不同，避免“双草稿合并成本”。

## 生成流程（建议）
1. **需求解析**  
   - 提取主题、目标体裁、长度、限制条件、引用偏好。
2. **检索与引用库查找**  
   - 先查“引用库”（本地高频段落/标准表述）。  
   - 再进行在线检索抓取摘要与关键段落。
3. **大纲生成（低成本）**  
   - 由 1.5b 输出结构化提纲与段落要点。
4. **草稿生成（并行）**  
   - 3b 根据提纲生成主干正文。  
   - 1.5b 负责补充：背景、定义、相关工作、引用摘要。
5. **统筹修订（7b 小范围）**  
   - 仅处理：标题、摘要、关键段落衔接、学术语气、引用格式。
6. **引用与格式整理**  
   - 输出参考文献列表与文中标注（统一格式）。

## 引用库设计（Redis / MySQL）
### 适用场景
高频出现的学术表达、经典定义、通用背景介绍、模板段落。

### 基础字段
- `id`（主键）
- `text`（原文段落）
- `source_url`（来源）
- `source_title`
- `source_time`
- `topic_tags`（主题标签）
- `embedding`（向量）
- `hash`（去重）
- `usage_count`
- `last_used_at`

### 检索策略
- 优先走向量检索（相似度阈值）
- 同时做 `hash` 去重与重复度控制
- 按主题标签做快速过滤（MySQL 索引）

## 在线获取文本策略
1. 允许全来源，但保留原文引用与链接。
2. 仅抓取与主题强相关的段落，控制引用比例。
3. 对抓取内容做“引用预算控制”（例如 30% 以内）。

## 速度优化策略
- **缩小 7b 的工作量**：只让其改关键段落和文首/文末。
- **分块并行**：不同段落/模块并行生成，最后统一拼接。
- **缓存**：命中引用库可直接使用，无需模型生成。
- **短上下文**：限制输入长度，尽量用“摘要 + 引用库”替代全文。

## 质量控制
- 引用一致性检查：文中标注与参考文献一致。
- 逻辑一致性：章节顺序、因果关系、概念前后一致。
- 学术语气：避免口语化与营销语气。

## 1 分钟目标的现实约束
若本机只有 CPU 或显存不足，1 分钟目标需要：
- 7b 修订范围极小（只处理 2-3 个关键段落）。
- 主体草稿主要由 3b 输出。
- 缓存命中率高（引用库与检索复用）。

## 可选增强（后续）
- 增加“重写器”：对低质量段落进行局部再生成。
- 引用可信度评分：优先学术来源或高质量站点。
- 本地全文索引：将常用领域资料提前入库。

## 风险与注意事项
- 引用过多导致拼贴感，需限制比例并进行语义串联。
- 多模型输出风格不一致，需要 7b 做统一修订。
- 在线抓取内容需要明确保留来源，避免版权风险。

## 建议落地顺序
1. 引用库 + 去重检索（提高命中率）
2. 模型分工与并行结构
3. 7b 收敛策略（小范围修订）
4. 在线抓取规范与引用格式

