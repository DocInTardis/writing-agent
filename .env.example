# 写作Agent环境变量配置示例
# 复制此文件为 .env 并按需修改

# ============================================
# Ollama配置
# ============================================
# 是否启用Ollama (1=启用, 0=禁用)
WRITING_AGENT_USE_OLLAMA=1

# Ollama服务地址
OLLAMA_HOST=http://127.0.0.1:11434

# 默认模型 (自动检测优先级: 7b > 3b > 1.5b > 0.5b)
# OLLAMA_MODEL=qwen2.5:7b

# ============================================
# 并发与性能配置
# ============================================
# 并发worker数量 (建议: CPU核心数-2, 默认12)
WRITING_AGENT_WORKERS=12

# 章节生成超时时间(秒, 默认60)
WRITING_AGENT_SECTION_TIMEOUT_S=60

# 规划阶段超时时间(秒, 默认20)
WRITING_AGENT_PLAN_TIMEOUT_S=20

# 分析阶段超时时间(秒, 默认12)
WRITING_AGENT_ANALYSIS_TIMEOUT_S=12

# SSE流事件超时(秒, 默认90)
WRITING_AGENT_STREAM_EVENT_TIMEOUT_S=90

# 章节级别超时(秒, 默认45)
WRITING_AGENT_STREAM_SECTION_TIMEOUT_S=45

# 整体生成超时(秒, 默认180)
WRITING_AGENT_STREAM_MAX_S=180

# ============================================
# 内容生成配置
# ============================================
# 字数硬限制模式 (1=硬限制截断, 0=软限制自然结束, 默认0)
WRITING_AGENT_HARD_MAX=0

# 目标字数浮动比例 (默认0.15, 即+15%)
WRITING_AGENT_TARGET_MARGIN=0.15

# 是否启用RAG检索 (1=启用, 0=禁用, 默认1-自动启用)
WRITING_AGENT_EVIDENCE_ENABLED=1

# RAG自动补充最小论文数（低于此数自动抓取，默认5）
WRITING_AGENT_RAG_MIN_PAPERS=5

# RAG查询缓存（1=启用, 0=禁用, 默认1）
WRITING_AGENT_RAG_CACHE=1

# ============================================
# 系统资源配置
# ============================================
# CPU高压阈值(%, 超过则降低并发, 默认85)
WRITING_AGENT_FAST_CPU=85.0

# 内存高压阈值(%, 超过则降低并发, 默认85)
WRITING_AGENT_FAST_MEM=85.0

# ============================================
# 分析配置
# ============================================
# 消息分析最大时间(秒, 默认20)
WRITING_AGENT_ANALYSIS_MAX_S=20

# ============================================
# Edit Intent Plan (Schema Parser)
# ============================================
# Enable schema-first edit planning (1=enable, 0=disable)
WRITING_AGENT_EDIT_PLAN_ENABLE=1

# Optional dedicated model for edit plan parsing
# WRITING_AGENT_EDIT_PLAN_MODEL=

# Timeout in seconds for edit plan parser model call
WRITING_AGENT_EDIT_PLAN_TIMEOUT_S=20

# Require explicit confirmation for high-risk edit plans
WRITING_AGENT_EDIT_REQUIRE_CONFIRM_HIGH=1

# Local-only parser metrics log (silent, no UI/API exposure)
WRITING_AGENT_EDIT_PLAN_METRICS_ENABLE=1
WRITING_AGENT_EDIT_PLAN_METRICS_PATH=.data/metrics/edit_plan_events.jsonl
WRITING_AGENT_EDIT_PLAN_METRICS_MAX_BYTES=2097152

# ============================================
# Incident Notification Channels (optional)
# ============================================
# Generic incident webhook
# WA_INCIDENT_WEBHOOK_URL=

# Slack incoming webhook
# WA_INCIDENT_SLACK_WEBHOOK_URL=

# Feishu bot webhook
# WA_INCIDENT_FEISHU_WEBHOOK_URL=

# Optional webhook signing key (generic webhook only)
# WA_INCIDENT_SIGNING_KEY=

# SMTP email channel
# WA_INCIDENT_EMAIL_TO=oncall@example.com
# WA_INCIDENT_EMAIL_FROM=writing-agent@example.com
# WA_INCIDENT_SMTP_HOST=smtp.example.com
# WA_INCIDENT_SMTP_PORT=587
# WA_INCIDENT_SMTP_USER=
# WA_INCIDENT_SMTP_PASSWORD=

# ============================================
# Incremental Node AI Gateway Backend
# ============================================
# Backend route: python | node
WRITING_AGENT_LLM_BACKEND=python

# Node gateway base url (required when backend=node)
# WRITING_AGENT_NODE_GATEWAY_URL=http://127.0.0.1:8787

# Canary rollout percent for node backend (0-100)
WRITING_AGENT_LLM_BACKEND_ROLLOUT_PERCENT=100

# Route key used by deterministic canary bucketing
# WRITING_AGENT_LLM_ROUTE_KEY=tenant-default

# Auto fallback to python provider when node path fails
WRITING_AGENT_NODE_GATEWAY_AUTO_FALLBACK=1

# Node gateway local runtime options
# WA_NODE_GATEWAY_MODEL=gpt-4o-mini
# WA_NODE_GATEWAY_TIMEOUT_S=60
# WA_NODE_GATEWAY_MAX_RETRIES=2
# WRITING_AGENT_NODE_FALLBACK_LOG=.data/metrics/node_backend_fallback.jsonl

# ============================================
# Idempotency Cache (local file store)
# ============================================
# TTL in seconds. <=0 disables expiration.
WRITING_AGENT_IDEMPOTENCY_TTL_S=21600

# Max cache files to keep. <=0 disables size-cap eviction.
WRITING_AGENT_IDEMPOTENCY_MAX_ENTRIES=2000

# Active sweep interval in seconds. <=0 means cleanup on every write.
WRITING_AGENT_IDEMPOTENCY_SWEEP_INTERVAL_S=60
